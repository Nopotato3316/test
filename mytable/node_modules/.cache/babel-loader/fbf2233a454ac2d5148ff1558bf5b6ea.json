{"remainingRequest":"C:\\Users\\ren\\Desktop\\test\\mytable\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\ren\\Desktop\\test\\mytable\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\ren\\Desktop\\test\\mytable\\src\\components\\mytinymce\\themes\\silver\\theme.min.js","dependencies":[{"path":"C:\\Users\\ren\\Desktop\\test\\mytable\\src\\components\\mytinymce\\themes\\silver\\theme.min.js","mtime":1633891664000},{"path":"C:\\Users\\ren\\Desktop\\test\\mytable\\babel.config.js","mtime":1634872674031},{"path":"C:\\Users\\ren\\Desktop\\test\\mytable\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\ren\\Desktop\\test\\mytable\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\ren\\Desktop\\test\\mytable\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF90eXBlb2YgPSByZXF1aXJlKCJDOi9Vc2Vycy9yZW4vRGVza3RvcC90ZXN0L215dGFibGUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mIikuZGVmYXVsdDsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZnJvbS5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zZWFyY2guanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubWF0Y2guanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZnJlZXplLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmcuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci50by1maXhlZC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5maXhlZC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmFuY2hvci5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuY29uc3RydWN0b3IuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5nbG9iYWwtdGhpcy5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5pbW1lZGlhdGUuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubGluay5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5kZXNjcmlwdGlvbi5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnVpbnQ4LWFycmF5LmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuY29weS13aXRoaW4uanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5ldmVyeS5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbGwuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maWx0ZXIuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmluZC1pbmRleC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZvci1lYWNoLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaW5jbHVkZXMuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pbmRleC1vZi5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lml0ZXJhdG9yLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuam9pbi5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lmxhc3QtaW5kZXgtb2YuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5tYXAuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZWR1Y2UuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZWR1Y2UtcmlnaHQuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZXZlcnNlLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2V0LmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2xpY2UuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zb21lLmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc29ydC5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnN1YmFycmF5LmpzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudG8tbG9jYWxlLXN0cmluZy5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnRvLXN0cmluZy5qcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwuanMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLXNlYXJjaC1wYXJhbXMuanMiKTsKCi8qKgogKiBDb3B5cmlnaHQgKGMpIFRpbnkgVGVjaG5vbG9naWVzLCBJbmMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBMR1BMIG9yIGEgY29tbWVyY2lhbCBsaWNlbnNlLgogKiBGb3IgTEdQTCBzZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi4KICogRm9yIGNvbW1lcmNpYWwgbGljZW5zZXMgc2VlIGh0dHBzOi8vd3d3LnRpbnkuY2xvdWQvCiAqCiAqIFZlcnNpb246IDUuMTAuMCAoMjAyMS0xMC0xMSkKICovCiFmdW5jdGlvbiAoKSB7CiAgInVzZSBzdHJpY3QiOwoKICBmdW5jdGlvbiB0KG8pIHsKICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gZSA9IF90eXBlb2YobiA9IHQpLCAobnVsbCA9PT0gbiA/ICJudWxsIiA6ICJvYmplY3QiID09IGUgJiYgKEFycmF5LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKG4pIHx8IG4uY29uc3RydWN0b3IgJiYgIkFycmF5IiA9PT0gbi5jb25zdHJ1Y3Rvci5uYW1lKSA/ICJhcnJheSIgOiAib2JqZWN0IiA9PSBlICYmIChTdHJpbmcucHJvdG90eXBlLmlzUHJvdG90eXBlT2YobikgfHwgbi5jb25zdHJ1Y3RvciAmJiAiU3RyaW5nIiA9PT0gbi5jb25zdHJ1Y3Rvci5uYW1lKSA/ICJzdHJpbmciIDogZSkgPT09IG87CiAgICAgIHZhciBuLCBlOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIG4obikgewogICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBfdHlwZW9mKHQpID09PSBuOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIGUobikgewogICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBuID09PSB0OwogICAgfTsKICB9CgogIGZ1bmN0aW9uIGcodCkgewogICAgcmV0dXJuIG51bGwgPT0gdDsKICB9CgogIGZ1bmN0aW9uIGYodCwgbikgewogICAgaWYgKGModCkpIHsKICAgICAgZm9yICh2YXIgZSA9IDAsIG8gPSB0Lmxlbmd0aDsgZSA8IG87ICsrZSkgewogICAgICAgIGlmICghbih0W2VdKSkgcmV0dXJuOwogICAgICB9CgogICAgICByZXR1cm4gMTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHN0KCkge30KCiAgZnVuY3Rpb24gcihlLCBvKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICBmb3IgKHZhciB0ID0gW10sIG4gPSAwOyBuIDwgYXJndW1lbnRzLmxlbmd0aDsgbisrKSB7CiAgICAgICAgdFtuXSA9IGFyZ3VtZW50c1tuXTsKICAgICAgfQoKICAgICAgcmV0dXJuIGUoby5hcHBseShudWxsLCB0KSk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gcnQodCkgewogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHQ7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gaCh0KSB7CiAgICByZXR1cm4gdDsKICB9CgogIGZ1bmN0aW9uIHYodCwgbikgewogICAgcmV0dXJuIHQgPT09IG47CiAgfQoKICB2YXIgeSA9IHQoInN0cmluZyIpLAogICAgICB4ID0gdCgib2JqZWN0IiksCiAgICAgIGMgPSB0KCJhcnJheSIpLAogICAgICBiID0gZShudWxsKSwKICAgICAgdyA9IG4oImJvb2xlYW4iKSwKICAgICAgRSA9IGUodm9pZCAwKSwKICAgICAgZCA9IGZ1bmN0aW9uIGQodCkgewogICAgcmV0dXJuICFnKHQpOwogIH0sCiAgICAgIG0gPSBuKCJmdW5jdGlvbiIpLAogICAgICB1ID0gbigibnVtYmVyIik7CgogIGZ1bmN0aW9uIFMobykgewogICAgZm9yICh2YXIgciA9IFtdLCB0ID0gMTsgdCA8IGFyZ3VtZW50cy5sZW5ndGg7IHQrKykgewogICAgICByW3QgLSAxXSA9IGFyZ3VtZW50c1t0XTsKICAgIH0KCiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICBmb3IgKHZhciB0ID0gW10sIG4gPSAwOyBuIDwgYXJndW1lbnRzLmxlbmd0aDsgbisrKSB7CiAgICAgICAgdFtuXSA9IGFyZ3VtZW50c1tuXTsKICAgICAgfQoKICAgICAgdmFyIGUgPSByLmNvbmNhdCh0KTsKICAgICAgcmV0dXJuIG8uYXBwbHkobnVsbCwgZSk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gQyhuKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuICFuKHQpOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIGsodCkgewogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKHQpOwogICAgfTsKICB9CgogIHZhciBPID0gcnQoITEpLAogICAgICBfID0gcnQoITApLAogICAgICBvID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoInRpbnltY2UuVGhlbWVNYW5hZ2VyIiksCiAgICAgIF9sdCA9IGZ1bmN0aW9uIGx0KCkgewogICAgcmV0dXJuIChfbHQgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0KSB7CiAgICAgIGZvciAodmFyIG4sIGUgPSAxLCBvID0gYXJndW1lbnRzLmxlbmd0aDsgZSA8IG87IGUrKykgewogICAgICAgIGZvciAodmFyIHIgaW4gbiA9IGFyZ3VtZW50c1tlXSkgewogICAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG4sIHIpICYmICh0W3JdID0gbltyXSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdDsKICAgIH0pLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKCiAgZnVuY3Rpb24gcyh0LCBuKSB7CiAgICB2YXIgZSA9IHt9OwoKICAgIGZvciAociBpbiB0KSB7CiAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCByKSAmJiBuLmluZGV4T2YocikgPCAwICYmIChlW3JdID0gdFtyXSk7CiAgICB9CgogICAgaWYgKG51bGwgIT0gdCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSBmb3IgKHZhciBvID0gMCwgciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHModCk7IG8gPCByLmxlbmd0aDsgbysrKSB7CiAgICAgIG4uaW5kZXhPZihyW29dKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHQsIHJbb10pICYmIChlW3Jbb11dID0gdFtyW29dXSk7CiAgICB9CiAgICByZXR1cm4gZTsKICB9CgogIGZ1bmN0aW9uIEgodCwgbiwgZSkgewogICAgaWYgKGUgfHwgMiA9PT0gYXJndW1lbnRzLmxlbmd0aCkgZm9yICh2YXIgbywgciA9IDAsIGkgPSBuLmxlbmd0aDsgciA8IGk7IHIrKykgewogICAgICAhbyAmJiByIGluIG4gfHwgKChvID0gbyB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChuLCAwLCByKSlbcl0gPSBuW3JdKTsKICAgIH0KICAgIHJldHVybiB0LmNvbmNhdChvIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKG4pKTsKICB9CgogIGZ1bmN0aW9uIGkoKSB7CiAgICByZXR1cm4gYTsKICB9CgogIHZhciBhID0gewogICAgZm9sZDogZnVuY3Rpb24gZm9sZCh0LCBuKSB7CiAgICAgIHJldHVybiB0KCk7CiAgICB9LAogICAgaXNTb21lOiBPLAogICAgaXNOb25lOiBfLAogICAgZ2V0T3I6IGgsCiAgICBnZXRPclRodW5rOiBsLAogICAgZ2V0T3JEaWU6IGZ1bmN0aW9uIGdldE9yRGllKHQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKHQgfHwgImVycm9yOiBnZXRPckRpZSBjYWxsZWQgb24gbm9uZS4iKTsKICAgIH0sCiAgICBnZXRPck51bGw6IHJ0KG51bGwpLAogICAgZ2V0T3JVbmRlZmluZWQ6IHJ0KHZvaWQgMCksCiAgICBvcjogaCwKICAgIG9yVGh1bms6IGwsCiAgICBtYXA6IGksCiAgICBlYWNoOiBzdCwKICAgIGJpbmQ6IGksCiAgICBleGlzdHM6IE8sCiAgICBmb3JhbGw6IF8sCiAgICBmaWx0ZXI6IGZ1bmN0aW9uIGZpbHRlcigpIHsKICAgICAgcmV0dXJuIGE7CiAgICB9LAogICAgdG9BcnJheTogZnVuY3Rpb24gdG9BcnJheSgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfSwKICAgIHRvU3RyaW5nOiBydCgibm9uZSgpIikKICB9OwoKICBmdW5jdGlvbiBsKHQpIHsKICAgIHJldHVybiB0KCk7CiAgfQoKICBmdW5jdGlvbiBwKHQsIG4pIHsKICAgIHJldHVybiB5dC5jYWxsKHQsIG4pOwogIH0KCiAgZnVuY3Rpb24gVCh0LCBuKSB7CiAgICBmb3IgKHZhciBlID0gMCwgbyA9IHQubGVuZ3RoOyBlIDwgbzsgZSsrKSB7CiAgICAgIGlmIChuKHRbZV0sIGUpKSByZXR1cm4gITA7CiAgICB9CgogICAgcmV0dXJuICExOwogIH0KCiAgZnVuY3Rpb24gRCh0LCBuKSB7CiAgICBmb3IgKHZhciBlID0gW10sIG8gPSAwOyBvIDwgdDsgbysrKSB7CiAgICAgIGUucHVzaChuKG8pKTsKICAgIH0KCiAgICByZXR1cm4gZTsKICB9CgogIGZ1bmN0aW9uIEIodCwgbikgewogICAgZm9yICh2YXIgZSA9IFtdLCBvID0gMDsgbyA8IHQubGVuZ3RoOyBvICs9IG4pIHsKICAgICAgdmFyIHIgPSBidC5jYWxsKHQsIG8sIG8gKyBuKTsKICAgICAgZS5wdXNoKHIpOwogICAgfQoKICAgIHJldHVybiBlOwogIH0KCiAgZnVuY3Rpb24gTSh0LCBuKSB7CiAgICBmb3IgKHZhciBlID0gdC5sZW5ndGgsIG8gPSBuZXcgQXJyYXkoZSksIHIgPSAwOyByIDwgZTsgcisrKSB7CiAgICAgIHZhciBpID0gdFtyXTsKICAgICAgb1tyXSA9IG4oaSwgcik7CiAgICB9CgogICAgcmV0dXJuIG87CiAgfQoKICBmdW5jdGlvbiBBKHQsIG4pIHsKICAgIGZvciAodmFyIGUgPSBbXSwgbyA9IFtdLCByID0gMCwgaSA9IHQubGVuZ3RoOyByIDwgaTsgcisrKSB7CiAgICAgIHZhciB1ID0gdFtyXTsKICAgICAgKG4odSwgcikgPyBlIDogbykucHVzaCh1KTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBwYXNzOiBlLAogICAgICBmYWlsOiBvCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gRih0LCBuKSB7CiAgICBmb3IgKHZhciBlID0gW10sIG8gPSAwLCByID0gdC5sZW5ndGg7IG8gPCByOyBvKyspIHsKICAgICAgdmFyIGkgPSB0W29dOwogICAgICBuKGksIG8pICYmIGUucHVzaChpKTsKICAgIH0KCiAgICByZXR1cm4gZTsKICB9CgogIGZ1bmN0aW9uIEkodCwgbywgcikgewogICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgIGZvciAodmFyIG4sIGUgPSB0Lmxlbmd0aCAtIDE7IDAgPD0gZTsgZS0tKSB7CiAgICAgICAgbiA9IHRbZV0sIHIgPSBvKHIsIG4sIGUpOwogICAgICB9CiAgICB9KHQpLCByOwogIH0KCiAgZnVuY3Rpb24gUih0LCBlLCBvKSB7CiAgICByZXR1cm4gU3QodCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgbyA9IGUobywgdCwgbik7CiAgICB9KSwgbzsKICB9CgogIGZ1bmN0aW9uIFYodCwgbikgewogICAgcmV0dXJuIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgIGZvciAodmFyIG8gPSAwLCByID0gdC5sZW5ndGg7IG8gPCByOyBvKyspIHsKICAgICAgICB2YXIgaSA9IHRbb107CiAgICAgICAgaWYgKG4oaSwgbykpIHJldHVybiB2dC5zb21lKGkpOwogICAgICAgIGlmIChlKGksIG8pKSBicmVhazsKICAgICAgfQoKICAgICAgcmV0dXJuIHZ0Lm5vbmUoKTsKICAgIH0odCwgbiwgTyk7CiAgfQoKICBmdW5jdGlvbiBQKHQsIG4pIHsKICAgIGZvciAodmFyIGUgPSAwLCBvID0gdC5sZW5ndGg7IGUgPCBvOyBlKyspIHsKICAgICAgaWYgKG4odFtlXSwgZSkpIHJldHVybiB2dC5zb21lKGUpOwogICAgfQoKICAgIHJldHVybiB2dC5ub25lKCk7CiAgfQoKICBmdW5jdGlvbiBmdCh0KSB7CiAgICBmb3IgKHZhciBuID0gW10sIGUgPSAwLCBvID0gdC5sZW5ndGg7IGUgPCBvOyArK2UpIHsKICAgICAgaWYgKCFjKHRbZV0pKSB0aHJvdyBuZXcgRXJyb3IoIkFyci5mbGF0dGVuIGl0ZW0gIiArIGUgKyAiIHdhcyBub3QgYW4gYXJyYXksIGlucHV0OiAiICsgdCk7CiAgICAgIHh0LmFwcGx5KG4sIHRbZV0pOwogICAgfQoKICAgIHJldHVybiBuOwogIH0KCiAgZnVuY3Rpb24geih0LCBuKSB7CiAgICByZXR1cm4gZnQoTSh0LCBuKSk7CiAgfQoKICBmdW5jdGlvbiBOKHQsIG4pIHsKICAgIGZvciAodmFyIGUgPSAwLCBvID0gdC5sZW5ndGg7IGUgPCBvOyArK2UpIHsKICAgICAgaWYgKCEwICE9PSBuKHRbZV0sIGUpKSByZXR1cm4gITE7CiAgICB9CgogICAgcmV0dXJuICEwOwogIH0KCiAgZnVuY3Rpb24gTCh0KSB7CiAgICB2YXIgbiA9IGJ0LmNhbGwodCwgMCk7CiAgICByZXR1cm4gbi5yZXZlcnNlKCksIG47CiAgfQoKICBmdW5jdGlvbiBXKHQsIG4pIHsKICAgIHJldHVybiBGKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiAhd3QobiwgdCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIFUodCwgbikgewogICAgZm9yICh2YXIgZSA9IHt9LCBvID0gMCwgciA9IHQubGVuZ3RoOyBvIDwgcjsgbysrKSB7CiAgICAgIHZhciBpID0gdFtvXTsKICAgICAgZVtTdHJpbmcoaSldID0gbihpLCBvKTsKICAgIH0KCiAgICByZXR1cm4gZTsKICB9CgogIGZ1bmN0aW9uIGoodCkgewogICAgcmV0dXJuIFt0XTsKICB9CgogIGZ1bmN0aW9uIEcodCwgbikgewogICAgdmFyIGUgPSBidC5jYWxsKHQsIDApOwogICAgcmV0dXJuIGUuc29ydChuKSwgZTsKICB9CgogIGZ1bmN0aW9uIFgodCwgbikgewogICAgcmV0dXJuIDAgPD0gbiAmJiBuIDwgdC5sZW5ndGggPyB2dC5zb21lKHRbbl0pIDogdnQubm9uZSgpOwogIH0KCiAgZnVuY3Rpb24gWSh0KSB7CiAgICByZXR1cm4gWCh0LCAwKTsKICB9CgogIGZ1bmN0aW9uIHEodCkgewogICAgcmV0dXJuIFgodCwgdC5sZW5ndGggLSAxKTsKICB9CgogIGZ1bmN0aW9uIEsodCwgbikgewogICAgZm9yICh2YXIgZSA9IDA7IGUgPCB0Lmxlbmd0aDsgZSsrKSB7CiAgICAgIHZhciBvID0gbih0W2VdLCBlKTsKICAgICAgaWYgKG8uaXNTb21lKCkpIHJldHVybiBvOwogICAgfQoKICAgIHJldHVybiB2dC5ub25lKCk7CiAgfQoKICBmdW5jdGlvbiBKKHQsIG4pIHsKICAgIGZvciAodmFyIGUgPSBrdCh0KSwgbyA9IDAsIHIgPSBlLmxlbmd0aDsgbyA8IHI7IG8rKykgewogICAgICB2YXIgaSA9IGVbb107CiAgICAgIG4odFtpXSwgaSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBkdCh0LCBlKSB7CiAgICByZXR1cm4gX3QodCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBrOiBuLAogICAgICAgIHY6IGUodCwgbikKICAgICAgfTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gJCh0LCBlKSB7CiAgICB2YXIgbyA9IFtdOwogICAgcmV0dXJuIEoodCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgby5wdXNoKGUodCwgbikpOwogICAgfSksIG87CiAgfQoKICBmdW5jdGlvbiBRKHQsIG4pIHsKICAgIGZvciAodmFyIGUgPSBrdCh0KSwgbyA9IDAsIHIgPSBlLmxlbmd0aDsgbyA8IHI7IG8rKykgewogICAgICB2YXIgaSA9IGVbb10sCiAgICAgICAgICB1ID0gdFtpXTsKICAgICAgaWYgKG4odSwgaSwgdCkpIHJldHVybiB2dC5zb21lKHUpOwogICAgfQoKICAgIHJldHVybiB2dC5ub25lKCk7CiAgfQoKICBmdW5jdGlvbiBaKHQpIHsKICAgIHJldHVybiAkKHQsIGgpOwogIH0KCiAgZnVuY3Rpb24gdHQodCwgbikgewogICAgcmV0dXJuIFR0KHQsIG4pID8gdnQuZnJvbSh0W25dKSA6IHZ0Lm5vbmUoKTsKICB9CgogIGZ1bmN0aW9uIG50KHQsIG4pIHsKICAgIHJldHVybiBUdCh0LCBuKSAmJiB2b2lkIDAgIT09IHRbbl0gJiYgbnVsbCAhPT0gdFtuXTsKICB9CgogIGZ1bmN0aW9uIG10KHQsIG4sIGUpIHsKICAgIHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSB2KSwgdC5leGlzdHMoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIGUodCwgbik7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGV0KHQpIHsKICAgIGZvciAodmFyIG4gPSBbXSwgZSA9IGZ1bmN0aW9uIGUodCkgewogICAgICBuLnB1c2godCk7CiAgICB9LCBvID0gMDsgbyA8IHQubGVuZ3RoOyBvKyspIHsKICAgICAgdFtvXS5lYWNoKGUpOwogICAgfQoKICAgIHJldHVybiBuOwogIH0KCiAgZnVuY3Rpb24gb3QodCwgbikgewogICAgcmV0dXJuIHQgPyB2dC5zb21lKG4pIDogdnQubm9uZSgpOwogIH0KCiAgZnVuY3Rpb24gaXQodCwgbiwgZSkgewogICAgcmV0dXJuICIiID09PSBuIHx8IHQubGVuZ3RoID49IG4ubGVuZ3RoICYmIHQuc3Vic3RyKGUsIGUgKyBuLmxlbmd0aCkgPT09IG47CiAgfQoKICBmdW5jdGlvbiB1dCh0LCBuKSB7CiAgICByZXR1cm4gLTEgIT09IHQuaW5kZXhPZihuKTsKICB9CgogIGZ1bmN0aW9uIGF0KHQpIHsKICAgIHJldHVybiAwIDwgdC5sZW5ndGg7CiAgfQoKICBmdW5jdGlvbiBjdCh0KSB7CiAgICByZXR1cm4gdm9pZCAwICE9PSB0LnN0eWxlICYmIG0odC5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGd0KHQpIHsKICAgIGlmIChudWxsID09IHQpIHRocm93IG5ldyBFcnJvcigiTm9kZSBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQiKTsKICAgIHJldHVybiB7CiAgICAgIGRvbTogdAogICAgfTsKICB9CgogIHZhciBwdCwKICAgICAgaHQgPSBmdW5jdGlvbiBodChlKSB7CiAgICBmdW5jdGlvbiB0KCkgewogICAgICByZXR1cm4gcjsKICAgIH0KCiAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgcmV0dXJuIHQoZSk7CiAgICB9CgogICAgdmFyIG8gPSBydChlKSwKICAgICAgICByID0gewogICAgICBmb2xkOiBmdW5jdGlvbiBmb2xkKHQsIG4pIHsKICAgICAgICByZXR1cm4gbihlKTsKICAgICAgfSwKICAgICAgaXNTb21lOiBfLAogICAgICBpc05vbmU6IE8sCiAgICAgIGdldE9yOiBvLAogICAgICBnZXRPclRodW5rOiBvLAogICAgICBnZXRPckRpZTogbywKICAgICAgZ2V0T3JOdWxsOiBvLAogICAgICBnZXRPclVuZGVmaW5lZDogbywKICAgICAgb3I6IHQsCiAgICAgIG9yVGh1bms6IHQsCiAgICAgIG1hcDogZnVuY3Rpb24gbWFwKHQpIHsKICAgICAgICByZXR1cm4gaHQodChlKSk7CiAgICAgIH0sCiAgICAgIGVhY2g6IGZ1bmN0aW9uIGVhY2godCkgewogICAgICAgIHQoZSk7CiAgICAgIH0sCiAgICAgIGJpbmQ6IG4sCiAgICAgIGV4aXN0czogbiwKICAgICAgZm9yYWxsOiBuLAogICAgICBmaWx0ZXI6IGZ1bmN0aW9uIGZpbHRlcih0KSB7CiAgICAgICAgcmV0dXJuIHQoZSkgPyByIDogYTsKICAgICAgfSwKICAgICAgdG9BcnJheTogZnVuY3Rpb24gdG9BcnJheSgpIHsKICAgICAgICByZXR1cm4gW2VdOwogICAgICB9LAogICAgICB0b1N0cmluZzogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuICJzb21lKCIgKyBlICsgIikiOwogICAgICB9CiAgICB9OwogICAgcmV0dXJuIHI7CiAgfSwKICAgICAgdnQgPSB7CiAgICBzb21lOiBodCwKICAgIG5vbmU6IGksCiAgICBmcm9tOiBmdW5jdGlvbiBmcm9tKHQpIHsKICAgICAgcmV0dXJuIG51bGwgPT0gdCA/IGEgOiBodCh0KTsKICAgIH0KICB9LAogICAgICBidCA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgICAgeXQgPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZiwKICAgICAgeHQgPSBBcnJheS5wcm90b3R5cGUucHVzaCwKICAgICAgd3QgPSBmdW5jdGlvbiB3dCh0LCBuKSB7CiAgICByZXR1cm4gLTEgPCBwKHQsIG4pOwogIH0sCiAgICAgIFN0ID0gZnVuY3Rpb24gU3QodCwgbikgewogICAgZm9yICh2YXIgZSA9IDAsIG8gPSB0Lmxlbmd0aDsgZSA8IG87IGUrKykgewogICAgICBuKHRbZV0sIGUpOwogICAgfQogIH0sCiAgICAgIEN0ID0gbShBcnJheS5mcm9tKSA/IEFycmF5LmZyb20gOiBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIGJ0LmNhbGwodCk7CiAgfSwKICAgICAga3QgPSBPYmplY3Qua2V5cywKICAgICAgT3QgPSBPYmplY3QuaGFzT3duUHJvcGVydHksCiAgICAgIF90ID0gZnVuY3Rpb24gX3QodCwgbykgewogICAgdmFyIHIgPSB7fTsKICAgIHJldHVybiBKKHQsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHZhciBlID0gbyh0LCBuKTsKICAgICAgcltlLmtdID0gZS52OwogICAgfSksIHI7CiAgfSwKICAgICAgVHQgPSBmdW5jdGlvbiBUdCh0LCBuKSB7CiAgICByZXR1cm4gT3QuY2FsbCh0LCBuKTsKICB9LAogICAgICBFdCA9IGZ1bmN0aW9uIEV0KHQsIG4sIGUpIHsKICAgIHJldHVybiB0LmlzU29tZSgpICYmIG4uaXNTb21lKCkgPyB2dC5zb21lKGUodC5nZXRPckRpZSgpLCBuLmdldE9yRGllKCkpKSA6IHZ0Lm5vbmUoKTsKICB9LAogICAgICBEdCA9IGZ1bmN0aW9uIER0KHQsIG4pIHsKICAgIHJldHVybiBpdCh0LCBuLCAwKTsKICB9LAogICAgICBCdCA9IGZ1bmN0aW9uIEJ0KHQsIG4pIHsKICAgIHJldHVybiBpdCh0LCBuLCB0Lmxlbmd0aCAtIG4ubGVuZ3RoKTsKICB9LAogICAgICBNdCA9IChwdCA9IC9eXHMrfFxzKyQvZywgZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiB0LnJlcGxhY2UocHQsICIiKTsKICB9KSwKICAgICAgQXQgPSB7CiAgICBmcm9tSHRtbDogZnVuY3Rpb24gZnJvbUh0bWwodCwgbikgewogICAgICB2YXIgZSA9IChuIHx8IGRvY3VtZW50KS5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgaWYgKGUuaW5uZXJIVE1MID0gdCwgIWUuaGFzQ2hpbGROb2RlcygpIHx8IDEgPCBlLmNoaWxkTm9kZXMubGVuZ3RoKSB0aHJvdyBjb25zb2xlLmVycm9yKCJIVE1MIGRvZXMgbm90IGhhdmUgYSBzaW5nbGUgcm9vdCBub2RlIiwgdCksIG5ldyBFcnJvcigiSFRNTCBtdXN0IGhhdmUgYSBzaW5nbGUgcm9vdCBub2RlIik7CiAgICAgIHJldHVybiBndChlLmNoaWxkTm9kZXNbMF0pOwogICAgfSwKICAgIGZyb21UYWc6IGZ1bmN0aW9uIGZyb21UYWcodCwgbikgewogICAgICB2YXIgZSA9IChuIHx8IGRvY3VtZW50KS5jcmVhdGVFbGVtZW50KHQpOwogICAgICByZXR1cm4gZ3QoZSk7CiAgICB9LAogICAgZnJvbVRleHQ6IGZ1bmN0aW9uIGZyb21UZXh0KHQsIG4pIHsKICAgICAgdmFyIGUgPSAobiB8fCBkb2N1bWVudCkuY3JlYXRlVGV4dE5vZGUodCk7CiAgICAgIHJldHVybiBndChlKTsKICAgIH0sCiAgICBmcm9tRG9tOiBndCwKICAgIGZyb21Qb2ludDogZnVuY3Rpb24gZnJvbVBvaW50KHQsIG4sIGUpIHsKICAgICAgcmV0dXJuIHZ0LmZyb20odC5kb20uZWxlbWVudEZyb21Qb2ludChuLCBlKSkubWFwKGd0KTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiBGdCh0KSB7CiAgICByZXR1cm4gdC5kb20ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKICB9CgogIGZ1bmN0aW9uIEl0KG4pIHsKICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdC5kb20ubm9kZVR5cGUgPT09IG47CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gUnQoZSkgewogICAgdmFyIG8sCiAgICAgICAgciA9ICExOwogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgZm9yICh2YXIgdCA9IFtdLCBuID0gMDsgbiA8IGFyZ3VtZW50cy5sZW5ndGg7IG4rKykgewogICAgICAgIHRbbl0gPSBhcmd1bWVudHNbbl07CiAgICAgIH0KCiAgICAgIHJldHVybiByIHx8IChyID0gITAsIG8gPSBlLmFwcGx5KG51bGwsIHQpKSwgbzsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBWdCh0LCBuKSB7CiAgICB2YXIgZSA9IFN0cmluZyhuKS50b0xvd2VyQ2FzZSgpOwogICAgcmV0dXJuIFYodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQuc2VhcmNoKGUpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBQdChuKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHV0KHQsIG4pOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIEh0KHQpIHsKICAgIHJldHVybiB3aW5kb3cubWF0Y2hNZWRpYSh0KS5tYXRjaGVzOwogIH0KCiAgZnVuY3Rpb24genQodCwgbikgewogICAgdmFyIGUgPSB0LmRvbTsKICAgIGlmICgxICE9PSBlLm5vZGVUeXBlKSByZXR1cm4gITE7CiAgICB2YXIgbyA9IGU7CiAgICBpZiAodm9pZCAwICE9PSBvLm1hdGNoZXMpIHJldHVybiBvLm1hdGNoZXMobik7CiAgICBpZiAodm9pZCAwICE9PSBvLm1zTWF0Y2hlc1NlbGVjdG9yKSByZXR1cm4gby5tc01hdGNoZXNTZWxlY3RvcihuKTsKICAgIGlmICh2b2lkIDAgIT09IG8ud2Via2l0TWF0Y2hlc1NlbGVjdG9yKSByZXR1cm4gby53ZWJraXRNYXRjaGVzU2VsZWN0b3Iobik7CiAgICBpZiAodm9pZCAwICE9PSBvLm1vek1hdGNoZXNTZWxlY3RvcikgcmV0dXJuIG8ubW96TWF0Y2hlc1NlbGVjdG9yKG4pOwogICAgdGhyb3cgbmV3IEVycm9yKCJCcm93c2VyIGxhY2tzIG5hdGl2ZSBzZWxlY3RvcnMiKTsKICB9CgogIGZ1bmN0aW9uIE50KHQpIHsKICAgIHJldHVybiAxICE9PSB0Lm5vZGVUeXBlICYmIDkgIT09IHQubm9kZVR5cGUgJiYgMTEgIT09IHQubm9kZVR5cGUgfHwgMCA9PT0gdC5jaGlsZEVsZW1lbnRDb3VudDsKICB9CgogIGZ1bmN0aW9uIEx0KHQsIG4pIHsKICAgIHJldHVybiB0LmRvbSA9PT0gbi5kb207CiAgfQoKICBmdW5jdGlvbiBXdCh0LCBuKSB7CiAgICByZXR1cm4gc2UoKS5icm93c2VyLmlzSUUoKSA/IChlID0gdC5kb20sIG8gPSBuLmRvbSwgciA9IE5vZGUuRE9DVU1FTlRfUE9TSVRJT05fQ09OVEFJTkVEX0JZLCAwICE9IChlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKG8pICYgcikpIDogKGkgPSB0LmRvbSkgIT09ICh1ID0gbi5kb20pICYmIGkuY29udGFpbnModSk7CiAgICB2YXIgZSwgbywgciwgaSwgdTsKICB9CgogIGZ1bmN0aW9uIFV0KHQpIHsKICAgIHJldHVybiBBdC5mcm9tRG9tKHQuZG9tLm93bmVyRG9jdW1lbnQpOwogIH0KCiAgZnVuY3Rpb24ganQodCkgewogICAgcmV0dXJuIFluKHQpID8gdCA6IFV0KHQpOwogIH0KCiAgZnVuY3Rpb24gR3QodCkgewogICAgcmV0dXJuIEF0LmZyb21Eb20oanQodCkuZG9tLmRvY3VtZW50RWxlbWVudCk7CiAgfQoKICBmdW5jdGlvbiBYdCh0KSB7CiAgICByZXR1cm4gQXQuZnJvbURvbShqdCh0KS5kb20uZGVmYXVsdFZpZXcpOwogIH0KCiAgZnVuY3Rpb24gWXQodCkgewogICAgcmV0dXJuIHZ0LmZyb20odC5kb20ucGFyZW50Tm9kZSkubWFwKEF0LmZyb21Eb20pOwogIH0KCiAgZnVuY3Rpb24gcXQodCkgewogICAgcmV0dXJuIHZ0LmZyb20odC5kb20ub2Zmc2V0UGFyZW50KS5tYXAoQXQuZnJvbURvbSk7CiAgfQoKICBmdW5jdGlvbiBLdCh0KSB7CiAgICByZXR1cm4gTSh0LmRvbS5jaGlsZE5vZGVzLCBBdC5mcm9tRG9tKTsKICB9CgogIGZ1bmN0aW9uIEp0KHQsIG4pIHsKICAgIHZhciBlID0gdC5kb20uY2hpbGROb2RlczsKICAgIHJldHVybiB2dC5mcm9tKGVbbl0pLm1hcChBdC5mcm9tRG9tKTsKICB9CgogIGZ1bmN0aW9uICR0KHQsIG4pIHsKICAgIHJldHVybiB7CiAgICAgIGVsZW1lbnQ6IHQsCiAgICAgIG9mZnNldDogbgogICAgfTsKICB9CgogIGZ1bmN0aW9uIFF0KHQsIG4pIHsKICAgIHZhciBlID0gS3QodCk7CiAgICByZXR1cm4gMCA8IGUubGVuZ3RoICYmIG4gPCBlLmxlbmd0aCA/ICR0KGVbbl0sIDApIDogJHQodCwgbik7CiAgfQoKICBmdW5jdGlvbiBadCh0KSB7CiAgICByZXR1cm4gcW4odCkgJiYgZCh0LmRvbS5ob3N0KTsKICB9CgogIGZ1bmN0aW9uIHRuKHQpIHsKICAgIHJldHVybiBadCh0KSA/IHQgOiBBdC5mcm9tRG9tKGp0KHQpLmRvbS5ib2R5KTsKICB9CgogIGZ1bmN0aW9uIG5uKHQpIHsKICAgIHJldHVybiBBdC5mcm9tRG9tKHQuZG9tLmhvc3QpOwogIH0KCiAgZnVuY3Rpb24gZW4odCwgbiwgZSkgewogICAgaWYgKCEoeShlKSB8fCB3KGUpIHx8IHUoZSkpKSB0aHJvdyBjb25zb2xlLmVycm9yKCJJbnZhbGlkIGNhbGwgdG8gQXR0cmlidXRlLnNldC4gS2V5ICIsIG4sICI6OiBWYWx1ZSAiLCBlLCAiOjogRWxlbWVudCAiLCB0KSwgbmV3IEVycm9yKCJBdHRyaWJ1dGUgdmFsdWUgd2FzIG5vdCBzaW1wbGUiKTsKICAgIHQuc2V0QXR0cmlidXRlKG4sIGUgKyAiIik7CiAgfQoKICBmdW5jdGlvbiBvbih0LCBuLCBlKSB7CiAgICBlbih0LmRvbSwgbiwgZSk7CiAgfQoKICBmdW5jdGlvbiBybih0LCBuKSB7CiAgICB2YXIgZSA9IHQuZG9tLmdldEF0dHJpYnV0ZShuKTsKICAgIHJldHVybiBudWxsID09PSBlID8gdm9pZCAwIDogZTsKICB9CgogIGZ1bmN0aW9uIHVuKHQsIG4pIHsKICAgIHJldHVybiB2dC5mcm9tKHJuKHQsIG4pKTsKICB9CgogIGZ1bmN0aW9uIGFuKHQsIG4pIHsKICAgIHZhciBlID0gdC5kb207CiAgICByZXR1cm4gISghZSB8fCAhZS5oYXNBdHRyaWJ1dGUpICYmIGUuaGFzQXR0cmlidXRlKG4pOwogIH0KCiAgZnVuY3Rpb24gY24odCwgbikgewogICAgdC5kb20ucmVtb3ZlQXR0cmlidXRlKG4pOwogIH0KCiAgZnVuY3Rpb24gc24odCwgbiwgZSkgewogICAgaWYgKCF5KGUpKSB0aHJvdyBjb25zb2xlLmVycm9yKCJJbnZhbGlkIGNhbGwgdG8gQ1NTLnNldC4gUHJvcGVydHkgIiwgbiwgIjo6IFZhbHVlICIsIGUsICI6OiBFbGVtZW50ICIsIHQpLCBuZXcgRXJyb3IoIkNTUyB2YWx1ZSBtdXN0IGJlIGEgc3RyaW5nOiAiICsgZSk7CiAgICBjdCh0KSAmJiB0LnN0eWxlLnNldFByb3BlcnR5KG4sIGUpOwogIH0KCiAgZnVuY3Rpb24gbG4odCwgbikgewogICAgY3QodCkgJiYgdC5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKTsKICB9CgogIGZ1bmN0aW9uIGZuKHQsIG4sIGUpIHsKICAgIHNuKHQuZG9tLCBuLCBlKTsKICB9CgogIGZ1bmN0aW9uIGRuKHQsIG4pIHsKICAgIHZhciBlID0gdC5kb207CiAgICBKKG4sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHNuKGUsIG4sIHQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBtbih0LCBuKSB7CiAgICB2YXIgZSA9IHQuZG9tOwogICAgSihuLCBmdW5jdGlvbiAodCwgbikgewogICAgICB0LmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgIGxuKGUsIG4pOwogICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgIHNuKGUsIG4sIHQpOwogICAgICB9KTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZ24odCwgbikgewogICAgdmFyIGUgPSB0LmRvbSwKICAgICAgICBvID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZSkuZ2V0UHJvcGVydHlWYWx1ZShuKTsKICAgIHJldHVybiAiIiAhPT0gbyB8fCBoZSh0KSA/IG8gOiB5ZShlLCBuKTsKICB9CgogIGZ1bmN0aW9uIHBuKHQsIG4pIHsKICAgIHZhciBlID0gdC5kb20sCiAgICAgICAgbyA9IHllKGUsIG4pOwogICAgcmV0dXJuIHZ0LmZyb20obykuZmlsdGVyKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiAwIDwgdC5sZW5ndGg7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGhuKHQsIG4sIGUpIHsKICAgIHZhciBvID0gQXQuZnJvbVRhZyh0KTsKICAgIHJldHVybiBmbihvLCBuLCBlKSwgcG4obywgbikuaXNTb21lKCk7CiAgfQoKICBmdW5jdGlvbiB2bih0LCBuKSB7CiAgICBsbih0LmRvbSwgbiksIG10KHVuKHQsICJzdHlsZSIpLm1hcChNdCksICIiKSAmJiBjbih0LCAic3R5bGUiKTsKICB9CgogIGZ1bmN0aW9uIGJuKHQpIHsKICAgIHJldHVybiB0LmRvbS5vZmZzZXRXaWR0aDsKICB9CgogIGZ1bmN0aW9uIHluKG8sIHIpIHsKICAgIGZ1bmN0aW9uIHQodCkgewogICAgICB2YXIgbiA9IHIodCk7CgogICAgICBpZiAobiA8PSAwIHx8IG51bGwgPT09IG4pIHsKICAgICAgICB2YXIgZSA9IGduKHQsIG8pOwogICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGUpIHx8IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICAgIGZ1bmN0aW9uIGkociwgdCkgewogICAgICByZXR1cm4gUih0LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIHZhciBlID0gZ24ociwgbiksCiAgICAgICAgICAgIG8gPSB2b2lkIDAgPT09IGUgPyAwIDogcGFyc2VJbnQoZSwgMTApOwogICAgICAgIHJldHVybiBpc05hTihvKSA/IHQgOiB0ICsgbzsKICAgICAgfSwgMCk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodCwgbikgewogICAgICAgIGlmICghdShuKSAmJiAhbi5tYXRjaCgvXlswLTldKyQvKSkgdGhyb3cgbmV3IEVycm9yKG8gKyAiLnNldCBhY2NlcHRzIG9ubHkgcG9zaXRpdmUgaW50ZWdlciB2YWx1ZXMuIFZhbHVlIHdhcyAiICsgbik7CiAgICAgICAgdmFyIGUgPSB0LmRvbTsKICAgICAgICBjdChlKSAmJiAoZS5zdHlsZVtvXSA9IG4gKyAicHgiKTsKICAgICAgfSwKICAgICAgZ2V0OiB0LAogICAgICBnZXRPdXRlcjogdCwKICAgICAgYWdncmVnYXRlOiBpLAogICAgICBtYXg6IGZ1bmN0aW9uIG1heCh0LCBuLCBlKSB7CiAgICAgICAgdmFyIG8gPSBpKHQsIGUpOwogICAgICAgIHJldHVybiBvIDwgbiA/IG4gLSBvIDogMDsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIHhuKHQpIHsKICAgIHJldHVybiB4ZS5nZXQodCk7CiAgfQoKICBmdW5jdGlvbiB3bih0KSB7CiAgICByZXR1cm4geGUuZ2V0T3V0ZXIodCk7CiAgfQoKICBmdW5jdGlvbiBTbih0LCBuKSB7CiAgICByZXR1cm4gdm9pZCAwICE9PSB0ID8gdCA6IHZvaWQgMCAhPT0gbiA/IG4gOiAwOwogIH0KCiAgZnVuY3Rpb24gQ24odCkgewogICAgdmFyIG4gPSB0LmRvbS5vd25lckRvY3VtZW50LAogICAgICAgIGUgPSBuLmJvZHksCiAgICAgICAgbyA9IG4uZGVmYXVsdFZpZXcsCiAgICAgICAgciA9IG4uZG9jdW1lbnRFbGVtZW50OwogICAgaWYgKGUgPT09IHQuZG9tKSByZXR1cm4gU2UoZS5vZmZzZXRMZWZ0LCBlLm9mZnNldFRvcCk7CiAgICB2YXIgaSA9IFNuKG51bGwgPT0gbyA/IHZvaWQgMCA6IG8ucGFnZVlPZmZzZXQsIHIuc2Nyb2xsVG9wKSwKICAgICAgICB1ID0gU24obnVsbCA9PSBvID8gdm9pZCAwIDogby5wYWdlWE9mZnNldCwgci5zY3JvbGxMZWZ0KSwKICAgICAgICBhID0gU24oci5jbGllbnRUb3AsIGUuY2xpZW50VG9wKSwKICAgICAgICBjID0gU24oci5jbGllbnRMZWZ0LCBlLmNsaWVudExlZnQpOwogICAgcmV0dXJuIENlKHQpLnRyYW5zbGF0ZSh1IC0gYywgaSAtIGEpOwogIH0KCiAgZnVuY3Rpb24ga24odCkgewogICAgcmV0dXJuIGtlLmdldCh0KTsKICB9CgogIGZ1bmN0aW9uIE9uKHQpIHsKICAgIHJldHVybiBrZS5nZXRPdXRlcih0KTsKICB9CgogIGZ1bmN0aW9uIF9uKHQpIHsKICAgIGZ1bmN0aW9uIG4oKSB7CiAgICAgIHJldHVybiB0LnN0b3BQcm9wYWdhdGlvbigpOwogICAgfQoKICAgIGZ1bmN0aW9uIGUoKSB7CiAgICAgIHJldHVybiB0LnByZXZlbnREZWZhdWx0KCk7CiAgICB9CgogICAgdmFyIG8gPSByKGUsIG4pOwogICAgcmV0dXJuIHsKICAgICAgdGFyZ2V0OiBBdC5mcm9tRG9tKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaWYgKGRlKCkgJiYgZCh0LnRhcmdldCkpIHsKICAgICAgICAgIHZhciBuID0gQXQuZnJvbURvbSh0LnRhcmdldCk7CgogICAgICAgICAgaWYgKEduKG4pICYmIHBlKG4pICYmIHQuY29tcG9zZWQgJiYgdC5jb21wb3NlZFBhdGgpIHsKICAgICAgICAgICAgdmFyIGUgPSB0LmNvbXBvc2VkUGF0aCgpOwogICAgICAgICAgICBpZiAoZSkgcmV0dXJuIFkoZSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdnQuZnJvbSh0LnRhcmdldCk7CiAgICAgIH0odCkuZ2V0T3IodC50YXJnZXQpKSwKICAgICAgeDogdC5jbGllbnRYLAogICAgICB5OiB0LmNsaWVudFksCiAgICAgIHN0b3A6IG4sCiAgICAgIHByZXZlbnQ6IGUsCiAgICAgIGtpbGw6IG8sCiAgICAgIHJhdzogdAogICAgfTsKICB9CgogIGZ1bmN0aW9uIFRuKHQsIG4sIGUsIG8sIHIpIHsKICAgIHZhciBpLAogICAgICAgIHUsCiAgICAgICAgYSA9IChpID0gZSwgdSA9IG8sIGZ1bmN0aW9uICh0KSB7CiAgICAgIGkodCkgJiYgdShfbih0KSk7CiAgICB9KTsKICAgIHJldHVybiB0LmRvbS5hZGRFdmVudExpc3RlbmVyKG4sIGEsIHIpLCB7CiAgICAgIHVuYmluZDogUyhPZSwgdCwgbiwgYSwgcikKICAgIH07CiAgfQoKICBmdW5jdGlvbiBFbihuLCBlKSB7CiAgICBZdChuKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgIHQuZG9tLmluc2VydEJlZm9yZShlLmRvbSwgbi5kb20pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBEbih0LCBuKSB7CiAgICB2dC5mcm9tKHQuZG9tLm5leHRTaWJsaW5nKS5tYXAoQXQuZnJvbURvbSkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIFl0KHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICBfZSh0LCBuKTsKICAgICAgfSk7CiAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICBFbih0LCBuKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gQm4obiwgZSkgewogICAgSnQobiwgMCkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIF9lKG4sIGUpOwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgbi5kb20uaW5zZXJ0QmVmb3JlKGUuZG9tLCB0LmRvbSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIE1uKG4sIHQpIHsKICAgIFN0KHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgIF9lKG4sIHQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBBbih0KSB7CiAgICB0LmRvbS50ZXh0Q29udGVudCA9ICIiLCBTdChLdCh0KSwgZnVuY3Rpb24gKHQpIHsKICAgICAgVGUodCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIEZuKHQpIHsKICAgIHZhciBuLAogICAgICAgIGUgPSBLdCh0KTsKICAgIDAgPCBlLmxlbmd0aCAmJiAobiA9IHQsIFN0KGUsIGZ1bmN0aW9uICh0KSB7CiAgICAgIEVuKG4sIHQpOwogICAgfSkpLCBUZSh0KTsKICB9CgogIGZ1bmN0aW9uIEluKHQpIHsKICAgIHZhciBuID0gdm9pZCAwICE9PSB0ID8gdC5kb20gOiBkb2N1bWVudCwKICAgICAgICBlID0gbi5ib2R5LnNjcm9sbExlZnQgfHwgbi5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCwKICAgICAgICBvID0gbi5ib2R5LnNjcm9sbFRvcCB8fCBuLmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7CiAgICByZXR1cm4gU2UoZSwgbyk7CiAgfQoKICBmdW5jdGlvbiBSbih0LCBuLCBlKSB7CiAgICB2YXIgbyA9ICh2b2lkIDAgIT09IGUgPyBlLmRvbSA6IGRvY3VtZW50KS5kZWZhdWx0VmlldzsKICAgIG8gJiYgby5zY3JvbGxUbyh0LCBuKTsKICB9CgogIGZ1bmN0aW9uIFZuKHQsIG4sIGUsIG8pIHsKICAgIHJldHVybiB7CiAgICAgIHg6IHQsCiAgICAgIHk6IG4sCiAgICAgIHdpZHRoOiBlLAogICAgICBoZWlnaHQ6IG8sCiAgICAgIHJpZ2h0OiB0ICsgZSwKICAgICAgYm90dG9tOiBuICsgbwogICAgfTsKICB9CgogIGZ1bmN0aW9uIFBuKHQpIHsKICAgIHZhciBvID0gdm9pZCAwID09PSB0ID8gd2luZG93IDogdCwKICAgICAgICBuID0gby5kb2N1bWVudCwKICAgICAgICByID0gSW4oQXQuZnJvbURvbShuKSksCiAgICAgICAgZSA9IHZvaWQgMCA9PT0gbyA/IHdpbmRvdyA6IG87CiAgICByZXR1cm4gKHNlKCkuYnJvd3Nlci5pc0ZpcmVmb3goKSA/IHZ0Lm5vbmUoKSA6IHZ0LmZyb20oZS52aXN1YWxWaWV3cG9ydCkpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICB2YXIgdCA9IG8uZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LAogICAgICAgICAgbiA9IHQuY2xpZW50V2lkdGgsCiAgICAgICAgICBlID0gdC5jbGllbnRIZWlnaHQ7CiAgICAgIHJldHVybiBWbihyLmxlZnQsIHIudG9wLCBuLCBlKTsKICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBWbihNYXRoLm1heCh0LnBhZ2VMZWZ0LCByLmxlZnQpLCBNYXRoLm1heCh0LnBhZ2VUb3AsIHIudG9wKSwgdC53aWR0aCwgdC5oZWlnaHQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBIbihvKSB7CiAgICB2YXIgdCwKICAgICAgICByID0gSW4oQXQuZnJvbURvbShkb2N1bWVudCkpLAogICAgICAgIG4gPSAodCA9IERlKS5vd25lcihvKSwKICAgICAgICBlID0gRWUodCwgbik7CiAgICByZXR1cm4gdnQuc29tZShlKS5mb2xkKFMoQ24sIG8pLCBmdW5jdGlvbiAodCkgewogICAgICB2YXIgbiA9IENlKG8pLAogICAgICAgICAgZSA9IEkodCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICB2YXIgZSA9IENlKG4pOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsZWZ0OiB0LmxlZnQgKyBlLmxlZnQsCiAgICAgICAgICB0b3A6IHQudG9wICsgZS50b3AKICAgICAgICB9OwogICAgICB9LCB7CiAgICAgICAgbGVmdDogMCwKICAgICAgICB0b3A6IDAKICAgICAgfSk7CiAgICAgIHJldHVybiBTZShlLmxlZnQgKyBuLmxlZnQgKyByLmxlZnQsIGUudG9wICsgbi50b3AgKyByLnRvcCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHpuKHQpIHsKICAgIHZhciBuID0gSG4odCksCiAgICAgICAgZSA9IE9uKHQpLAogICAgICAgIG8gPSB3bih0KTsKICAgIHJldHVybiBCZShuLmxlZnQsIG4udG9wLCBlLCBvKTsKICB9CgogICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgfHwgRnVuY3Rpb24oInJldHVybiB0aGlzOyIpKCk7CgogIGZ1bmN0aW9uIE5uKCkgewogICAgcmV0dXJuIEtuKDAsIDApOwogIH0KCiAgZnVuY3Rpb24gTG4odCkgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGUgPT09IHQ7CiAgICAgIH07CiAgICB9CgogICAgdmFyIGUgPSB0LmN1cnJlbnQsCiAgICAgICAgbyA9IHQudmVyc2lvbjsKICAgIHJldHVybiB7CiAgICAgIGN1cnJlbnQ6IGUsCiAgICAgIHZlcnNpb246IG8sCiAgICAgIGlzRWRnZTogbigiRWRnZSIpLAogICAgICBpc0Nocm9tZTogbigiQ2hyb21lIiksCiAgICAgIGlzSUU6IG4oIklFIiksCiAgICAgIGlzT3BlcmE6IG4oIk9wZXJhIiksCiAgICAgIGlzRmlyZWZveDogbihabiksCiAgICAgIGlzU2FmYXJpOiBuKCJTYWZhcmkiKQogICAgfTsKICB9CgogIGZ1bmN0aW9uIFduKHQpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBlID09PSB0OwogICAgICB9OwogICAgfQoKICAgIHZhciBlID0gdC5jdXJyZW50LAogICAgICAgIG8gPSB0LnZlcnNpb247CiAgICByZXR1cm4gewogICAgICBjdXJyZW50OiBlLAogICAgICB2ZXJzaW9uOiBvLAogICAgICBpc1dpbmRvd3M6IG4oZWUpLAogICAgICBpc2lPUzogbigiaU9TIiksCiAgICAgIGlzQW5kcm9pZDogbihvZSksCiAgICAgIGlzT1NYOiBuKCJPU1giKSwKICAgICAgaXNMaW51eDogbigiTGludXgiKSwKICAgICAgaXNTb2xhcmlzOiBuKHJlKSwKICAgICAgaXNGcmVlQlNEOiBuKGllKSwKICAgICAgaXNDaHJvbWVPUzogbih1ZSkKICAgIH07CiAgfQoKICB2YXIgVW4sCiAgICAgIGpuLAogICAgICBHbiA9IEl0KDEpLAogICAgICBYbiA9IEl0KDMpLAogICAgICBZbiA9IEl0KDkpLAogICAgICBxbiA9IEl0KDExKSwKICAgICAgS24gPSBmdW5jdGlvbiBLbih0LCBuKSB7CiAgICByZXR1cm4gewogICAgICBtYWpvcjogdCwKICAgICAgbWlub3I6IG4KICAgIH07CiAgfSwKICAgICAgSm4gPSB7CiAgICBudTogS24sCiAgICBkZXRlY3Q6IGZ1bmN0aW9uIGRldGVjdCh0LCBuKSB7CiAgICAgIHZhciBlLAogICAgICAgICAgbywKICAgICAgICAgIHIgPSBTdHJpbmcobikudG9Mb3dlckNhc2UoKTsKICAgICAgcmV0dXJuIDAgPT09IHQubGVuZ3RoID8gTm4oKSA6IChvID0gZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBmb3IgKHZhciBlID0gMDsgZSA8IHQubGVuZ3RoOyBlKyspIHsKICAgICAgICAgIHZhciBvID0gdFtlXTsKICAgICAgICAgIGlmIChvLnRlc3QobikpIHJldHVybiBvOwogICAgICAgIH0KICAgICAgfSh0LCBlID0gcikpID8gS24oaSgxKSwgaSgyKSkgOiB7CiAgICAgICAgbWFqb3I6IDAsCiAgICAgICAgbWlub3I6IDAKICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIGkodCkgewogICAgICAgIHJldHVybiBOdW1iZXIoZS5yZXBsYWNlKG8sICIkIiArIHQpKTsKICAgICAgfQogICAgfSwKICAgIHVua25vd246IE5uCiAgfSwKICAgICAgJG4gPSAvLio/dmVyc2lvblwvXCA/KFswLTldKylcLihbMC05XSspLiovLAogICAgICBRbiA9IHsKICAgIGJyb3dzZXJzOiBydChbewogICAgICBuYW1lOiAiRWRnZSIsCiAgICAgIHZlcnNpb25SZWdleGVzOiBbLy4qP2VkZ2VcLyA/KFswLTldKylcLihbMC05XSspJC9dLAogICAgICBzZWFyY2g6IGZ1bmN0aW9uIHNlYXJjaCh0KSB7CiAgICAgICAgcmV0dXJuIHV0KHQsICJlZGdlLyIpICYmIHV0KHQsICJjaHJvbWUiKSAmJiB1dCh0LCAic2FmYXJpIikgJiYgdXQodCwgImFwcGxld2Via2l0Iik7CiAgICAgIH0KICAgIH0sIHsKICAgICAgbmFtZTogIkNocm9tZSIsCiAgICAgIGJyYW5kOiAiQ2hyb21pdW0iLAogICAgICB2ZXJzaW9uUmVnZXhlczogWy8uKj9jaHJvbWVcLyhbMC05XSspXC4oWzAtOV0rKS4qLywgJG5dLAogICAgICBzZWFyY2g6IGZ1bmN0aW9uIHNlYXJjaCh0KSB7CiAgICAgICAgcmV0dXJuIHV0KHQsICJjaHJvbWUiKSAmJiAhdXQodCwgImNocm9tZWZyYW1lIik7CiAgICAgIH0KICAgIH0sIHsKICAgICAgbmFtZTogIklFIiwKICAgICAgdmVyc2lvblJlZ2V4ZXM6IFsvLio/bXNpZVwgPyhbMC05XSspXC4oWzAtOV0rKS4qLywgLy4qP3J2OihbMC05XSspXC4oWzAtOV0rKS4qL10sCiAgICAgIHNlYXJjaDogZnVuY3Rpb24gc2VhcmNoKHQpIHsKICAgICAgICByZXR1cm4gdXQodCwgIm1zaWUiKSB8fCB1dCh0LCAidHJpZGVudCIpOwogICAgICB9CiAgICB9LCB7CiAgICAgIG5hbWU6ICJPcGVyYSIsCiAgICAgIHZlcnNpb25SZWdleGVzOiBbJG4sIC8uKj9vcGVyYVwvKFswLTldKylcLihbMC05XSspLiovXSwKICAgICAgc2VhcmNoOiBQdCgib3BlcmEiKQogICAgfSwgewogICAgICBuYW1lOiAiRmlyZWZveCIsCiAgICAgIHZlcnNpb25SZWdleGVzOiBbLy4qP2ZpcmVmb3hcL1wgPyhbMC05XSspXC4oWzAtOV0rKS4qL10sCiAgICAgIHNlYXJjaDogUHQoImZpcmVmb3giKQogICAgfSwgewogICAgICBuYW1lOiAiU2FmYXJpIiwKICAgICAgdmVyc2lvblJlZ2V4ZXM6IFskbiwgLy4qP2NwdSBvcyAoWzAtOV0rKV8oWzAtOV0rKS4qL10sCiAgICAgIHNlYXJjaDogZnVuY3Rpb24gc2VhcmNoKHQpIHsKICAgICAgICByZXR1cm4gKHV0KHQsICJzYWZhcmkiKSB8fCB1dCh0LCAibW9iaWxlLyIpKSAmJiB1dCh0LCAiYXBwbGV3ZWJraXQiKTsKICAgICAgfQogICAgfV0pLAogICAgb3NlczogcnQoW3sKICAgICAgbmFtZTogIldpbmRvd3MiLAogICAgICBzZWFyY2g6IFB0KCJ3aW4iKSwKICAgICAgdmVyc2lvblJlZ2V4ZXM6IFsvLio/d2luZG93c1wgbnRcID8oWzAtOV0rKVwuKFswLTldKykuKi9dCiAgICB9LCB7CiAgICAgIG5hbWU6ICJpT1MiLAogICAgICBzZWFyY2g6IGZ1bmN0aW9uIHNlYXJjaCh0KSB7CiAgICAgICAgcmV0dXJuIHV0KHQsICJpcGhvbmUiKSB8fCB1dCh0LCAiaXBhZCIpOwogICAgICB9LAogICAgICB2ZXJzaW9uUmVnZXhlczogWy8uKj92ZXJzaW9uXC9cID8oWzAtOV0rKVwuKFswLTldKykuKi8sIC8uKmNwdSBvcyAoWzAtOV0rKV8oWzAtOV0rKS4qLywgLy4qY3B1IGlwaG9uZSBvcyAoWzAtOV0rKV8oWzAtOV0rKS4qL10KICAgIH0sIHsKICAgICAgbmFtZTogIkFuZHJvaWQiLAogICAgICBzZWFyY2g6IFB0KCJhbmRyb2lkIiksCiAgICAgIHZlcnNpb25SZWdleGVzOiBbLy4qP2FuZHJvaWRcID8oWzAtOV0rKVwuKFswLTldKykuKi9dCiAgICB9LCB7CiAgICAgIG5hbWU6ICJPU1giLAogICAgICBzZWFyY2g6IFB0KCJtYWMgb3MgeCIpLAogICAgICB2ZXJzaW9uUmVnZXhlczogWy8uKj9tYWNcIG9zXCB4XCA/KFswLTldKylfKFswLTldKykuKi9dCiAgICB9LCB7CiAgICAgIG5hbWU6ICJMaW51eCIsCiAgICAgIHNlYXJjaDogUHQoImxpbnV4IiksCiAgICAgIHZlcnNpb25SZWdleGVzOiBbXQogICAgfSwgewogICAgICBuYW1lOiAiU29sYXJpcyIsCiAgICAgIHNlYXJjaDogUHQoInN1bm9zIiksCiAgICAgIHZlcnNpb25SZWdleGVzOiBbXQogICAgfSwgewogICAgICBuYW1lOiAiRnJlZUJTRCIsCiAgICAgIHNlYXJjaDogUHQoImZyZWVic2QiKSwKICAgICAgdmVyc2lvblJlZ2V4ZXM6IFtdCiAgICB9LCB7CiAgICAgIG5hbWU6ICJDaHJvbWVPUyIsCiAgICAgIHNlYXJjaDogUHQoImNyb3MiKSwKICAgICAgdmVyc2lvblJlZ2V4ZXM6IFsvLio/Y2hyb21lXC8oWzAtOV0rKVwuKFswLTldKykuKi9dCiAgICB9XSkKICB9LAogICAgICBabiA9ICJGaXJlZm94IiwKICAgICAgdGUgPSBmdW5jdGlvbiB0ZSgpIHsKICAgIHJldHVybiBMbih7CiAgICAgIGN1cnJlbnQ6IHZvaWQgMCwKICAgICAgdmVyc2lvbjogSm4udW5rbm93bigpCiAgICB9KTsKICB9LAogICAgICBuZSA9IExuLAogICAgICBlZSA9IChydCgiRWRnZSIpLCBydCgiQ2hyb21lIiksIHJ0KCJJRSIpLCBydCgiT3BlcmEiKSwgcnQoWm4pLCBydCgiU2FmYXJpIiksICJXaW5kb3dzIiksCiAgICAgIG9lID0gIkFuZHJvaWQiLAogICAgICByZSA9ICJTb2xhcmlzIiwKICAgICAgaWUgPSAiRnJlZUJTRCIsCiAgICAgIHVlID0gIkNocm9tZU9TIiwKICAgICAgYWUgPSBmdW5jdGlvbiBhZSgpIHsKICAgIHJldHVybiBXbih7CiAgICAgIGN1cnJlbnQ6IHZvaWQgMCwKICAgICAgdmVyc2lvbjogSm4udW5rbm93bigpCiAgICB9KTsKICB9LAogICAgICBjZSA9IFduLAogICAgICBzZSA9IChydChlZSksIHJ0KCJpT1MiKSwgcnQob2UpLCBydCgiTGludXgiKSwgcnQoIk9TWCIpLCBydChyZSksIHJ0KGllKSwgcnQodWUpLCBSdChmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdCA9IG5hdmlnYXRvci51c2VyQWdlbnQsIG4gPSB2dC5mcm9tKG5hdmlnYXRvci51c2VyQWdlbnREYXRhKSwgZSA9IEh0LCBwID0gUW4uYnJvd3NlcnMoKSwgaCA9IFFuLm9zZXMoKSwgdiA9IG4uYmluZChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gbyA9IHAsIEsodC5icmFuZHMsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgdmFyIGUgPSBuLmJyYW5kLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgcmV0dXJuIFYobywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuOwogICAgICAgICAgcmV0dXJuIGUgPT09IChudWxsID09PSAobiA9IHQuYnJhbmQpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4udG9Mb3dlckNhc2UoKSk7CiAgICAgICAgfSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjdXJyZW50OiB0Lm5hbWUsCiAgICAgICAgICAgIHZlcnNpb246IEpuLm51KHBhcnNlSW50KG4udmVyc2lvbiwgMTApLCAwKQogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHZhciBvOwogICAgfSkub3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBWdChwLCBlID0gdCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSBKbi5kZXRlY3QodC52ZXJzaW9uUmVnZXhlcywgZSk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGN1cnJlbnQ6IHQubmFtZSwKICAgICAgICAgIHZlcnNpb246IG4KICAgICAgICB9OwogICAgICB9KTsKICAgICAgdmFyIGU7CiAgICB9KS5mb2xkKHRlLCBuZSksIGIgPSBWdChoLCBvID0gdCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuID0gSm4uZGV0ZWN0KHQudmVyc2lvblJlZ2V4ZXMsIG8pOwogICAgICByZXR1cm4gewogICAgICAgIGN1cnJlbnQ6IHQubmFtZSwKICAgICAgICB2ZXJzaW9uOiBuCiAgICAgIH07CiAgICB9KS5mb2xkKGFlLCBjZSksIHsKICAgICAgYnJvd3NlcjogdiwKICAgICAgb3M6IGIsCiAgICAgIGRldmljZVR5cGU6IChpID0gdiwgdSA9IHQsIGEgPSBlLCBjID0gKHIgPSBiKS5pc2lPUygpICYmICEwID09PSAvaXBhZC9pLnRlc3QodSksIHMgPSByLmlzaU9TKCkgJiYgIWMsIGYgPSAobCA9IHIuaXNpT1MoKSB8fCByLmlzQW5kcm9pZCgpKSB8fCBhKCIocG9pbnRlcjpjb2Fyc2UpIiksIGQgPSBjIHx8ICFzICYmIGwgJiYgYSgiKG1pbi1kZXZpY2Utd2lkdGg6NzY4cHgpIiksIG0gPSBzIHx8IGwgJiYgIWQsIGcgPSBpLmlzU2FmYXJpKCkgJiYgci5pc2lPUygpICYmICExID09PSAvc2FmYXJpL2kudGVzdCh1KSwgewogICAgICAgIGlzaVBhZDogcnQoYyksCiAgICAgICAgaXNpUGhvbmU6IHJ0KHMpLAogICAgICAgIGlzVGFibGV0OiBydChkKSwKICAgICAgICBpc1Bob25lOiBydChtKSwKICAgICAgICBpc1RvdWNoOiBydChmKSwKICAgICAgICBpc0FuZHJvaWQ6IHIuaXNBbmRyb2lkLAogICAgICAgIGlzaU9TOiByLmlzaU9TLAogICAgICAgIGlzV2ViVmlldzogcnQoZyksCiAgICAgICAgaXNEZXNrdG9wOiBydCghbSAmJiAhZCAmJiAhZykKICAgICAgfSkKICAgIH07CiAgICB2YXIgdCwgbiwgZSwgbywgciwgaSwgdSwgYSwgYywgcywgbCwgZiwgZCwgbSwgZywgcCwgaCwgdiwgYjsKICB9KSksCiAgICAgIGxlID0gWXQsCiAgICAgIGZlID0gbShFbGVtZW50LnByb3RvdHlwZS5hdHRhY2hTaGFkb3cpICYmIG0oTm9kZS5wcm90b3R5cGUuZ2V0Um9vdE5vZGUpLAogICAgICBkZSA9IHJ0KGZlKSwKICAgICAgbWUgPSBmZSA/IGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gQXQuZnJvbURvbSh0LmRvbS5nZXRSb290Tm9kZSgpKTsKICB9IDoganQsCiAgICAgIGdlID0gZnVuY3Rpb24gZ2UodCkgewogICAgdmFyIG4gPSBtZSh0KTsKICAgIHJldHVybiBadChuKSA/IHZ0LnNvbWUobikgOiB2dC5ub25lKCk7CiAgfSwKICAgICAgcGUgPSBmdW5jdGlvbiBwZSh0KSB7CiAgICByZXR1cm4gZCh0LmRvbS5zaGFkb3dSb290KTsKICB9LAogICAgICBoZSA9IGZ1bmN0aW9uIGhlKHQpIHsKICAgIHZhciBuID0gWG4odCkgPyB0LmRvbS5wYXJlbnROb2RlIDogdC5kb207CiAgICBpZiAobnVsbCA9PSBuIHx8IG51bGwgPT09IG4ub3duZXJEb2N1bWVudCkgcmV0dXJuICExOwogICAgdmFyIGUsCiAgICAgICAgbywKICAgICAgICByID0gbi5vd25lckRvY3VtZW50OwogICAgcmV0dXJuIGdlKEF0LmZyb21Eb20obikpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gci5ib2R5LmNvbnRhaW5zKG4pOwogICAgfSwgKGUgPSBoZSwgbyA9IG5uLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gZShvKHQpKTsKICAgIH0pKTsKICB9LAogICAgICB2ZSA9IGZ1bmN0aW9uIHZlKCkgewogICAgcmV0dXJuIGJlKEF0LmZyb21Eb20oZG9jdW1lbnQpKTsKICB9LAogICAgICBiZSA9IGZ1bmN0aW9uIGJlKHQpIHsKICAgIHZhciBuID0gdC5kb20uYm9keTsKICAgIGlmIChudWxsID09IG4pIHRocm93IG5ldyBFcnJvcigiQm9keSBpcyBub3QgYXZhaWxhYmxlIHlldCIpOwogICAgcmV0dXJuIEF0LmZyb21Eb20obik7CiAgfSwKICAgICAgeWUgPSBmdW5jdGlvbiB5ZSh0LCBuKSB7CiAgICByZXR1cm4gY3QodCkgPyB0LnN0eWxlLmdldFByb3BlcnR5VmFsdWUobikgOiAiIjsKICB9LAogICAgICB4ZSA9IHluKCJoZWlnaHQiLCBmdW5jdGlvbiAodCkgewogICAgdmFyIG4gPSB0LmRvbTsKICAgIHJldHVybiBoZSh0KSA/IG4uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0IDogbi5vZmZzZXRIZWlnaHQ7CiAgfSksCiAgICAgIHdlID0gZnVuY3Rpb24gd2UoZSwgbykgewogICAgcmV0dXJuIHsKICAgICAgbGVmdDogZSwKICAgICAgdG9wOiBvLAogICAgICB0cmFuc2xhdGU6IGZ1bmN0aW9uIHRyYW5zbGF0ZSh0LCBuKSB7CiAgICAgICAgcmV0dXJuIHdlKGUgKyB0LCBvICsgbik7CiAgICAgIH0KICAgIH07CiAgfSwKICAgICAgU2UgPSB3ZSwKICAgICAgQ2UgPSBmdW5jdGlvbiBDZSh0KSB7CiAgICB2YXIgbiwKICAgICAgICBlID0gdC5kb20sCiAgICAgICAgbyA9IGUub3duZXJEb2N1bWVudC5ib2R5OwogICAgcmV0dXJuIG8gPT09IGUgPyBTZShvLm9mZnNldExlZnQsIG8ub2Zmc2V0VG9wKSA6IGhlKHQpID8gKG4gPSBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLCBTZShuLmxlZnQsIG4udG9wKSkgOiBTZSgwLCAwKTsKICB9LAogICAgICBrZSA9IHluKCJ3aWR0aCIsIGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gdC5kb20ub2Zmc2V0V2lkdGg7CiAgfSksCiAgICAgIE9lID0gZnVuY3Rpb24gT2UodCwgbiwgZSwgbykgewogICAgdC5kb20ucmVtb3ZlRXZlbnRMaXN0ZW5lcihuLCBlLCBvKTsKICB9LAogICAgICBfZSA9IGZ1bmN0aW9uIF9lKHQsIG4pIHsKICAgIHQuZG9tLmFwcGVuZENoaWxkKG4uZG9tKTsKICB9LAogICAgICBUZSA9IGZ1bmN0aW9uIFRlKHQpIHsKICAgIHZhciBuID0gdC5kb207CiAgICBudWxsICE9PSBuLnBhcmVudE5vZGUgJiYgbi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG4pOwogIH0sCiAgICAgIEVlID0gZnVuY3Rpb24gRWUobywgdCkgewogICAgcmV0dXJuIG8udmlldyh0KS5mb2xkKHJ0KFtdKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSBvLm93bmVyKHQpLAogICAgICAgICAgZSA9IEVlKG8sIG4pOwogICAgICByZXR1cm4gW3RdLmNvbmNhdChlKTsKICAgIH0pOwogIH0sCiAgICAgIERlID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICB2aWV3OiBmdW5jdGlvbiB2aWV3KHQpIHsKICAgICAgdmFyIG47CiAgICAgIHJldHVybiAodC5kb20gPT09IGRvY3VtZW50ID8gdnQubm9uZSgpIDogdnQuZnJvbShudWxsID09PSAobiA9IHQuZG9tLmRlZmF1bHRWaWV3KSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLmZyYW1lRWxlbWVudCkpLm1hcChBdC5mcm9tRG9tKTsKICAgIH0sCiAgICBvd25lcjogVXQKICB9KSwKICAgICAgQmUgPSBmdW5jdGlvbiBCZSh0LCBuLCBlLCBvKSB7CiAgICByZXR1cm4gewogICAgICB4OiB0LAogICAgICB5OiBuLAogICAgICB3aWR0aDogZSwKICAgICAgaGVpZ2h0OiBvLAogICAgICByaWdodDogdCArIGUsCiAgICAgIGJvdHRvbTogbiArIG8KICAgIH07CiAgfSwKICAgICAgTWUgPSBmdW5jdGlvbiBNZSh0KSB7CiAgICB2YXIgbiA9IENuKHQpLAogICAgICAgIGUgPSBPbih0KSwKICAgICAgICBvID0gd24odCk7CiAgICByZXR1cm4gQmUobi5sZWZ0LCBuLnRvcCwgZSwgbyk7CiAgfSwKICAgICAgQWUgPSBmdW5jdGlvbiBBZSgpIHsKICAgIHJldHVybiBQbih3aW5kb3cpOwogIH0sCiAgICAgIEZlID0gZnVuY3Rpb24gRmUoZSkgewogICAgcmV0dXJuIHsKICAgICAgaXNWYWx1ZTogXywKICAgICAgaXNFcnJvcjogTywKICAgICAgZ2V0T3I6IHJ0KGUpLAogICAgICBnZXRPclRodW5rOiBydChlKSwKICAgICAgZ2V0T3JEaWU6IHJ0KGUpLAogICAgICBvcjogZnVuY3Rpb24gb3IodCkgewogICAgICAgIHJldHVybiBGZShlKTsKICAgICAgfSwKICAgICAgb3JUaHVuazogZnVuY3Rpb24gb3JUaHVuayh0KSB7CiAgICAgICAgcmV0dXJuIEZlKGUpOwogICAgICB9LAogICAgICBmb2xkOiBmdW5jdGlvbiBmb2xkKHQsIG4pIHsKICAgICAgICByZXR1cm4gbihlKTsKICAgICAgfSwKICAgICAgbWFwOiBmdW5jdGlvbiBtYXAodCkgewogICAgICAgIHJldHVybiBGZSh0KGUpKTsKICAgICAgfSwKICAgICAgbWFwRXJyb3I6IGZ1bmN0aW9uIG1hcEVycm9yKHQpIHsKICAgICAgICByZXR1cm4gRmUoZSk7CiAgICAgIH0sCiAgICAgIGVhY2g6IGZ1bmN0aW9uIGVhY2godCkgewogICAgICAgIHQoZSk7CiAgICAgIH0sCiAgICAgIGJpbmQ6IGZ1bmN0aW9uIGJpbmQodCkgewogICAgICAgIHJldHVybiB0KGUpOwogICAgICB9LAogICAgICBleGlzdHM6IGZ1bmN0aW9uIGV4aXN0cyh0KSB7CiAgICAgICAgcmV0dXJuIHQoZSk7CiAgICAgIH0sCiAgICAgIGZvcmFsbDogZnVuY3Rpb24gZm9yYWxsKHQpIHsKICAgICAgICByZXR1cm4gdChlKTsKICAgICAgfSwKICAgICAgdG9PcHRpb25hbDogZnVuY3Rpb24gdG9PcHRpb25hbCgpIHsKICAgICAgICByZXR1cm4gdnQuc29tZShlKTsKICAgICAgfQogICAgfTsKICB9LAogICAgICBJZSA9IGZ1bmN0aW9uIEllKGUpIHsKICAgIHJldHVybiB7CiAgICAgIGlzVmFsdWU6IE8sCiAgICAgIGlzRXJyb3I6IF8sCiAgICAgIGdldE9yOiBoLAogICAgICBnZXRPclRodW5rOiBmdW5jdGlvbiBnZXRPclRodW5rKHQpIHsKICAgICAgICByZXR1cm4gdCgpOwogICAgICB9LAogICAgICBnZXRPckRpZTogZnVuY3Rpb24gZ2V0T3JEaWUoKSB7CiAgICAgICAgcmV0dXJuIGsoU3RyaW5nKGUpKSgpOwogICAgICB9LAogICAgICBvcjogaCwKICAgICAgb3JUaHVuazogZnVuY3Rpb24gb3JUaHVuayh0KSB7CiAgICAgICAgcmV0dXJuIHQoKTsKICAgICAgfSwKICAgICAgZm9sZDogZnVuY3Rpb24gZm9sZCh0LCBuKSB7CiAgICAgICAgcmV0dXJuIHQoZSk7CiAgICAgIH0sCiAgICAgIG1hcDogZnVuY3Rpb24gbWFwKHQpIHsKICAgICAgICByZXR1cm4gSWUoZSk7CiAgICAgIH0sCiAgICAgIG1hcEVycm9yOiBmdW5jdGlvbiBtYXBFcnJvcih0KSB7CiAgICAgICAgcmV0dXJuIEllKHQoZSkpOwogICAgICB9LAogICAgICBlYWNoOiBzdCwKICAgICAgYmluZDogZnVuY3Rpb24gYmluZCh0KSB7CiAgICAgICAgcmV0dXJuIEllKGUpOwogICAgICB9LAogICAgICBleGlzdHM6IE8sCiAgICAgIGZvcmFsbDogXywKICAgICAgdG9PcHRpb25hbDogdnQubm9uZQogICAgfTsKICB9LAogICAgICBSZSA9IHsKICAgIHZhbHVlOiBGZSwKICAgIGVycm9yOiBJZSwKICAgIGZyb21PcHRpb246IGZ1bmN0aW9uIGZyb21PcHRpb24odCwgbikgewogICAgICByZXR1cm4gdC5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gSWUobik7CiAgICAgIH0sIEZlKTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiBWZSh0LCBuLCBlKSB7CiAgICByZXR1cm4gdC5zdHlwZSA9PT0gVW4uRXJyb3IgPyBuKHQuc2Vycm9yKSA6IGUodC5zdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gUGUodCkgewogICAgcmV0dXJuIHsKICAgICAgc3R5cGU6IFVuLlZhbHVlLAogICAgICBzdmFsdWU6IHQKICAgIH07CiAgfQoKICBmdW5jdGlvbiBIZSh0KSB7CiAgICByZXR1cm4gewogICAgICBzdHlwZTogVW4uRXJyb3IsCiAgICAgIHNlcnJvcjogdAogICAgfTsKICB9CgogIGZ1bmN0aW9uIHplKHQsIG4sIGUsIG8pIHsKICAgIHJldHVybiB7CiAgICAgIHRhZzogImZpZWxkIiwKICAgICAga2V5OiB0LAogICAgICBuZXdLZXk6IG4sCiAgICAgIHByZXNlbmNlOiBlLAogICAgICBwcm9wOiBvCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gTmUodCwgbiwgZSkgewogICAgc3dpdGNoICh0LnRhZykgewogICAgICBjYXNlICJmaWVsZCI6CiAgICAgICAgcmV0dXJuIG4odC5rZXksIHQubmV3S2V5LCB0LnByZXNlbmNlLCB0LnByb3ApOwoKICAgICAgY2FzZSAiY3VzdG9tIjoKICAgICAgICByZXR1cm4gZSh0Lm5ld0tleSwgdC5pbnN0YW50aWF0b3IpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gTGUodSkgewogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgZm9yICh2YXIgdCA9IFtdLCBuID0gMDsgbiA8IGFyZ3VtZW50cy5sZW5ndGg7IG4rKykgewogICAgICAgIHRbbl0gPSBhcmd1bWVudHNbbl07CiAgICAgIH0KCiAgICAgIGlmICgwID09PSB0Lmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCJDYW4ndCBtZXJnZSB6ZXJvIG9iamVjdHMiKTsKCiAgICAgIGZvciAodmFyIGUgPSB7fSwgbyA9IDA7IG8gPCB0Lmxlbmd0aDsgbysrKSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIGkgPSB0W29dOwoKICAgICAgICBmb3IgKHIgaW4gaSkgewogICAgICAgICAgVHQoaSwgcikgJiYgKGVbcl0gPSB1KGVbcl0sIGlbcl0pKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBlOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIFdlKCkgewogICAgcmV0dXJuIHsKICAgICAgdGFnOiAicmVxdWlyZWQiLAogICAgICBwcm9jZXNzOiB7fQogICAgfTsKICB9CgogIGZ1bmN0aW9uIFVlKHQpIHsKICAgIHJldHVybiB7CiAgICAgIHRhZzogImRlZmF1bHRlZFRodW5rIiwKICAgICAgcHJvY2VzczogdAogICAgfTsKICB9CgogIGZ1bmN0aW9uIGplKHQpIHsKICAgIHJldHVybiBVZShydCh0KSk7CiAgfQoKICBmdW5jdGlvbiBHZSgpIHsKICAgIHJldHVybiB7CiAgICAgIHRhZzogIm9wdGlvbiIsCiAgICAgIHByb2Nlc3M6IHt9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gWGUodCkgewogICAgcmV0dXJuIHsKICAgICAgdGFnOiAibWVyZ2VXaXRoVGh1bmsiLAogICAgICBwcm9jZXNzOiB0CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gWWUodCkgewogICAgcmV0dXJuIHgodCkgJiYgMTAwIDwga3QodCkubGVuZ3RoID8gIiByZW1vdmVkIGR1ZSB0byBzaXplIiA6IEpTT04uc3RyaW5naWZ5KHQsIG51bGwsIDIpOwogIH0KCiAgZnVuY3Rpb24gcWUodCwgbikgewogICAgcmV0dXJuIE5vKFt7CiAgICAgIHBhdGg6IHQsCiAgICAgIGdldEVycm9ySW5mbzogbgogICAgfV0pOwogIH0KCiAgZnVuY3Rpb24gS2UoZSkgewogICAgcmV0dXJuIHsKICAgICAgZXh0cmFjdDogZnVuY3Rpb24gZXh0cmFjdChuLCB0KSB7CiAgICAgICAgcmV0dXJuIFdvKGUodCksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gcWUobiwgcnQodCkpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICB0b1N0cmluZzogcnQoInZhbCIpCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gSmUodCwgbiwgZSwgbykgewogICAgcmV0dXJuIG8odHQodCwgbikuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBlKHQpOwogICAgfSkpOwogIH0KCiAgZnVuY3Rpb24gJGUobiwgZSwgbywgciwgaSkgewogICAgZnVuY3Rpb24gdSh0KSB7CiAgICAgIHJldHVybiBpLmV4dHJhY3QoZS5jb25jYXQoW3JdKSwgdCk7CiAgICB9CgogICAgZnVuY3Rpb24gdCh0KSB7CiAgICAgIHJldHVybiB0LmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB6byh2dC5ub25lKCkpOwogICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBuID0gaS5leHRyYWN0KGUuY29uY2F0KFtyXSksIHQpOwogICAgICAgIHJldHVybiBVbyhuLCB2dC5zb21lKTsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIGEsIGMsIHMsIGwsIGYsIGQ7CgogICAgc3dpdGNoIChuLnRhZykgewogICAgICBjYXNlICJyZXF1aXJlZCI6CiAgICAgICAgcmV0dXJuIHMgPSBlLCBkID0gdSwgdHQobCA9IG8sIGYgPSByKS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0ID0gZiwgbiA9IGwsIHFlKHMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuICdDb3VsZCBub3QgZmluZCB2YWxpZCAqcmVxdWlyZWQqIHZhbHVlIGZvciAiJyArIHQgKyAnIiBpbiAnICsgWWUobik7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciB0LCBuOwogICAgICAgIH0sIGQpOwoKICAgICAgY2FzZSAiZGVmYXVsdGVkVGh1bmsiOgogICAgICAgIHJldHVybiBKZShvLCByLCBuLnByb2Nlc3MsIHUpOwoKICAgICAgY2FzZSAib3B0aW9uIjoKICAgICAgICByZXR1cm4gdCh0dChvLCByKSk7CgogICAgICBjYXNlICJkZWZhdWx0ZWRPcHRpb25UaHVuayI6CiAgICAgICAgcmV0dXJuIGMgPSBuLnByb2Nlc3MsIHQodHQoYSA9IG8sIHIpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuICEwID09PSB0ID8gYyhhKSA6IHQ7CiAgICAgICAgfSkpOwoKICAgICAgY2FzZSAibWVyZ2VXaXRoVGh1bmsiOgogICAgICAgIHJldHVybiBKZShvLCByLCBydCh7fSksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdShYbyhuLnByb2Nlc3MobyksIHQpKTsKICAgICAgICB9KTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIFFlKGUpIHsKICAgIHJldHVybiB7CiAgICAgIGV4dHJhY3Q6IGZ1bmN0aW9uIGV4dHJhY3QodCwgbikgewogICAgICAgIHJldHVybiBlKCkuZXh0cmFjdCh0LCBuKTsKICAgICAgfSwKICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiBlKCkudG9TdHJpbmcoKTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIFplKHQpIHsKICAgIHZhciBzID0gSm8odCksCiAgICAgICAgbCA9IEkodCwgZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgcmV0dXJuIE5lKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG47CiAgICAgICAgcmV0dXJuIFhvKGUsICgobiA9IHt9KVt0XSA9ICEwLCBuKSk7CiAgICAgIH0sIHJ0KGUpKTsKICAgIH0sIHt9KTsKICAgIHJldHVybiB7CiAgICAgIGV4dHJhY3Q6IGZ1bmN0aW9uIGV4dHJhY3QodCwgbikgewogICAgICAgIHZhciBlLAogICAgICAgICAgICBvLAogICAgICAgICAgICByLAogICAgICAgICAgICBpLAogICAgICAgICAgICB1LAogICAgICAgICAgICBhLAogICAgICAgICAgICBjID0gRih3KG4pID8gW10gOiBrdCgociA9IGQsIGkgPSBvID0ge30sIHUgPSBmdW5jdGlvbiB1KHQsIG4pIHsKICAgICAgICAgIGlbbl0gPSB0OwogICAgICAgIH0sIGEgPSBzdCwgSihuLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgKHIodCwgbikgPyB1IDogYSkodCwgbik7CiAgICAgICAgfSksIG8pKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAhbnQobCwgdCk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIDAgPT09IGMubGVuZ3RoID8gcy5leHRyYWN0KHQsIG4pIDogKGUgPSBjLCBxZSh0LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gIlRoZXJlIGFyZSB1bnN1cHBvcnRlZCBmaWVsZHM6IFsiICsgZS5qb2luKCIsICIpICsgIl0gc3BlY2lmaWVkIjsKICAgICAgICB9KSk7CiAgICAgIH0sCiAgICAgIHRvU3RyaW5nOiBzLnRvU3RyaW5nCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gdG8obykgewogICAgcmV0dXJuIHsKICAgICAgZXh0cmFjdDogZnVuY3Rpb24gZXh0cmFjdChlLCB0KSB7CiAgICAgICAgdmFyIG4gPSBNKHQsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICByZXR1cm4gby5leHRyYWN0KGUuY29uY2F0KFsiWyIgKyBuICsgIl0iXSksIHQpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBxbyhuKTsKICAgICAgfSwKICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiAiYXJyYXkoIiArIG8udG9TdHJpbmcoKSArICIpIjsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIG5vKHUpIHsKICAgIHJldHVybiB7CiAgICAgIGV4dHJhY3Q6IGZ1bmN0aW9uIGV4dHJhY3QodCwgbikgewogICAgICAgIGZvciAodmFyIGUgPSBbXSwgbyA9IDAsIHIgPSB1OyBvIDwgci5sZW5ndGg7IG8rKykgewogICAgICAgICAgdmFyIGkgPSByW29dLmV4dHJhY3QodCwgbik7CiAgICAgICAgICBpZiAoaS5zdHlwZSA9PT0gVW4uVmFsdWUpIHJldHVybiBpOwogICAgICAgICAgZS5wdXNoKGkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHFvKGUpOwogICAgICB9LAogICAgICB0b1N0cmluZzogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuICJvbmVPZigiICsgTSh1LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHQudG9TdHJpbmcoKTsKICAgICAgICB9KS5qb2luKCIsICIpICsgIikiOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gZW8oZSwgbykgewogICAgcmV0dXJuIEtlKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuID0gX3R5cGVvZih0KTsKCiAgICAgIHJldHVybiBlKHQpID8gem8odCkgOiBObygiRXhwZWN0ZWQgdHlwZTogIiArIG8gKyAiIGJ1dCBnb3Q6ICIgKyBuKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gb28obiwgYSkgewogICAgcmV0dXJuIHsKICAgICAgZXh0cmFjdDogZnVuY3Rpb24gZXh0cmFjdChpLCB1KSB7CiAgICAgICAgcmV0dXJuIHR0KHUsIG4pLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHQgPSBuLCBxZShpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiAnQ2hvaWNlIHNjaGVtYSBkaWQgbm90IGNvbnRhaW4gY2hvaWNlIGtleTogIicgKyB0ICsgJyInOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgdDsKICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGUgPSBpLCBuID0gdSwgdHQobyA9IGEsIHIgPSB0KS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHQgPSBvLCBuID0gciwgcWUoZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiAnVGhlIGNob3NlbiBzY2hlbWE6ICInICsgbiArICciIGRpZCBub3QgZXhpc3QgaW4gYnJhbmNoZXM6ICcgKyBZZSh0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciB0LCBuOwogICAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHQuZXh0cmFjdChlLmNvbmNhdChbImJyYW5jaDogIiArIHJdKSwgbik7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBlLCBuLCBvLCByOwogICAgICAgIH0pOwogICAgICB9LAogICAgICB0b1N0cmluZzogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuICJjaG9vc2VPbigiICsgbiArICIpLiBQb3NzaWJsZSB2YWx1ZXM6ICIgKyBrdChhKTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIHJvKG4pIHsKICAgIHJldHVybiBLZShmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gbih0KS5mb2xkKE5vLCB6byk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGlvKG4sIHQpIHsKICAgIHJldHVybiByID0gZnVuY3Rpb24gcih0KSB7CiAgICAgIHJldHVybiBuKHQpLmZvbGQoSGUsIFBlKTsKICAgIH0sIGkgPSB0LCB7CiAgICAgIGV4dHJhY3Q6IGZ1bmN0aW9uIGV4dHJhY3QoZSwgbykgewogICAgICAgIHZhciB0ID0ga3QobyksCiAgICAgICAgICAgIG4gPSB0byhLZShyKSkuZXh0cmFjdChlLCB0KTsKICAgICAgICByZXR1cm4gTG8obiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gTSh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gemUodCwgdCwgV2UoKSwgaSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBKbyhuKS5leHRyYWN0KGUsIG8pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICB0b1N0cmluZzogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuICJzZXRPZigiICsgaS50b1N0cmluZygpICsgIikiOwogICAgICB9CiAgICB9OwogICAgdmFyIHIsIGk7CiAgfQoKICBmdW5jdGlvbiB1byh0LCBuLCBlKSB7CiAgICByZXR1cm4gSG8oKHIgPSBuLmV4dHJhY3QoW3RdLCBvID0gZSksIGpvKHIsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaW5wdXQ6IG8sCiAgICAgICAgZXJyb3JzOiB0CiAgICAgIH07CiAgICB9KSkpOwogICAgdmFyIG8sIHI7CiAgfQoKICBmdW5jdGlvbiBhbyh0KSB7CiAgICByZXR1cm4gdC5mb2xkKGZ1bmN0aW9uICh0KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihpcih0KSk7CiAgICB9LCBoKTsKICB9CgogIGZ1bmN0aW9uIGNvKHQsIG4sIGUpIHsKICAgIHJldHVybiBhbyh1byh0LCBuLCBlKSk7CiAgfQoKICBmdW5jdGlvbiBzbyh0LCBuKSB7CiAgICByZXR1cm4gb28odCwgZHQobiwgSm8pKTsKICB9CgogIGZ1bmN0aW9uIGxvKG4pIHsKICAgIHJldHVybiBybyhmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gd3QobiwgdCkgPyBSZS52YWx1ZSh0KSA6IFJlLmVycm9yKCdVbnN1cHBvcnRlZCB2YWx1ZTogIicgKyB0ICsgJyIsIGNob29zZSBvbmUgb2YgIicgKyBuLmpvaW4oIiwgIikgKyAnIi4nKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZm8odCkgewogICAgcmV0dXJuIHVyKHQsIHQsIFdlKCksIFFvKCkpOwogIH0KCiAgZnVuY3Rpb24gbW8odCwgbikgewogICAgcmV0dXJuIHVyKHQsIHQsIFdlKCksIG4pOwogIH0KCiAgZnVuY3Rpb24gZ28odCkgewogICAgcmV0dXJuIG1vKHQsIHRyKTsKICB9CgogIGZ1bmN0aW9uIHBvKHQsIG4pIHsKICAgIHJldHVybiB1cih0LCB0LCBXZSgpLCBsbyhuKSk7CiAgfQoKICBmdW5jdGlvbiBobyh0KSB7CiAgICByZXR1cm4gbW8odCwgZXIpOwogIH0KCiAgZnVuY3Rpb24gdm8odCwgbikgewogICAgcmV0dXJuIHVyKHQsIHQsIFdlKCksIEpvKG4pKTsKICB9CgogIGZ1bmN0aW9uIGJvKHQsIG4pIHsKICAgIHJldHVybiB1cih0LCB0LCBXZSgpLCAkbyhuKSk7CiAgfQoKICBmdW5jdGlvbiB5byh0LCBuKSB7CiAgICByZXR1cm4gdXIodCwgdCwgV2UoKSwgdG8obikpOwogIH0KCiAgZnVuY3Rpb24geG8odCkgewogICAgcmV0dXJuIHVyKHQsIHQsIEdlKCksIFFvKCkpOwogIH0KCiAgZnVuY3Rpb24gd28odCwgbikgewogICAgcmV0dXJuIHVyKHQsIHQsIEdlKCksIG4pOwogIH0KCiAgZnVuY3Rpb24gU28odCkgewogICAgcmV0dXJuIHdvKHQsIFpvKTsKICB9CgogIGZ1bmN0aW9uIENvKHQpIHsKICAgIHJldHVybiB3byh0LCB0cik7CiAgfQoKICBmdW5jdGlvbiBrbyh0KSB7CiAgICByZXR1cm4gd28odCwgZXIpOwogIH0KCiAgZnVuY3Rpb24gT28odCwgbikgewogICAgcmV0dXJuIHdvKHQsIHRvKG4pKTsKICB9CgogIGZ1bmN0aW9uIF9vKHQsIG4pIHsKICAgIHJldHVybiB3byh0LCBKbyhuKSk7CiAgfQoKICBmdW5jdGlvbiBUbyh0LCBuKSB7CiAgICByZXR1cm4gdXIodCwgdCwgamUobiksIFFvKCkpOwogIH0KCiAgZnVuY3Rpb24gRW8odCwgbiwgZSkgewogICAgcmV0dXJuIHVyKHQsIHQsIGplKG4pLCBlKTsKICB9CgogIGZ1bmN0aW9uIERvKHQsIG4pIHsKICAgIHJldHVybiBFbyh0LCBuLCBabyk7CiAgfQoKICBmdW5jdGlvbiBCbyh0LCBuKSB7CiAgICByZXR1cm4gRW8odCwgbiwgdHIpOwogIH0KCiAgZnVuY3Rpb24gTW8odCwgbiwgZSkgewogICAgcmV0dXJuIEVvKHQsIG4sIGxvKGUpKTsKICB9CgogIGZ1bmN0aW9uIEFvKHQsIG4pIHsKICAgIHJldHVybiBFbyh0LCBuLCBucik7CiAgfQoKICBmdW5jdGlvbiBGbyh0LCBuKSB7CiAgICByZXR1cm4gRW8odCwgbiwgZXIpOwogIH0KCiAgZnVuY3Rpb24gSW8odCwgbiwgZSkgewogICAgcmV0dXJuIEVvKHQsIG4sIHRvKGUpKTsKICB9CgogIGZ1bmN0aW9uIFJvKHQsIG4sIGUpIHsKICAgIHJldHVybiBFbyh0LCBuLCBKbyhlKSk7CiAgfQoKICBmdW5jdGlvbiBWbyh0KSB7CiAgICB2YXIgbiA9IHQ7CiAgICByZXR1cm4gewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gbjsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodCkgewogICAgICAgIG4gPSB0OwogICAgICB9CiAgICB9OwogIH0KCiAgKGpuID0gVW4gPSB7fSlbam4uRXJyb3IgPSAwXSA9ICJFcnJvciIsIGpuW2puLlZhbHVlID0gMV0gPSAiVmFsdWUiOwoKICBmdW5jdGlvbiBQbyh1KSB7CiAgICBpZiAoIWModSkpIHRocm93IG5ldyBFcnJvcigiY2FzZXMgbXVzdCBiZSBhbiBhcnJheSIpOwogICAgaWYgKDAgPT09IHUubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoInRoZXJlIG11c3QgYmUgYXQgbGVhc3Qgb25lIGNhc2UiKTsKICAgIHZhciBhID0gW10sCiAgICAgICAgZSA9IHt9OwogICAgcmV0dXJuIFN0KHUsIGZ1bmN0aW9uICh0LCBvKSB7CiAgICAgIHZhciBuID0ga3QodCk7CiAgICAgIGlmICgxICE9PSBuLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCJvbmUgYW5kIG9ubHkgb25lIG5hbWUgcGVyIGNhc2UiKTsKICAgICAgdmFyIHIgPSBuWzBdLAogICAgICAgICAgaSA9IHRbcl07CiAgICAgIGlmICh2b2lkIDAgIT09IGVbcl0pIHRocm93IG5ldyBFcnJvcigiZHVwbGljYXRlIGtleSBkZXRlY3RlZDoiICsgcik7CiAgICAgIGlmICgiY2F0YSIgPT09IHIpIHRocm93IG5ldyBFcnJvcigiY2Fubm90IGhhdmUgYSBjYXNlIG5hbWVkIGNhdGEgKHNvcnJ5KSIpOwogICAgICBpZiAoIWMoaSkpIHRocm93IG5ldyBFcnJvcigiY2FzZSBhcmd1bWVudHMgbXVzdCBiZSBhbiBhcnJheSIpOwogICAgICBhLnB1c2gociksIGVbcl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZm9yICh2YXIgZSA9IFtdLCB0ID0gMDsgdCA8IGFyZ3VtZW50cy5sZW5ndGg7IHQrKykgewogICAgICAgICAgZVt0XSA9IGFyZ3VtZW50c1t0XTsKICAgICAgICB9CgogICAgICAgIHZhciBuID0gZS5sZW5ndGg7CiAgICAgICAgaWYgKG4gIT09IGkubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgdG8gY2FzZSAiICsgciArICIuIEV4cGVjdGVkICIgKyBpLmxlbmd0aCArICIgKCIgKyBpICsgIiksIGdvdCAiICsgbik7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGZvbGQ6IGZ1bmN0aW9uIGZvbGQoKSB7CiAgICAgICAgICAgIGZvciAodmFyIHQgPSBbXSwgbiA9IDA7IG4gPCBhcmd1bWVudHMubGVuZ3RoOyBuKyspIHsKICAgICAgICAgICAgICB0W25dID0gYXJndW1lbnRzW25dOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodC5sZW5ndGggIT09IHUubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgdG8gZm9sZC4gRXhwZWN0ZWQgIiArIHUubGVuZ3RoICsgIiwgZ290ICIgKyB0Lmxlbmd0aCk7CiAgICAgICAgICAgIHJldHVybiB0W29dLmFwcGx5KG51bGwsIGUpOwogICAgICAgICAgfSwKICAgICAgICAgIG1hdGNoOiBmdW5jdGlvbiBtYXRjaCh0KSB7CiAgICAgICAgICAgIHZhciBuID0ga3QodCk7CiAgICAgICAgICAgIGlmIChhLmxlbmd0aCAhPT0gbi5sZW5ndGgpIHRocm93IG5ldyBFcnJvcigiV3JvbmcgbnVtYmVyIG9mIGFyZ3VtZW50cyB0byBtYXRjaC4gRXhwZWN0ZWQ6ICIgKyBhLmpvaW4oIiwiKSArICJcbkFjdHVhbDogIiArIG4uam9pbigiLCIpKTsKICAgICAgICAgICAgaWYgKCFOKGEsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHd0KG4sIHQpOwogICAgICAgICAgICB9KSkgdGhyb3cgbmV3IEVycm9yKCJOb3QgYWxsIGJyYW5jaGVzIHdlcmUgc3BlY2lmaWVkIHdoZW4gdXNpbmcgbWF0Y2guIFNwZWNpZmllZDogIiArIG4uam9pbigiLCAiKSArICJcblJlcXVpcmVkOiAiICsgYS5qb2luKCIsICIpKTsKICAgICAgICAgICAgcmV0dXJuIHRbcl0uYXBwbHkobnVsbCwgZSk7CiAgICAgICAgICB9LAogICAgICAgICAgbG9nOiBmdW5jdGlvbiBsb2codCkgewogICAgICAgICAgICBjb25zb2xlLmxvZyh0LCB7CiAgICAgICAgICAgICAgY29uc3RydWN0b3JzOiBhLAogICAgICAgICAgICAgIGNvbnN0cnVjdG9yOiByLAogICAgICAgICAgICAgIHBhcmFtczogZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9OwogICAgfSksIGU7CiAgfQoKICB2YXIgSG8gPSBmdW5jdGlvbiBIbyh0KSB7CiAgICByZXR1cm4gVmUodCwgUmUuZXJyb3IsIFJlLnZhbHVlKTsKICB9LAogICAgICB6byA9IFBlLAogICAgICBObyA9IEhlLAogICAgICBMbyA9IGZ1bmN0aW9uIExvKHQsIG4pIHsKICAgIHJldHVybiB0LnN0eXBlID09PSBVbi5WYWx1ZSA/IG4odC5zdmFsdWUpIDogdDsKICB9LAogICAgICBXbyA9IGZ1bmN0aW9uIFdvKHQsIG4pIHsKICAgIHJldHVybiB0LnN0eXBlID09PSBVbi5FcnJvciA/IG4odC5zZXJyb3IpIDogdDsKICB9LAogICAgICBVbyA9IGZ1bmN0aW9uIFVvKHQsIG4pIHsKICAgIHJldHVybiB0LnN0eXBlID09PSBVbi5WYWx1ZSA/IHsKICAgICAgc3R5cGU6IFVuLlZhbHVlLAogICAgICBzdmFsdWU6IG4odC5zdmFsdWUpCiAgICB9IDogdDsKICB9LAogICAgICBqbyA9IGZ1bmN0aW9uIGpvKHQsIG4pIHsKICAgIHJldHVybiB0LnN0eXBlID09PSBVbi5FcnJvciA/IHsKICAgICAgc3R5cGU6IFVuLkVycm9yLAogICAgICBzZXJyb3I6IG4odC5zZXJyb3IpCiAgICB9IDogdDsKICB9LAogICAgICBHbyA9IFZlLAogICAgICBYbyA9IExlKGZ1bmN0aW9uICh0LCBuKSB7CiAgICByZXR1cm4geCh0KSAmJiB4KG4pID8gWG8odCwgbikgOiBuOwogIH0pLAogICAgICBZbyA9IExlKGZ1bmN0aW9uICh0LCBuKSB7CiAgICByZXR1cm4gbjsKICB9KSwKICAgICAgcW8gPSBmdW5jdGlvbiBxbyh0KSB7CiAgICB2YXIgbiwKICAgICAgICBlLAogICAgICAgIG8gPSAobiA9IFtdLCBlID0gW10sIFN0KHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgIFZlKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIGUucHVzaCh0KTsKICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gbi5wdXNoKHQpOwogICAgICB9KTsKICAgIH0pLCB7CiAgICAgIHZhbHVlczogbiwKICAgICAgZXJyb3JzOiBlCiAgICB9KTsKICAgIHJldHVybiAwIDwgby5lcnJvcnMubGVuZ3RoID8gcihObywgZnQpKG8uZXJyb3JzKSA6IHpvKG8udmFsdWVzKTsKICB9LAogICAgICBLbyA9IEtlKHpvKSwKICAgICAgSm8gPSBmdW5jdGlvbiBKbyhlKSB7CiAgICByZXR1cm4gewogICAgICBleHRyYWN0OiBmdW5jdGlvbiBleHRyYWN0KGksIHUpIHsKICAgICAgICBmb3IgKHZhciBhID0ge30sIGMgPSBbXSwgdCA9IDAsIG4gPSBlOyB0IDwgbi5sZW5ndGg7IHQrKykgewogICAgICAgICAgTmUoblt0XSwgZnVuY3Rpb24gKHQsIG4sIGUsIG8pIHsKICAgICAgICAgICAgdmFyIHIgPSAkZShlLCBpLCB1LCB0LCBvKTsKICAgICAgICAgICAgR28ociwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBjLnB1c2guYXBwbHkoYywgdCk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgYVtuXSA9IHQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgYVt0XSA9IG4odSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAwIDwgYy5sZW5ndGggPyBObyhjKSA6IHpvKGEpOwogICAgICB9LAogICAgICB0b1N0cmluZzogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuICJvYmp7XG4iICsgTShlLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIE5lKHQsIGZ1bmN0aW9uICh0LCBuLCBlLCBvKSB7CiAgICAgICAgICAgIHJldHVybiB0ICsgIiAtPiAiICsgby50b1N0cmluZygpOwogICAgICAgICAgfSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgcmV0dXJuICJzdGF0ZSgiICsgdCArICIpIjsKICAgICAgICAgIH0pOwogICAgICAgIH0pLmpvaW4oIlxuIikgKyAifSI7CiAgICAgIH0KICAgIH07CiAgfSwKICAgICAgJG8gPSByKHRvLCBKbyksCiAgICAgIFFvID0gcnQoS28pLAogICAgICBabyA9IGVvKHUsICJudW1iZXIiKSwKICAgICAgdHIgPSBlbyh5LCAic3RyaW5nIiksCiAgICAgIG5yID0gZW8odywgImJvb2xlYW4iKSwKICAgICAgZXIgPSBlbyhtLCAiZnVuY3Rpb24iKSwKICAgICAgb3IgPSBmdW5jdGlvbiBvcihuKSB7CiAgICBpZiAoT2JqZWN0KG4pICE9PSBuKSByZXR1cm4gITA7CgogICAgc3dpdGNoICh7fS50b1N0cmluZy5jYWxsKG4pLnNsaWNlKDgsIC0xKSkgewogICAgICBjYXNlICJCb29sZWFuIjoKICAgICAgY2FzZSAiTnVtYmVyIjoKICAgICAgY2FzZSAiU3RyaW5nIjoKICAgICAgY2FzZSAiRGF0ZSI6CiAgICAgIGNhc2UgIlJlZ0V4cCI6CiAgICAgIGNhc2UgIkJsb2IiOgogICAgICBjYXNlICJGaWxlTGlzdCI6CiAgICAgIGNhc2UgIkltYWdlRGF0YSI6CiAgICAgIGNhc2UgIkltYWdlQml0bWFwIjoKICAgICAgY2FzZSAiQXJyYXlCdWZmZXIiOgogICAgICAgIHJldHVybiAhMDsKCiAgICAgIGNhc2UgIkFycmF5IjoKICAgICAgY2FzZSAiT2JqZWN0IjoKICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMobikuZXZlcnkoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBvcihuW3RdKTsKICAgICAgICB9KTsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuICExOwogICAgfQogIH0sCiAgICAgIHJyID0gS2UoZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiBvcih0KSA/IHpvKHQpIDogTm8oIkV4cGVjdGVkIHZhbHVlIHRvIGJlIGFjY2VwdGFibGUgZm9yIHNlbmRpbmcgdmlhIHBvc3RNZXNzYWdlIik7CiAgfSksCiAgICAgIGlyID0gZnVuY3Rpb24gaXIodCkgewogICAgcmV0dXJuICJFcnJvcnM6IFxuIiArIE0oMTAgPCAobiA9IHQuZXJyb3JzKS5sZW5ndGggPyBuLnNsaWNlKDAsIDEwKS5jb25jYXQoW3sKICAgICAgcGF0aDogW10sCiAgICAgIGdldEVycm9ySW5mbzogcnQoIi4uLiAob25seSBzaG93aW5nIGZpcnN0IHRlbiBmYWlsdXJlcykiKQogICAgfV0pIDogbiwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuICJGYWlsZWQgcGF0aDogKCIgKyB0LnBhdGguam9pbigiID4gIikgKyAiKVxuIiArIHQuZ2V0RXJyb3JJbmZvKCk7CiAgICB9KS5qb2luKCJcbiIpICsgIlxuXG5JbnB1dCBvYmplY3Q6ICIgKyBZZSh0LmlucHV0KTsKICAgIHZhciBuOwogIH0sCiAgICAgIHVyID0gemUsCiAgICAgIGFyID0gZnVuY3Rpb24gYXIodCwgbikgewogICAgcmV0dXJuIHsKICAgICAgdGFnOiAiY3VzdG9tIiwKICAgICAgbmV3S2V5OiB0LAogICAgICBpbnN0YW50aWF0b3I6IG4KICAgIH07CiAgfTsKCiAgZnVuY3Rpb24gY3IodCwgbikgewogICAgcmV0dXJuIChlID0ge30pW3RdID0gbiwgZTsKICAgIHZhciBlOwogIH0KCiAgZnVuY3Rpb24gc3IodCkgewogICAgcmV0dXJuIG4gPSB7fSwgU3QodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgblt0LmtleV0gPSB0LnZhbHVlOwogICAgfSksIG47CiAgICB2YXIgbjsKICB9CgogIGZ1bmN0aW9uIGxyKHQpIHsKICAgIHJldHVybiBtKHQpID8gdCA6IE87CiAgfQoKICBmdW5jdGlvbiBmcih0LCBuLCBlKSB7CiAgICBmb3IgKHZhciBvID0gdC5kb20sIHIgPSBscihlKTsgby5wYXJlbnROb2RlOykgewogICAgICB2YXIgbyA9IG8ucGFyZW50Tm9kZSwKICAgICAgICAgIGkgPSBBdC5mcm9tRG9tKG8pLAogICAgICAgICAgdSA9IG4oaSk7CiAgICAgIGlmICh1LmlzU29tZSgpKSByZXR1cm4gdTsKICAgICAgaWYgKHIoaSkpIGJyZWFrOwogICAgfQoKICAgIHJldHVybiB2dC5ub25lKCk7CiAgfQoKICBmdW5jdGlvbiBkcih0LCBuLCBlKSB7CiAgICB2YXIgbyA9IG4odCksCiAgICAgICAgciA9IGxyKGUpOwogICAgcmV0dXJuIG8ub3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiByKHQpID8gdnQubm9uZSgpIDogZnIodCwgbiwgcik7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIG1yKHQsIG4pIHsKICAgIHJldHVybiBMdCh0LmVsZW1lbnQsIG4uZXZlbnQudGFyZ2V0KTsKICB9CgogIGZ1bmN0aW9uIGdyKHQpIHsKICAgIGlmICghbnQodCwgImNhbiIpICYmICFudCh0LCAiYWJvcnQiKSAmJiAhbnQodCwgInJ1biIpKSB0aHJvdyBuZXcgRXJyb3IoIkV2ZW50SGFuZGxlciBkZWZpbmVkIGJ5OiAiICsgSlNPTi5zdHJpbmdpZnkodCwgbnVsbCwgMikgKyAiIGRvZXMgbm90IGhhdmUgY2FuLCBhYm9ydCwgb3IgcnVuISIpOwogICAgcmV0dXJuIF9sdChfbHQoe30sIHVpKSwgdCk7CiAgfQoKICBmdW5jdGlvbiBwcih0KSB7CiAgICByZXR1cm4gcnQoImFsbG95LiIgKyB0KTsKICB9CgogIGZ1bmN0aW9uIGhyKHQsIG4pIHsKICAgIHR1KHQsIHQuZWxlbWVudCwgbiwge30pOwogIH0KCiAgZnVuY3Rpb24gdnIodCwgbiwgZSkgewogICAgdHUodCwgdC5lbGVtZW50LCBuLCBlKTsKICB9CgogIGZ1bmN0aW9uIGJyKHQpIHsKICAgIGhyKHQsIEZpKCkpOwogIH0KCiAgZnVuY3Rpb24geXIodCwgbiwgZSkgewogICAgdHUodCwgbiwgZSwge30pOwogIH0KCiAgZnVuY3Rpb24geHIodCwgbiwgZSwgbykgewogICAgdC5nZXRTeXN0ZW0oKS50cmlnZ2VyRXZlbnQoZSwgbiwgby5ldmVudCk7CiAgfQoKICBmdW5jdGlvbiB3cih0LCBuKSB7CiAgICByZXR1cm4gewogICAgICBrZXk6IHQsCiAgICAgIHZhbHVlOiBncih7CiAgICAgICAgYWJvcnQ6IG4KICAgICAgfSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBTcih0KSB7CiAgICByZXR1cm4gewogICAgICBrZXk6IHQsCiAgICAgIHZhbHVlOiBncih7CiAgICAgICAgcnVuOiBmdW5jdGlvbiBydW4odCwgbikgewogICAgICAgICAgbi5ldmVudC5wcmV2ZW50KCk7CiAgICAgICAgfQogICAgICB9KQogICAgfTsKICB9CgogIGZ1bmN0aW9uIENyKHQsIG4pIHsKICAgIHJldHVybiB7CiAgICAgIGtleTogdCwKICAgICAgdmFsdWU6IGdyKHsKICAgICAgICBydW46IG4KICAgICAgfSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBrcih0LCBlLCBvKSB7CiAgICByZXR1cm4gewogICAgICBrZXk6IHQsCiAgICAgIHZhbHVlOiBncih7CiAgICAgICAgcnVuOiBmdW5jdGlvbiBydW4odCwgbikgewogICAgICAgICAgZS5hcHBseSh2b2lkIDAsIFt0LCBuXS5jb25jYXQobykpOwogICAgICAgIH0KICAgICAgfSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBPcih0KSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBrZXk6IHQsCiAgICAgICAgdmFsdWU6IGdyKHsKICAgICAgICAgIHJ1bjogZnVuY3Rpb24gcnVuKHQsIG4pIHsKICAgICAgICAgICAgbXIodCwgbikgJiYgZSh0LCBuKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9OwogICAgfTsKICB9CgogIGZ1bmN0aW9uIF9yKHQsIG4sIGUpIHsKICAgIHZhciBvLAogICAgICAgIHIgPSBuLnBhcnRVaWRzW2VdOwogICAgcmV0dXJuIENyKG8gPSB0LCBmdW5jdGlvbiAodCwgbikgewogICAgICB0LmdldFN5c3RlbSgpLmdldEJ5VWlkKHIpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICB4cih0LCB0LmVsZW1lbnQsIG8sIG4pOwogICAgICB9KTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gVHIodCwgcikgewogICAgcmV0dXJuIENyKHQsIGZ1bmN0aW9uIChuLCB0KSB7CiAgICAgIHZhciBlID0gdC5ldmVudCwKICAgICAgICAgIG8gPSBuLmdldFN5c3RlbSgpLmdldEJ5RG9tKGUudGFyZ2V0KS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gZHIoZS50YXJnZXQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gbi5nZXRTeXN0ZW0oKS5nZXRCeURvbSh0KS50b09wdGlvbmFsKCk7CiAgICAgICAgfSwgTykuZ2V0T3Iobik7CiAgICAgIH0pOwogICAgICByKG4sIG8sIHQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBFcih0KSB7CiAgICByZXR1cm4gQ3IodCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgbi5jdXQoKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gRHIodCwgbikgewogICAgcmV0dXJuIE9yKHQpKG4pOwogIH0KCiAgZnVuY3Rpb24gQnIodCkgewogICAgcmV0dXJuIHQuZG9tLmlubmVySFRNTDsKICB9CgogIGZ1bmN0aW9uIE1yKHQsIG4pIHsKICAgIHZhciBlLAogICAgICAgIG8sCiAgICAgICAgciA9IFV0KHQpLmRvbSwKICAgICAgICBpID0gQXQuZnJvbURvbShyLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSk7CiAgICBNbihpLCAoZSA9IG4sIChvID0gKHIgfHwgZG9jdW1lbnQpLmNyZWF0ZUVsZW1lbnQoImRpdiIpKS5pbm5lckhUTUwgPSBlLCBLdChBdC5mcm9tRG9tKG8pKSkpLCBBbih0KSwgX2UodCwgaSk7CiAgfQoKICBmdW5jdGlvbiBBcih0KSB7CiAgICBpZiAoWnQodCkpIHJldHVybiAiI3NoYWRvdy1yb290IjsKICAgIHZhciBuID0gQXQuZnJvbURvbSh0LmRvbS5jbG9uZU5vZGUoITEpKSwKICAgICAgICBlID0gQXQuZnJvbVRhZygiZGl2IiksCiAgICAgICAgbyA9IEF0LmZyb21Eb20obi5kb20uY2xvbmVOb2RlKCEwKSk7CiAgICByZXR1cm4gX2UoZSwgbyksIEJyKGUpOwogIH0KCiAgZnVuY3Rpb24gRnIodCkgewogICAgdmFyIG4gPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIHJldHVybiB0ICsgIl8iICsgTWF0aC5mbG9vcigxZTkgKiBNYXRoLnJhbmRvbSgpKSArICsrY3UgKyBTdHJpbmcobik7CiAgfQoKICBmdW5jdGlvbiBJcih0KSB7CiAgICB2YXIgbiA9IEduKHQpID8gdC5kb21bZHVdIDogbnVsbDsKICAgIHJldHVybiB2dC5mcm9tKG4pOwogIH0KCiAgZnVuY3Rpb24gUnIobikgewogICAgZnVuY3Rpb24gZSh0KSB7CiAgICAgIHJldHVybiAiVGhlIGNvbXBvbmVudCBtdXN0IGJlIGluIGEgY29udGV4dCB0byBleGVjdXRlOiAiICsgdCArIChuID8gIlxuIiArIEFyKG4oKS5lbGVtZW50KSArICIgaXMgbm90IGluIGNvbnRleHQuIiA6ICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0KHQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZSh0KSk7CiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gbyh0KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgY29uc29sZS53YXJuKGUodCkpOwogICAgICB9OwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIGRlYnVnSW5mbzogcnQoImZha2UiKSwKICAgICAgdHJpZ2dlckV2ZW50OiBvKCJ0cmlnZ2VyRXZlbnQiKSwKICAgICAgdHJpZ2dlckZvY3VzOiBvKCJ0cmlnZ2VyRm9jdXMiKSwKICAgICAgdHJpZ2dlckVzY2FwZTogbygidHJpZ2dlckVzY2FwZSIpLAogICAgICBicm9hZGNhc3Q6IG8oImJyb2FkY2FzdCIpLAogICAgICBicm9hZGNhc3RPbjogbygiYnJvYWRjYXN0T24iKSwKICAgICAgYnJvYWRjYXN0RXZlbnQ6IG8oImJyb2FkY2FzdEV2ZW50IiksCiAgICAgIGJ1aWxkOiB0KCJidWlsZCIpLAogICAgICBhZGRUb1dvcmxkOiB0KCJhZGRUb1dvcmxkIiksCiAgICAgIHJlbW92ZUZyb21Xb3JsZDogdCgicmVtb3ZlRnJvbVdvcmxkIiksCiAgICAgIGFkZFRvR3VpOiB0KCJhZGRUb0d1aSIpLAogICAgICByZW1vdmVGcm9tR3VpOiB0KCJyZW1vdmVGcm9tR3VpIiksCiAgICAgIGdldEJ5VWlkOiB0KCJnZXRCeVVpZCIpLAogICAgICBnZXRCeURvbTogdCgiZ2V0QnlEb20iKSwKICAgICAgaXNDb25uZWN0ZWQ6IE8KICAgIH07CiAgfQoKICBmdW5jdGlvbiBWcih0LCBuKSB7CiAgICB2YXIgZSA9IHQudG9TdHJpbmcoKSwKICAgICAgICBvID0gZS5pbmRleE9mKCIpIikgKyAxLAogICAgICAgIHIgPSBlLmluZGV4T2YoIigiKSwKICAgICAgICBpID0gZS5zdWJzdHJpbmcociArIDEsIG8gLSAxKS5zcGxpdCgvLFxzKi8pOwogICAgcmV0dXJuIHQudG9GdW5jdGlvbkFubm90YXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogbiwKICAgICAgICBwYXJhbWV0ZXJzOiB2dShpKQogICAgICB9OwogICAgfSwgdDsKICB9CgogIGZ1bmN0aW9uIFByKHQpIHsKICAgIHJldHVybiBjcihidSwgdCk7CiAgfQoKICBmdW5jdGlvbiBIcihvKSB7CiAgICByZXR1cm4gdCA9IGZ1bmN0aW9uIHQoX3QyKSB7CiAgICAgIGZvciAodmFyIG4gPSBbXSwgZSA9IDE7IGUgPCBhcmd1bWVudHMubGVuZ3RoOyBlKyspIHsKICAgICAgICBuW2UgLSAxXSA9IGFyZ3VtZW50c1tlXTsKICAgICAgfQoKICAgICAgcmV0dXJuIG8uYXBwbHkodm9pZCAwLCBIKFtfdDIuZ2V0QXBpcygpLCBfdDJdLCBuLCAhMSkpOwogICAgfSwgZSA9IChuID0gby50b1N0cmluZygpKS5pbmRleE9mKCIpIikgKyAxLCByID0gbi5pbmRleE9mKCIoIiksIGkgPSBuLnN1YnN0cmluZyhyICsgMSwgZSAtIDEpLnNwbGl0KC8sXHMqLyksIHQudG9GdW5jdGlvbkFubm90YXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogIk9WRVJSSURFIiwKICAgICAgICBwYXJhbWV0ZXJzOiB2dShpLnNsaWNlKDEpKQogICAgICB9OwogICAgfSwgdDsKICAgIHZhciB0LCBuLCBlLCByLCBpOwogIH0KCiAgZnVuY3Rpb24genIodCwgcikgewogICAgdmFyIGkgPSB7fTsKICAgIHJldHVybiBKKHQsIGZ1bmN0aW9uICh0LCBvKSB7CiAgICAgIEoodCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICB2YXIgZSA9IHR0KGksIG4pLmdldE9yKFtdKTsKICAgICAgICBpW25dID0gZS5jb25jYXQoW3IobywgdCldKTsKICAgICAgfSk7CiAgICB9KSwgaTsKICB9CgogIGZ1bmN0aW9uIE5yKHQpIHsKICAgIHJldHVybiB7CiAgICAgIGNsYXNzZXM6IEUodC5jbGFzc2VzKSA/IFtdIDogdC5jbGFzc2VzLAogICAgICBhdHRyaWJ1dGVzOiBFKHQuYXR0cmlidXRlcykgPyB7fSA6IHQuYXR0cmlidXRlcywKICAgICAgc3R5bGVzOiBFKHQuc3R5bGVzKSA/IHt9IDogdC5zdHlsZXMKICAgIH07CiAgfQoKICBmdW5jdGlvbiBMcih0KSB7CiAgICByZXR1cm4gdC5jSGFuZGxlcjsKICB9CgogIGZ1bmN0aW9uIFdyKHQsIG4pIHsKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IHQsCiAgICAgIGhhbmRsZXI6IG4KICAgIH07CiAgfQoKICBmdW5jdGlvbiBVcih0LCBuLCBlKSB7CiAgICB2YXIgbyA9IG5bZV07CiAgICByZXR1cm4gbyA/IGZ1bmN0aW9uICh1LCB0LCBhKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIG4gPSBHKHQsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICB2YXIgZSA9IHQubmFtZSwKICAgICAgICAgICAgICBvID0gbi5uYW1lLAogICAgICAgICAgICAgIHIgPSBhLmluZGV4T2YoZSksCiAgICAgICAgICAgICAgaSA9IGEuaW5kZXhPZihvKTsKICAgICAgICAgIGlmICgtMSA9PT0gcikgdGhyb3cgbmV3IEVycm9yKCJUaGUgb3JkZXJpbmcgZm9yICIgKyB1ICsgIiBkb2VzIG5vdCBoYXZlIGFuIGVudHJ5IGZvciAiICsgZSArICIuXG5PcmRlciBzcGVjaWZpZWQ6ICIgKyBKU09OLnN0cmluZ2lmeShhLCBudWxsLCAyKSk7CiAgICAgICAgICBpZiAoLTEgPT09IGkpIHRocm93IG5ldyBFcnJvcigiVGhlIG9yZGVyaW5nIGZvciAiICsgdSArICIgZG9lcyBub3QgaGF2ZSBhbiBlbnRyeSBmb3IgIiArIG8gKyAiLlxuT3JkZXIgc3BlY2lmaWVkOiAiICsgSlNPTi5zdHJpbmdpZnkoYSwgbnVsbCwgMikpOwogICAgICAgICAgcmV0dXJuIHIgPCBpID8gLTEgOiBpIDwgciA/IDEgOiAwOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBSZS52YWx1ZShuKTsKICAgICAgfSBjYXRjaCAodCkgewogICAgICAgIHJldHVybiBSZS5lcnJvcihbdF0pOwogICAgICB9CiAgICB9KCJFdmVudDogIiArIGUsIHQsIG8pLm1hcChmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSwKICAgICAgICAgIG4sCiAgICAgICAgICBvLAogICAgICAgICAgciwKICAgICAgICAgIGkgPSBNKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHQuaGFuZGxlcjsKICAgICAgfSk7CiAgICAgIHJldHVybiB7CiAgICAgICAgY2FuOiBmdW5jdGlvbiBjYW4oKSB7CiAgICAgICAgICBmb3IgKHZhciBlID0gW10sIHQgPSAwOyB0IDwgYXJndW1lbnRzLmxlbmd0aDsgdCsrKSB7CiAgICAgICAgICAgIGVbdF0gPSBhcmd1bWVudHNbdF07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIFIobiwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgcmV0dXJuIHQgJiYgbi5jYW4uYXBwbHkodm9pZCAwLCBlKTsKICAgICAgICAgIH0sICEwKTsKICAgICAgICB9LAogICAgICAgIGFib3J0OiAobyA9IG4gPSBlID0gaSwgciA9IGZ1bmN0aW9uIHIodCkgewogICAgICAgICAgcmV0dXJuIHQuYWJvcnQ7CiAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgZm9yICh2YXIgZSA9IFtdLCB0ID0gMDsgdCA8IGFyZ3VtZW50cy5sZW5ndGg7IHQrKykgewogICAgICAgICAgICBlW3RdID0gYXJndW1lbnRzW3RdOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBSKG8sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgIHJldHVybiB0IHx8IHIobikuYXBwbHkodm9pZCAwLCBlKTsKICAgICAgICAgIH0sICExKTsKICAgICAgICB9KSwKICAgICAgICBydW46IGZ1bmN0aW9uIHJ1bigpIHsKICAgICAgICAgIGZvciAodmFyIG4gPSBbXSwgdCA9IDA7IHQgPCBhcmd1bWVudHMubGVuZ3RoOyB0KyspIHsKICAgICAgICAgICAgblt0XSA9IGFyZ3VtZW50c1t0XTsKICAgICAgICAgIH0KCiAgICAgICAgICBTdChlLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICB0LnJ1bi5hcHBseSh2b2lkIDAsIG4pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9OwogICAgfSkgOiBSZS5lcnJvcihbIlRoZSBldmVudCAoIiArIGUgKyAnKSBoYXMgbW9yZSB0aGFuIG9uZSBiZWhhdmlvdXIgdGhhdCBsaXN0ZW5zIHRvIGl0LlxuV2hlbiB0aGlzIG9jY3VycywgeW91IG11c3Qgc3BlY2lmeSBhbiBldmVudCBvcmRlcmluZyBmb3IgdGhlIGJlaGF2aW91cnMgaW4geW91ciBzcGVjIChlLmcuIFsgImxpc3RpbmciLCAidG9nZ2xpbmciIF0pLlxuVGhlIGJlaGF2aW91cnMgdGhhdCBjYW4gdHJpZ2dlciBpdCBhcmU6ICcgKyBKU09OLnN0cmluZ2lmeShNKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0Lm5hbWU7CiAgICB9KSwgbnVsbCwgMildKTsKICB9CgogIGZ1bmN0aW9uIGpyKHQsIG4pIHsKICAgIHZhciBlID0gcm4odCwgbik7CiAgICByZXR1cm4gdm9pZCAwID09PSBlIHx8ICIiID09PSBlID8gW10gOiBlLnNwbGl0KCIgIik7CiAgfQoKICBmdW5jdGlvbiBHcih0KSB7CiAgICByZXR1cm4gdm9pZCAwICE9PSB0LmRvbS5jbGFzc0xpc3Q7CiAgfQoKICBmdW5jdGlvbiBYcih0LCBuKSB7CiAgICB2YXIgZSwgbywgcjsKICAgIEdyKHQpID8gdC5kb20uY2xhc3NMaXN0LmFkZChuKSA6IChvID0gbiwgciA9IGpyKGUgPSB0LCAiY2xhc3MiKS5jb25jYXQoW29dKSwgb24oZSwgImNsYXNzIiwgci5qb2luKCIgIikpKTsKICB9CgogIGZ1bmN0aW9uIFlyKHQsIG4pIHsKICAgIHZhciBlLCBvLCByLCBpOwogICAgR3IodCkgPyB0LmRvbS5jbGFzc0xpc3QucmVtb3ZlKG4pIDogKHIgPSBuLCAwIDwgKGkgPSBGKGpyKG8gPSB0LCAiY2xhc3MiKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQgIT09IHI7CiAgICB9KSkubGVuZ3RoID8gb24obywgImNsYXNzIiwgaS5qb2luKCIgIikpIDogY24obywgImNsYXNzIikpLCAwID09PSAoR3IoZSA9IHQpID8gZS5kb20uY2xhc3NMaXN0IDoganIoZSwgImNsYXNzIikpLmxlbmd0aCAmJiBjbihlLCAiY2xhc3MiKTsKICB9CgogIGZ1bmN0aW9uIHFyKHQsIG4pIHsKICAgIHJldHVybiBHcih0KSAmJiB0LmRvbS5jbGFzc0xpc3QuY29udGFpbnMobik7CiAgfQoKICBmdW5jdGlvbiBLcihuLCB0KSB7CiAgICBTdCh0LCBmdW5jdGlvbiAodCkgewogICAgICBYcihuLCB0KTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gSnIobiwgdCkgewogICAgU3QodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgWXIobiwgdCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uICRyKHQpIHsKICAgIHJldHVybiB0LmRvbS52YWx1ZTsKICB9CgogIGZ1bmN0aW9uIFFyKHQsIG4pIHsKICAgIGlmICh2b2lkIDAgPT09IG4pIHRocm93IG5ldyBFcnJvcigiVmFsdWUuc2V0IHdhcyB1bmRlZmluZWQiKTsKICAgIHQuZG9tLnZhbHVlID0gbjsKICB9CgogIGZ1bmN0aW9uIFpyKHQpIHsKICAgIHZhciBlLAogICAgICAgIG4sCiAgICAgICAgbywKICAgICAgICByLAogICAgICAgIGkgPSAoZSA9IHR0KHQsICJiZWhhdmlvdXJzIikuZ2V0T3Ioe30pLCB6KGt0KGUpLCBmdW5jdGlvbiAodCkgewogICAgICB2YXIgbiA9IGVbdF07CiAgICAgIHJldHVybiBkKG4pID8gW24ubWVdIDogW107CiAgICB9KSk7CiAgICByZXR1cm4gbiA9IHQsIHIgPSBNKG8gPSBpLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gX28odC5uYW1lKCksIFtmbygiY29uZmlnIiksIFRvKCJzdGF0ZSIsIHl1KV0pOwogICAgfSksIHsKICAgICAgbGlzdDogbywKICAgICAgZGF0YTogZHQodW8oImNvbXBvbmVudC5iZWhhdmlvdXJzIiwgSm8ociksIG4uYmVoYXZpb3VycykuZm9sZChmdW5jdGlvbiAodCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihpcih0KSArICJcbkNvbXBsZXRlIHNwZWM6XG4iICsgSlNPTi5zdHJpbmdpZnkobiwgbnVsbCwgMikpOwogICAgICB9LCBoKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gcnQodC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNvbmZpZzogdC5jb25maWcsCiAgICAgICAgICAgIHN0YXRlOiB0LnN0YXRlLmluaXQodC5jb25maWcpCiAgICAgICAgICB9OwogICAgICAgIH0pKTsKICAgICAgfSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiB0aSh0LCBuLCBlKSB7CiAgICB2YXIgbywKICAgICAgICByLAogICAgICAgIGkgPSBfbHQoX2x0KHt9LCAobyA9IHQpLmRvbSksIHsKICAgICAgdWlkOiBvLnVpZCwKICAgICAgZG9tQ2hpbGRyZW46IE0oby5jb21wb25lbnRzLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0LmVsZW1lbnQ7CiAgICAgIH0pCiAgICB9KSwKICAgICAgICB1ID0gdC5kb21Nb2RpZmljYXRpb24uZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBOcih7fSk7CiAgICB9LCBOciksCiAgICAgICAgYSA9IDAgPCBuLmxlbmd0aCA/IGZ1bmN0aW9uIChuLCB0LCBlLCBvKSB7CiAgICAgIHZhciByID0gX2x0KHt9LCB0KTsKCiAgICAgIGZ1bmN0aW9uIGkodCkgewogICAgICAgIHJldHVybiBJKHQsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICByZXR1cm4gX2x0KF9sdCh7fSwgbi5tb2RpZmljYXRpb24pLCB0KTsKICAgICAgICB9LCB7fSk7CiAgICAgIH0KCiAgICAgIFN0KGUsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgclt0Lm5hbWUoKV0gPSB0LmV4aGliaXQobiwgbyk7CiAgICAgIH0pOwogICAgICB2YXIgdSA9IHpyKHIsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG5hbWU6IHQsCiAgICAgICAgICBtb2RpZmljYXRpb246IG4KICAgICAgICB9OwogICAgICB9KTsKICAgICAgcmV0dXJuIE5yKHsKICAgICAgICBjbGFzc2VzOiBJKHUuY2xhc3NlcywgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIHJldHVybiBuLm1vZGlmaWNhdGlvbi5jb25jYXQodCk7CiAgICAgICAgfSwgW10pLAogICAgICAgIGF0dHJpYnV0ZXM6IGkodS5hdHRyaWJ1dGVzKSwKICAgICAgICBzdHlsZXM6IGkodS5zdHlsZXMpCiAgICAgIH0pOwogICAgfShlLCB7CiAgICAgICJhbGxveS5iYXNlLm1vZGlmaWNhdGlvbiI6IHUKICAgIH0sIG4sIGkpIDogdTsKCiAgICByZXR1cm4gX2x0KF9sdCh7fSwgciA9IGkpLCB7CiAgICAgIGF0dHJpYnV0ZXM6IF9sdChfbHQoe30sIHIuYXR0cmlidXRlcyksIGEuYXR0cmlidXRlcyksCiAgICAgIHN0eWxlczogX2x0KF9sdCh7fSwgci5zdHlsZXMpLCBhLnN0eWxlcyksCiAgICAgIGNsYXNzZXM6IHIuY2xhc3Nlcy5jb25jYXQoYS5jbGFzc2VzKQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBuaSh0LCBuLCBlKSB7CiAgICB2YXIgbywKICAgICAgICByLAogICAgICAgIGksCiAgICAgICAgdSwKICAgICAgICBhLAogICAgICAgIGMgPSB7CiAgICAgICJhbGxveS5iYXNlLmJlaGF2aW91ciI6IHQuZXZlbnRzCiAgICB9LAogICAgICAgIHMgPSB0LmV2ZW50T3JkZXI7CiAgICByZXR1cm4gciA9IGUsIGkgPSBuLCBvID0genIoX2x0KF9sdCh7fSwgYyksICh1ID0gciwgYSA9IHt9LCBTdChpLCBmdW5jdGlvbiAodCkgewogICAgICBhW3QubmFtZSgpXSA9IHQuaGFuZGxlcnModSk7CiAgICB9KSwgYSkpLCBXciksIHd1KG8sIHMpLmdldE9yRGllKCk7CiAgfQoKICBmdW5jdGlvbiBlaShlKSB7CiAgICBmdW5jdGlvbiB0KCkgewogICAgICByZXR1cm4gbDsKICAgIH0KCiAgICB2YXIgbiA9IFZvKGh1KSwKICAgICAgICBvID0gYW8odW8oImN1c3RvbS5kZWZpbml0aW9uIiwgQ3UsIGUpKSwKICAgICAgICByID0gWnIoZSksCiAgICAgICAgaSA9IHIubGlzdCwKICAgICAgICB1ID0gci5kYXRhLAogICAgICAgIGEgPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgbiA9IEF0LmZyb21UYWcodC50YWcpLAogICAgICAgICAgZSA9IHQuYXR0cmlidXRlcywKICAgICAgICAgIG8gPSBuLmRvbTsKICAgICAgSihlLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIGVuKG8sIG4sIHQpOwogICAgICB9KSwgS3IobiwgdC5jbGFzc2VzKSwgZG4obiwgdC5zdHlsZXMpLCB0LmlubmVySHRtbC5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIE1yKG4sIHQpOwogICAgICB9KTsKICAgICAgdmFyIHIgPSB0LmRvbUNoaWxkcmVuOwogICAgICByZXR1cm4gTW4obiwgciksIHQudmFsdWUuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIFFyKG4sIHQpOwogICAgICB9KSwgdC51aWQsIG11KG4sIHQudWlkKSwgbjsKICAgIH0odGkobywgaSwgdSkpLAogICAgICAgIGMgPSBuaShvLCBpLCB1KSwKICAgICAgICBzID0gVm8oby5jb21wb25lbnRzKSwKICAgICAgICBsID0gewogICAgICB1aWQ6IGUudWlkLAogICAgICBnZXRTeXN0ZW06IG4uZ2V0LAogICAgICBjb25maWc6IGZ1bmN0aW9uIGNvbmZpZyh0KSB7CiAgICAgICAgdmFyIG4gPSB1OwogICAgICAgIHJldHVybiAobShuW3QubmFtZSgpXSkgPyBuW3QubmFtZSgpXSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ291bGQgbm90IGZpbmQgIiArIHQubmFtZSgpICsgIiBpbiAiICsgSlNPTi5zdHJpbmdpZnkoZSwgbnVsbCwgMikpOwogICAgICAgIH0pKCk7CiAgICAgIH0sCiAgICAgIGhhc0NvbmZpZ3VyZWQ6IGZ1bmN0aW9uIGhhc0NvbmZpZ3VyZWQodCkgewogICAgICAgIHJldHVybiBtKHVbdC5uYW1lKCldKTsKICAgICAgfSwKICAgICAgc3BlYzogZSwKICAgICAgcmVhZFN0YXRlOiBmdW5jdGlvbiByZWFkU3RhdGUodCkgewogICAgICAgIHJldHVybiB1W3RdKCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC5zdGF0ZS5yZWFkU3RhdGUoKTsKICAgICAgICB9KS5nZXRPcigibm90IGVuYWJsZWQiKTsKICAgICAgfSwKICAgICAgZ2V0QXBpczogZnVuY3Rpb24gZ2V0QXBpcygpIHsKICAgICAgICByZXR1cm4gby5hcGlzOwogICAgICB9LAogICAgICBjb25uZWN0OiBmdW5jdGlvbiBjb25uZWN0KHQpIHsKICAgICAgICBuLnNldCh0KTsKICAgICAgfSwKICAgICAgZGlzY29ubmVjdDogZnVuY3Rpb24gZGlzY29ubmVjdCgpIHsKICAgICAgICBuLnNldChScih0KSk7CiAgICAgIH0sCiAgICAgIGVsZW1lbnQ6IGEsCiAgICAgIHN5bmNDb21wb25lbnRzOiBmdW5jdGlvbiBzeW5jQ29tcG9uZW50cygpIHsKICAgICAgICB2YXIgdCA9IHooS3QoYSksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gbi5nZXQoKS5nZXRCeURvbSh0KS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgfSwgaik7CiAgICAgICAgfSk7CiAgICAgICAgcy5zZXQodCk7CiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IHMuZ2V0LAogICAgICBldmVudHM6IGMKICAgIH07CgogICAgcmV0dXJuIGw7CiAgfQoKICBmdW5jdGlvbiBvaSh0KSB7CiAgICB2YXIgbiA9IEF0LmZyb21UZXh0KHQpOwogICAgcmV0dXJuIGt1KHsKICAgICAgZWxlbWVudDogbgogICAgfSk7CiAgfQoKICBQbyhbewogICAgYm90aEVycm9yczogWyJlcnJvcjEiLCAiZXJyb3IyIl0KICB9LCB7CiAgICBmaXJzdEVycm9yOiBbImVycm9yMSIsICJ2YWx1ZTIiXQogIH0sIHsKICAgIHNlY29uZEVycm9yOiBbInZhbHVlMSIsICJlcnJvcjIiXQogIH0sIHsKICAgIGJvdGhWYWx1ZXM6IFsidmFsdWUxIiwgInZhbHVlMiJdCiAgfV0pOwoKICB2YXIgcmksCiAgICAgIGlpLAogICAgICB1aSA9IHsKICAgIGNhbjogXywKICAgIGFib3J0OiBPLAogICAgcnVuOiBzdAogIH0sCiAgICAgIGFpID0gcnQsCiAgICAgIGNpID0gYWkoInRvdWNoc3RhcnQiKSwKICAgICAgc2kgPSBhaSgidG91Y2htb3ZlIiksCiAgICAgIGxpID0gYWkoInRvdWNoZW5kIiksCiAgICAgIGZpID0gYWkoInRvdWNoY2FuY2VsIiksCiAgICAgIGRpID0gYWkoIm1vdXNlZG93biIpLAogICAgICBtaSA9IGFpKCJtb3VzZW1vdmUiKSwKICAgICAgZ2kgPSBhaSgibW91c2VvdXQiKSwKICAgICAgcGkgPSBhaSgibW91c2V1cCIpLAogICAgICBoaSA9IGFpKCJtb3VzZW92ZXIiKSwKICAgICAgdmkgPSBhaSgiZm9jdXNpbiIpLAogICAgICBiaSA9IGFpKCJmb2N1c291dCIpLAogICAgICB5aSA9IGFpKCJrZXlkb3duIiksCiAgICAgIHhpID0gYWkoImtleXVwIiksCiAgICAgIHdpID0gYWkoImlucHV0IiksCiAgICAgIFNpID0gYWkoImNoYW5nZSIpLAogICAgICBDaSA9IGFpKCJjbGljayIpLAogICAgICBraSA9IGFpKCJ0cmFuc2l0aW9uY2FuY2VsIiksCiAgICAgIE9pID0gYWkoInRyYW5zaXRpb25lbmQiKSwKICAgICAgX2kgPSBhaSgidHJhbnNpdGlvbnN0YXJ0IiksCiAgICAgIFRpID0gYWkoInNlbGVjdHN0YXJ0IiksCiAgICAgIEVpID0gewogICAgdGFwOiBwcigidGFwIikKICB9LAogICAgICBEaSA9IHByKCJmb2N1cyIpLAogICAgICBCaSA9IHByKCJibHVyLnBvc3QiKSwKICAgICAgTWkgPSBwcigicGFzdGUucG9zdCIpLAogICAgICBBaSA9IHByKCJyZWNlaXZlIiksCiAgICAgIEZpID0gcHIoImV4ZWN1dGUiKSwKICAgICAgSWkgPSBwcigiZm9jdXMuaXRlbSIpLAogICAgICBSaSA9IEVpLnRhcCwKICAgICAgVmkgPSBwcigibG9uZ3ByZXNzIiksCiAgICAgIFBpID0gcHIoInNhbmRib3guY2xvc2UiKSwKICAgICAgSGkgPSBwcigidHlwZWFoZWFkLmNhbmNlbCIpLAogICAgICB6aSA9IHByKCJzeXN0ZW0uaW5pdCIpLAogICAgICBOaSA9IHByKCJzeXN0ZW0udG91Y2htb3ZlIiksCiAgICAgIExpID0gcHIoInN5c3RlbS50b3VjaGVuZCIpLAogICAgICBXaSA9IHByKCJzeXN0ZW0uc2Nyb2xsIiksCiAgICAgIFVpID0gcHIoInN5c3RlbS5yZXNpemUiKSwKICAgICAgamkgPSBwcigic3lzdGVtLmF0dGFjaGVkIiksCiAgICAgIEdpID0gcHIoInN5c3RlbS5kZXRhY2hlZCIpLAogICAgICBYaSA9IHByKCJzeXN0ZW0uZGlzbWlzc1JlcXVlc3RlZCIpLAogICAgICBZaSA9IHByKCJzeXN0ZW0ucmVwb3NpdGlvblJlcXVlc3RlZCIpLAogICAgICBxaSA9IHByKCJmb2N1c21hbmFnZXIuc2hpZnRlZCIpLAogICAgICBLaSA9IHByKCJzbG90Y29udGFpbmVyLnZpc2liaWxpdHkiKSwKICAgICAgSmkgPSBwcigiY2hhbmdlLnRhYiIpLAogICAgICAkaSA9IHByKCJkaXNtaXNzLnRhYiIpLAogICAgICBRaSA9IHByKCJoaWdobGlnaHQiKSwKICAgICAgWmkgPSBwcigiZGVoaWdobGlnaHQiKSwKICAgICAgdHUgPSBmdW5jdGlvbiB0dSh0LCBuLCBlLCBvKSB7CiAgICB2YXIgciA9IF9sdCh7CiAgICAgIHRhcmdldDogbgogICAgfSwgbyk7CgogICAgdC5nZXRTeXN0ZW0oKS50cmlnZ2VyRXZlbnQoZSwgbiwgcik7CiAgfSwKICAgICAgbnUgPSBzciwKICAgICAgZXUgPSBPcihqaSgpKSwKICAgICAgb3UgPSBPcihHaSgpKSwKICAgICAgcnUgPSBPcih6aSgpKSwKICAgICAgaXUgPSAocmkgPSBGaSgpLCBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIENyKHJpLCB0KTsKICB9KSwKICAgICAgdXUgPSBudShbewogICAga2V5OiBEaSgpLAogICAgdmFsdWU6IGdyKHsKICAgICAgY2FuOiBmdW5jdGlvbiBjYW4odCwgbikgewogICAgICAgIHZhciBlLAogICAgICAgICAgICBvID0gbi5ldmVudCwKICAgICAgICAgICAgciA9IG8ub3JpZ2luYXRvciwKICAgICAgICAgICAgaSA9IG8udGFyZ2V0OwogICAgICAgIHJldHVybiAhKEx0KGUgPSByLCB0LmVsZW1lbnQpICYmICFMdChlLCBpKSAmJiAoY29uc29sZS53YXJuKERpKCkgKyAiIGRpZCBub3QgZ2V0IGludGVycHJldGVkIGJ5IHRoZSBkZXNpcmVkIHRhcmdldC4gXG5PcmlnaW5hdG9yOiAiICsgQXIocikgKyAiXG5UYXJnZXQ6ICIgKyBBcihpKSArICJcbkNoZWNrIHRoZSAiICsgRGkoKSArICIgZXZlbnQgaGFuZGxlcnMiKSwgMSkpOwogICAgICB9CiAgICB9KQogIH1dKSwKICAgICAgYXUgPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGV2ZW50czogdXUKICB9KSwKICAgICAgY3UgPSAwLAogICAgICBzdSA9IHJ0KCJhbGxveS1pZC0iKSwKICAgICAgbHUgPSBydCgiZGF0YS1hbGxveS1pZCIpLAogICAgICBmdSA9IHN1KCksCiAgICAgIGR1ID0gbHUoKSwKICAgICAgbXUgPSBmdW5jdGlvbiBtdSh0LCBuKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodC5kb20sIGR1LCB7CiAgICAgIHZhbHVlOiBuLAogICAgICB3cml0YWJsZTogITAKICAgIH0pOwogIH0sCiAgICAgIGd1ID0gRnIsCiAgICAgIHB1ID0gaCwKICAgICAgaHUgPSBScigpLAogICAgICB2dSA9IGZ1bmN0aW9uIHZ1KHQpIHsKICAgIHJldHVybiBNKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBCdCh0LCAiLyoiKSA/IHQuc3Vic3RyaW5nKDAsIHQubGVuZ3RoIC0gIi8qIi5sZW5ndGgpIDogdDsKICAgIH0pOwogIH0sCiAgICAgIGJ1ID0gRnIoImFsbG95LXByZW1hZGUiKSwKICAgICAgeXUgPSB7CiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICByZXR1cm4geHUoewogICAgICAgIHJlYWRTdGF0ZTogcnQoIk5vIFN0YXRlIHJlcXVpcmVkIikKICAgICAgfSk7CiAgICB9CiAgfSwKICAgICAgeHUgPSBmdW5jdGlvbiB4dSh0KSB7CiAgICByZXR1cm4gdDsKICB9LAogICAgICB3dSA9IGZ1bmN0aW9uIHd1KHQsIGEpIHsKICAgIHZhciBuLAogICAgICAgIGUsCiAgICAgICAgbywKICAgICAgICByLAogICAgICAgIGksCiAgICAgICAgdSwKICAgICAgICBjID0gJCh0LCBmdW5jdGlvbiAociwgdSkgewogICAgICByZXR1cm4gKDEgPT09IHIubGVuZ3RoID8gUmUudmFsdWUoclswXS5oYW5kbGVyKSA6IFVyKHIsIGEsIHUpKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbiwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgZSA9IChpID0gbShuID0gdCkgPyB7CiAgICAgICAgICBjYW46IF8sCiAgICAgICAgICBhYm9ydDogTywKICAgICAgICAgIHJ1bjogbgogICAgICAgIH0gOiBuLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgZm9yICh2YXIgZSA9IFtdLCBvID0gMjsgbyA8IGFyZ3VtZW50cy5sZW5ndGg7IG8rKykgewogICAgICAgICAgICBlW28gLSAyXSA9IGFyZ3VtZW50c1tvXTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgciA9IFt0LCBuXS5jb25jYXQoZSk7CiAgICAgICAgICBpLmFib3J0LmFwcGx5KHZvaWQgMCwgcikgPyBuLnN0b3AoKSA6IGkuY2FuLmFwcGx5KHZvaWQgMCwgcikgJiYgaS5ydW4uYXBwbHkodm9pZCAwLCByKTsKICAgICAgICB9KSwKICAgICAgICAgICAgbyA9IDEgPCByLmxlbmd0aCA/IEYoYVt1XSwgZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIHJldHVybiBUKHIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB0Lm5hbWUgPT09IG47CiAgICAgICAgICB9KTsKICAgICAgICB9KS5qb2luKCIgPiAiKSA6IHJbMF0ubmFtZTsKICAgICAgICByZXR1cm4gY3IodSwgewogICAgICAgICAgaGFuZGxlcjogZSwKICAgICAgICAgIHB1cnBvc2U6IG8KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiBuID0ge30sIGUgPSBbXSwgbyA9IFtdLCBTdChjLCBmdW5jdGlvbiAodCkgewogICAgICB0LmZvbGQoZnVuY3Rpb24gKHQpIHsKICAgICAgICBlLnB1c2godCk7CiAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgby5wdXNoKHQpOwogICAgICB9KTsKICAgIH0pLCAwIDwgKHUgPSB7CiAgICAgIGVycm9yczogZSwKICAgICAgdmFsdWVzOiBvCiAgICB9KS5lcnJvcnMubGVuZ3RoID8gUmUuZXJyb3IoZnQodS5lcnJvcnMpKSA6IChpID0gbiwgMCA9PT0gKHIgPSB1LnZhbHVlcykubGVuZ3RoID8gUmUudmFsdWUoaSkgOiBSZS52YWx1ZShYbyhpLCBZby5hcHBseSh2b2lkIDAsIHIpKSkpOwogIH0sCiAgICAgIFN1ID0gImFsbG95LmJhc2UuYmVoYXZpb3VyIiwKICAgICAgQ3UgPSBKbyhbdXIoImRvbSIsICJkb20iLCBXZSgpLCBKbyhbZm8oInRhZyIpLCBUbygic3R5bGVzIiwge30pLCBUbygiY2xhc3NlcyIsIFtdKSwgVG8oImF0dHJpYnV0ZXMiLCB7fSksIHhvKCJ2YWx1ZSIpLCB4bygiaW5uZXJIdG1sIildKSksIGZvKCJjb21wb25lbnRzIiksIGZvKCJ1aWQiKSwgVG8oImV2ZW50cyIsIHt9KSwgVG8oImFwaXMiLCB7fSksIHVyKCJldmVudE9yZGVyIiwgImV2ZW50T3JkZXIiLCAoKGlpID0ge30pW0ZpKCldID0gWyJkaXNhYmxpbmciLCBTdSwgInRvZ2dsaW5nIiwgInR5cGVhaGVhZGV2ZW50cyJdLCBpaVtEaSgpXSA9IFtTdSwgImZvY3VzaW5nIiwgImtleWluZyJdLCBpaVt6aSgpXSA9IFtTdSwgImRpc2FibGluZyIsICJ0b2dnbGluZyIsICJyZXByZXNlbnRpbmciXSwgaWlbd2koKV0gPSBbU3UsICJyZXByZXNlbnRpbmciLCAic3RyZWFtaW5nIiwgImludmFsaWRhdGluZyJdLCBpaVtHaSgpXSA9IFtTdSwgInJlcHJlc2VudGluZyIsICJpdGVtLWV2ZW50cyIsICJ0b29sdGlwcGluZyJdLCBpaVtkaSgpXSA9IFsiZm9jdXNpbmciLCBTdSwgIml0ZW0tdHlwZS1ldmVudHMiXSwgaWlbY2koKV0gPSBbImZvY3VzaW5nIiwgU3UsICJpdGVtLXR5cGUtZXZlbnRzIl0sIGlpW2hpKCldID0gWyJpdGVtLXR5cGUtZXZlbnRzIiwgInRvb2x0aXBwaW5nIl0sIGlpW0FpKCldID0gWyJyZWNlaXZpbmciLCAicmVmbGVjdGluZyIsICJ0b29sdGlwcGluZyJdLCBYZShydChpaSkpKSwgUW8oKSksIHhvKCJkb21Nb2RpZmljYXRpb24iKV0pLAogICAgICBrdSA9IGZ1bmN0aW9uIGt1KHQpIHsKICAgIHZhciBuID0gY28oImV4dGVybmFsLmNvbXBvbmVudCIsIFplKFtmbygiZWxlbWVudCIpLCB4bygidWlkIildKSwgdCksCiAgICAgICAgZSA9IFZvKFJyKCkpLAogICAgICAgIG8gPSBuLnVpZC5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGd1KCJleHRlcm5hbCIpOwogICAgfSk7CiAgICBtdShuLmVsZW1lbnQsIG8pOwogICAgdmFyIHIgPSB7CiAgICAgIHVpZDogbywKICAgICAgZ2V0U3lzdGVtOiBlLmdldCwKICAgICAgY29uZmlnOiB2dC5ub25lLAogICAgICBoYXNDb25maWd1cmVkOiBPLAogICAgICBjb25uZWN0OiBmdW5jdGlvbiBjb25uZWN0KHQpIHsKICAgICAgICBlLnNldCh0KTsKICAgICAgfSwKICAgICAgZGlzY29ubmVjdDogZnVuY3Rpb24gZGlzY29ubmVjdCgpIHsKICAgICAgICBlLnNldChScihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gcjsKICAgICAgICB9KSk7CiAgICAgIH0sCiAgICAgIGdldEFwaXM6IGZ1bmN0aW9uIGdldEFwaXMoKSB7CiAgICAgICAgcmV0dXJuIHt9OwogICAgICB9LAogICAgICBlbGVtZW50OiBuLmVsZW1lbnQsCiAgICAgIHNwZWM6IHQsCiAgICAgIHJlYWRTdGF0ZTogcnQoIk5vIHN0YXRlIiksCiAgICAgIHN5bmNDb21wb25lbnRzOiBzdCwKICAgICAgY29tcG9uZW50czogcnQoW10pLAogICAgICBldmVudHM6IHt9CiAgICB9OwogICAgcmV0dXJuIFByKHIpOwogIH0sCiAgICAgIE91ID0gZ3UsCiAgICAgIF91ID0gZnVuY3Rpb24gX3UodSkgewogICAgcmV0dXJuIHR0KHUsIGJ1KS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHQsCiAgICAgICAgICBuLAogICAgICAgICAgZSwKICAgICAgICAgIG8sCiAgICAgICAgICByLAogICAgICAgICAgaSA9IFR0KHUsICJ1aWQiKSA/IHUgOiBfbHQoewogICAgICAgIHVpZDogT3UoIiIpCiAgICAgIH0sIHUpOwogICAgICByZXR1cm4gdCA9IHB1KGkpLCBuID0gdC5ldmVudHMsIGUgPSBzKHQsIFsiZXZlbnRzIl0pLCBvID0gTSh0dChlLCAiY29tcG9uZW50cyIpLmdldE9yKFtdKSwgX3UpLCByID0gX2x0KF9sdCh7fSwgZSksIHsKICAgICAgICBldmVudHM6IF9sdChfbHQoe30sIGF1KSwgbiksCiAgICAgICAgY29tcG9uZW50czogbwogICAgICB9KSwgUmUudmFsdWUoZWkocikpLmdldE9yRGllKCk7CiAgICB9KTsKICB9LAogICAgICBUdSA9IFByOwoKICBmdW5jdGlvbiBFdSh0LCBuLCBlLCBvLCByKSB7CiAgICByZXR1cm4gdChlLCBvKSA/IHZ0LnNvbWUoZSkgOiBtKHIpICYmIHIoZSkgPyB2dC5ub25lKCkgOiBuKGUsIG8sIHIpOwogIH0KCiAgZnVuY3Rpb24gRHUodCwgbiwgZSkgewogICAgZm9yICh2YXIgbyA9IHQuZG9tLCByID0gbShlKSA/IGUgOiBPOyBvLnBhcmVudE5vZGU7KSB7CiAgICAgIHZhciBvID0gby5wYXJlbnROb2RlLAogICAgICAgICAgaSA9IEF0LmZyb21Eb20obyk7CiAgICAgIGlmIChuKGkpKSByZXR1cm4gdnQuc29tZShpKTsKICAgICAgaWYgKHIoaSkpIGJyZWFrOwogICAgfQoKICAgIHJldHVybiB2dC5ub25lKCk7CiAgfQoKICBmdW5jdGlvbiBCdSh0LCBuLCBlKSB7CiAgICByZXR1cm4gRXUoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIG4odCk7CiAgICB9LCBEdSwgdCwgbiwgZSk7CiAgfQoKICBmdW5jdGlvbiBNdSh0LCBuLCBlKSB7CiAgICByZXR1cm4gQnUodCwgbiwgZSkuaXNTb21lKCk7CiAgfQoKICBmdW5jdGlvbiBBdSh0LCBuLCBlKSB7CiAgICByZXR1cm4gRHUodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHp0KHQsIG4pOwogICAgfSwgZSk7CiAgfQoKICBmdW5jdGlvbiBGdSh0LCBuKSB7CiAgICByZXR1cm4gZSA9IG4sIE50KG8gPSB2b2lkIDAgPT09IHQgPyBkb2N1bWVudCA6IHQuZG9tKSA/IHZ0Lm5vbmUoKSA6IHZ0LmZyb20oby5xdWVyeVNlbGVjdG9yKGUpKS5tYXAoQXQuZnJvbURvbSk7CiAgICB2YXIgZSwgbzsKICB9CgogIGZ1bmN0aW9uIEl1KHQsIG4sIGUpIHsKICAgIHJldHVybiBFdSh6dCwgQXUsIHQsIG4sIGUpOwogIH0KCiAgZnVuY3Rpb24gUnUoKSB7CiAgICB2YXIgbiA9IEZyKCJhcmlhLW93bnMiKTsKICAgIHJldHVybiB7CiAgICAgIGlkOiBuLAogICAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHQpIHsKICAgICAgICBvbih0LCAiYXJpYS1vd25zIiwgbik7CiAgICAgIH0sCiAgICAgIHVubGluazogZnVuY3Rpb24gdW5saW5rKHQpIHsKICAgICAgICBjbih0LCAiYXJpYS1vd25zIik7CiAgICAgIH0KICAgIH07CiAgfQoKICB2YXIgVnUsCiAgICAgIFB1LAogICAgICBIdSA9IGZ1bmN0aW9uIEh1KG4sIHQpIHsKICAgIHJldHVybiBNdSh0LCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gTHQodCwgbi5lbGVtZW50KTsKICAgIH0sIE8pIHx8IChlID0gbiwgQnUodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgaWYgKCFHbih0KSkgcmV0dXJuICExOwogICAgICB2YXIgbiA9IHJuKHQsICJpZCIpOwogICAgICByZXR1cm4gdm9pZCAwICE9PSBuICYmIC0xIDwgbi5pbmRleE9mKCJhcmlhLW93bnMiKTsKICAgIH0pLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSBybih0LCAiaWQiKTsKICAgICAgcmV0dXJuIEZ1KG1lKHQpLCAnW2FyaWEtb3ducz0iJyArIG4gKyAnIl0nKTsKICAgIH0pLmV4aXN0cyhmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gSHUoZSwgdCk7CiAgICB9KSk7CiAgICB2YXIgZTsKICB9LAogICAgICB6dSA9ICJ1bmtub3duIjsKCiAgZnVuY3Rpb24gTnUobiwgdCwgZSkgewogICAgdmFyIG8sIHIsIGksIHU7CgogICAgc3dpdGNoICh0dChMdS5nZXQoKSwgbikub3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBLKGt0KEx1LmdldCgpKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gLTEgPCBuLmluZGV4T2YodCkgPyB2dC5zb21lKEx1LmdldCgpW3RdKSA6IHZ0Lm5vbmUoKTsKICAgICAgfSk7CiAgICB9KS5nZXRPcihWdS5OT1JNQUwpKSB7CiAgICAgIGNhc2UgVnUuTk9STUFMOgogICAgICAgIHJldHVybiBlKFV1KCkpOwoKICAgICAgY2FzZSBWdS5MT0dHSU5HOgogICAgICAgIHZhciBhID0gKG8gPSBuLCByID0gdCwgaSA9IFtdLCB1ID0gbmV3IERhdGUoKS5nZXRUaW1lKCksIHsKICAgICAgICAgIGxvZ0V2ZW50Q3V0OiBmdW5jdGlvbiBsb2dFdmVudEN1dCh0LCBuLCBlKSB7CiAgICAgICAgICAgIGkucHVzaCh7CiAgICAgICAgICAgICAgb3V0Y29tZTogImN1dCIsCiAgICAgICAgICAgICAgdGFyZ2V0OiBuLAogICAgICAgICAgICAgIHB1cnBvc2U6IGUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgbG9nRXZlbnRTdG9wcGVkOiBmdW5jdGlvbiBsb2dFdmVudFN0b3BwZWQodCwgbiwgZSkgewogICAgICAgICAgICBpLnB1c2goewogICAgICAgICAgICAgIG91dGNvbWU6ICJzdG9wcGVkIiwKICAgICAgICAgICAgICB0YXJnZXQ6IG4sCiAgICAgICAgICAgICAgcHVycG9zZTogZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBsb2dOb1BhcmVudDogZnVuY3Rpb24gbG9nTm9QYXJlbnQodCwgbiwgZSkgewogICAgICAgICAgICBpLnB1c2goewogICAgICAgICAgICAgIG91dGNvbWU6ICJuby1wYXJlbnQiLAogICAgICAgICAgICAgIHRhcmdldDogbiwKICAgICAgICAgICAgICBwdXJwb3NlOiBlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGxvZ0V2ZW50Tm9IYW5kbGVyczogZnVuY3Rpb24gbG9nRXZlbnROb0hhbmRsZXJzKHQsIG4pIHsKICAgICAgICAgICAgaS5wdXNoKHsKICAgICAgICAgICAgICBvdXRjb21lOiAibm8taGFuZGxlcnMtbGVmdCIsCiAgICAgICAgICAgICAgdGFyZ2V0OiBuCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGxvZ0V2ZW50UmVzcG9uc2U6IGZ1bmN0aW9uIGxvZ0V2ZW50UmVzcG9uc2UodCwgbiwgZSkgewogICAgICAgICAgICBpLnB1c2goewogICAgICAgICAgICAgIG91dGNvbWU6ICJyZXNwb25zZSIsCiAgICAgICAgICAgICAgcHVycG9zZTogZSwKICAgICAgICAgICAgICB0YXJnZXQ6IG4KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgd3JpdGU6IGZ1bmN0aW9uIHdyaXRlKCkgewogICAgICAgICAgICB2YXIgdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICB3dChbIm1vdXNlbW92ZSIsICJtb3VzZW92ZXIiLCAibW91c2VvdXQiLCB6aSgpXSwgbykgfHwgY29uc29sZS5sb2cobywgewogICAgICAgICAgICAgIGV2ZW50OiBvLAogICAgICAgICAgICAgIHRpbWU6IHQgLSB1LAogICAgICAgICAgICAgIHRhcmdldDogci5kb20sCiAgICAgICAgICAgICAgc2VxdWVuY2U6IE0oaSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB3dChbImN1dCIsICJzdG9wcGVkIiwgInJlc3BvbnNlIl0sIHQub3V0Y29tZSkgPyAieyIgKyB0LnB1cnBvc2UgKyAifSAiICsgdC5vdXRjb21lICsgIiBhdCAoIiArIEFyKHQudGFyZ2V0KSArICIpIiA6IHQub3V0Y29tZTsKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICAgICAgYyA9IGUoYSk7CiAgICAgICAgcmV0dXJuIGEud3JpdGUoKSwgYzsKCiAgICAgIGNhc2UgVnUuU1RPUDoKICAgICAgICByZXR1cm4gITA7CiAgICB9CiAgfQoKICAoUHUgPSBWdSA9IFZ1IHx8IHt9KVtQdS5TVE9QID0gMF0gPSAiU1RPUCIsIFB1W1B1Lk5PUk1BTCA9IDFdID0gIk5PUk1BTCIsIFB1W1B1LkxPR0dJTkcgPSAyXSA9ICJMT0dHSU5HIjsKICB2YXIgTHUgPSBWbyh7fSksCiAgICAgIFd1ID0gWyJhbGxveS9kYXRhL0ZpZWxkcyIsICJhbGxveS9kZWJ1Z2dpbmcvRGVidWdnaW5nIl0sCiAgICAgIFV1ID0gcnQoewogICAgbG9nRXZlbnRDdXQ6IHN0LAogICAgbG9nRXZlbnRTdG9wcGVkOiBzdCwKICAgIGxvZ05vUGFyZW50OiBzdCwKICAgIGxvZ0V2ZW50Tm9IYW5kbGVyczogc3QsCiAgICBsb2dFdmVudFJlc3BvbnNlOiBzdCwKICAgIHdyaXRlOiBzdAogIH0pLAogICAgICBqdSA9IHJ0KFtmbygibWVudSIpLCBmbygic2VsZWN0ZWRNZW51IildKSwKICAgICAgR3UgPSBydChbZm8oIml0ZW0iKSwgZm8oInNlbGVjdGVkSXRlbSIpXSk7CgogIGZ1bmN0aW9uIFh1KCkgewogICAgcmV0dXJuIHZvKCJtYXJrZXJzIiwgW2ZvKCJiYWNrZ3JvdW5kTWVudSIpXS5jb25jYXQoanUoKSkuY29uY2F0KEd1KCkpKTsKICB9CgogIGZ1bmN0aW9uIFl1KHQpIHsKICAgIHJldHVybiB2bygibWFya2VycyIsIE0odCwgZm8pKTsKICB9CgogIGZ1bmN0aW9uIHF1KHQsIG4sIGUpIHsKICAgIHJldHVybiB2b2lkIDAgIT09IChvID0gbmV3IEVycm9yKCkpLnN0YWNrICYmIFYoby5zdGFjay5zcGxpdCgiXG4iKSwgZnVuY3Rpb24gKG4pIHsKICAgICAgcmV0dXJuIDAgPCBuLmluZGV4T2YoImFsbG95IikgJiYgIVQoV3UsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIC0xIDwgbi5pbmRleE9mKHQpOwogICAgICB9KTsKICAgIH0pLmdldE9yKHp1KSwgdXIobiwgbiwgZSwgcm8oZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIFJlLnZhbHVlKGZ1bmN0aW9uICgpIHsKICAgICAgICBmb3IgKHZhciB0ID0gW10sIG4gPSAwOyBuIDwgYXJndW1lbnRzLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICB0W25dID0gYXJndW1lbnRzW25dOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGUuYXBwbHkodm9pZCAwLCB0KTsKICAgICAgfSk7CiAgICB9KSk7CiAgICB2YXIgbzsKICB9CgogIGZ1bmN0aW9uIEt1KHQpIHsKICAgIHJldHVybiBxdSgwLCB0LCBqZShzdCkpOwogIH0KCiAgZnVuY3Rpb24gSnUodCkgewogICAgcmV0dXJuIHF1KDAsIHQsIGplKHZ0Lm5vbmUpKTsKICB9CgogIGZ1bmN0aW9uICR1KHQpIHsKICAgIHJldHVybiBxdSgwLCB0LCBXZSgpKTsKICB9CgogIGZ1bmN0aW9uIFF1KHQpIHsKICAgIHJldHVybiBxdSgwLCB0LCBXZSgpKTsKICB9CgogIGZ1bmN0aW9uIFp1KHQsIG4pIHsKICAgIHJldHVybiBhcih0LCBydChuKSk7CiAgfQoKICBmdW5jdGlvbiB0YSh0KSB7CiAgICByZXR1cm4gYXIodCwgaCk7CiAgfQoKICBmdW5jdGlvbiBuYSh0LCBuLCBlLCBvLCByLCBpLCB1LCBhKSB7CiAgICByZXR1cm4gewogICAgICB4OiB0LAogICAgICB5OiBuLAogICAgICBidWJibGU6IGUsCiAgICAgIGRpcmVjdGlvbjogbywKICAgICAgcGxhY2VtZW50OiByLAogICAgICByZXN0cmljdGlvbjogaSwKICAgICAgbGFiZWw6IHUgKyAiLSIgKyByLAogICAgICBhbHdheXNGaXQ6IGEgPSB2b2lkIDAgIT09IGEgJiYgYQogICAgfTsKICB9CgogIGZ1bmN0aW9uIGVhKHQsIG4sIGUsIG8pIHsKICAgIHZhciByID0gdCArIG47CiAgICByZXR1cm4gbyA8IHIgPyBlIDogciA8IGUgPyBvIDogcjsKICB9CgogIGZ1bmN0aW9uIG9hKGUsIG4pIHsKICAgIHJldHVybiBVKFsibGVmdCIsICJyaWdodCIsICJ0b3AiLCAiYm90dG9tIl0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0dChuLCB0KS5tYXAoZnVuY3Rpb24gKG4pIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHN3aXRjaCAobikgewogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgcmV0dXJuIHQueDsKCiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICByZXR1cm4gdC54ICsgdC53aWR0aDsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICByZXR1cm4gdC55OwoKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHJldHVybiB0LnkgKyB0LmhlaWdodDsKICAgICAgICAgIH0KICAgICAgICB9KGUpOwogICAgICB9KTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gcmEodCwgbikgewogICAgcmV0dXJuIHQueCArIHQud2lkdGggLyAyIC0gbi53aWR0aCAvIDI7CiAgfQoKICBmdW5jdGlvbiBpYSh0LCBuKSB7CiAgICByZXR1cm4gdC54ICsgdC53aWR0aCAtIG4ud2lkdGg7CiAgfQoKICBmdW5jdGlvbiB1YSh0LCBuKSB7CiAgICByZXR1cm4gdC55IC0gbi5oZWlnaHQ7CiAgfQoKICBmdW5jdGlvbiBhYSh0KSB7CiAgICByZXR1cm4gdC55ICsgdC5oZWlnaHQ7CiAgfQoKICBmdW5jdGlvbiBjYSh0LCBuKSB7CiAgICByZXR1cm4gdC55ICsgdC5oZWlnaHQgLyAyIC0gbi5oZWlnaHQgLyAyOwogIH0KCiAgZnVuY3Rpb24gc2EodCwgbiwgZSkgewogICAgcmV0dXJuIG5hKHQueCArIHQud2lkdGgsIGNhKHQsIG4pLCBlLmVhc3QoKSwgTGEoKSwgImVhc3QiLCBvYSh0LCB7CiAgICAgIGxlZnQ6IDAKICAgIH0pLCBqYSk7CiAgfQoKICBmdW5jdGlvbiBsYSh0LCBuLCBlKSB7CiAgICByZXR1cm4gbmEodC54IC0gbi53aWR0aCwgY2EodCwgbiksIGUud2VzdCgpLCBXYSgpLCAid2VzdCIsIG9hKHQsIHsKICAgICAgcmlnaHQ6IDEKICAgIH0pLCBqYSk7CiAgfQoKICBmdW5jdGlvbiBmYSgpIHsKICAgIHJldHVybiBbR2EsIFhhLCBZYSwgcWEsIEphLCBLYSwgc2EsIGxhXTsKICB9CgogIGZ1bmN0aW9uIGRhKCkgewogICAgcmV0dXJuIFtYYSwgR2EsIHFhLCBZYSwgSmEsIEthLCBzYSwgbGFdOwogIH0KCiAgZnVuY3Rpb24gbWEoKSB7CiAgICByZXR1cm4gW1lhLCBxYSwgR2EsIFhhLCBLYSwgSmFdOwogIH0KCiAgZnVuY3Rpb24gZ2EoKSB7CiAgICByZXR1cm4gW3FhLCBZYSwgWGEsIEdhLCBLYSwgSmFdOwogIH0KCiAgZnVuY3Rpb24gcGEoKSB7CiAgICByZXR1cm4gW0dhLCBYYSwgWWEsIHFhLCBKYSwgS2FdOwogIH0KCiAgZnVuY3Rpb24gaGEoKSB7CiAgICByZXR1cm4gW1hhLCBHYSwgcWEsIFlhLCBKYSwgS2FdOwogIH0KCiAgZnVuY3Rpb24gdmEoZSwgbywgcikgewogICAgcmV0dXJuIHJ1KGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHIodCwgZSwgbyk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGJhKHQpIHsKICAgIHJldHVybiB7CiAgICAgIGtleTogdCwKICAgICAgdmFsdWU6IHZvaWQgMAogICAgfTsKICB9CgogIGZ1bmN0aW9uIHlhKHQpIHsKICAgIHZhciBuLAogICAgICAgIGUsCiAgICAgICAgbywKICAgICAgICByLAogICAgICAgIGksCiAgICAgICAgdSwKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICAgcyA9IGNvKCJDcmVhdGluZyBiZWhhdmlvdXI6ICIgKyB0Lm5hbWUsIG5jLCB0KTsKICAgIHJldHVybiBuID0gcy5maWVsZHMsIGUgPSBzLm5hbWUsIG8gPSBzLmFjdGl2ZSwgciA9IHMuYXBpcywgaSA9IHMuZXh0cmEsIHUgPSBzLnN0YXRlLCBhID0gWmUobiksIGMgPSBfbyhlLCBbd28oImNvbmZpZyIsIFplKG4pKV0pLCBaYShhLCBjLCBlLCBvLCByLCBpLCB1KTsKICB9CgogIGZ1bmN0aW9uIHhhKHQpIHsKICAgIHZhciBuLAogICAgICAgIGUgPSBjbygiQ3JlYXRpbmcgYmVoYXZpb3VyOiAiICsgdC5uYW1lLCBlYywgdCksCiAgICAgICAgbyA9IHNvKGUuYnJhbmNoS2V5LCBlLmJyYW5jaGVzKSwKICAgICAgICByID0gZS5uYW1lLAogICAgICAgIGkgPSBlLmFjdGl2ZSwKICAgICAgICB1ID0gZS5hcGlzLAogICAgICAgIGEgPSBlLmV4dHJhLAogICAgICAgIGMgPSBlLnN0YXRlLAogICAgICAgIHMgPSBfbyhyLCBbd28oImNvbmZpZyIsIG4gPSBvKV0pOwoKICAgIHJldHVybiBaYShuLCBzLCByLCBpLCB1LCBhLCBjKTsKICB9CgogIGZ1bmN0aW9uIHdhKCkgewogICAgcmV0dXJuIEF0LmZyb21Eb20oZG9jdW1lbnQpOwogIH0KCiAgZnVuY3Rpb24gU2EodCkgewogICAgcmV0dXJuIHQuZG9tLmZvY3VzKCk7CiAgfQoKICBmdW5jdGlvbiBDYSh0KSB7CiAgICB2YXIgbiA9IG1lKHQpLmRvbTsKICAgIHJldHVybiB0LmRvbSA9PT0gbi5hY3RpdmVFbGVtZW50OwogIH0KCiAgZnVuY3Rpb24ga2EodCkgewogICAgcmV0dXJuIHZvaWQgMCA9PT0gdCAmJiAodCA9IHdhKCkpLCB2dC5mcm9tKHQuZG9tLmFjdGl2ZUVsZW1lbnQpLm1hcChBdC5mcm9tRG9tKTsKICB9CgogIGZ1bmN0aW9uIE9hKG4pIHsKICAgIHJldHVybiBrYShtZShuKSkuZmlsdGVyKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBuLmRvbS5jb250YWlucyh0LmRvbSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIF9hKHQsIGUpIHsKICAgIHZhciBvID0gbWUoZSksCiAgICAgICAgbiA9IGthKG8pLmJpbmQoZnVuY3Rpb24gKG4pIHsKICAgICAgZnVuY3Rpb24gdCh0KSB7CiAgICAgICAgcmV0dXJuIEx0KG4sIHQpOwogICAgICB9CgogICAgICB2YXIgciwgX2kyOwoKICAgICAgcmV0dXJuIHQoZSkgPyB2dC5zb21lKGUpIDogKHIgPSB0LCAoX2kyID0gZnVuY3Rpb24gaSh0KSB7CiAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCB0LmNoaWxkTm9kZXMubGVuZ3RoOyBuKyspIHsKICAgICAgICAgIHZhciBlID0gQXQuZnJvbURvbSh0LmNoaWxkTm9kZXNbbl0pOwogICAgICAgICAgaWYgKHIoZSkpIHJldHVybiB2dC5zb21lKGUpOwoKICAgICAgICAgIHZhciBvID0gX2kyKHQuY2hpbGROb2Rlc1tuXSk7CgogICAgICAgICAgaWYgKG8uaXNTb21lKCkpIHJldHVybiBvOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZ0Lm5vbmUoKTsKICAgICAgfSkoZS5kb20pKTsKICAgIH0pLAogICAgICAgIHIgPSB0KGUpOwogICAgcmV0dXJuIG4uZWFjaChmdW5jdGlvbiAobikgewogICAgICBrYShvKS5maWx0ZXIoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gTHQodCwgbik7CiAgICAgIH0pLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgIFNhKG4pOwogICAgICB9LCBzdCk7CiAgICB9KSwgcjsKICB9CgogIGZ1bmN0aW9uIFRhKHQsIG4sIGUsIG8sIHIpIHsKICAgIGZ1bmN0aW9uIGkodCkgewogICAgICByZXR1cm4gdCArICJweCI7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgcG9zaXRpb246IHQsCiAgICAgIGxlZnQ6IG4ubWFwKGkpLAogICAgICB0b3A6IGUubWFwKGkpLAogICAgICByaWdodDogby5tYXAoaSksCiAgICAgIGJvdHRvbTogci5tYXAoaSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBFYSh0LCBuKSB7CiAgICB2YXIgZTsKICAgIG1uKHQsIF9sdChfbHQoe30sIGUgPSBuKSwgewogICAgICBwb3NpdGlvbjogdnQuc29tZShlLnBvc2l0aW9uKQogICAgfSkpOwogIH0KCiAgZnVuY3Rpb24gRGEodCwgbiwgZSwgbywgciwgaSkgewogICAgdmFyIHUgPSBuLnJlY3QsCiAgICAgICAgYSA9IHUueCAtIGUsCiAgICAgICAgYyA9IHUueSAtIG8sCiAgICAgICAgcyA9IHIgLSAoYSArIHUud2lkdGgpLAogICAgICAgIGwgPSBpIC0gKGMgKyB1LmhlaWdodCksCiAgICAgICAgZiA9IHZ0LnNvbWUoYSksCiAgICAgICAgZCA9IHZ0LnNvbWUoYyksCiAgICAgICAgbSA9IHZ0LnNvbWUocyksCiAgICAgICAgZyA9IHZ0LnNvbWUobCksCiAgICAgICAgcCA9IHZ0Lm5vbmUoKTsKICAgIHJldHVybiBuLmRpcmVjdGlvbi5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFRhKHQsIGYsIGQsIHAsIHApOwogICAgfSwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gVGEodCwgcCwgZCwgbSwgcCk7CiAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBUYSh0LCBmLCBwLCBwLCBnKTsKICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFRhKHQsIHAsIHAsIG0sIGcpOwogICAgfSwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gVGEodCwgZiwgZCwgcCwgcCk7CiAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBUYSh0LCBmLCBwLCBwLCBnKTsKICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFRhKHQsIGYsIGQsIHAsIHApOwogICAgfSwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gVGEodCwgcCwgZCwgbSwgcCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIEJhKHQsIHIpIHsKICAgIHJldHVybiB0LmZvbGQoZnVuY3Rpb24gKCkgewogICAgICB2YXIgdCA9IHIucmVjdDsKICAgICAgcmV0dXJuIFRhKCJhYnNvbHV0ZSIsIHZ0LnNvbWUodC54KSwgdnQuc29tZSh0LnkpLCB2dC5ub25lKCksIHZ0Lm5vbmUoKSk7CiAgICB9LCBmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgICByZXR1cm4gRGEoImFic29sdXRlIiwgciwgdCwgbiwgZSwgbyk7CiAgICB9LCBmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgICByZXR1cm4gRGEoImZpeGVkIiwgciwgdCwgbiwgZSwgbyk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIE1hKHQsIG4pIHsKICAgIHZhciBlID0gUyhIbiwgbiksCiAgICAgICAgbyA9IHQuZm9sZChlLCBlLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0ID0gSW4oKTsKICAgICAgcmV0dXJuIEhuKG4pLnRyYW5zbGF0ZSgtdC5sZWZ0LCAtdC50b3ApOwogICAgfSksCiAgICAgICAgciA9IE9uKG4pLAogICAgICAgIGkgPSB3bihuKTsKICAgIHJldHVybiBCZShvLmxlZnQsIG8udG9wLCByLCBpKTsKICB9CgogIHJ0KEpvKEd1KCkuY29uY2F0KGp1KCkpKSk7CgogIHZhciBBYSA9IHJ0KEpvKEd1KCkpKSwKICAgICAgRmEgPSBydCh2bygiaW5pdFNpemUiLCBbZm8oIm51bUNvbHVtbnMiKSwgZm8oIm51bVJvd3MiKV0pKSwKICAgICAgSWEgPSBQbyhbewogICAgc291dGhlYXN0OiBbXQogIH0sIHsKICAgIHNvdXRod2VzdDogW10KICB9LCB7CiAgICBub3J0aGVhc3Q6IFtdCiAgfSwgewogICAgbm9ydGh3ZXN0OiBbXQogIH0sIHsKICAgIHNvdXRoOiBbXQogIH0sIHsKICAgIG5vcnRoOiBbXQogIH0sIHsKICAgIGVhc3Q6IFtdCiAgfSwgewogICAgd2VzdDogW10KICB9XSksCiAgICAgIFJhID0gSWEuc291dGhlYXN0LAogICAgICBWYSA9IElhLnNvdXRod2VzdCwKICAgICAgUGEgPSBJYS5ub3J0aGVhc3QsCiAgICAgIEhhID0gSWEubm9ydGh3ZXN0LAogICAgICB6YSA9IElhLnNvdXRoLAogICAgICBOYSA9IElhLm5vcnRoLAogICAgICBMYSA9IElhLmVhc3QsCiAgICAgIFdhID0gSWEud2VzdCwKICAgICAgVWEgPSBmdW5jdGlvbiBVYSh0LCBuLCBlKSB7CiAgICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgodCwgbiksIGUpOwogIH0sCiAgICAgIGphID0gImxheW91dCIsCiAgICAgIEdhID0gZnVuY3Rpb24gR2EodCwgbiwgZSkgewogICAgcmV0dXJuIG5hKHQueCwgYWEodCksIGUuc291dGhlYXN0KCksIFJhKCksICJzb3V0aGVhc3QiLCBvYSh0LCB7CiAgICAgIGxlZnQ6IDEsCiAgICAgIHRvcDogMwogICAgfSksIGphKTsKICB9LAogICAgICBYYSA9IGZ1bmN0aW9uIFhhKHQsIG4sIGUpIHsKICAgIHJldHVybiBuYShpYSh0LCBuKSwgYWEodCksIGUuc291dGh3ZXN0KCksIFZhKCksICJzb3V0aHdlc3QiLCBvYSh0LCB7CiAgICAgIHJpZ2h0OiAwLAogICAgICB0b3A6IDMKICAgIH0pLCBqYSk7CiAgfSwKICAgICAgWWEgPSBmdW5jdGlvbiBZYSh0LCBuLCBlKSB7CiAgICByZXR1cm4gbmEodC54LCB1YSh0LCBuKSwgZS5ub3J0aGVhc3QoKSwgUGEoKSwgIm5vcnRoZWFzdCIsIG9hKHQsIHsKICAgICAgbGVmdDogMSwKICAgICAgYm90dG9tOiAyCiAgICB9KSwgamEpOwogIH0sCiAgICAgIHFhID0gZnVuY3Rpb24gcWEodCwgbiwgZSkgewogICAgcmV0dXJuIG5hKGlhKHQsIG4pLCB1YSh0LCBuKSwgZS5ub3J0aHdlc3QoKSwgSGEoKSwgIm5vcnRod2VzdCIsIG9hKHQsIHsKICAgICAgcmlnaHQ6IDAsCiAgICAgIGJvdHRvbTogMgogICAgfSksIGphKTsKICB9LAogICAgICBLYSA9IGZ1bmN0aW9uIEthKHQsIG4sIGUpIHsKICAgIHJldHVybiBuYShyYSh0LCBuKSwgdWEodCwgbiksIGUubm9ydGgoKSwgTmEoKSwgIm5vcnRoIiwgb2EodCwgewogICAgICBib3R0b206IDIKICAgIH0pLCBqYSk7CiAgfSwKICAgICAgSmEgPSBmdW5jdGlvbiBKYSh0LCBuLCBlKSB7CiAgICByZXR1cm4gbmEocmEodCwgbiksIGFhKHQpLCBlLnNvdXRoKCksIHphKCksICJzb3V0aCIsIG9hKHQsIHsKICAgICAgdG9wOiAzCiAgICB9KSwgamEpOwogIH0sCiAgICAgICRhID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBldmVudHM6IGZ1bmN0aW9uIGV2ZW50cyhhKSB7CiAgICAgIHJldHVybiBudShbQ3IoQWkoKSwgZnVuY3Rpb24gKHIsIHQpIHsKICAgICAgICB2YXIgbiwKICAgICAgICAgICAgaSA9IGEuY2hhbm5lbHMsCiAgICAgICAgICAgIGUgPSBrdChpKSwKICAgICAgICAgICAgdSA9IHQsCiAgICAgICAgICAgIG8gPSAobiA9IHUpLnVuaXZlcnNhbCA/IGUgOiBGKGUsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gd3Qobi5jaGFubmVscywgdCk7CiAgICAgICAgfSk7CiAgICAgICAgU3QobywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gaVt0XSwKICAgICAgICAgICAgICBlID0gbi5zY2hlbWEsCiAgICAgICAgICAgICAgbyA9IGNvKCJjaGFubmVsWyIgKyB0ICsgIl0gZGF0YVxuUmVjZWl2ZXI6ICIgKyBBcihyLmVsZW1lbnQpLCBlLCB1LmRhdGEpOwogICAgICAgICAgbi5vblJlY2VpdmUociwgbyk7CiAgICAgICAgfSk7CiAgICAgIH0pXSk7CiAgICB9CiAgfSksCiAgICAgIFFhID0gW21vKCJjaGFubmVscyIsIGlvKFJlLnZhbHVlLCBaZShbJHUoIm9uUmVjZWl2ZSIpLCBUbygic2NoZW1hIiwgUW8oKSldKSkpXSwKICAgICAgWmEgPSBmdW5jdGlvbiBaYShlLCB0LCBmLCBuLCBvLCByLCBpKSB7CiAgICBmdW5jdGlvbiB1KHQpIHsKICAgICAgcmV0dXJuIG50KHQsIGYpID8gdFtmXSgpIDogdnQubm9uZSgpOwogICAgfQoKICAgIHZhciBhID0gZHQobywgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIHIgPSBmLCBlID0gZnVuY3Rpb24gZShfZTIpIHsKICAgICAgICBmb3IgKHZhciB0ID0gW10sIG4gPSAxOyBuIDwgYXJndW1lbnRzLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICB0W24gLSAxXSA9IGFyZ3VtZW50c1tuXTsKICAgICAgICB9CgogICAgICAgIHZhciBvID0gW19lMl0uY29uY2F0KHQpOwogICAgICAgIHJldHVybiBfZTIuY29uZmlnKHsKICAgICAgICAgIG5hbWU6IHJ0KHIpCiAgICAgICAgfSkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldlIGNvdWxkIG5vdCBmaW5kIGFueSBiZWhhdmlvdXIgY29uZmlndXJhdGlvbiBmb3I6ICIgKyByICsgIi4gVXNpbmcgQVBJOiAiICsgdSk7CiAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwobywgMSk7CiAgICAgICAgICByZXR1cm4gaS5hcHBseSh2b2lkIDAsIFtfZTIsIHQuY29uZmlnLCB0LnN0YXRlXS5jb25jYXQobikpOwogICAgICAgIH0pOwogICAgICB9LCBvID0gdSA9IG4sIGEgPSAoaSA9IHQpLnRvU3RyaW5nKCksIGMgPSBhLmluZGV4T2YoIikiKSArIDEsIHMgPSBhLmluZGV4T2YoIigiKSwgbCA9IGEuc3Vic3RyaW5nKHMgKyAxLCBjIC0gMSkuc3BsaXQoLyxccyovKSwgZS50b0Z1bmN0aW9uQW5ub3RhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgbmFtZTogbywKICAgICAgICAgIHBhcmFtZXRlcnM6IHZ1KGwuc2xpY2UoMCwgMSkuY29uY2F0KGwuc2xpY2UoMykpKQogICAgICAgIH07CiAgICAgIH0sIGU7CiAgICAgIHZhciByLCBpLCB1LCBlLCBvLCBhLCBjLCBzLCBsOwogICAgfSksCiAgICAgICAgYyA9IGR0KHIsIFZyKSwKICAgICAgICBzID0gX2x0KF9sdChfbHQoe30sIGMpLCBhKSwgewogICAgICByZXZva2U6IFMoYmEsIGYpLAogICAgICBjb25maWc6IGZ1bmN0aW9uIGNvbmZpZyh0KSB7CiAgICAgICAgdmFyIG4gPSBjbyhmICsgIi1jb25maWciLCBlLCB0KTsKICAgICAgICByZXR1cm4gewogICAgICAgICAga2V5OiBmLAogICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgY29uZmlnOiBuLAogICAgICAgICAgICBtZTogcywKICAgICAgICAgICAgY29uZmlnQXNSYXc6IFJ0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gY28oZiArICItY29uZmlnIiwgZSwgdCk7CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBpbml0aWFsQ29uZmlnOiB0LAogICAgICAgICAgICBzdGF0ZTogaQogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0sCiAgICAgIHNjaGVtYTogcnQodCksCiAgICAgIGV4aGliaXQ6IGZ1bmN0aW9uIGV4aGliaXQodCwgZSkgewogICAgICAgIHJldHVybiBFdCh1KHQpLCB0dChuLCAiZXhoaWJpdCIpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgcmV0dXJuIG4oZSwgdC5jb25maWcsIHQuc3RhdGUpOwogICAgICAgIH0pLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIE5yKHt9KTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgbmFtZTogcnQoZiksCiAgICAgIGhhbmRsZXJzOiBmdW5jdGlvbiBoYW5kbGVycyh0KSB7CiAgICAgICAgcmV0dXJuIHUodCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdHQobiwgImV2ZW50cyIpLmdldE9yKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgICAgfSkodC5jb25maWcsIHQuc3RhdGUpOwogICAgICAgIH0pLmdldE9yKHt9KTsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIHM7CiAgfSwKICAgICAgdGMgPSBzciwKICAgICAgbmMgPSBaZShbZm8oImZpZWxkcyIpLCBmbygibmFtZSIpLCBUbygiYWN0aXZlIiwge30pLCBUbygiYXBpcyIsIHt9KSwgVG8oInN0YXRlIiwgeXUpLCBUbygiZXh0cmEiLCB7fSldKSwKICAgICAgZWMgPSBaZShbZm8oImJyYW5jaEtleSIpLCBmbygiYnJhbmNoZXMiKSwgZm8oIm5hbWUiKSwgVG8oImFjdGl2ZSIsIHt9KSwgVG8oImFwaXMiLCB7fSksIFRvKCJzdGF0ZSIsIHl1KSwgVG8oImV4dHJhIiwge30pXSksCiAgICAgIG9jID0gcnQodm9pZCAwKSwKICAgICAgcmMgPSB5YSh7CiAgICBmaWVsZHM6IFFhLAogICAgbmFtZTogInJlY2VpdmluZyIsCiAgICBhY3RpdmU6ICRhCiAgfSksCiAgICAgIGljID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBleGhpYml0OiBmdW5jdGlvbiBleGhpYml0KHQsIG4pIHsKICAgICAgcmV0dXJuIE5yKHsKICAgICAgICBjbGFzc2VzOiBbXSwKICAgICAgICBzdHlsZXM6IG4udXNlRml4ZWQoKSA/IHt9IDogewogICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pLAogICAgICB1YyA9IFBvKFt7CiAgICBub25lOiBbXQogIH0sIHsKICAgIHJlbGF0aXZlOiBbIngiLCAieSIsICJ3aWR0aCIsICJoZWlnaHQiXQogIH0sIHsKICAgIGZpeGVkOiBbIngiLCAieSIsICJ3aWR0aCIsICJoZWlnaHQiXQogIH1dKSwKICAgICAgYWMgPSBmdW5jdGlvbiBhYyh0LCBuLCBlKSB7CiAgICB2YXIgbyA9IFNlKG4sIGUpOwogICAgcmV0dXJuIHQuZm9sZChydChvKSwgcnQobyksIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHQgPSBJbigpOwogICAgICByZXR1cm4gby50cmFuc2xhdGUoLXQubGVmdCwgLXQudG9wKTsKICAgIH0pOwogIH07CgogIGZ1bmN0aW9uIGNjKHQpIHsKICAgIHJldHVybiB1bih0LCBUYyk7CiAgfQoKICBmdW5jdGlvbiBzYyh0LCBuLCBlLCBvKSB7CiAgICB2YXIgciwKICAgICAgICBpLAogICAgICAgIHUsCiAgICAgICAgYSwKICAgICAgICBjLAogICAgICAgIHMsCiAgICAgICAgbCwKICAgICAgICBmLAogICAgICAgIGQsCiAgICAgICAgbSwKICAgICAgICBnLAogICAgICAgIHAsCiAgICAgICAgaCwKICAgICAgICB2LAogICAgICAgIGIsCiAgICAgICAgeSwKICAgICAgICB4LAogICAgICAgIHcsCiAgICAgICAgUywKICAgICAgICBDLAogICAgICAgIGssCiAgICAgICAgTywKICAgICAgICBfLAogICAgICAgIFQsCiAgICAgICAgRSwKICAgICAgICBELAogICAgICAgIEIsCiAgICAgICAgTSwKICAgICAgICBBLAogICAgICAgIEYsCiAgICAgICAgSSwKICAgICAgICBSLAogICAgICAgIFYsCiAgICAgICAgUCwKICAgICAgICBILAogICAgICAgIHosCiAgICAgICAgTiwKICAgICAgICBMLAogICAgICAgIFcsCiAgICAgICAgVSA9IHQuYnViYmxlLAogICAgICAgIGogPSBVLm9mZnNldCwKICAgICAgICBHID0gKFYgPSBvLCBQID0gdC5yZXN0cmljdGlvbiwgSCA9IGosIHogPSBvdCgibGVmdCIsIFYueCksIE4gPSBvdCgidG9wIiwgVi55KSwgTCA9IG90KCJyaWdodCIsIFYucmlnaHQpLCBXID0gb3QoImJvdHRvbSIsIFYuYm90dG9tKSwgQmUoeiwgTiwgTCAtIHosIFcgLSBOKSksCiAgICAgICAgWCA9IHQueCArIGoubGVmdCwKICAgICAgICBZID0gdC55ICsgai50b3AsCiAgICAgICAgcSA9IEJlKFgsIFksIG4sIGUpLAogICAgICAgIEsgPSAociA9IEcueCwgaSA9IEcueSwgdSA9IEcucmlnaHQsIGEgPSBHLmJvdHRvbSwgYyA9IHEueCwgcyA9IHEueSwgbCA9IHEucmlnaHQsIGYgPSBxLmJvdHRvbSwgZCA9IHEud2lkdGgsIG0gPSBxLmhlaWdodCwgewogICAgICBvcmlnaW5JbkJvdW5kczogciA8PSBjICYmIGMgPD0gdSAmJiBpIDw9IHMgJiYgcyA8PSBhLAogICAgICBzaXplSW5Cb3VuZHM6IGwgPD0gdSAmJiByIDw9IGwgJiYgZiA8PSBhICYmIGkgPD0gZiwKICAgICAgdmlzaWJsZVc6IE1hdGgubWluKGQsIHIgPD0gYyA/IHUgLSBjIDogbCAtIHIpLAogICAgICB2aXNpYmxlSDogTWF0aC5taW4obSwgaSA8PSBzID8gYSAtIHMgOiBmIC0gaSkKICAgIH0pLAogICAgICAgIEogPSBLLnZpc2libGVXLAogICAgICAgICQgPSBLLnZpc2libGVILAogICAgICAgIFEgPSBLLm9yaWdpbkluQm91bmRzICYmIEsuc2l6ZUluQm91bmRzLAogICAgICAgIFogPSBRID8gcSA6IChnID0gRy54LCBwID0gRy55LCBoID0gRy5yaWdodCwgdiA9IEcuYm90dG9tLCBiID0gcS54LCB5ID0gcS55LCB4ID0gcS53aWR0aCwgdyA9IHEuaGVpZ2h0LCBTID0gTWF0aC5tYXgoZywgaCAtIHgpLCBDID0gTWF0aC5tYXgocCwgdiAtIHcpLCBrID0gVWEoYiwgZywgUyksIE8gPSBVYSh5LCBwLCBDKSwgXyA9IE1hdGgubWluKGsgKyB4LCBoKSAtIGssIFQgPSBNYXRoLm1pbihPICsgdywgdikgLSBPLCBCZShrLCBPLCBfLCBUKSksCiAgICAgICAgdHQgPSAwIDwgWi53aWR0aCAmJiAwIDwgWi5oZWlnaHQsCiAgICAgICAgbnQgPSAoRSA9IHQuZGlyZWN0aW9uLCBNID0gcnQoKEQgPSBaKS5ib3R0b20gLSAoQiA9IG8pLnkpLCBBID0gcnQoQi5ib3R0b20gLSBELnkpLCBGID0gRS5mb2xkKEEsIEEsIE0sIE0sIEEsIE0sIEEsIEEpLCBJID0gcnQoRC5yaWdodCAtIEIueCksIFIgPSBydChCLnJpZ2h0IC0gRC54KSwgewogICAgICBtYXhXaWR0aDogRS5mb2xkKFIsIEksIFIsIEksIFIsIFIsIFIsIEkpLAogICAgICBtYXhIZWlnaHQ6IEYKICAgIH0pLAogICAgICAgIGV0ID0gewogICAgICByZWN0OiBaLAogICAgICBtYXhIZWlnaHQ6IG50Lm1heEhlaWdodCwKICAgICAgbWF4V2lkdGg6IG50Lm1heFdpZHRoLAogICAgICBkaXJlY3Rpb246IHQuZGlyZWN0aW9uLAogICAgICBwbGFjZW1lbnQ6IHQucGxhY2VtZW50LAogICAgICBjbGFzc2VzOiB7CiAgICAgICAgb246IFUuY2xhc3Nlc09uLAogICAgICAgIG9mZjogVS5jbGFzc2VzT2ZmCiAgICAgIH0sCiAgICAgIGxheW91dDogdC5sYWJlbCwKICAgICAgdGVzdFk6IFkKICAgIH07CgogICAgZnVuY3Rpb24gb3QociwgaSkgewogICAgICByZXR1cm4gUFtyXS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbiA9ICJ0b3AiID09PSByIHx8ICJib3R0b20iID09PSByLAogICAgICAgICAgICBlID0gbiA/IEgudG9wIDogSC5sZWZ0LAogICAgICAgICAgICBvID0gKCJsZWZ0IiA9PT0gciB8fCAidG9wIiA9PT0gciA/IE1hdGgubWF4IDogTWF0aC5taW4pKHQsIGkpICsgZTsKICAgICAgICByZXR1cm4gbiA/IFVhKG8sIFYueSwgVi5ib3R0b20pIDogVWEobywgVi54LCBWLnJpZ2h0KTsKICAgICAgfSkuZ2V0T3IoaSk7CiAgICB9CgogICAgcmV0dXJuIFEgfHwgdC5hbHdheXNGaXQgPyBFYy5maXQoZXQpIDogRWMubm9maXQoZXQsIEosICQsIHR0KTsKICB9CgogIGZ1bmN0aW9uIGxjKHQpIHsKICAgIGZ1bmN0aW9uIG4oKSB7CiAgICAgIHJldHVybiBlLmdldCgpLmVhY2godCk7CiAgICB9CgogICAgdmFyIGUgPSBWbyh2dC5ub25lKCkpOwogICAgcmV0dXJuIHsKICAgICAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKCkgewogICAgICAgIG4oKSwgZS5zZXQodnQubm9uZSgpKTsKICAgICAgfSwKICAgICAgaXNTZXQ6IGZ1bmN0aW9uIGlzU2V0KCkgewogICAgICAgIHJldHVybiBlLmdldCgpLmlzU29tZSgpOwogICAgICB9LAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gZS5nZXQoKTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodCkgewogICAgICAgIG4oKSwgZS5zZXQodnQuc29tZSh0KSk7CiAgICAgIH0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBmYygpIHsKICAgIHJldHVybiBsYyhmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdC51bmJpbmQoKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZGMoKSB7CiAgICB2YXIgbiA9IGxjKHN0KTsKICAgIHJldHVybiBfbHQoX2x0KHt9LCBuKSwgewogICAgICBvbjogZnVuY3Rpb24gb24odCkgewogICAgICAgIHJldHVybiBuLmdldCgpLmVhY2godCk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gbWModCwgbiwgZSkgewogICAgcmV0dXJuIFRuKHQsIG4sIERjLCBlLCAhMSk7CiAgfQoKICBmdW5jdGlvbiBnYyh0LCBuLCBlKSB7CiAgICByZXR1cm4gVG4odCwgbiwgRGMsIGUsICEwKTsKICB9CgogIGZ1bmN0aW9uIHBjKG8sIGUpIHsKICAgIGZ1bmN0aW9uIHIodCkgewogICAgICB2YXIgbiwKICAgICAgICAgIGUgPSBudWxsICE9PSAobiA9IHQucmF3LnBzZXVkb0VsZW1lbnQpICYmIHZvaWQgMCAhPT0gbiA/IG4gOiAiIjsKICAgICAgcmV0dXJuIEx0KHQudGFyZ2V0LCBvKSAmJiAhYXQoZSkgJiYgd3QoTWMsIHQucmF3LnByb3BlcnR5TmFtZSk7CiAgICB9CgogICAgZnVuY3Rpb24gdCh0KSB7CiAgICAgIHZhciBuOwogICAgICAoZyh0KSB8fCByKHQpKSAmJiAoYS5jbGVhcigpLCBjLmNsZWFyKCksICFnKG4gPSBudWxsID09IHQgPyB2b2lkIDAgOiB0LnJhdy50eXBlKSAmJiBuICE9PSBPaSgpIHx8IChjbGVhclRpbWVvdXQoaSksIGNuKG8sIEFjKSwgSnIobywgZS5jbGFzc2VzKSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIG4oKSB7CiAgICAgIGEuc2V0KG1jKG8sIE9pKCksIHQpKSwgYy5zZXQobWMobywga2koKSwgdCkpOwogICAgfQoKICAgIHZhciBpLAogICAgICAgIHUsCiAgICAgICAgYSA9IGZjKCksCiAgICAgICAgYyA9IGZjKCk7CiAgICAib250cmFuc2l0aW9uc3RhcnQiIGluIG8uZG9tID8gdSA9IG1jKG8sIF9pKCksIGZ1bmN0aW9uICh0KSB7CiAgICAgIHIodCkgJiYgKHUudW5iaW5kKCksIG4oKSk7CiAgICB9KSA6IG4oKTsKICAgIHZhciBzLAogICAgICAgIGwsCiAgICAgICAgZiA9IChzID0gbywgbCA9IGQoInRyYW5zaXRpb24tZGVsYXkiKSwgUihkKCJ0cmFuc2l0aW9uLWR1cmF0aW9uIiksIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgIHZhciBvID0gbShsW2VdKSArIG0obik7CiAgICAgIHJldHVybiBNYXRoLm1heCh0LCBvKTsKICAgIH0sIDApKTsKCiAgICBmdW5jdGlvbiBkKHQpIHsKICAgICAgdmFyIG4gPSBnbihzLCB0KTsKICAgICAgcmV0dXJuIEYoeShuKSA/IG4uc3BsaXQoL1xzKixccyovKSA6IFtdLCBhdCk7CiAgICB9CgogICAgZnVuY3Rpb24gbSh0KSB7CiAgICAgIGlmICh5KHQpICYmIC9eW1xkLl0rLy50ZXN0KHQpKSB7CiAgICAgICAgdmFyIG4gPSBwYXJzZUZsb2F0KHQpOwogICAgICAgIHJldHVybiBCdCh0LCAibXMiKSA/IG4gOiAxZTMgKiBuOwogICAgICB9CgogICAgICByZXR1cm4gMDsKICAgIH0KCiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICBpID0gc2V0VGltZW91dCh0LCBmICsgMTcpLCBvbihvLCBBYywgaSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGhjKHQsIG4sIGUsIG8sIHIsIGkpIHsKICAgIHZhciB1LAogICAgICAgIGEsCiAgICAgICAgYywKICAgICAgICBzLAogICAgICAgIGwsCiAgICAgICAgZiwKICAgICAgICBkLAogICAgICAgIG0sCiAgICAgICAgZywKICAgICAgICBwID0gKHUgPSBvLCBhID0gciwgaS5leGlzdHMoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSB1Lm1vZGU7CiAgICAgIHJldHVybiAiYWxsIiA9PT0gbiB8fCB0W25dICE9PSBhW25dOwogICAgfSkpOwoKICAgIGZ1bmN0aW9uIGgodCkgewogICAgICByZXR1cm4gcGFyc2VGbG9hdCh0KS50b0ZpeGVkKDMpOwogICAgfQoKICAgIHAgfHwgKGcgPSB0LCBOKG8uY2xhc3NlcywgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHFyKGcsIHQpOwogICAgfSkpID8gKGZuKHQsICJwb3NpdGlvbiIsIGUucG9zaXRpb24pLCBjID0gTWEobiwgdCksIHMgPSBCYShuLCBfbHQoX2x0KHt9LCByKSwgewogICAgICByZWN0OiBjCiAgICB9KSksIGwgPSBVKE1jLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gc1t0XTsKICAgIH0pLCBtID0gZSwgUShsLCBmdW5jdGlvbiAodCwgbikgewogICAgICB2YXIgZSwKICAgICAgICAgIG8sCiAgICAgICAgICByLAogICAgICAgICAgaSA9IG1bbl0ubWFwKGgpLAogICAgICAgICAgdSA9IHQubWFwKGgpOwogICAgICByZXR1cm4gIUV0KGUgPSBpLCBvID0gdSwgciA9IHZvaWQgMCA9PT0gciA/IHYgOiByKS5nZXRPcihlLmlzTm9uZSgpICYmIG8uaXNOb25lKCkpOwogICAgfSkuaXNTb21lKCkgJiYgKG1uKHQsIGwpLCBwICYmIChLcihmID0gdCwgKGQgPSBvKS5jbGFzc2VzKSwgdW4oZiwgQWMpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgY2xlYXJUaW1lb3V0KHBhcnNlSW50KHQsIDEwKSksIGNuKGYsIEFjKTsKICAgIH0pLCBwYyhmLCBkKSksIGJuKHQpKSkgOiBKcih0LCBvLmNsYXNzZXMpOwogIH0KCiAgZnVuY3Rpb24gdmModCwgbiwgZSwgbykgewogICAgdm4obiwgIm1heC1oZWlnaHQiKSwgdm4obiwgIm1heC13aWR0aCIpOwogICAgdmFyIHIsCiAgICAgICAgcywKICAgICAgICBpLAogICAgICAgIGwsCiAgICAgICAgZiwKICAgICAgICBkLAogICAgICAgIG0sCiAgICAgICAgZywKICAgICAgICBwLAogICAgICAgIHUgPSB7CiAgICAgIHdpZHRoOiBPbihyID0gbiksCiAgICAgIGhlaWdodDogd24ocikKICAgIH07CiAgICByZXR1cm4gcyA9IG4sIGkgPSBvLnByZWZlcmVuY2UsIGwgPSB0LCBmID0gdSwgZCA9IGUsIG0gPSBvLmJvdW5kcywgZyA9IGYud2lkdGgsIHAgPSBmLmhlaWdodCwgUihpLCBmdW5jdGlvbiAodCwgbikgewogICAgICB2YXIgZSA9IFMoYSwgbik7CiAgICAgIHJldHVybiB0LmZvbGQocnQodCksIGUpOwogICAgfSwgRWMubm9maXQoewogICAgICByZWN0OiBsLAogICAgICBtYXhIZWlnaHQ6IGYuaGVpZ2h0LAogICAgICBtYXhXaWR0aDogZi53aWR0aCwKICAgICAgZGlyZWN0aW9uOiBSYSgpLAogICAgICBwbGFjZW1lbnQ6ICJzb3V0aGVhc3QiLAogICAgICBjbGFzc2VzOiB7CiAgICAgICAgb246IFtdLAogICAgICAgIG9mZjogW10KICAgICAgfSwKICAgICAgbGF5b3V0OiAibm9uZSIsCiAgICAgIHRlc3RZOiBsLnkKICAgIH0sIC0xLCAtMSwgITEpKS5mb2xkKGgsIGgpOwoKICAgIGZ1bmN0aW9uIGEodCwgciwgaSwgdSwgYSkgewogICAgICB2YXIgYyA9IHNjKHQobCwgZiwgZCwgcywgbSksIGcsIHAsIG0pOwogICAgICByZXR1cm4gYy5mb2xkKHJ0KGMpLCBmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgICAgIHJldHVybiAoYSA9PT0gbyA/IHUgPCBlIHx8IGkgPCBuIDogIWEgJiYgbykgPyBjIDogRWMubm9maXQociwgaSwgdSwgYSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gYmModCwgbikgewogICAgdmFyIGUgPSB0LAogICAgICAgIG8gPSBNYXRoLmZsb29yKG4pOwogICAgZm4oZSwgIm1heC1oZWlnaHQiLCB4ZS5tYXgoZSwgbywgWyJtYXJnaW4tdG9wIiwgImJvcmRlci10b3Atd2lkdGgiLCAicGFkZGluZy10b3AiLCAicGFkZGluZy1ib3R0b20iLCAiYm9yZGVyLWJvdHRvbS13aWR0aCIsICJtYXJnaW4tYm90dG9tIl0pICsgInB4Iik7CiAgfQoKICBmdW5jdGlvbiB5Yyh0LCBuLCBlKSB7CiAgICByZXR1cm4gdm9pZCAwID09PSB0W25dID8gZSA6IHRbbl07CiAgfQoKICBmdW5jdGlvbiB4Yyh0LCBuLCBlLCBvKSB7CiAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgcmV0dXJuIHR0KGUsIHQpLmdldE9yKFtdKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpKHQsIG4sIGUpIHsKICAgICAgdmFyIG8gPSBXKFZjLCBlKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBvZmZzZXQ6IFNlKHQsIG4pLAogICAgICAgIGNsYXNzZXNPbjogeihlLCByKSwKICAgICAgICBjbGFzc2VzT2ZmOiB6KG8sIHIpCiAgICAgIH07CiAgICB9CgogICAgdmFyIHUgPSB0ICogKG8gPSB2b2lkIDAgPT09IG8gPyAxIDogbyksCiAgICAgICAgYSA9IG4gKiBvOwogICAgcmV0dXJuIHsKICAgICAgc291dGhlYXN0OiBmdW5jdGlvbiBzb3V0aGVhc3QoKSB7CiAgICAgICAgcmV0dXJuIGkoLXQsIG4sIFsidG9wIiwgImFsaWduTGVmdCJdKTsKICAgICAgfSwKICAgICAgc291dGh3ZXN0OiBmdW5jdGlvbiBzb3V0aHdlc3QoKSB7CiAgICAgICAgcmV0dXJuIGkodCwgbiwgWyJ0b3AiLCAiYWxpZ25SaWdodCJdKTsKICAgICAgfSwKICAgICAgc291dGg6IGZ1bmN0aW9uIHNvdXRoKCkgewogICAgICAgIHJldHVybiBpKC10IC8gMiwgbiwgWyJ0b3AiLCAiYWxpZ25DZW50cmUiXSk7CiAgICAgIH0sCiAgICAgIG5vcnRoZWFzdDogZnVuY3Rpb24gbm9ydGhlYXN0KCkgewogICAgICAgIHJldHVybiBpKC10LCAtbiwgWyJib3R0b20iLCAiYWxpZ25MZWZ0Il0pOwogICAgICB9LAogICAgICBub3J0aHdlc3Q6IGZ1bmN0aW9uIG5vcnRod2VzdCgpIHsKICAgICAgICByZXR1cm4gaSh0LCAtbiwgWyJib3R0b20iLCAiYWxpZ25SaWdodCJdKTsKICAgICAgfSwKICAgICAgbm9ydGg6IGZ1bmN0aW9uIG5vcnRoKCkgewogICAgICAgIHJldHVybiBpKC10IC8gMiwgLW4sIFsiYm90dG9tIiwgImFsaWduQ2VudHJlIl0pOwogICAgICB9LAogICAgICBlYXN0OiBmdW5jdGlvbiBlYXN0KCkgewogICAgICAgIHJldHVybiBpKHQsIC1uIC8gMiwgWyJ2YWxpZ25DZW50cmUiLCAibGVmdCJdKTsKICAgICAgfSwKICAgICAgd2VzdDogZnVuY3Rpb24gd2VzdCgpIHsKICAgICAgICByZXR1cm4gaSgtdCwgLW4gLyAyLCBbInZhbGlnbkNlbnRyZSIsICJyaWdodCJdKTsKICAgICAgfSwKICAgICAgaW5zZXROb3J0aGVhc3Q6IGZ1bmN0aW9uIGluc2V0Tm9ydGhlYXN0KCkgewogICAgICAgIHJldHVybiBpKHUsIGEsIFsidG9wIiwgImFsaWduTGVmdCIsICJpbnNldCJdKTsKICAgICAgfSwKICAgICAgaW5zZXROb3J0aHdlc3Q6IGZ1bmN0aW9uIGluc2V0Tm9ydGh3ZXN0KCkgewogICAgICAgIHJldHVybiBpKC11LCBhLCBbInRvcCIsICJhbGlnblJpZ2h0IiwgImluc2V0Il0pOwogICAgICB9LAogICAgICBpbnNldE5vcnRoOiBmdW5jdGlvbiBpbnNldE5vcnRoKCkgewogICAgICAgIHJldHVybiBpKC11IC8gMiwgYSwgWyJ0b3AiLCAiYWxpZ25DZW50cmUiLCAiaW5zZXQiXSk7CiAgICAgIH0sCiAgICAgIGluc2V0U291dGhlYXN0OiBmdW5jdGlvbiBpbnNldFNvdXRoZWFzdCgpIHsKICAgICAgICByZXR1cm4gaSh1LCAtYSwgWyJib3R0b20iLCAiYWxpZ25MZWZ0IiwgImluc2V0Il0pOwogICAgICB9LAogICAgICBpbnNldFNvdXRod2VzdDogZnVuY3Rpb24gaW5zZXRTb3V0aHdlc3QoKSB7CiAgICAgICAgcmV0dXJuIGkoLXUsIC1hLCBbImJvdHRvbSIsICJhbGlnblJpZ2h0IiwgImluc2V0Il0pOwogICAgICB9LAogICAgICBpbnNldFNvdXRoOiBmdW5jdGlvbiBpbnNldFNvdXRoKCkgewogICAgICAgIHJldHVybiBpKC11IC8gMiwgLWEsIFsiYm90dG9tIiwgImFsaWduQ2VudHJlIiwgImluc2V0Il0pOwogICAgICB9LAogICAgICBpbnNldEVhc3Q6IGZ1bmN0aW9uIGluc2V0RWFzdCgpIHsKICAgICAgICByZXR1cm4gaSgtdSwgLWEgLyAyLCBbInZhbGlnbkNlbnRyZSIsICJyaWdodCIsICJpbnNldCJdKTsKICAgICAgfSwKICAgICAgaW5zZXRXZXN0OiBmdW5jdGlvbiBpbnNldFdlc3QoKSB7CiAgICAgICAgcmV0dXJuIGkodSwgLWEgLyAyLCBbInZhbGlnbkNlbnRyZSIsICJsZWZ0IiwgImluc2V0Il0pOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gd2MoKSB7CiAgICByZXR1cm4geGMoMCwgMCwge30pOwogIH0KCiAgZnVuY3Rpb24gU2MobiwgZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiAicnRsIiA9PT0gSGModCkgPyBlIDogbjsKICAgIH07CiAgfQoKICB1Yy5ub25lOwoKICB2YXIgQ2MsCiAgICAgIGtjLAogICAgICBPYyA9IHVjLnJlbGF0aXZlLAogICAgICBfYyA9IHVjLmZpeGVkLAogICAgICBUYyA9ICJkYXRhLWFsbG95LXBsYWNlbWVudCIsCiAgICAgIEVjID0gUG8oW3sKICAgIGZpdDogWyJyZXBvc2l0aW9uIl0KICB9LCB7CiAgICBub2ZpdDogWyJyZXBvc2l0aW9uIiwgInZpc2libGVXIiwgInZpc2libGVIIiwgImlzVmlzaWJsZSJdCiAgfV0pLAogICAgICBEYyA9IF8sCiAgICAgIEJjID0gX24sCiAgICAgIE1jID0gWyJ0b3AiLCAiYm90dG9tIiwgInJpZ2h0IiwgImxlZnQiXSwKICAgICAgQWMgPSAiZGF0YS1hbGxveS10cmFuc2l0aW9uLXRpbWVyIiwKICAgICAgRmMgPSBydChmdW5jdGlvbiAodCwgbikgewogICAgYmModCwgbiksIGRuKHQsIHsKICAgICAgIm92ZXJmbG93LXgiOiAiaGlkZGVuIiwKICAgICAgIm92ZXJmbG93LXkiOiAiYXV0byIKICAgIH0pOwogIH0pLAogICAgICBJYyA9IHJ0KGZ1bmN0aW9uICh0LCBuKSB7CiAgICBiYyh0LCBuKTsKICB9KSwKICAgICAgUmMgPSBmdW5jdGlvbiBSYyh0LCBuLCBlLCBvKSB7CiAgICB2YXIgciwKICAgICAgICBpLAogICAgICAgIHUsCiAgICAgICAgYSwKICAgICAgICBjID0gdmModCwgbiwgZSwgbyksCiAgICAgICAgcyA9IG4sCiAgICAgICAgbCA9IGMsCiAgICAgICAgZiA9IEJhKChyID0gbykub3JpZ2luLCBsKTsKICAgIHJldHVybiByLnRyYW5zaXRpb24uZWFjaChmdW5jdGlvbiAodCkgewogICAgICBoYyhzLCByLm9yaWdpbiwgZiwgdCwgbCwgci5sYXN0UGxhY2VtZW50KTsKICAgIH0pLCBFYShzLCBmKSwgYSA9IGMucGxhY2VtZW50LCBvbihuLCBUYywgYSksIEpyKGkgPSBuLCAodSA9IGMuY2xhc3Nlcykub2ZmKSwgS3IoaSwgdS5vbiksICgwLCBvLm1heEhlaWdodEZ1bmN0aW9uKShuLCBjLm1heEhlaWdodCksICgwLCBvLm1heFdpZHRoRnVuY3Rpb24pKG4sIGMubWF4V2lkdGgpLCB7CiAgICAgIGxheW91dDogYy5sYXlvdXQsCiAgICAgIHBsYWNlbWVudDogYy5wbGFjZW1lbnQKICAgIH07CiAgfSwKICAgICAgVmMgPSBbInZhbGlnbkNlbnRyZSIsICJhbGlnbkxlZnQiLCAiYWxpZ25SaWdodCIsICJhbGlnbkNlbnRyZSIsICJ0b3AiLCAiYm90dG9tIiwgImxlZnQiLCAicmlnaHQiLCAiaW5zZXQiXSwKICAgICAgUGMgPSBoLAogICAgICBIYyA9IGZ1bmN0aW9uIEhjKHQpIHsKICAgIHJldHVybiAicnRsIiA9PT0gZ24odCwgImRpcmVjdGlvbiIpID8gInJ0bCIgOiAibHRyIjsKICB9OwoKICBmdW5jdGlvbiB6Yyh0KSB7CiAgICByZXR1cm4gTXUodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIEduKHQpICYmIHJuKHQsICJkYXRhLWFsbG95LXZlcnRpY2FsLWRpciIpID09PSBDYy5Cb3R0b21Ub1RvcDsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gTmMoKSB7CiAgICByZXR1cm4gX28oImxheW91dHMiLCBbZm8oIm9uTHRyIiksIGZvKCJvblJ0bCIpLCB4bygib25Cb3R0b21MdHIiKSwgeG8oIm9uQm90dG9tUnRsIildKTsKICB9CgogIGZ1bmN0aW9uIExjKG4sIHQsIGUsIG8sIHIsIGksIHUpIHsKICAgIHZhciBhID0gdS5tYXAoemMpLmdldE9yKCExKSwKICAgICAgICBjID0gdC5sYXlvdXRzLm1hcChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdC5vbkx0cihuKTsKICAgIH0pLAogICAgICAgIHMgPSB0LmxheW91dHMubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0Lm9uUnRsKG4pOwogICAgfSk7CiAgICByZXR1cm4gU2MoYSA/IHQubGF5b3V0cy5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0Lm9uQm90dG9tTHRyLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0KG4pOwogICAgICB9KTsKICAgIH0pLm9yKGMpLmdldE9yKHIpIDogYy5nZXRPcihlKSwgYSA/IHQubGF5b3V0cy5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0Lm9uQm90dG9tUnRsLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0KG4pOwogICAgICB9KTsKICAgIH0pLm9yKHMpLmdldE9yKGkpIDogcy5nZXRPcihvKSkobik7CiAgfQoKICBmdW5jdGlvbiBXYyh0KSB7CiAgICByZXR1cm4gdC5mb2xkKGgsIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgIHJldHVybiB0LnRyYW5zbGF0ZSgtbiwgLWUpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBVYyh0KSB7CiAgICByZXR1cm4gdC5mb2xkKGgsIGgpOwogIH0KCiAgZnVuY3Rpb24gamModCkgewogICAgcmV0dXJuIFIodCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIHQudHJhbnNsYXRlKG4ubGVmdCwgbi50b3ApOwogICAgfSwgU2UoMCwgMCkpOwogIH0KCiAgZnVuY3Rpb24gR2ModCkgewogICAgcmV0dXJuIGpjKE0odCwgVWMpKTsKICB9CgogIGZ1bmN0aW9uIFhjKHQsIG4sIGUpIHsKICAgIHZhciBvLAogICAgICAgIHIsCiAgICAgICAgaSA9IEluKFV0KHQuZWxlbWVudCkpLAogICAgICAgIHUgPSAobyA9IHQsIHIgPSBYdChlLnJvb3QpLmRvbSwgdnQuZnJvbShyLmZyYW1lRWxlbWVudCkubWFwKEF0LmZyb21Eb20pLmZpbHRlcihmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gTHQoVXQodCksIFV0KG8uZWxlbWVudCkpOwogICAgfSkubWFwKENuKS5nZXRPcihpKSk7CiAgICByZXR1cm4gaXModSwgaS5sZWZ0LCBpLnRvcCk7CiAgfQoKICBmdW5jdGlvbiBZYyh0LCBuLCBlLCBvKSB7CiAgICB2YXIgciA9IHJzKFNlKHQsIG4pKTsKICAgIHJldHVybiB2dC5zb21lKHsKICAgICAgcG9pbnQ6IHIsCiAgICAgIHdpZHRoOiBlLAogICAgICBoZWlnaHQ6IG8KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gcWModCwgYSwgYywgcywgbCkgewogICAgcmV0dXJuIHQubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuID0gW2EsIHQucG9pbnRdLAogICAgICAgICAgZSA9IHMuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIEdjKG4pOwogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIEdjKG4pOwogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGpjKE0obiwgV2MpKTsKICAgICAgfSksCiAgICAgICAgICBvID0gewogICAgICAgIHg6IGUubGVmdCwKICAgICAgICB5OiBlLnRvcCwKICAgICAgICB3aWR0aDogdC53aWR0aCwKICAgICAgICBoZWlnaHQ6IHQuaGVpZ2h0CiAgICAgIH0sCiAgICAgICAgICByID0gKGMuc2hvd0Fib3ZlID8gbWEgOiBwYSkoKSwKICAgICAgICAgIGkgPSAoYy5zaG93QWJvdmUgPyBnYSA6IGhhKSgpLAogICAgICAgICAgdSA9IExjKGwsIGMsIHIsIGksIHIsIGksIHZ0Lm5vbmUoKSk7CiAgICAgIHJldHVybiBQYyh7CiAgICAgICAgYW5jaG9yQm94OiBvLAogICAgICAgIGJ1YmJsZTogYy5idWJibGUuZ2V0T3Iod2MoKSksCiAgICAgICAgb3ZlcnJpZGVzOiBjLm92ZXJyaWRlcywKICAgICAgICBsYXlvdXRzOiB1LAogICAgICAgIHBsYWNlcjogdnQubm9uZSgpCiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBLYyh0LCBuLCBlKSB7CiAgICB2YXIgbywKICAgICAgICByID0gdC5kb2N1bWVudC5jcmVhdGVSYW5nZSgpLAogICAgICAgIGkgPSByOwogICAgcmV0dXJuIG4uZm9sZChmdW5jdGlvbiAodCkgewogICAgICBpLnNldFN0YXJ0QmVmb3JlKHQuZG9tKTsKICAgIH0sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIGkuc2V0U3RhcnQodC5kb20sIG4pOwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgaS5zZXRTdGFydEFmdGVyKHQuZG9tKTsKICAgIH0pLCBvID0gciwgZS5mb2xkKGZ1bmN0aW9uICh0KSB7CiAgICAgIG8uc2V0RW5kQmVmb3JlKHQuZG9tKTsKICAgIH0sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIG8uc2V0RW5kKHQuZG9tLCBuKTsKICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIG8uc2V0RW5kQWZ0ZXIodC5kb20pOwogICAgfSksIHI7CiAgfQoKICBmdW5jdGlvbiBKYyh0LCBuLCBlLCBvLCByKSB7CiAgICB2YXIgaSA9IHQuZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTsKICAgIHJldHVybiBpLnNldFN0YXJ0KG4uZG9tLCBlKSwgaS5zZXRFbmQoby5kb20sIHIpLCBpOwogIH0KCiAgZnVuY3Rpb24gJGModCkgewogICAgcmV0dXJuIHsKICAgICAgbGVmdDogdC5sZWZ0LAogICAgICB0b3A6IHQudG9wLAogICAgICByaWdodDogdC5yaWdodCwKICAgICAgYm90dG9tOiB0LmJvdHRvbSwKICAgICAgd2lkdGg6IHQud2lkdGgsCiAgICAgIGhlaWdodDogdC5oZWlnaHQKICAgIH07CiAgfQoKICBmdW5jdGlvbiBRYyh0LCBuLCBlKSB7CiAgICByZXR1cm4gbihBdC5mcm9tRG9tKGUuc3RhcnRDb250YWluZXIpLCBlLnN0YXJ0T2Zmc2V0LCBBdC5mcm9tRG9tKGUuZW5kQ29udGFpbmVyKSwgZS5lbmRPZmZzZXQpOwogIH0KCiAgZnVuY3Rpb24gWmMoaSwgdCkgewogICAgcmV0dXJuIHIgPSBpLCBvID0gdC5tYXRjaCh7CiAgICAgIGRvbVJhbmdlOiBmdW5jdGlvbiBkb21SYW5nZSh0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGx0cjogcnQodCksCiAgICAgICAgICBydGw6IHZ0Lm5vbmUKICAgICAgICB9OwogICAgICB9LAogICAgICByZWxhdGl2ZTogZnVuY3Rpb24gcmVsYXRpdmUodCwgbikgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsdHI6IFJ0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIEtjKHIsIHQsIG4pOwogICAgICAgICAgfSksCiAgICAgICAgICBydGw6IFJ0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHZ0LnNvbWUoS2MociwgbiwgdCkpOwogICAgICAgICAgfSkKICAgICAgICB9OwogICAgICB9LAogICAgICBleGFjdDogZnVuY3Rpb24gZXhhY3QodCwgbiwgZSwgbykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsdHI6IFJ0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIEpjKHIsIHQsIG4sIGUsIG8pOwogICAgICAgICAgfSksCiAgICAgICAgICBydGw6IFJ0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHZ0LnNvbWUoSmMociwgZSwgbywgdCwgbikpOwogICAgICAgICAgfSkKICAgICAgICB9OwogICAgICB9CiAgICB9KSwgKChlID0gKG4gPSBvKS5sdHIoKSkuY29sbGFwc2VkID8gbi5ydGwoKS5maWx0ZXIoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuICExID09PSB0LmNvbGxhcHNlZDsKICAgIH0pLm1hcChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gZHMucnRsKEF0LmZyb21Eb20odC5lbmRDb250YWluZXIpLCB0LmVuZE9mZnNldCwgQXQuZnJvbURvbSh0LnN0YXJ0Q29udGFpbmVyKSwgdC5zdGFydE9mZnNldCk7CiAgICB9KS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFFjKDAsIGRzLmx0ciwgZSk7CiAgICB9KSA6IFFjKDAsIGRzLmx0ciwgZSkpLm1hdGNoKHsKICAgICAgbHRyOiBmdW5jdGlvbiBsdHIodCwgbiwgZSwgbykgewogICAgICAgIHZhciByID0gaS5kb2N1bWVudC5jcmVhdGVSYW5nZSgpOwogICAgICAgIHJldHVybiByLnNldFN0YXJ0KHQuZG9tLCBuKSwgci5zZXRFbmQoZS5kb20sIG8pLCByOwogICAgICB9LAogICAgICBydGw6IGZ1bmN0aW9uIHJ0bCh0LCBuLCBlLCBvKSB7CiAgICAgICAgdmFyIHIgPSBpLmRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7CiAgICAgICAgcmV0dXJuIHIuc2V0U3RhcnQoZS5kb20sIG8pLCByLnNldEVuZCh0LmRvbSwgbiksIHI7CiAgICAgIH0KICAgIH0pOwogICAgdmFyIHIsIG4sIGUsIG87CiAgfQoKICAoQ2MgPSBDYyB8fCB7fSkuVG9wVG9Cb3R0b20gPSAidG9wdG9ib3R0b20iLCBDYy5Cb3R0b21Ub1RvcCA9ICJib3R0b210b3RvcCI7CgogIHZhciB0cyA9ICJkYXRhLWFsbG95LXZlcnRpY2FsLWRpciIsCiAgICAgIG5zID0gW2ZvKCJob3RzcG90IiksIHhvKCJidWJibGUiKSwgVG8oIm92ZXJyaWRlcyIsIHt9KSwgTmMoKSwgWnUoInBsYWNlbWVudCIsIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICB2YXIgbyA9IE1hKGUsIG4uaG90c3BvdC5lbGVtZW50KSwKICAgICAgICByID0gTGModC5lbGVtZW50LCBuLCBwYSgpLCBoYSgpLCBtYSgpLCBnYSgpLCB2dC5zb21lKG4uaG90c3BvdC5lbGVtZW50KSk7CiAgICByZXR1cm4gdnQuc29tZShQYyh7CiAgICAgIGFuY2hvckJveDogbywKICAgICAgYnViYmxlOiBuLmJ1YmJsZS5nZXRPcih3YygpKSwKICAgICAgb3ZlcnJpZGVzOiBuLm92ZXJyaWRlcywKICAgICAgbGF5b3V0czogciwKICAgICAgcGxhY2VyOiB2dC5ub25lKCkKICAgIH0pKTsKICB9KV0sCiAgICAgIGVzID0gW2ZvKCJ4IiksIGZvKCJ5IiksIFRvKCJoZWlnaHQiLCAwKSwgVG8oIndpZHRoIiwgMCksIFRvKCJidWJibGUiLCB3YygpKSwgVG8oIm92ZXJyaWRlcyIsIHt9KSwgTmMoKSwgWnUoInBsYWNlbWVudCIsIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICB2YXIgbyA9IGFjKGUsIG4ueCwgbi55KSwKICAgICAgICByID0gQmUoby5sZWZ0LCBvLnRvcCwgbi53aWR0aCwgbi5oZWlnaHQpLAogICAgICAgIGkgPSBMYyh0LmVsZW1lbnQsIG4sIGZhKCksIGRhKCksIGZhKCksIGRhKCksIHZ0Lm5vbmUoKSk7CiAgICByZXR1cm4gdnQuc29tZShQYyh7CiAgICAgIGFuY2hvckJveDogciwKICAgICAgYnViYmxlOiBuLmJ1YmJsZSwKICAgICAgb3ZlcnJpZGVzOiBuLm92ZXJyaWRlcywKICAgICAgbGF5b3V0czogaSwKICAgICAgcGxhY2VyOiB2dC5ub25lKCkKICAgIH0pKTsKICB9KV0sCiAgICAgIG9zID0gUG8oW3sKICAgIHNjcmVlbjogWyJwb2ludCJdCiAgfSwgewogICAgYWJzb2x1dGU6IFsicG9pbnQiLCAic2Nyb2xsTGVmdCIsICJzY3JvbGxUb3AiXQogIH1dKSwKICAgICAgcnMgPSBvcy5zY3JlZW4sCiAgICAgIGlzID0gb3MuYWJzb2x1dGUsCiAgICAgIHVzID0gW2ZvKCJub2RlIiksIGZvKCJyb290IiksIHhvKCJidWJibGUiKSwgTmMoKSwgVG8oIm92ZXJyaWRlcyIsIHt9KSwgVG8oInNob3dBYm92ZSIsICExKSwgWnUoInBsYWNlbWVudCIsIGZ1bmN0aW9uIChyLCBpLCB1KSB7CiAgICB2YXIgYSA9IFhjKHIsIDAsIGkpOwogICAgcmV0dXJuIGkubm9kZS5maWx0ZXIoaGUpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSB0LmRvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwKICAgICAgICAgIGUgPSBZYyhuLmxlZnQsIG4udG9wLCBuLndpZHRoLCBuLmhlaWdodCksCiAgICAgICAgICBvID0gaS5ub2RlLmdldE9yKHIuZWxlbWVudCk7CiAgICAgIHJldHVybiBxYyhlLCBhLCBpLCB1LCBvKTsKICAgIH0pOwogIH0pXSwKICAgICAgYXMgPSBmdW5jdGlvbiBhcyh0LCBuLCBlLCBvKSB7CiAgICByZXR1cm4gewogICAgICBzdGFydDogdCwKICAgICAgc29mZnNldDogbiwKICAgICAgZmluaXNoOiBlLAogICAgICBmb2Zmc2V0OiBvCiAgICB9OwogIH0sCiAgICAgIGNzID0gUG8oW3sKICAgIGJlZm9yZTogWyJlbGVtZW50Il0KICB9LCB7CiAgICBvbjogWyJlbGVtZW50IiwgIm9mZnNldCJdCiAgfSwgewogICAgYWZ0ZXI6IFsiZWxlbWVudCJdCiAgfV0pLAogICAgICBzcyA9IChjcy5iZWZvcmUsIGNzLm9uLCBjcy5hZnRlciwgZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiB0LmZvbGQoaCwgaCwgaCk7CiAgfSksCiAgICAgIGxzID0gUG8oW3sKICAgIGRvbVJhbmdlOiBbInJuZyJdCiAgfSwgewogICAgcmVsYXRpdmU6IFsic3RhcnRTaXR1IiwgImZpbmlzaFNpdHUiXQogIH0sIHsKICAgIGV4YWN0OiBbInN0YXJ0IiwgInNvZmZzZXQiLCAiZmluaXNoIiwgImZvZmZzZXQiXQogIH1dKSwKICAgICAgZnMgPSB7CiAgICBkb21SYW5nZTogbHMuZG9tUmFuZ2UsCiAgICByZWxhdGl2ZTogbHMucmVsYXRpdmUsCiAgICBleGFjdDogbHMuZXhhY3QsCiAgICBleGFjdEZyb21SYW5nZTogZnVuY3Rpb24gZXhhY3RGcm9tUmFuZ2UodCkgewogICAgICByZXR1cm4gbHMuZXhhY3QodC5zdGFydCwgdC5zb2Zmc2V0LCB0LmZpbmlzaCwgdC5mb2Zmc2V0KTsKICAgIH0sCiAgICBnZXRXaW46IGZ1bmN0aW9uIGdldFdpbih0KSB7CiAgICAgIHJldHVybiBYdCh0Lm1hdGNoKHsKICAgICAgICBkb21SYW5nZTogZnVuY3Rpb24gZG9tUmFuZ2UodCkgewogICAgICAgICAgcmV0dXJuIEF0LmZyb21Eb20odC5zdGFydENvbnRhaW5lcik7CiAgICAgICAgfSwKICAgICAgICByZWxhdGl2ZTogZnVuY3Rpb24gcmVsYXRpdmUodCwgbikgewogICAgICAgICAgcmV0dXJuIHNzKHQpOwogICAgICAgIH0sCiAgICAgICAgZXhhY3Q6IGZ1bmN0aW9uIGV4YWN0KHQsIG4sIGUsIG8pIHsKICAgICAgICAgIHJldHVybiB0OwogICAgICAgIH0KICAgICAgfSkpOwogICAgfSwKICAgIHJhbmdlOiBhcwogIH0sCiAgICAgIGRzID0gUG8oW3sKICAgIGx0cjogWyJzdGFydCIsICJzb2Zmc2V0IiwgImZpbmlzaCIsICJmb2Zmc2V0Il0KICB9LCB7CiAgICBydGw6IFsic3RhcnQiLCAic29mZnNldCIsICJmaW5pc2giLCAiZm9mZnNldCJdCiAgfV0pOwoKICBmdW5jdGlvbiBtcyh0KSB7CiAgICByZXR1cm4gWmwuZ2V0T3B0aW9uKHQpOwogIH0KCiAgZnVuY3Rpb24gZ3ModCkgewogICAgcmV0dXJuIG1zKHQpLmZpbHRlcihmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gMCAhPT0gdC50cmltKCkubGVuZ3RoIHx8IC0xIDwgdC5pbmRleE9mKCJceGEwIik7CiAgICB9KS5pc1NvbWUoKSB8fCB3dCh0ZiwgRnQodCkpOwogIH0KCiAgZnVuY3Rpb24gcHModCwgbikgewogICAgcmV0dXJuIE50KGUgPSB2b2lkIDAgPT09IHQgPyBkb2N1bWVudCA6IHQuZG9tKSA/IFtdIDogTShlLnF1ZXJ5U2VsZWN0b3JBbGwobiksIEF0LmZyb21Eb20pOwogICAgdmFyIGU7CiAgfQoKICBmdW5jdGlvbiBocyh0KSB7CiAgICBpZiAoMCA8IHQucmFuZ2VDb3VudCkgewogICAgICB2YXIgbiA9IHQuZ2V0UmFuZ2VBdCgwKSwKICAgICAgICAgIGUgPSB0LmdldFJhbmdlQXQodC5yYW5nZUNvdW50IC0gMSk7CiAgICAgIHJldHVybiB2dC5zb21lKGFzKEF0LmZyb21Eb20obi5zdGFydENvbnRhaW5lciksIG4uc3RhcnRPZmZzZXQsIEF0LmZyb21Eb20oZS5lbmRDb250YWluZXIpLCBlLmVuZE9mZnNldCkpOwogICAgfQoKICAgIHJldHVybiB2dC5ub25lKCk7CiAgfQoKICBmdW5jdGlvbiB2cyh0KSB7CiAgICBpZiAobnVsbCA9PT0gdC5hbmNob3JOb2RlIHx8IG51bGwgPT09IHQuZm9jdXNOb2RlKSByZXR1cm4gaHModCk7CiAgICB2YXIgbiwKICAgICAgICBlLAogICAgICAgIG8sCiAgICAgICAgciwKICAgICAgICBpLAogICAgICAgIHUsCiAgICAgICAgYSwKICAgICAgICBjLAogICAgICAgIHMsCiAgICAgICAgbCwKICAgICAgICBmLAogICAgICAgIGQgPSBBdC5mcm9tRG9tKHQuYW5jaG9yTm9kZSksCiAgICAgICAgbSA9IEF0LmZyb21Eb20odC5mb2N1c05vZGUpOwogICAgcmV0dXJuIG4gPSBkLCBlID0gdC5hbmNob3JPZmZzZXQsIG8gPSBtLCByID0gdC5mb2N1c09mZnNldCwgdSA9IGUsIGEgPSBvLCBjID0gciwgKHMgPSBVdChpID0gbikuZG9tLmNyZWF0ZVJhbmdlKCkpLnNldFN0YXJ0KGkuZG9tLCB1KSwgcy5zZXRFbmQoYS5kb20sIGMpLCBsID0gcywgZiA9IEx0KG4sIG8pICYmIGUgPT09IHIsIGwuY29sbGFwc2VkICYmICFmID8gdnQuc29tZShhcyhkLCB0LmFuY2hvck9mZnNldCwgbSwgdC5mb2N1c09mZnNldCkpIDogaHModCk7CiAgfQoKICBmdW5jdGlvbiBicyh0LCBuKSB7CiAgICB2YXIgZSwKICAgICAgICBvLAogICAgICAgIHIgPSAoZSA9IFpjKHQsIG4pKS5nZXRDbGllbnRSZWN0cygpOwogICAgcmV0dXJuIDAgPCAobyA9IDAgPCByLmxlbmd0aCA/IHJbMF0gOiBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKS53aWR0aCB8fCAwIDwgby5oZWlnaHQgPyB2dC5zb21lKG8pLm1hcCgkYykgOiB2dC5ub25lKCk7CiAgfQoKICBmdW5jdGlvbiB5cyh0LCBuKSB7CiAgICByZXR1cm4gewogICAgICBlbGVtZW50OiB0LAogICAgICBvZmZzZXQ6IG4KICAgIH07CiAgfQoKICBmdW5jdGlvbiB4cyh0LCBuKSB7CiAgICByZXR1cm4gKFhuKHQpID8geXMgOiBmdW5jdGlvbiAodCwgbikgewogICAgICB2YXIgZSA9IEt0KHQpOwogICAgICBpZiAoMCA9PT0gZS5sZW5ndGgpIHJldHVybiB5cyh0LCBuKTsKICAgICAgaWYgKG4gPCBlLmxlbmd0aCkgcmV0dXJuIHlzKGVbbl0sIDApOwogICAgICB2YXIgbyA9IGVbZS5sZW5ndGggLSAxXTsKICAgICAgcmV0dXJuIHlzKG8sIChYbihvKSA/IFpsLmdldChvKSA6IEt0KG8pKS5sZW5ndGgpOwogICAgfSkodCwgbik7CiAgfQoKICBmdW5jdGlvbiB3cyh0LCBuKSB7CiAgICByZXR1cm4gbi5nZXRTZWxlY3Rpb24uZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHZ0LmZyb20odC5nZXRTZWxlY3Rpb24oKSkuZmlsdGVyKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gMCA8IHQucmFuZ2VDb3VudDsKICAgICAgICB9KS5iaW5kKHZzKTsKICAgICAgfTsKICAgIH0pKCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuID0geHModC5zdGFydCwgdC5zb2Zmc2V0KSwKICAgICAgICAgIGUgPSB4cyh0LmZpbmlzaCwgdC5mb2Zmc2V0KTsKICAgICAgcmV0dXJuIGZzLnJhbmdlKG4uZWxlbWVudCwgbi5vZmZzZXQsIGUuZWxlbWVudCwgZS5vZmZzZXQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBTcyh0KSB7CiAgICByZXR1cm4gdC54ICsgdC53aWR0aDsKICB9CgogIGZ1bmN0aW9uIENzKHQsIG4pIHsKICAgIHJldHVybiB0LnggLSBuLndpZHRoOwogIH0KCiAgZnVuY3Rpb24ga3ModCwgbikgewogICAgcmV0dXJuIHQueSAtIG4uaGVpZ2h0ICsgdC5oZWlnaHQ7CiAgfQoKICBmdW5jdGlvbiBPcyh0LCBuLCBlKSB7CiAgICByZXR1cm4gbmEoU3ModCksIHQueSwgZS5zb3V0aGVhc3QoKSwgUmEoKSwgInNvdXRoZWFzdCIsIG9hKHQsIHsKICAgICAgbGVmdDogMCwKICAgICAgdG9wOiAyCiAgICB9KSwgZWYpOwogIH0KCiAgZnVuY3Rpb24gX3ModCwgbiwgZSkgewogICAgcmV0dXJuIG5hKENzKHQsIG4pLCB0LnksIGUuc291dGh3ZXN0KCksIFZhKCksICJzb3V0aHdlc3QiLCBvYSh0LCB7CiAgICAgIHJpZ2h0OiAxLAogICAgICB0b3A6IDIKICAgIH0pLCBlZik7CiAgfQoKICBmdW5jdGlvbiBUcyh0LCBuLCBlKSB7CiAgICByZXR1cm4gbmEoU3ModCksIGtzKHQsIG4pLCBlLm5vcnRoZWFzdCgpLCBQYSgpLCAibm9ydGhlYXN0Iiwgb2EodCwgewogICAgICBsZWZ0OiAwLAogICAgICBib3R0b206IDMKICAgIH0pLCBlZik7CiAgfQoKICBmdW5jdGlvbiBFcyh0LCBuLCBlKSB7CiAgICByZXR1cm4gbmEoQ3ModCwgbiksIGtzKHQsIG4pLCBlLm5vcnRod2VzdCgpLCBIYSgpLCAibm9ydGh3ZXN0Iiwgb2EodCwgewogICAgICByaWdodDogMSwKICAgICAgYm90dG9tOiAzCiAgICB9KSwgZWYpOwogIH0KCiAgZnVuY3Rpb24gRHMoKSB7CiAgICByZXR1cm4gW09zLCBfcywgVHMsIEVzXTsKICB9CgogIGZ1bmN0aW9uIEJzKCkgewogICAgcmV0dXJuIFtfcywgT3MsIEVzLCBUc107CiAgfQoKICBmdW5jdGlvbiBNcyh0LCBuLCBlLCBvLCByLCBpLCB1KSB7CiAgICB2YXIgYSwKICAgICAgICBjLAogICAgICAgIHMsCiAgICAgICAgbCwKICAgICAgICBmLAogICAgICAgIGQsCiAgICAgICAgbSwKICAgICAgICBnLAogICAgICAgIHAsCiAgICAgICAgaCwKICAgICAgICB2LAogICAgICAgIGIsCiAgICAgICAgeSwKICAgICAgICB4LAogICAgICAgIHcgPSB7CiAgICAgIGFuY2hvckJveDogZS5hbmNob3JCb3gsCiAgICAgIG9yaWdpbjogbgogICAgfTsKICAgIHJldHVybiBhID0gdywgYyA9IHIuZWxlbWVudCwgcyA9IGUuYnViYmxlLCBsID0gZS5sYXlvdXRzLCBmID0gaSwgZCA9IG8sIG0gPSBlLm92ZXJyaWRlcywgZyA9IHUsIGggPSB5YyhtLCAibWF4SGVpZ2h0RnVuY3Rpb24iLCBGYygpKSwgdiA9IHljKG0sICJtYXhXaWR0aEZ1bmN0aW9uIiwgc3QpLCBiID0gYS5hbmNob3JCb3gsIHkgPSBhLm9yaWdpbiwgeCA9IHsKICAgICAgYm91bmRzOiAocCA9IHksIGQuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHAuZm9sZChBZSwgQWUsIEJlKTsKICAgICAgfSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gcC5mb2xkKGUsIGUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0ID0gZSgpLAogICAgICAgICAgICAgIG4gPSBhYyhwLCB0LngsIHQueSk7CiAgICAgICAgICByZXR1cm4gQmUobi5sZWZ0LCBuLnRvcCwgdC53aWR0aCwgdC5oZWlnaHQpOwogICAgICAgIH0pOwogICAgICB9KSksCiAgICAgIG9yaWdpbjogeSwKICAgICAgcHJlZmVyZW5jZTogbCwKICAgICAgbWF4SGVpZ2h0RnVuY3Rpb246IGgsCiAgICAgIG1heFdpZHRoRnVuY3Rpb246IHYsCiAgICAgIGxhc3RQbGFjZW1lbnQ6IGYsCiAgICAgIHRyYW5zaXRpb246IGcKICAgIH0sIFJjKGIsIGMsIHMsIHgpOwogIH0KCiAgZnVuY3Rpb24gQXModCwgbikgewogICAgX2UodC5lbGVtZW50LCBuLmVsZW1lbnQpOwogIH0KCiAgZnVuY3Rpb24gRnMobiwgdCkgewogICAgdmFyIGUsCiAgICAgICAgbyA9IG4uY29tcG9uZW50cygpOwogICAgU3QoKGUgPSBuKS5jb21wb25lbnRzKCksIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBUZSh0LmVsZW1lbnQpOwogICAgfSksIEFuKGUuZWxlbWVudCksIGUuc3luY0NvbXBvbmVudHMoKTsKICAgIHZhciByID0gVyhvLCB0KTsKICAgIFN0KHIsIGZ1bmN0aW9uICh0KSB7CiAgICAgIGxmKHQpLCBuLmdldFN5c3RlbSgpLnJlbW92ZUZyb21Xb3JsZCh0KTsKICAgIH0pLCBTdCh0LCBmdW5jdGlvbiAodCkgewogICAgICB0LmdldFN5c3RlbSgpLmlzQ29ubmVjdGVkKCkgPyBBcyhuLCB0KSA6IChuLmdldFN5c3RlbSgpLmFkZFRvV29ybGQodCksIEFzKG4sIHQpLCBoZShuLmVsZW1lbnQpICYmIGZmKHQpKSwgbi5zeW5jQ29tcG9uZW50cygpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBJcyh0LCBuKSB7CiAgICBkZih0LCBuLCBfZSk7CiAgfQoKICBmdW5jdGlvbiBScyh0KSB7CiAgICBsZih0KSwgVGUodC5lbGVtZW50KSwgdC5nZXRTeXN0ZW0oKS5yZW1vdmVGcm9tV29ybGQodCk7CiAgfQoKICBmdW5jdGlvbiBWcyhuKSB7CiAgICB2YXIgdCA9IFl0KG4uZWxlbWVudCkuYmluZChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gbi5nZXRTeXN0ZW0oKS5nZXRCeURvbSh0KS50b09wdGlvbmFsKCk7CiAgICB9KTsKICAgIFJzKG4pLCB0LmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgdC5zeW5jQ29tcG9uZW50cygpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBQcyh0KSB7CiAgICB2YXIgbiA9IHQuY29tcG9uZW50cygpOwogICAgU3QobiwgUnMpLCBBbih0LmVsZW1lbnQpLCB0LnN5bmNDb21wb25lbnRzKCk7CiAgfQoKICBmdW5jdGlvbiBIcyh0LCBuKSB7CiAgICBtZih0LCBuLCBfZSk7CiAgfQoKICBmdW5jdGlvbiB6cyhuKSB7CiAgICB2YXIgdCA9IEt0KG4uZWxlbWVudCk7CiAgICBTdCh0LCBmdW5jdGlvbiAodCkgewogICAgICBuLmdldEJ5RG9tKHQpLmVhY2gobGYpOwogICAgfSksIFRlKG4uZWxlbWVudCk7CiAgfQoKICBmdW5jdGlvbiBOcyhuLCB0LCBlLCBvKSB7CiAgICBlLmdldCgpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgUHMobik7CiAgICB9KSwgSXModC5nZXRBdHRhY2hQb2ludChuKSwgbik7CiAgICB2YXIgciA9IG4uZ2V0U3lzdGVtKCkuYnVpbGQobyk7CiAgICByZXR1cm4gSXMobiwgciksIGUuc2V0KHIpLCByOwogIH0KCiAgZnVuY3Rpb24gTHModCwgbiwgZSwgbykgewogICAgdmFyIHIgPSBOcyh0LCBuLCBlLCBvKTsKICAgIHJldHVybiBuLm9uT3Blbih0LCByKSwgcjsKICB9CgogIGZ1bmN0aW9uIFdzKG4sIGUsIG8pIHsKICAgIG8uZ2V0KCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICBQcyhuKSwgVnMobiksIGUub25DbG9zZShuLCB0KSwgby5jbGVhcigpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBVcyh0LCBuLCBlKSB7CiAgICByZXR1cm4gZS5pc09wZW4oKTsKICB9CgogIGZ1bmN0aW9uIGpzKHQpIHsKICAgIHZhciBlID0gY28oIkRpc21pc3NhbCIsIHhmLCB0KSwKICAgICAgICBuID0ge307CiAgICByZXR1cm4gblt2ZigpXSA9IHsKICAgICAgc2NoZW1hOiBaZShbZm8oInRhcmdldCIpXSksCiAgICAgIG9uUmVjZWl2ZTogZnVuY3Rpb24gb25SZWNlaXZlKG4sIHQpIHsKICAgICAgICBoZi5pc09wZW4obikgJiYgKGhmLmlzUGFydE9mKG4sIHQudGFyZ2V0KSB8fCBlLmlzRXh0cmFQYXJ0KG4sIHQudGFyZ2V0KSB8fCBlLmZpcmVFdmVudEluc3RlYWQuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gaGYuY2xvc2Uobik7CiAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBocihuLCB0LmV2ZW50KTsKICAgICAgICB9KSk7CiAgICAgIH0KICAgIH0sIG47CiAgfQoKICBmdW5jdGlvbiBHcyh0KSB7CiAgICB2YXIgZSA9IGNvKCJSZXBvc2l0aW9uIiwgd2YsIHQpLAogICAgICAgIG4gPSB7fTsKICAgIHJldHVybiBuW2JmKCldID0gewogICAgICBvblJlY2VpdmU6IGZ1bmN0aW9uIG9uUmVjZWl2ZShuKSB7CiAgICAgICAgaGYuaXNPcGVuKG4pICYmIGUuZmlyZUV2ZW50SW5zdGVhZC5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBlLmRvUmVwb3NpdGlvbihuKTsKICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGhyKG4sIHQuZXZlbnQpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LCBuOwogIH0KCiAgZnVuY3Rpb24gWHModCwgbiwgZSkgewogICAgbi5zdG9yZS5tYW5hZ2VyLm9uTG9hZCh0LCBuLCBlKTsKICB9CgogIGZ1bmN0aW9uIFlzKHQsIG4sIGUpIHsKICAgIG4uc3RvcmUubWFuYWdlci5vblVubG9hZCh0LCBuLCBlKTsKICB9CgogIGZ1bmN0aW9uIHFzKCkgewogICAgdmFyIHQgPSBWbyhudWxsKTsKICAgIHJldHVybiB4dSh7CiAgICAgIHNldDogdC5zZXQsCiAgICAgIGdldDogdC5nZXQsCiAgICAgIGlzTm90U2V0OiBmdW5jdGlvbiBpc05vdFNldCgpIHsKICAgICAgICByZXR1cm4gbnVsbCA9PT0gdC5nZXQoKTsKICAgICAgfSwKICAgICAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKCkgewogICAgICAgIHQuc2V0KG51bGwpOwogICAgICB9LAogICAgICByZWFkU3RhdGU6IGZ1bmN0aW9uIHJlYWRTdGF0ZSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgbW9kZTogIm1lbW9yeSIsCiAgICAgICAgICB2YWx1ZTogdC5nZXQoKQogICAgICAgIH07CiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gS3MoKSB7CiAgICB2YXIgaSA9IFZvKHt9KSwKICAgICAgICB1ID0gVm8oe30pOwogICAgcmV0dXJuIHh1KHsKICAgICAgcmVhZFN0YXRlOiBmdW5jdGlvbiByZWFkU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG1vZGU6ICJkYXRhc2V0IiwKICAgICAgICAgIGRhdGFCeVZhbHVlOiBpLmdldCgpLAogICAgICAgICAgZGF0YUJ5VGV4dDogdS5nZXQoKQogICAgICAgIH07CiAgICAgIH0sCiAgICAgIGxvb2t1cDogZnVuY3Rpb24gbG9va3VwKHQpIHsKICAgICAgICByZXR1cm4gdHQoaS5nZXQoKSwgdCkub3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdHQodS5nZXQoKSwgdCk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKHQpIHsKICAgICAgICB2YXIgbiA9IGkuZ2V0KCksCiAgICAgICAgICAgIGUgPSB1LmdldCgpLAogICAgICAgICAgICBvID0ge30sCiAgICAgICAgICAgIHIgPSB7fTsKICAgICAgICBTdCh0LCBmdW5jdGlvbiAobikgewogICAgICAgICAgdHQob1tuLnZhbHVlXSA9IG4sICJtZXRhIikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICB0dCh0LCAidGV4dCIpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByW3RdID0gbjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KSwgaS5zZXQoX2x0KF9sdCh7fSwgbiksIG8pKSwgdS5zZXQoX2x0KF9sdCh7fSwgZSksIHIpKTsKICAgICAgfSwKICAgICAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKCkgewogICAgICAgIGkuc2V0KHt9KSwgdS5zZXQoe30pOwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIEpzKHQsIG4sIGUsIG8pIHsKICAgIHZhciByID0gbi5zdG9yZTsKICAgIGUudXBkYXRlKFtvXSksIHIuc2V0VmFsdWUodCwgbyksIG4ub25TZXRWYWx1ZSh0LCBvKTsKICB9CgogIGZ1bmN0aW9uICRzKG8sIHQpIHsKICAgIHJldHVybiBSbyhvLCB7fSwgTSh0LCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gbiA9IHQubmFtZSgpLCBlID0gIkNhbm5vdCBjb25maWd1cmUgIiArIHQubmFtZSgpICsgIiBmb3IgIiArIG8sIHVyKG4sIG4sIEdlKCksIEtlKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIE5vKCJUaGUgZmllbGQ6ICIgKyBuICsgIiBpcyBmb3JiaWRkZW4uICIgKyBlKTsKICAgICAgfSkpOwogICAgICB2YXIgbiwgZTsKICAgIH0pLmNvbmNhdChbYXIoImR1bXAiLCBoKV0pKTsKICB9CgogIGZ1bmN0aW9uIFFzKHQpIHsKICAgIHJldHVybiB0LmR1bXA7CiAgfQoKICBmdW5jdGlvbiBacyh0LCBuKSB7CiAgICByZXR1cm4gX2x0KF9sdCh7fSwgdGMobikpLCB0LmR1bXApOwogIH0KCiAgZnVuY3Rpb24gdGwodCkgewogICAgcmV0dXJuIFR0KHQsICJ1aVR5cGUiKTsKICB9CgogIGZ1bmN0aW9uIG5sKHQpIHsKICAgIHJldHVybiB0LmZvbGQodnQuc29tZSwgdnQubm9uZSwgdnQuc29tZSwgdnQuc29tZSk7CiAgfQoKICBmdW5jdGlvbiBlbCh0KSB7CiAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgcmV0dXJuIHQubmFtZTsKICAgIH0KCiAgICByZXR1cm4gdC5mb2xkKG4sIG4sIG4sIG4pOwogIH0KCiAgZnVuY3Rpb24gb2woZSwgbykgewogICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuID0gY28oIkNvbnZlcnRpbmcgcGFydCB0eXBlIiwgbywgdCk7CiAgICAgIHJldHVybiBlKG4pOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIHJsKHQsIG4sIGUsIG8pIHsKICAgIHJldHVybiBYbyhuLmRlZmF1bHRzKHQsIGUsIG8pLCBlLCB7CiAgICAgIHVpZDogdC5wYXJ0VWlkc1tuLm5hbWVdCiAgICB9LCBuLm92ZXJyaWRlcyh0LCBlLCBvKSk7CiAgfQoKICBmdW5jdGlvbiBpbChyLCB0KSB7CiAgICB2YXIgbiA9IHt9OwogICAgcmV0dXJuIFN0KHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgIG5sKHQpLmVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgbyA9IHRkKHIsIGUucG5hbWUpOwoKICAgICAgICBuW2UubmFtZV0gPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIG4gPSBjbygiUGFydDogIiArIGUubmFtZSArICIgaW4gIiArIHIsIEpvKGUuc2NoZW1hKSwgdCk7CiAgICAgICAgICByZXR1cm4gX2x0KF9sdCh7fSwgbyksIHsKICAgICAgICAgICAgY29uZmlnOiB0LAogICAgICAgICAgICB2YWxpZGF0ZWQ6IG4KICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgIH0pOwogICAgfSksIG47CiAgfQoKICBmdW5jdGlvbiB1bCh0LCBuLCBlKSB7CiAgICByZXR1cm4gewogICAgICB1aVR5cGU6IFJmKCksCiAgICAgIG93bmVyOiB0LAogICAgICBuYW1lOiBuLAogICAgICBjb25maWc6IGUsCiAgICAgIHZhbGlkYXRlZDoge30KICAgIH07CiAgfQoKICBmdW5jdGlvbiBhbCh0KSB7CiAgICByZXR1cm4geih0LCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdC5mb2xkKHZ0Lm5vbmUsIHZ0LnNvbWUsIHZ0Lm5vbmUsIHZ0Lm5vbmUpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB2byh0Lm5hbWUsIHQuc2NoZW1hLmNvbmNhdChbdGEoUWYoKSldKSk7CiAgICAgIH0pLnRvQXJyYXkoKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gY2wodCkgewogICAgcmV0dXJuIE0odCwgZWwpOwogIH0KCiAgZnVuY3Rpb24gc2wodCwgbiwgZSkgewogICAgcmV0dXJuIG8gPSBuLCByID0ge30sIGkgPSB7fSwgU3QoZSwgZnVuY3Rpb24gKHQpIHsKICAgICAgdC5mb2xkKGZ1bmN0aW9uIChvKSB7CiAgICAgICAgcltvLnBuYW1lXSA9IEZmKCEwLCBmdW5jdGlvbiAodCwgbiwgZSkgewogICAgICAgICAgcmV0dXJuIG8uZmFjdG9yeS5za2V0Y2gocmwodCwgbywgbiwgZSkpOwogICAgICAgIH0pOwogICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBuID0gby5wYXJ0c1t0Lm5hbWVdOwogICAgICAgIGlbdC5uYW1lXSA9IHJ0KHQuZmFjdG9yeS5za2V0Y2gocmwobywgdCwgbltRZigpXSksIG4pKTsKICAgICAgfSwgZnVuY3Rpb24gKG8pIHsKICAgICAgICByW28ucG5hbWVdID0gRmYoITEsIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgICAgICByZXR1cm4gby5mYWN0b3J5LnNrZXRjaChybCh0LCBvLCBuLCBlKSk7CiAgICAgICAgfSk7CiAgICAgIH0sIGZ1bmN0aW9uIChvKSB7CiAgICAgICAgcltvLnBuYW1lXSA9IElmKCEwLCBmdW5jdGlvbiAobiwgdCwgZSkgewogICAgICAgICAgcmV0dXJuIE0obltvLm5hbWVdLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gby5mYWN0b3J5LnNrZXRjaChYbyhvLmRlZmF1bHRzKG4sIHQsIGUpLCB0LCBvLm92ZXJyaWRlcyhuLCB0KSkpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSksIHsKICAgICAgaW50ZXJuYWxzOiBydChyKSwKICAgICAgZXh0ZXJuYWxzOiBydChpKQogICAgfTsKICAgIHZhciBvLCByLCBpOwogIH0KCiAgZnVuY3Rpb24gbGwodCwgbiwgZSkgewogICAgcmV0dXJuIG8gPSB2dC5zb21lKHQpLCBpID0gKHIgPSBuKS5jb21wb25lbnRzLCBzID0gZHQoZSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIG8gPSB0LCByID0gITEsIHsKICAgICAgICBuYW1lOiBydChlID0gbiksCiAgICAgICAgcmVxdWlyZWQ6IGZ1bmN0aW9uIHJlcXVpcmVkKCkgewogICAgICAgICAgcmV0dXJuIG8uZm9sZChmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICByZXR1cm4gdDsKICAgICAgICAgIH0sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgIHJldHVybiB0OwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICB1c2VkOiBmdW5jdGlvbiB1c2VkKCkgewogICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgfSwKICAgICAgICByZXBsYWNlOiBmdW5jdGlvbiByZXBsYWNlKCkgewogICAgICAgICAgaWYgKHIpIHRocm93IG5ldyBFcnJvcigiVHJ5aW5nIHRvIHVzZSB0aGUgc2FtZSBwbGFjZWhvbGRlciBtb3JlIHRoYW4gb25jZTogIiArIGUpOwogICAgICAgICAgcmV0dXJuIHIgPSAhMCwgbzsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciBlLCBvLCByOwogICAgfSksIHUgPSBvLCBhID0gciwgYyA9IHMsIGwgPSB6KGksIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBBZih1LCBhLCB0LCBjKTsKICAgIH0pLCBKKHMsIGZ1bmN0aW9uICh0KSB7CiAgICAgIGlmICghMSA9PT0gdC51c2VkKCkgJiYgdC5yZXF1aXJlZCgpKSB0aHJvdyBuZXcgRXJyb3IoIlBsYWNlaG9sZGVyOiAiICsgdC5uYW1lKCkgKyAiIHdhcyBub3QgZm91bmQgaW4gY29tcG9uZW50cyBsaXN0XG5OYW1lc3BhY2U6ICIgKyBvLmdldE9yKCJub25lIikgKyAiXG5Db21wb25lbnRzOiAiICsgSlNPTi5zdHJpbmdpZnkoci5jb21wb25lbnRzLCBudWxsLCAyKSk7CiAgICB9KSwgbDsKICAgIHZhciBvLCByLCBpLCB1LCBhLCBjLCBzLCBsOwogIH0KCiAgZnVuY3Rpb24gZmwodCwgbiwgZSkgewogICAgdmFyIG8gPSBuLnBhcnRVaWRzW2VdOwogICAgcmV0dXJuIHQuZ2V0U3lzdGVtKCkuZ2V0QnlVaWQobykudG9PcHRpb25hbCgpOwogIH0KCiAgZnVuY3Rpb24gZGwodCwgbiwgZSkgewogICAgcmV0dXJuIGZsKHQsIG4sIGUpLmdldE9yRGllKCJDb3VsZCBub3QgZmluZCBwYXJ0OiAiICsgZSk7CiAgfQoKICBmdW5jdGlvbiBtbCh0LCBuLCBlKSB7CiAgICB2YXIgbyA9IHt9LAogICAgICAgIHIgPSBuLnBhcnRVaWRzLAogICAgICAgIGkgPSB0LmdldFN5c3RlbSgpOwogICAgcmV0dXJuIFN0KGUsIGZ1bmN0aW9uICh0KSB7CiAgICAgIG9bdF0gPSBydChpLmdldEJ5VWlkKHJbdF0pKTsKICAgIH0pLCBvOwogIH0KCiAgZnVuY3Rpb24gZ2wodCwgbikgewogICAgdmFyIGUgPSB0LmdldFN5c3RlbSgpOwogICAgcmV0dXJuIGR0KG4ucGFydFVpZHMsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiBydChlLmdldEJ5VWlkKHQpKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gcGwodCkgewogICAgcmV0dXJuIGt0KHQucGFydFVpZHMpOwogIH0KCiAgZnVuY3Rpb24gaGwodCwgbiwgZSkgewogICAgdmFyIG8gPSB7fSwKICAgICAgICByID0gbi5wYXJ0VWlkcywKICAgICAgICBpID0gdC5nZXRTeXN0ZW0oKTsKICAgIHJldHVybiBTdChlLCBmdW5jdGlvbiAodCkgewogICAgICBvW3RdID0gcnQoaS5nZXRCeVVpZChyW3RdKS5nZXRPckRpZSgpKTsKICAgIH0pLCBvOwogIH0KCiAgZnVuY3Rpb24gdmwobiwgdCkgewogICAgcmV0dXJuIHNyKE0oY2wodCksIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAga2V5OiB0LAogICAgICAgIHZhbHVlOiBuICsgIi0iICsgdAogICAgICB9OwogICAgfSkpOwogIH0KCiAgZnVuY3Rpb24gYmwobikgewogICAgcmV0dXJuIHVyKCJwYXJ0VWlkcyIsICJwYXJ0VWlkcyIsIFhlKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB2bCh0LnVpZCwgbik7CiAgICB9KSwgUW8oKSk7CiAgfQoKICBmdW5jdGlvbiB5bCh0LCBuLCBlLCBvLCByKSB7CiAgICB2YXIgaTsKICAgIHJldHVybiBjbyh0ICsgIiBbU3BlY1NjaGVtYV0iLCBaZSgoaSA9IHIsICgwIDwgby5sZW5ndGggPyBbdm8oInBhcnRzIiwgbyldIDogW10pLmNvbmNhdChbZm8oInVpZCIpLCBUbygiZG9tIiwge30pLCBUbygiY29tcG9uZW50cyIsIFtdKSwgdGEoIm9yaWdpbmFsU3BlYyIpLCBUbygiZGVidWcuc2tldGNoZXIiLCB7fSldKS5jb25jYXQoaSkpLmNvbmNhdChuKSksIGUpOwogIH0KCiAgZnVuY3Rpb24geGwodCwgbiwgZSwgbywgcikgewogICAgdmFyIGkgPSBlZChyKSwKICAgICAgICB1ID0geWwodCwgbiwgaSwgYWwoZSksIFtibChlKV0pLAogICAgICAgIGEgPSBzbCgwLCB1LCBlKTsKICAgIHJldHVybiBvKHUsIGxsKHQsIHUsIGEuaW50ZXJuYWxzKCkpLCBpLCBhLmV4dGVybmFscygpKTsKICB9CgogIGZ1bmN0aW9uIHdsKHQpIHsKICAgIHZhciByID0gY28oIlNrZXRjaGVyIGZvciAiICsgdC5uYW1lLCBvZCwgdCksCiAgICAgICAgbiA9IGR0KHIuYXBpcywgSHIpLAogICAgICAgIGUgPSBkdChyLmV4dHJhQXBpcywgVnIpOwogICAgcmV0dXJuIF9sdChfbHQoewogICAgICBuYW1lOiByLm5hbWUsCiAgICAgIGNvbmZpZ0ZpZWxkczogci5jb25maWdGaWVsZHMsCiAgICAgIHNrZXRjaDogZnVuY3Rpb24gc2tldGNoKHQpIHsKICAgICAgICByZXR1cm4gbiA9IHIubmFtZSwgZSA9IHIuY29uZmlnRmllbGRzLCAoMCwgci5mYWN0b3J5KSh5bChuLCBlLCBvID0gZWQodCksIFtdLCBbXSksIG8pOwogICAgICAgIHZhciBuLCBlLCBvOwogICAgICB9CiAgICB9LCBuKSwgZSk7CiAgfQoKICBmdW5jdGlvbiBTbCh0KSB7CiAgICB2YXIgbiA9IGNvKCJTa2V0Y2hlciBmb3IgIiArIHQubmFtZSwgcmQsIHQpLAogICAgICAgIGUgPSBpbChuLm5hbWUsIG4ucGFydEZpZWxkcyksCiAgICAgICAgbyA9IGR0KG4uYXBpcywgSHIpLAogICAgICAgIHIgPSBkdChuLmV4dHJhQXBpcywgVnIpOwogICAgcmV0dXJuIF9sdChfbHQoewogICAgICBuYW1lOiBuLm5hbWUsCiAgICAgIHBhcnRGaWVsZHM6IG4ucGFydEZpZWxkcywKICAgICAgY29uZmlnRmllbGRzOiBuLmNvbmZpZ0ZpZWxkcywKICAgICAgc2tldGNoOiBmdW5jdGlvbiBza2V0Y2godCkgewogICAgICAgIHJldHVybiB4bChuLm5hbWUsIG4uY29uZmlnRmllbGRzLCBuLnBhcnRGaWVsZHMsIG4uZmFjdG9yeSwgdCk7CiAgICAgIH0sCiAgICAgIHBhcnRzOiBlCiAgICB9LCBvKSwgcik7CiAgfQoKICBmdW5jdGlvbiBDbCh0KSB7CiAgICByZXR1cm4gImlucHV0IiA9PT0gRnQodCkgJiYgInJhZGlvIiAhPT0gcm4odCwgInR5cGUiKSB8fCAidGV4dGFyZWEiID09PSBGdCh0KTsKICB9CgogIGZ1bmN0aW9uIGtsKHQsIG4sIGUpIHsKICAgIChuLmRpc2FibGVkKCkgPyBjZCA6IHNkKSh0LCBuKTsKICB9CgogIGZ1bmN0aW9uIE9sKHQsIG4pIHsKICAgIHJldHVybiAhMCA9PT0gbi51c2VOYXRpdmUgJiYgd3QoYWQsIEZ0KHQuZWxlbWVudCkpOwogIH0KCiAgZnVuY3Rpb24gX2wodCwgbikgewogICAgcmV0dXJuIE9sKHQsIG4pID8gYW4odC5lbGVtZW50LCAiZGlzYWJsZWQiKSA6ICJ0cnVlIiA9PT0gcm4odC5lbGVtZW50LCAiYXJpYS1kaXNhYmxlZCIpOwogIH0KCiAgZnVuY3Rpb24gVGwoZSwgbywgdCwgcikgewogICAgdmFyIG4gPSBwcyhlLmVsZW1lbnQsICIuIiArIG8uaGlnaGxpZ2h0Q2xhc3MpOwogICAgU3QobiwgZnVuY3Rpb24gKG4pIHsKICAgICAgVChyLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0LmVsZW1lbnQgPT09IG47CiAgICAgIH0pIHx8IChZcihuLCBvLmhpZ2hsaWdodENsYXNzKSwgZS5nZXRTeXN0ZW0oKS5nZXRCeURvbShuKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgby5vbkRlaGlnaGxpZ2h0KGUsIHQpLCBocih0LCBaaSgpKTsKICAgICAgfSkpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBFbCh0LCBuLCBlLCBvKSB7CiAgICBUbCh0LCBuLCAwLCBbb10pLCBHbCgwLCBuLCAwLCBvKSB8fCAoWHIoby5lbGVtZW50LCBuLmhpZ2hsaWdodENsYXNzKSwgbi5vbkhpZ2hsaWdodCh0LCBvKSwgaHIobywgUWkoKSkpOwogIH0KCiAgZnVuY3Rpb24gRGwoZSwgbiwgdCwgbykgewogICAgdmFyIHIgPSBwcyhlLmVsZW1lbnQsICIuIiArIG4uaXRlbUNsYXNzKTsKICAgIHJldHVybiBQKHIsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBxcih0LCBuLmhpZ2hsaWdodENsYXNzKTsKICAgIH0pLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSBlYSh0LCBvLCAwLCByLmxlbmd0aCAtIDEpOwogICAgICByZXR1cm4gZS5nZXRTeXN0ZW0oKS5nZXRCeURvbShyW25dKS50b09wdGlvbmFsKCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIEJsKHQsIG4sIGUpIHsKICAgIHZhciBvID0gTCh0LnNsaWNlKDAsIG4pKSwKICAgICAgICByID0gTCh0LnNsaWNlKG4gKyAxKSk7CiAgICByZXR1cm4gVihvLmNvbmNhdChyKSwgZSk7CiAgfQoKICBmdW5jdGlvbiBNbCh0LCBuLCBlKSB7CiAgICByZXR1cm4gVihMKHQuc2xpY2UoMCwgbikpLCBlKTsKICB9CgogIGZ1bmN0aW9uIEFsKHQsIG4sIGUpIHsKICAgIHZhciBvID0gdC5zbGljZSgwLCBuKTsKICAgIHJldHVybiBWKHQuc2xpY2UobiArIDEpLmNvbmNhdChvKSwgZSk7CiAgfQoKICBmdW5jdGlvbiBGbCh0LCBuLCBlKSB7CiAgICByZXR1cm4gVih0LnNsaWNlKG4gKyAxKSwgZSk7CiAgfQoKICBmdW5jdGlvbiBJbChlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSB0LnJhdzsKICAgICAgcmV0dXJuIHd0KGUsIG4ud2hpY2gpOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIFJsKHQpIHsKICAgIHJldHVybiBmdW5jdGlvbiAobikgewogICAgICByZXR1cm4gTih0LCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0KG4pOwogICAgICB9KTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBWbCh0KSB7CiAgICByZXR1cm4gITAgPT09IHQucmF3LnNoaWZ0S2V5OwogIH0KCiAgZnVuY3Rpb24gUGwodCkgewogICAgcmV0dXJuICEwID09PSB0LnJhdy5jdHJsS2V5OwogIH0KCiAgZnVuY3Rpb24gSGwodCwgbikgewogICAgcmV0dXJuIHsKICAgICAgbWF0Y2hlczogdCwKICAgICAgY2xhc3NpZmljYXRpb246IG4KICAgIH07CiAgfQoKICBmdW5jdGlvbiB6bCh0LCBuLCBlKSB7CiAgICBuLmV4aXN0cyhmdW5jdGlvbiAobikgewogICAgICByZXR1cm4gZS5leGlzdHMoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gTHQodCwgbik7CiAgICAgIH0pOwogICAgfSkgfHwgdnIodCwgcWkoKSwgewogICAgICBwcmV2Rm9jdXM6IG4sCiAgICAgIG5ld0ZvY3VzOiBlCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIE5sKCkgewogICAgZnVuY3Rpb24gbyh0KSB7CiAgICAgIHJldHVybiBPYSh0LmVsZW1lbnQpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIGdldDogbywKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodCwgbikgewogICAgICAgIHZhciBlID0gbyh0KTsKICAgICAgICB0LmdldFN5c3RlbSgpLnRyaWdnZXJGb2N1cyhuLCB0LmVsZW1lbnQpLCB6bCh0LCBlLCBvKHQpKTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIExsKCkgewogICAgZnVuY3Rpb24gcih0KSB7CiAgICAgIHJldHVybiBnZC5nZXRIaWdobGlnaHRlZCh0KS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdC5lbGVtZW50OwogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBnZXQ6IHIsCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KG4sIHQpIHsKICAgICAgICB2YXIgZSA9IHIobik7CiAgICAgICAgbi5nZXRTeXN0ZW0oKS5nZXRCeURvbSh0KS5mb2xkKHN0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgZ2QuaGlnaGxpZ2h0KG4sIHQpOwogICAgICAgIH0pOwogICAgICAgIHZhciBvID0gcihuKTsKICAgICAgICB6bChuLCBlLCBvKTsKICAgICAgfQogICAgfTsKICB9CgogIGRzLmx0ciwgZHMucnRsOwoKICBmdW5jdGlvbiBXbCh0LCBuLCBlLCBvLCByLCBpKSB7CiAgICB2YXIgdSA9IGkubWFwKE1lKTsKICAgIHJldHVybiBjZih0LCBuLCBlLCBvLCByLCB1KTsKICB9CgogIGZ1bmN0aW9uIFVsKHQsIG4sIGUpIHsKICAgIHZhciBvLAogICAgICAgIHIsCiAgICAgICAgaSwKICAgICAgICB1ID0gbi5nZXRBdHRhY2hQb2ludCh0KTsKICAgIGZuKHQuZWxlbWVudCwgInBvc2l0aW9uIiwgc2YuZ2V0TW9kZSh1KSksIGkgPSBuLmNsb2FrVmlzaWJpbGl0eUF0dHIsIHBuKChvID0gdCkuZWxlbWVudCwgciA9ICJ2aXNpYmlsaXR5IikuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIGNuKG8uZWxlbWVudCwgaSk7CiAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICBvbihvLmVsZW1lbnQsIGksIHQpOwogICAgfSksIGZuKG8uZWxlbWVudCwgciwgImhpZGRlbiIpOwogIH0KCiAgZnVuY3Rpb24gamwodCwgbiwgZSkgewogICAgdmFyIG8sCiAgICAgICAgciwKICAgICAgICBpLAogICAgICAgIHUgPSB0LmVsZW1lbnQ7CiAgICBUKFsidG9wIiwgImxlZnQiLCAicmlnaHQiLCAiYm90dG9tIl0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBwbih1LCB0KS5pc1NvbWUoKTsKICAgIH0pIHx8IHZuKHQuZWxlbWVudCwgInBvc2l0aW9uIiksIHIgPSAidmlzaWJpbGl0eSIsIGkgPSBuLmNsb2FrVmlzaWJpbGl0eUF0dHIsIHVuKChvID0gdCkuZWxlbWVudCwgaSkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB2bihvLmVsZW1lbnQsIHIpOwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIGZuKG8uZWxlbWVudCwgciwgdCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIEdsKHQsIG4sIGUsIG8pIHsKICAgIHJldHVybiBxcihvLmVsZW1lbnQsIG4uaGlnaGxpZ2h0Q2xhc3MpOwogIH0KCiAgZnVuY3Rpb24gWGwobiwgdCwgZSkgewogICAgcmV0dXJuIEZ1KG4uZWxlbWVudCwgIi4iICsgdC5pdGVtQ2xhc3MpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIG4uZ2V0U3lzdGVtKCkuZ2V0QnlEb20odCkudG9PcHRpb25hbCgpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBZbChuLCB0LCBlKSB7CiAgICB2YXIgbyA9IHBzKG4uZWxlbWVudCwgIi4iICsgdC5pdGVtQ2xhc3MpOwogICAgcmV0dXJuICgwIDwgby5sZW5ndGggPyB2dC5zb21lKG9bby5sZW5ndGggLSAxXSkgOiB2dC5ub25lKCkpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIG4uZ2V0U3lzdGVtKCkuZ2V0QnlEb20odCkudG9PcHRpb25hbCgpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBxbChuLCB0LCBlKSB7CiAgICByZXR1cm4gZXQoTShwcyhuLmVsZW1lbnQsICIuIiArIHQuaXRlbUNsYXNzKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIG4uZ2V0U3lzdGVtKCkuZ2V0QnlEb20odCkudG9PcHRpb25hbCgpOwogICAgfSkpOwogIH0KCiAgdmFyIEtsLAogICAgICBKbCwKICAgICAgJGwsCiAgICAgIFFsLAogICAgICBabCA9IChLbCA9IFhuLCB7CiAgICBnZXQ6IGZ1bmN0aW9uIGdldCh0KSB7CiAgICAgIGlmICghS2wodCkpIHRocm93IG5ldyBFcnJvcigiQ2FuIG9ubHkgZ2V0IHRleHQgdmFsdWUgb2YgYSB0ZXh0IG5vZGUiKTsKICAgICAgcmV0dXJuIEpsKHQpLmdldE9yKCIiKTsKICAgIH0sCiAgICBnZXRPcHRpb246IEpsID0gZnVuY3Rpb24gSmwodCkgewogICAgICByZXR1cm4gS2wodCkgPyB2dC5mcm9tKHQuZG9tLm5vZGVWYWx1ZSkgOiB2dC5ub25lKCk7CiAgICB9LAogICAgc2V0OiBmdW5jdGlvbiBzZXQodCwgbikgewogICAgICBpZiAoIUtsKHQpKSB0aHJvdyBuZXcgRXJyb3IoIkNhbiBvbmx5IHNldCByYXcgdGV4dCB2YWx1ZSBvZiBhIHRleHQgbm9kZSIpOwogICAgICB0LmRvbS5ub2RlVmFsdWUgPSBuOwogICAgfQogIH0pLAogICAgICB0ZiA9IFsiaW1nIiwgImJyIl0sCiAgICAgIG5mID0gW3hvKCJnZXRTZWxlY3Rpb24iKSwgZm8oInJvb3QiKSwgeG8oImJ1YmJsZSIpLCBOYygpLCBUbygib3ZlcnJpZGVzIiwge30pLCBUbygic2hvd0Fib3ZlIiwgITEpLCBadSgicGxhY2VtZW50IiwgZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgIHZhciByID0gWHQobi5yb290KS5kb20sCiAgICAgICAgbyA9IFhjKHQsIDAsIG4pOwogICAgcmV0dXJuIHFjKHdzKHIsIG4pLmJpbmQoZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHQgPSByLCBuID0gZnMuZXhhY3RGcm9tUmFuZ2UoZSksICgwIDwgKG8gPSBaYyh0LCBuKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSkud2lkdGggfHwgMCA8IG8uaGVpZ2h0ID8gdnQuc29tZShvKS5tYXAoJGMpIDogdnQubm9uZSgpKS5vclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IEF0LmZyb21UZXh0KCJcdUZFRkYiKTsKICAgICAgICBFbihlLnN0YXJ0LCB0KTsKICAgICAgICB2YXIgbiA9IGJzKHIsIGZzLmV4YWN0KHQsIDAsIHQsIDEpKTsKICAgICAgICByZXR1cm4gVGUodCksIG47CiAgICAgIH0pLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gWWModC5sZWZ0LCB0LnRvcCwgdC53aWR0aCwgdC5oZWlnaHQpOwogICAgICB9KTsKICAgICAgdmFyIHQsIG4sIG87CiAgICB9KSwgbywgbiwgZSwgd3MociwgbikuYmluZChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gR24odC5zdGFydCkgPyB2dC5zb21lKHQuc3RhcnQpIDogbGUodC5zdGFydCk7CiAgICB9KS5nZXRPcih0LmVsZW1lbnQpKTsKICB9KV0sCiAgICAgIGVmID0gImxpbmstbGF5b3V0IiwKICAgICAgb2YgPSBzbygidHlwZSIsIHsKICAgIHNlbGVjdGlvbjogbmYsCiAgICBub2RlOiB1cywKICAgIGhvdHNwb3Q6IG5zLAogICAgc3VibWVudTogW2ZvKCJpdGVtIiksIE5jKCksIFRvKCJvdmVycmlkZXMiLCB7fSksIFp1KCJwbGFjZW1lbnQiLCBmdW5jdGlvbiAodCwgbiwgZSkgewogICAgICB2YXIgbyA9IE1hKGUsIG4uaXRlbS5lbGVtZW50KSwKICAgICAgICAgIHIgPSBMYyh0LmVsZW1lbnQsIG4sIERzKCksIEJzKCksIERzKCksIEJzKCksIHZ0Lm5vbmUoKSk7CiAgICAgIHJldHVybiB2dC5zb21lKFBjKHsKICAgICAgICBhbmNob3JCb3g6IG8sCiAgICAgICAgYnViYmxlOiB3YygpLAogICAgICAgIG92ZXJyaWRlczogbi5vdmVycmlkZXMsCiAgICAgICAgbGF5b3V0czogciwKICAgICAgICBwbGFjZXI6IHZ0Lm5vbmUoKQogICAgICB9KSk7CiAgICB9KV0sCiAgICBtYWtlc2hpZnQ6IGVzCiAgfSksCiAgICAgIHJmID0gW3lvKCJjbGFzc2VzIiwgdHIpLCBNbygibW9kZSIsICJhbGwiLCBbImFsbCIsICJsYXlvdXQiLCAicGxhY2VtZW50Il0pXSwKICAgICAgdWYgPSBbVG8oInVzZUZpeGVkIiwgTyksIHhvKCJnZXRCb3VuZHMiKV0sCiAgICAgIGFmID0gW21vKCJhbmNob3IiLCBvZiksIF9vKCJ0cmFuc2l0aW9uIiwgcmYpXSwKICAgICAgY2YgPSBmdW5jdGlvbiBjZihjLCBzLCBsLCBmLCB0LCBkKSB7CiAgICB2YXIgbSA9IGNvKCJwbGFjZW1lbnQuaW5mbyIsIEpvKGFmKSwgdCksCiAgICAgICAgZyA9IG0uYW5jaG9yLAogICAgICAgIHAgPSBmLmVsZW1lbnQsCiAgICAgICAgaCA9IGwuZ2V0KGYudWlkKTsKCiAgICBfYShmdW5jdGlvbiAoKSB7CiAgICAgIGZuKHAsICJwb3NpdGlvbiIsICJmaXhlZCIpOwogICAgICB2YXIgdCA9IHBuKHAsICJ2aXNpYmlsaXR5Iik7CiAgICAgIGZuKHAsICJ2aXNpYmlsaXR5IiwgImhpZGRlbiIpOwogICAgICB2YXIgbiwKICAgICAgICAgIGUsCiAgICAgICAgICBvLAogICAgICAgICAgciwKICAgICAgICAgIGkgPSBzLnVzZUZpeGVkKCkgPyAociA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgX2MoMCwgMCwgci5jbGllbnRXaWR0aCwgci5jbGllbnRIZWlnaHQpKSA6IChlID0gQ24oKG4gPSBjKS5lbGVtZW50KSwgbyA9IG4uZWxlbWVudC5kb20uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIE9jKGUubGVmdCwgZS50b3AsIG8ud2lkdGgsIG8uaGVpZ2h0KSksCiAgICAgICAgICB1ID0gZy5wbGFjZW1lbnQsCiAgICAgICAgICBhID0gZC5tYXAocnQpLm9yKHMuZ2V0Qm91bmRzKTsKICAgICAgdShjLCBnLCBpKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSB0LnBsYWNlci5nZXRPcihNcykoYywgaSwgdCwgYSwgZiwgaCwgbS50cmFuc2l0aW9uKTsKICAgICAgICBsLnNldChmLnVpZCwgbik7CiAgICAgIH0pLCB0LmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgIHZuKHAsICJ2aXNpYmlsaXR5Iik7CiAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgZm4ocCwgInZpc2liaWxpdHkiLCB0KTsKICAgICAgfSksIHBuKHAsICJsZWZ0IikuaXNOb25lKCkgJiYgcG4ocCwgInRvcCIpLmlzTm9uZSgpICYmIHBuKHAsICJyaWdodCIpLmlzTm9uZSgpICYmIHBuKHAsICJib3R0b20iKS5pc05vbmUoKSAmJiBtdChwbihwLCAicG9zaXRpb24iKSwgImZpeGVkIikgJiYgdm4ocCwgInBvc2l0aW9uIik7CiAgICB9LCBwKTsKICB9LAogICAgICBzZiA9IHlhKHsKICAgIGZpZWxkczogdWYsCiAgICBuYW1lOiAicG9zaXRpb25pbmciLAogICAgYWN0aXZlOiBpYywKICAgIGFwaXM6IE9iamVjdC5mcmVlemUoewogICAgICBfX3Byb3RvX186IG51bGwsCiAgICAgIHBvc2l0aW9uOiBmdW5jdGlvbiBwb3NpdGlvbih0LCBuLCBlLCBvLCByKSB7CiAgICAgICAgV2wodCwgbiwgZSwgbywgciwgdnQubm9uZSgpKTsKICAgICAgfSwKICAgICAgcG9zaXRpb25XaXRoaW46IFdsLAogICAgICBwb3NpdGlvbldpdGhpbkJvdW5kczogY2YsCiAgICAgIGdldE1vZGU6IGZ1bmN0aW9uIGdldE1vZGUodCwgbiwgZSkgewogICAgICAgIHJldHVybiBuLnVzZUZpeGVkKCkgPyAiZml4ZWQiIDogImFic29sdXRlIjsKICAgICAgfSwKICAgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KHQsIG4sIGUsIG8pIHsKICAgICAgICB2YXIgciA9IG8uZWxlbWVudDsKICAgICAgICBTdChbInBvc2l0aW9uIiwgImxlZnQiLCAicmlnaHQiLCAidG9wIiwgImJvdHRvbSJdLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHZuKHIsIHQpOwogICAgICAgIH0pLCBjbihyLCBUYyksIGUuY2xlYXIoby51aWQpOwogICAgICB9CiAgICB9KSwKICAgIHN0YXRlOiBPYmplY3QuZnJlZXplKHsKICAgICAgX19wcm90b19fOiBudWxsLAogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHZhciBlID0ge307CiAgICAgICAgcmV0dXJuIHh1KHsKICAgICAgICAgIHJlYWRTdGF0ZTogZnVuY3Rpb24gcmVhZFN0YXRlKCkgewogICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgIH0sCiAgICAgICAgICBjbGVhcjogZnVuY3Rpb24gY2xlYXIodCkgewogICAgICAgICAgICBkKHQpID8gZGVsZXRlIGVbdF0gOiBlID0ge307CiAgICAgICAgICB9LAogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodCwgbikgewogICAgICAgICAgICBlW3RdID0gbjsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCh0KSB7CiAgICAgICAgICAgIHJldHVybiB0dChlLCB0KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSkKICB9KSwKICAgICAgbGYgPSBmdW5jdGlvbiBsZih0KSB7CiAgICBocih0LCBHaSgpKTsKICAgIHZhciBuID0gdC5jb21wb25lbnRzKCk7CiAgICBTdChuLCBsZik7CiAgfSwKICAgICAgZmYgPSBmdW5jdGlvbiBmZih0KSB7CiAgICB2YXIgbiA9IHQuY29tcG9uZW50cygpOwogICAgU3QobiwgZmYpLCBocih0LCBqaSgpKTsKICB9LAogICAgICBkZiA9IGZ1bmN0aW9uIGRmKHQsIG4sIGUpIHsKICAgIHQuZ2V0U3lzdGVtKCkuYWRkVG9Xb3JsZChuKSwgZSh0LmVsZW1lbnQsIG4uZWxlbWVudCksIGhlKHQuZWxlbWVudCkgJiYgZmYobiksIHQuc3luY0NvbXBvbmVudHMoKTsKICB9LAogICAgICBtZiA9IGZ1bmN0aW9uIG1mKHQsIG4sIGUpIHsKICAgIGUodCwgbi5lbGVtZW50KTsKICAgIHZhciBvID0gS3Qobi5lbGVtZW50KTsKICAgIFN0KG8sIGZ1bmN0aW9uICh0KSB7CiAgICAgIG4uZ2V0QnlEb20odCkuZWFjaChmZik7CiAgICB9KTsKICB9LAogICAgICBnZiA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgY2xvYWs6IFVsLAogICAgZGVjbG9hazogamwsCiAgICBvcGVuOiBMcywKICAgIG9wZW5XaGlsZUNsb2FrZWQ6IGZ1bmN0aW9uIG9wZW5XaGlsZUNsb2FrZWQodCwgbiwgZSwgbywgcikgewogICAgICBVbCh0LCBuKSwgTHModCwgbiwgZSwgbyksIHIoKSwgamwodCwgbik7CiAgICB9LAogICAgY2xvc2U6IFdzLAogICAgaXNPcGVuOiBVcywKICAgIGlzUGFydE9mOiBmdW5jdGlvbiBpc1BhcnRPZihuLCBlLCB0LCBvKSB7CiAgICAgIHJldHVybiBVcygwLCAwLCB0KSAmJiB0LmdldCgpLmV4aXN0cyhmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBlLmlzUGFydE9mKG4sIHQsIG8pOwogICAgICB9KTsKICAgIH0sCiAgICBnZXRTdGF0ZTogZnVuY3Rpb24gZ2V0U3RhdGUodCwgbiwgZSkgewogICAgICByZXR1cm4gZS5nZXQoKTsKICAgIH0sCiAgICBzZXRDb250ZW50OiBmdW5jdGlvbiBzZXRDb250ZW50KHQsIG4sIGUsIG8pIHsKICAgICAgcmV0dXJuIGUuZ2V0KCkubWFwKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gTnModCwgbiwgZSwgbyk7CiAgICAgIH0pOwogICAgfQogIH0pLAogICAgICBwZiA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgZXZlbnRzOiBmdW5jdGlvbiBldmVudHMoZSwgbykgewogICAgICByZXR1cm4gbnUoW0NyKFBpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgV3ModCwgZSwgbyk7CiAgICAgIH0pXSk7CiAgICB9CiAgfSksCiAgICAgIGhmID0geWEoewogICAgZmllbGRzOiBbS3UoIm9uT3BlbiIpLCBLdSgib25DbG9zZSIpLCBmbygiaXNQYXJ0T2YiKSwgZm8oImdldEF0dGFjaFBvaW50IiksIFRvKCJjbG9ha1Zpc2liaWxpdHlBdHRyIiwgImRhdGEtcHJlY2xvYWstdmlzaWJpbGl0eSIpXSwKICAgIG5hbWU6ICJzYW5kYm94aW5nIiwKICAgIGFjdGl2ZTogcGYsCiAgICBhcGlzOiBnZiwKICAgIHN0YXRlOiBPYmplY3QuZnJlZXplKHsKICAgICAgX19wcm90b19fOiBudWxsLAogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHZhciB0ID0gZGMoKSwKICAgICAgICAgICAgbiA9IHJ0KCJub3QtaW1wbGVtZW50ZWQiKTsKICAgICAgICByZXR1cm4geHUoewogICAgICAgICAgcmVhZFN0YXRlOiBuLAogICAgICAgICAgaXNPcGVuOiB0LmlzU2V0LAogICAgICAgICAgY2xlYXI6IHQuY2xlYXIsCiAgICAgICAgICBzZXQ6IHQuc2V0LAogICAgICAgICAgZ2V0OiB0LmdldAogICAgICAgIH0pOwogICAgICB9CiAgICB9KQogIH0pLAogICAgICB2ZiA9IHJ0KCJkaXNtaXNzLnBvcHVwcyIpLAogICAgICBiZiA9IHJ0KCJyZXBvc2l0aW9uLnBvcHVwcyIpLAogICAgICB5ZiA9IHJ0KCJtb3VzZS5yZWxlYXNlZCIpLAogICAgICB4ZiA9IFplKFtUbygiaXNFeHRyYVBhcnQiLCBPKSwgX28oImZpcmVFdmVudEluc3RlYWQiLCBbVG8oImV2ZW50IiwgWGkoKSldKV0pLAogICAgICB3ZiA9IFplKFtfbygiZmlyZUV2ZW50SW5zdGVhZCIsIFtUbygiZXZlbnQiLCBZaSgpKV0pLCBobygiZG9SZXBvc2l0aW9uIildKSwKICAgICAgU2YgPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIG9uTG9hZDogWHMsCiAgICBvblVubG9hZDogWXMsCiAgICBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUodCwgbiwgZSwgbykgewogICAgICBuLnN0b3JlLm1hbmFnZXIuc2V0VmFsdWUodCwgbiwgZSwgbyk7CiAgICB9LAogICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKHQsIG4sIGUpIHsKICAgICAgcmV0dXJuIG4uc3RvcmUubWFuYWdlci5nZXRWYWx1ZSh0LCBuLCBlKTsKICAgIH0sCiAgICBnZXRTdGF0ZTogZnVuY3Rpb24gZ2V0U3RhdGUodCwgbiwgZSkgewogICAgICByZXR1cm4gZTsKICAgIH0KICB9KSwKICAgICAgQ2YgPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGV2ZW50czogZnVuY3Rpb24gZXZlbnRzKGUsIG8pIHsKICAgICAgdmFyIHQgPSBlLnJlc2V0T25Eb20gPyBbZXUoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBYcyh0LCBlLCBvKTsKICAgICAgfSksIG91KGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgWXModCwgZSwgbyk7CiAgICAgIH0pXSA6IFt2YShlLCBvLCBYcyldOwogICAgICByZXR1cm4gbnUodCk7CiAgICB9CiAgfSksCiAgICAgIGtmID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBtZW1vcnk6IHFzLAogICAgZGF0YXNldDogS3MsCiAgICBtYW51YWw6IGZ1bmN0aW9uIG1hbnVhbCgpIHsKICAgICAgcmV0dXJuIHh1KHsKICAgICAgICByZWFkU3RhdGU6IHN0CiAgICAgIH0pOwogICAgfSwKICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQodCkgewogICAgICByZXR1cm4gdC5zdG9yZS5tYW5hZ2VyLnN0YXRlKHQpOwogICAgfQogIH0pLAogICAgICBPZiA9IFt4bygiaW5pdGlhbFZhbHVlIiksIGZvKCJnZXRGYWxsYmFja0VudHJ5IiksIGZvKCJnZXREYXRhS2V5IiksIGZvKCJzZXRWYWx1ZSIpLCBadSgibWFuYWdlciIsIHsKICAgIHNldFZhbHVlOiBKcywKICAgIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSh0LCBuLCBlKSB7CiAgICAgIHZhciBvID0gbi5zdG9yZSwKICAgICAgICAgIHIgPSBvLmdldERhdGFLZXkodCk7CiAgICAgIHJldHVybiBlLmxvb2t1cChyKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gby5nZXRGYWxsYmFja0VudHJ5KHIpOwogICAgICB9KTsKICAgIH0sCiAgICBvbkxvYWQ6IGZ1bmN0aW9uIG9uTG9hZChuLCBlLCBvKSB7CiAgICAgIGUuc3RvcmUuaW5pdGlhbFZhbHVlLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICBKcyhuLCBlLCBvLCB0KTsKICAgICAgfSk7CiAgICB9LAogICAgb25VbmxvYWQ6IGZ1bmN0aW9uIG9uVW5sb2FkKHQsIG4sIGUpIHsKICAgICAgZS5jbGVhcigpOwogICAgfSwKICAgIHN0YXRlOiBLcwogIH0pXSwKICAgICAgX2YgPSBbZm8oImdldFZhbHVlIiksIFRvKCJzZXRWYWx1ZSIsIHN0KSwgeG8oImluaXRpYWxWYWx1ZSIpLCBadSgibWFuYWdlciIsIHsKICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh0LCBuLCBlLCBvKSB7CiAgICAgIG4uc3RvcmUuc2V0VmFsdWUodCwgbyksIG4ub25TZXRWYWx1ZSh0LCBvKTsKICAgIH0sCiAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUodCwgbiwgZSkgewogICAgICByZXR1cm4gbi5zdG9yZS5nZXRWYWx1ZSh0KTsKICAgIH0sCiAgICBvbkxvYWQ6IGZ1bmN0aW9uIG9uTG9hZChuLCBlLCB0KSB7CiAgICAgIGUuc3RvcmUuaW5pdGlhbFZhbHVlLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICBlLnN0b3JlLnNldFZhbHVlKG4sIHQpOwogICAgICB9KTsKICAgIH0sCiAgICBvblVubG9hZDogc3QsCiAgICBzdGF0ZTogeXUuaW5pdAogIH0pXSwKICAgICAgVGYgPSB5YSh7CiAgICBmaWVsZHM6IFtFbygic3RvcmUiLCB7CiAgICAgIG1vZGU6ICJtZW1vcnkiCiAgICB9LCBzbygibW9kZSIsIHsKICAgICAgbWVtb3J5OiBbeG8oImluaXRpYWxWYWx1ZSIpLCBadSgibWFuYWdlciIsIHsKICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUodCwgbiwgZSwgbykgewogICAgICAgICAgZS5zZXQobyksIG4ub25TZXRWYWx1ZSh0LCBvKTsKICAgICAgICB9LAogICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSh0LCBuLCBlKSB7CiAgICAgICAgICByZXR1cm4gZS5nZXQoKTsKICAgICAgICB9LAogICAgICAgIG9uTG9hZDogZnVuY3Rpb24gb25Mb2FkKHQsIG4sIGUpIHsKICAgICAgICAgIG4uc3RvcmUuaW5pdGlhbFZhbHVlLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgZS5pc05vdFNldCgpICYmIGUuc2V0KHQpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBvblVubG9hZDogZnVuY3Rpb24gb25VbmxvYWQodCwgbiwgZSkgewogICAgICAgICAgZS5jbGVhcigpOwogICAgICAgIH0sCiAgICAgICAgc3RhdGU6IHFzCiAgICAgIH0pXSwKICAgICAgbWFudWFsOiBfZiwKICAgICAgZGF0YXNldDogT2YKICAgIH0pKSwgS3UoIm9uU2V0VmFsdWUiKSwgVG8oInJlc2V0T25Eb20iLCAhMSldLAogICAgbmFtZTogInJlcHJlc2VudGluZyIsCiAgICBhY3RpdmU6IENmLAogICAgYXBpczogU2YsCiAgICBleHRyYTogewogICAgICBzZXRWYWx1ZUZyb206IGZ1bmN0aW9uIHNldFZhbHVlRnJvbSh0LCBuKSB7CiAgICAgICAgdmFyIGUgPSBUZi5nZXRWYWx1ZShuKTsKICAgICAgICBUZi5zZXRWYWx1ZSh0LCBlKTsKICAgICAgfQogICAgfSwKICAgIHN0YXRlOiBrZgogIH0pLAogICAgICBFZiA9ICRzLAogICAgICBEZiA9IFpzLAogICAgICBCZiA9ICJwbGFjZWhvbGRlciIsCiAgICAgIE1mID0gUG8oW3sKICAgIHNpbmdsZTogWyJyZXF1aXJlZCIsICJ2YWx1ZVRodW5rIl0KICB9LCB7CiAgICBtdWx0aXBsZTogWyJyZXF1aXJlZCIsICJ2YWx1ZVRodW5rcyJdCiAgfV0pLAogICAgICBBZiA9IGZ1bmN0aW9uIEFmKHIsIGksIHUsIGEpIHsKICAgIHJldHVybiB0ID0gciwgZSA9IGEsICh0bChuID0gdSkgJiYgbi51aVR5cGUgPT09IEJmID8gKGMgPSBuLCBzID0gZSwgKG8gPSB0KS5leGlzdHMoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQgIT09IGMub3duZXI7CiAgICB9KSA/IE1mLnNpbmdsZSghMCwgcnQoYykpIDogdHQocywgYy5uYW1lKS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIHBsYWNlaG9sZGVyIGNvbXBvbmVudDogIiArIGMubmFtZSArICJcbktub3duOiBbIiArIGt0KHMpICsgIl1cbk5hbWVzcGFjZTogIiArIG8uZ2V0T3IoIm5vbmUiKSArICJcblNwZWM6ICIgKyBKU09OLnN0cmluZ2lmeShjLCBudWxsLCAyKSk7CiAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdC5yZXBsYWNlKCk7CiAgICB9KSkgOiBNZi5zaW5nbGUoITEsIHJ0KG4pKSkuZm9sZChmdW5jdGlvbiAodCwgbikgewogICAgICB2YXIgZSA9IHRsKHUpID8gbihpLCB1LmNvbmZpZywgdS52YWxpZGF0ZWQpIDogbihpKSwKICAgICAgICAgIG8gPSB6KHR0KGUsICJjb21wb25lbnRzIikuZ2V0T3IoW10pLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBBZihyLCBpLCB0LCBhKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBbX2x0KF9sdCh7fSwgZSksIHsKICAgICAgICBjb21wb25lbnRzOiBvCiAgICAgIH0pXTsKICAgIH0sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIGlmICh0bCh1KSkgewogICAgICAgIHZhciBlID0gbihpLCB1LmNvbmZpZywgdS52YWxpZGF0ZWQpOwogICAgICAgIHJldHVybiB1LnZhbGlkYXRlZC5wcmVwcm9jZXNzLmdldE9yKGgpKGUpOwogICAgICB9CgogICAgICByZXR1cm4gbihpKTsKICAgIH0pOwogICAgdmFyIHQsIG4sIGUsIG8sIGMsIHM7CiAgfSwKICAgICAgRmYgPSBNZi5zaW5nbGUsCiAgICAgIElmID0gTWYubXVsdGlwbGUsCiAgICAgIFJmID0gcnQoQmYpLAogICAgICBWZiA9IFBvKFt7CiAgICByZXF1aXJlZDogWyJkYXRhIl0KICB9LCB7CiAgICBleHRlcm5hbDogWyJkYXRhIl0KICB9LCB7CiAgICBvcHRpb25hbDogWyJkYXRhIl0KICB9LCB7CiAgICBncm91cDogWyJkYXRhIl0KICB9XSksCiAgICAgIFBmID0gVG8oImZhY3RvcnkiLCB7CiAgICBza2V0Y2g6IGgKICB9KSwKICAgICAgSGYgPSBUbygic2NoZW1hIiwgW10pLAogICAgICB6ZiA9IGZvKCJuYW1lIiksCiAgICAgIE5mID0gdXIoInBuYW1lIiwgInBuYW1lIiwgVWUoZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiAiPGFsbG95LiIgKyBGcih0Lm5hbWUpICsgIj4iOwogIH0pLCBRbygpKSwKICAgICAgTGYgPSBhcigic2NoZW1hIiwgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIFt4bygicHJlcHJvY2VzcyIpXTsKICB9KSwKICAgICAgV2YgPSBUbygiZGVmYXVsdHMiLCBydCh7fSkpLAogICAgICBVZiA9IFRvKCJvdmVycmlkZXMiLCBydCh7fSkpLAogICAgICBqZiA9IEpvKFtQZiwgSGYsIHpmLCBOZiwgV2YsIFVmXSksCiAgICAgIEdmID0gSm8oW1BmLCBIZiwgemYsIFdmLCBVZl0pLAogICAgICBYZiA9IEpvKFtQZiwgSGYsIHpmLCBOZiwgV2YsIFVmXSksCiAgICAgIFlmID0gSm8oW1BmLCBMZiwgemYsIGZvKCJ1bml0IiksIE5mLCBXZiwgVWZdKSwKICAgICAgcWYgPSBvbChWZi5yZXF1aXJlZCwgamYpLAogICAgICBLZiA9IG9sKFZmLmV4dGVybmFsLCBHZiksCiAgICAgIEpmID0gb2woVmYub3B0aW9uYWwsIFhmKSwKICAgICAgJGYgPSBvbChWZi5ncm91cCwgWWYpLAogICAgICBRZiA9IHJ0KCJlbnRpcmV0eSIpLAogICAgICBaZiA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgcmVxdWlyZWQ6IHFmLAogICAgZXh0ZXJuYWw6IEtmLAogICAgb3B0aW9uYWw6IEpmLAogICAgZ3JvdXA6ICRmLAogICAgYXNOYW1lZFBhcnQ6IG5sLAogICAgbmFtZTogZWwsCiAgICBhc0NvbW1vbjogZnVuY3Rpb24gYXNDb21tb24odCkgewogICAgICByZXR1cm4gdC5mb2xkKGgsIGgsIGgsIGgpOwogICAgfSwKICAgIG9yaWdpbmFsOiBRZgogIH0pLAogICAgICB0ZCA9IGZ1bmN0aW9uIHRkKHQsIG4pIHsKICAgIHJldHVybiB7CiAgICAgIHVpVHlwZTogUmYoKSwKICAgICAgb3duZXI6IHQsCiAgICAgIG5hbWU6IG4KICAgIH07CiAgfSwKICAgICAgbmQgPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBpbCwKICAgIGdlbmVyYXRlT25lOiB1bCwKICAgIHNjaGVtYXM6IGFsLAogICAgbmFtZXM6IGNsLAogICAgc3Vic3RpdHV0ZXM6IHNsLAogICAgY29tcG9uZW50czogbGwsCiAgICBkZWZhdWx0VWlkczogdmwsCiAgICBkZWZhdWx0VWlkc1NjaGVtYTogYmwsCiAgICBnZXRBbGxQYXJ0czogZ2wsCiAgICBnZXRBbGxQYXJ0TmFtZXM6IHBsLAogICAgZ2V0UGFydDogZmwsCiAgICBnZXRQYXJ0T3JEaWU6IGRsLAogICAgZ2V0UGFydHM6IG1sLAogICAgZ2V0UGFydHNPckRpZTogaGwKICB9KSwKICAgICAgZWQgPSBmdW5jdGlvbiBlZCh0KSB7CiAgICByZXR1cm4gVHQodCwgInVpZCIpID8gdCA6IF9sdChfbHQoe30sIHQpLCB7CiAgICAgIHVpZDogZ3UoInVpZCIpCiAgICB9KTsKICB9LAogICAgICBvZCA9IFplKFtmbygibmFtZSIpLCBmbygiZmFjdG9yeSIpLCBmbygiY29uZmlnRmllbGRzIiksIFRvKCJhcGlzIiwge30pLCBUbygiZXh0cmFBcGlzIiwge30pXSksCiAgICAgIHJkID0gWmUoW2ZvKCJuYW1lIiksIGZvKCJmYWN0b3J5IiksIGZvKCJjb25maWdGaWVsZHMiKSwgZm8oInBhcnRGaWVsZHMiKSwgVG8oImFwaXMiLCB7fSksIFRvKCJleHRyYUFwaXMiLCB7fSldKSwKICAgICAgaWQgPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdldEN1cnJlbnQ6IGZ1bmN0aW9uIGdldEN1cnJlbnQodCwgbiwgZSkgewogICAgICByZXR1cm4gbi5maW5kKHQpOwogICAgfQogIH0pLAogICAgICB1ZCA9IHlhKHsKICAgIGZpZWxkczogW2ZvKCJmaW5kIildLAogICAgbmFtZTogImNvbXBvc2luZyIsCiAgICBhcGlzOiBpZAogIH0pLAogICAgICBhZCA9IFsiaW5wdXQiLCAiYnV0dG9uIiwgInRleHRhcmVhIiwgInNlbGVjdCJdLAogICAgICBjZCA9IGZ1bmN0aW9uIGNkKG4sIHQsIGUpIHsKICAgIHQuZGlzYWJsZUNsYXNzLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgWHIobi5lbGVtZW50LCB0KTsKICAgIH0pLCAoT2wobiwgdCkgPyBmdW5jdGlvbiAodCkgewogICAgICBvbih0LmVsZW1lbnQsICJkaXNhYmxlZCIsICJkaXNhYmxlZCIpOwogICAgfSA6IGZ1bmN0aW9uICh0KSB7CiAgICAgIG9uKHQuZWxlbWVudCwgImFyaWEtZGlzYWJsZWQiLCAidHJ1ZSIpOwogICAgfSkobiksIHQub25EaXNhYmxlZChuKTsKICB9LAogICAgICBzZCA9IGZ1bmN0aW9uIHNkKG4sIHQsIGUpIHsKICAgIHQuZGlzYWJsZUNsYXNzLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgWXIobi5lbGVtZW50LCB0KTsKICAgIH0pLCAoT2wobiwgdCkgPyBmdW5jdGlvbiAodCkgewogICAgICBjbih0LmVsZW1lbnQsICJkaXNhYmxlZCIpOwogICAgfSA6IGZ1bmN0aW9uICh0KSB7CiAgICAgIG9uKHQuZWxlbWVudCwgImFyaWEtZGlzYWJsZWQiLCAiZmFsc2UiKTsKICAgIH0pKG4pLCB0Lm9uRW5hYmxlZChuKTsKICB9LAogICAgICBsZCA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgZW5hYmxlOiBzZCwKICAgIGRpc2FibGU6IGNkLAogICAgaXNEaXNhYmxlZDogX2wsCiAgICBvbkxvYWQ6IGtsLAogICAgc2V0OiBmdW5jdGlvbiBzZXQodCwgbiwgZSwgbykgewogICAgICAobyA/IGNkIDogc2QpKHQsIG4pOwogICAgfQogIH0pLAogICAgICBmZCA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgZXhoaWJpdDogZnVuY3Rpb24gZXhoaWJpdCh0LCBuKSB7CiAgICAgIHJldHVybiBOcih7CiAgICAgICAgY2xhc3Nlczogbi5kaXNhYmxlZCgpID8gbi5kaXNhYmxlQ2xhc3MudG9BcnJheSgpIDogW10KICAgICAgfSk7CiAgICB9LAogICAgZXZlbnRzOiBmdW5jdGlvbiBldmVudHMoZSwgdCkgewogICAgICByZXR1cm4gbnUoW3dyKEZpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgcmV0dXJuIF9sKHQsIGUpOwogICAgICB9KSwgdmEoZSwgdCwga2wpXSk7CiAgICB9CiAgfSksCiAgICAgIGRkID0geWEoewogICAgZmllbGRzOiBbRm8oImRpc2FibGVkIiwgTyksIFRvKCJ1c2VOYXRpdmUiLCAhMCksIHhvKCJkaXNhYmxlQ2xhc3MiKSwgS3UoIm9uRGlzYWJsZWQiKSwgS3UoIm9uRW5hYmxlZCIpXSwKICAgIG5hbWU6ICJkaXNhYmxpbmciLAogICAgYWN0aXZlOiBmZCwKICAgIGFwaXM6IGxkCiAgfSksCiAgICAgIG1kID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBkZWhpZ2hsaWdodEFsbDogZnVuY3Rpb24gZGVoaWdobGlnaHRBbGwodCwgbiwgZSkgewogICAgICByZXR1cm4gVGwodCwgbiwgMCwgW10pOwogICAgfSwKICAgIGRlaGlnaGxpZ2h0OiBmdW5jdGlvbiBkZWhpZ2hsaWdodCh0LCBuLCBlLCBvKSB7CiAgICAgIEdsKDAsIG4sIDAsIG8pICYmIChZcihvLmVsZW1lbnQsIG4uaGlnaGxpZ2h0Q2xhc3MpLCBuLm9uRGVoaWdobGlnaHQodCwgbyksIGhyKG8sIFppKCkpKTsKICAgIH0sCiAgICBoaWdobGlnaHQ6IEVsLAogICAgaGlnaGxpZ2h0Rmlyc3Q6IGZ1bmN0aW9uIGhpZ2hsaWdodEZpcnN0KG4sIGUsIHQpIHsKICAgICAgWGwobiwgZSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIEVsKG4sIGUsIDAsIHQpOwogICAgICB9KTsKICAgIH0sCiAgICBoaWdobGlnaHRMYXN0OiBmdW5jdGlvbiBoaWdobGlnaHRMYXN0KG4sIGUsIHQpIHsKICAgICAgWWwobiwgZSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIEVsKG4sIGUsIDAsIHQpOwogICAgICB9KTsKICAgIH0sCiAgICBoaWdobGlnaHRBdDogZnVuY3Rpb24gaGlnaGxpZ2h0QXQobiwgZSwgdCwgbykgewogICAgICB2YXIgciwgaSwgdTsKICAgICAgaSA9IG8sIHUgPSBwcygociA9IG4pLmVsZW1lbnQsICIuIiArIGUuaXRlbUNsYXNzKSwgdnQuZnJvbSh1W2ldKS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gUmUuZXJyb3IobmV3IEVycm9yKCJObyBlbGVtZW50IGZvdW5kIHdpdGggaW5kZXggIiArIGkpKTsKICAgICAgfSwgci5nZXRTeXN0ZW0oKS5nZXRCeURvbSkuZm9sZChmdW5jdGlvbiAodCkgewogICAgICAgIHRocm93IHQ7CiAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgRWwobiwgZSwgMCwgdCk7CiAgICAgIH0pOwogICAgfSwKICAgIGhpZ2hsaWdodEJ5OiBmdW5jdGlvbiBoaWdobGlnaHRCeShuLCBlLCB0LCBvKSB7CiAgICAgIFYocWwobiwgZSksIG8pLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICBFbChuLCBlLCAwLCB0KTsKICAgICAgfSk7CiAgICB9LAogICAgaXNIaWdobGlnaHRlZDogR2wsCiAgICBnZXRIaWdobGlnaHRlZDogZnVuY3Rpb24gZ2V0SGlnaGxpZ2h0ZWQobiwgdCwgZSkgewogICAgICByZXR1cm4gRnUobi5lbGVtZW50LCAiLiIgKyB0LmhpZ2hsaWdodENsYXNzKS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIG4uZ2V0U3lzdGVtKCkuZ2V0QnlEb20odCkudG9PcHRpb25hbCgpOwogICAgICB9KTsKICAgIH0sCiAgICBnZXRGaXJzdDogWGwsCiAgICBnZXRMYXN0OiBZbCwKICAgIGdldFByZXZpb3VzOiBmdW5jdGlvbiBnZXRQcmV2aW91cyh0LCBuLCBlKSB7CiAgICAgIHJldHVybiBEbCh0LCBuLCAwLCAtMSk7CiAgICB9LAogICAgZ2V0TmV4dDogZnVuY3Rpb24gZ2V0TmV4dCh0LCBuLCBlKSB7CiAgICAgIHJldHVybiBEbCh0LCBuLCAwLCAxKTsKICAgIH0sCiAgICBnZXRDYW5kaWRhdGVzOiBxbAogIH0pLAogICAgICBnZCA9IHlhKHsKICAgIGZpZWxkczogW2ZvKCJoaWdobGlnaHRDbGFzcyIpLCBmbygiaXRlbUNsYXNzIiksIEt1KCJvbkhpZ2hsaWdodCIpLCBLdSgib25EZWhpZ2hsaWdodCIpXSwKICAgIG5hbWU6ICJoaWdobGlnaHRpbmciLAogICAgYXBpczogbWQKICB9KSwKICAgICAgcGQgPSBbOF0sCiAgICAgIGhkID0gWzldLAogICAgICB2ZCA9IFsxM10sCiAgICAgIGJkID0gWzI3XSwKICAgICAgeWQgPSBbMzJdLAogICAgICB4ZCA9IFszN10sCiAgICAgIHdkID0gWzM4XSwKICAgICAgU2QgPSBbMzldLAogICAgICBDZCA9IFs0MF0sCiAgICAgIGtkID0gQyhWbCk7CgogIGZ1bmN0aW9uIE9kKHQsIG4sIGUsIG8sIGEpIHsKICAgIGZ1bmN0aW9uIGMobiwgZSwgdCwgbywgcikgewogICAgICB2YXIgaSA9IHQobiwgZSwgbywgciksCiAgICAgICAgICB1ID0gZS5ldmVudDsKICAgICAgcmV0dXJuIFYoaSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdC5tYXRjaGVzKHUpOwogICAgICB9KS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdC5jbGFzc2lmaWNhdGlvbjsKICAgICAgfSkuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0KG4sIGUsIG8sIHIpOwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgciA9IHsKICAgICAgc2NoZW1hOiBmdW5jdGlvbiBzY2hlbWEoKSB7CiAgICAgICAgcmV0dXJuIHQuY29uY2F0KFtUbygiZm9jdXNNYW5hZ2VyIiwgTmwoKSksIEVvKCJmb2N1c0luc2lkZSIsICJvbkZvY3VzIiwgcm8oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB3dChbIm9uRm9jdXMiLCAib25FbnRlck9yU3BhY2UiLCAib25BcGkiXSwgdCkgPyBSZS52YWx1ZSh0KSA6IFJlLmVycm9yKCJJbnZhbGlkIHZhbHVlIGZvciBmb2N1c0luc2lkZSIpOwogICAgICAgIH0pKSwgWnUoImhhbmRsZXIiLCByKSwgWnUoInN0YXRlIiwgbiksIFp1KCJzZW5kRm9jdXNJbiIsIGEpXSk7CiAgICAgIH0sCiAgICAgIHByb2Nlc3NLZXk6IGMsCiAgICAgIHRvRXZlbnRzOiBmdW5jdGlvbiB0b0V2ZW50cyhpLCB1KSB7CiAgICAgICAgdmFyIHQgPSBpLmZvY3VzSW5zaWRlICE9PSAkbC5PbkZvY3VzTW9kZSA/IHZ0Lm5vbmUoKSA6IGEoaSkubWFwKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gQ3IoRGkoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgZSh0LCBpLCB1KSwgbi5zdG9wKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KSwKICAgICAgICAgICAgbiA9IFtDcih5aSgpLCBmdW5jdGlvbiAobywgcikgewogICAgICAgICAgYyhvLCByLCBlLCBpLCB1KS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG4gPSBvLAogICAgICAgICAgICAgICAgZSA9IHIsCiAgICAgICAgICAgICAgICB0ID0gSWwoeWQuY29uY2F0KHZkKSkoZS5ldmVudCk7CiAgICAgICAgICAgIGkuZm9jdXNJbnNpZGUgPT09ICRsLk9uRW50ZXJPclNwYWNlTW9kZSAmJiB0ICYmIG1yKG4sIGUpICYmIGEoaSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHQobiwgaSwgdSksIGUuc3RvcCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHIuc3RvcCgpOwogICAgICAgICAgfSk7CiAgICAgICAgfSksIENyKHhpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICBjKHQsIG4sIG8sIGksIHUpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgbi5zdG9wKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KV07CiAgICAgICAgcmV0dXJuIG51KHQudG9BcnJheSgpLmNvbmNhdChuKSk7CiAgICAgIH0KICAgIH07CiAgICByZXR1cm4gcjsKICB9CgogIGZ1bmN0aW9uIF9kKHQpIHsKICAgIGZ1bmN0aW9uIGEodCwgbikgewogICAgICByZXR1cm4gMCA8IHhuKHQudmlzaWJpbGl0eVNlbGVjdG9yLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gSXUobiwgdCk7CiAgICAgIH0pLmdldE9yKG4pKTsKICAgIH0KCiAgICBmdW5jdGlvbiBuKG4sIGUsIHQpIHsKICAgICAgdmFyIG8gPSBlLAogICAgICAgICAgciA9IEYocHMobi5lbGVtZW50LCBvLnNlbGVjdG9yKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gYShvLCB0KTsKICAgICAgfSk7CiAgICAgIHZ0LmZyb20ocltvLmZpcnN0VGFic3RvcF0pLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICBlLmZvY3VzTWFuYWdlci5zZXQobiwgdCk7CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIG8oZSwgdCwgciwgaSkgewogICAgICB2YXIgbiwKICAgICAgICAgIHUgPSBwcyhlLmVsZW1lbnQsIHIuc2VsZWN0b3IpOwogICAgICByZXR1cm4gKG4gPSByKS5mb2N1c01hbmFnZXIuZ2V0KGUpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gSXUodCwgbi5zZWxlY3Rvcik7CiAgICAgIH0pLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gUCh1LCBTKEx0LCB0KSkuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIG4gPSBlLCBvID0gciwgaSh1LCB0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gYShuID0gbywgZSA9IHQpICYmIG4udXNlVGFic3RvcEF0KGUpOwogICAgICAgICAgICB2YXIgbiwgZTsKICAgICAgICAgIH0pLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gby5jeWNsaWMgPyB2dC5zb21lKCEwKSA6IHZ0Lm5vbmUoKTsKICAgICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiBvLmZvY3VzTWFuYWdlci5zZXQobiwgdCksIHZ0LnNvbWUoITApOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgbiwgbzsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIGUgPSBbeG8oIm9uRXNjYXBlIiksIHhvKCJvbkVudGVyIiksIFRvKCJzZWxlY3RvciIsICdbZGF0YS1hbGxveS10YWJzdG9wPSJ0cnVlIl06bm90KDpkaXNhYmxlZCknKSwgVG8oImZpcnN0VGFic3RvcCIsIDApLCBUbygidXNlVGFic3RvcEF0IiwgXyksIHhvKCJ2aXNpYmlsaXR5U2VsZWN0b3IiKV0uY29uY2F0KFt0XSksCiAgICAgICAgciA9IHJ0KFtIbChSbChbVmwsIElsKGhkKV0pLCBmdW5jdGlvbiAodCwgbiwgZSkgewogICAgICByZXR1cm4gbyh0LCAwLCBlLCBlLmN5Y2xpYyA/IEJsIDogTWwpOwogICAgfSksIEhsKElsKGhkKSwgZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgcmV0dXJuIG8odCwgMCwgZSwgZS5jeWNsaWMgPyBBbCA6IEZsKTsKICAgIH0pLCBIbChJbChiZCksIGZ1bmN0aW9uIChuLCBlLCB0KSB7CiAgICAgIHJldHVybiB0Lm9uRXNjYXBlLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdChuLCBlKTsKICAgICAgfSk7CiAgICB9KSwgSGwoUmwoW2tkLCBJbCh2ZCldKSwgZnVuY3Rpb24gKG4sIGUsIHQpIHsKICAgICAgcmV0dXJuIHQub25FbnRlci5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHQobiwgZSk7CiAgICAgIH0pOwogICAgfSldKSwKICAgICAgICBpID0gcnQoW10pOwogICAgcmV0dXJuIE9kKGUsIHl1LmluaXQsIHIsIGksIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHZ0LnNvbWUobik7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIFRkKHQsIG4sIGUpIHsKICAgIHJldHVybiBDbChlKSAmJiBJbCh5ZCkobi5ldmVudCkgPyB2dC5ub25lKCkgOiAoeXIodCwgZSwgRmkoKSksIHZ0LnNvbWUoITApKTsKICB9CgogIGZ1bmN0aW9uIEVkKHQsIG4pIHsKICAgIHJldHVybiB2dC5zb21lKCEwKTsKICB9CgogIGZ1bmN0aW9uIERkKHQsIG4sIGUpIHsKICAgIHJldHVybiBlLmV4ZWN1dGUodCwgbiwgdC5lbGVtZW50KTsKICB9CgogIGZ1bmN0aW9uIEJkKCkgewogICAgdmFyIGUgPSBkYygpOwogICAgcmV0dXJuIHh1KHsKICAgICAgcmVhZFN0YXRlOiBmdW5jdGlvbiByZWFkU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIGUuZ2V0KCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBudW1Sb3dzOiBTdHJpbmcodC5udW1Sb3dzKSwKICAgICAgICAgICAgbnVtQ29sdW1uczogU3RyaW5nKHQubnVtQ29sdW1ucykKICAgICAgICAgIH07CiAgICAgICAgfSkuZ2V0T3IoewogICAgICAgICAgbnVtUm93czogIj8iLAogICAgICAgICAgbnVtQ29sdW1uczogIj8iCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHNldEdyaWRTaXplOiBmdW5jdGlvbiBzZXRHcmlkU2l6ZSh0LCBuKSB7CiAgICAgICAgZS5zZXQoewogICAgICAgICAgbnVtUm93czogdCwKICAgICAgICAgIG51bUNvbHVtbnM6IG4KICAgICAgICB9KTsKICAgICAgfSwKICAgICAgZ2V0TnVtUm93czogZnVuY3Rpb24gZ2V0TnVtUm93cygpIHsKICAgICAgICByZXR1cm4gZS5nZXQoKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0Lm51bVJvd3M7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGdldE51bUNvbHVtbnM6IGZ1bmN0aW9uIGdldE51bUNvbHVtbnMoKSB7CiAgICAgICAgcmV0dXJuIGUuZ2V0KCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC5udW1Db2x1bW5zOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIE1kKGkpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgICB2YXIgciA9IGkodC5lbGVtZW50KTsKICAgICAgcmV0dXJuIFFtKHIsIHQsIG4sIGUsIG8pOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIEFkKHQsIG4pIHsKICAgIHJldHVybiBNZChTYyh0LCBuKSk7CiAgfQoKICBmdW5jdGlvbiBGZCh0LCBuKSB7CiAgICByZXR1cm4gTWQoU2MobiwgdCkpOwogIH0KCiAgZnVuY3Rpb24gSWQocikgewogICAgcmV0dXJuIGZ1bmN0aW9uICh0LCBuLCBlLCBvKSB7CiAgICAgIHJldHVybiBRbShyLCB0LCBuLCBlLCBvKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBSZCh0KSB7CiAgICByZXR1cm4gISgobiA9IHQuZG9tKS5vZmZzZXRXaWR0aCA8PSAwICYmIG4ub2Zmc2V0SGVpZ2h0IDw9IDApOwogICAgdmFyIG47CiAgfQoKICBmdW5jdGlvbiBWZCh0LCBuLCBlKSB7CiAgICB2YXIgbywKICAgICAgICByID0gRihwcyh0LCBlKSwgUmQpOwogICAgcmV0dXJuIFAobyA9IHIsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBMdCh0LCBuKTsKICAgIH0pLm1hcChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gewogICAgICAgIGluZGV4OiB0LAogICAgICAgIGNhbmRpZGF0ZXM6IG8KICAgICAgfTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gUGQodCwgbikgewogICAgcmV0dXJuIFAodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIEx0KG4sIHQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBIZChlLCB0LCBvLCBuKSB7CiAgICByZXR1cm4gbihNYXRoLmZsb29yKHQgLyBvKSwgdCAlIG8pLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSB0LnJvdyAqIG8gKyB0LmNvbHVtbjsKICAgICAgcmV0dXJuIDAgPD0gbiAmJiBuIDwgZS5sZW5ndGggPyB2dC5zb21lKGVbbl0pIDogdnQubm9uZSgpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB6ZChyLCB0LCBpLCB1LCBhKSB7CiAgICByZXR1cm4gSGQociwgdCwgdSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgdmFyIGUgPSB0ID09PSBpIC0gMSA/IHIubGVuZ3RoIC0gdCAqIHUgOiB1LAogICAgICAgICAgbyA9IGVhKG4sIGEsIDAsIGUgLSAxKTsKICAgICAgcmV0dXJuIHZ0LnNvbWUoewogICAgICAgIHJvdzogdCwKICAgICAgICBjb2x1bW46IG8KICAgICAgfSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIE5kKGksIHQsIHUsIGEsIGMpIHsKICAgIHJldHVybiBIZChpLCB0LCBhLCBmdW5jdGlvbiAodCwgbikgewogICAgICB2YXIgZSA9IGVhKHQsIGMsIDAsIHUgLSAxKSwKICAgICAgICAgIG8gPSBlID09PSB1IC0gMSA/IGkubGVuZ3RoIC0gZSAqIGEgOiBhLAogICAgICAgICAgciA9IFVhKG4sIDAsIG8gLSAxKTsKICAgICAgcmV0dXJuIHZ0LnNvbWUoewogICAgICAgIHJvdzogZSwKICAgICAgICBjb2x1bW46IHIKICAgICAgfSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIExkKG4sIGUsIHQpIHsKICAgIEZ1KG4uZWxlbWVudCwgZS5zZWxlY3RvcikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICBlLmZvY3VzTWFuYWdlci5zZXQobiwgdCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIFdkKHIpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgICByZXR1cm4gVmQodCwgbiwgZS5zZWxlY3RvcikuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiByKHQuY2FuZGlkYXRlcywgdC5pbmRleCwgby5nZXROdW1Sb3dzKCkuZ2V0T3IoZS5pbml0U2l6ZS5udW1Sb3dzKSwgby5nZXROdW1Db2x1bW5zKCkuZ2V0T3IoZS5pbml0U2l6ZS5udW1Db2x1bW5zKSk7CiAgICAgIH0pOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIFVkKHQsIG4sIGUpIHsKICAgIHJldHVybiBlLmNhcHR1cmVUYWIgPyB2dC5zb21lKCEwKSA6IHZ0Lm5vbmUoKTsKICB9CgogIGZ1bmN0aW9uIGpkKHQsIG4sIGUsIGkpIHsKICAgIHZhciB1ID0gZnVuY3Rpb24gdSh0LCBuLCBlKSB7CiAgICAgIHZhciBvLAogICAgICAgICAgciA9IGVhKG4sIGksIDAsIGUubGVuZ3RoIC0gMSk7CiAgICAgIHJldHVybiByID09PSB0ID8gdnQubm9uZSgpIDogImJ1dHRvbiIgPT09IEZ0KG8gPSBlW3JdKSAmJiAiZGlzYWJsZWQiID09PSBybihvLCAiZGlzYWJsZWQiKSA/IHUodCwgciwgZSkgOiB2dC5mcm9tKGVbcl0pOwogICAgfTsKCiAgICByZXR1cm4gVmQodCwgZSwgbikuYmluZChmdW5jdGlvbiAodCkgewogICAgICB2YXIgbiA9IHQuaW5kZXgsCiAgICAgICAgICBlID0gdC5jYW5kaWRhdGVzOwogICAgICByZXR1cm4gdShuLCBuLCBlKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gR2QobiwgZSwgbykgewogICAgcmV0dXJuIChyID0gbykuZm9jdXNNYW5hZ2VyLmdldChuKS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBJdSh0LCByLnNlbGVjdG9yKTsKICAgIH0pLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIG8uZXhlY3V0ZShuLCBlLCB0KTsKICAgIH0pOwogICAgdmFyIHI7CiAgfQoKICBmdW5jdGlvbiBYZChuLCBlLCB0KSB7CiAgICBlLmdldEluaXRpYWwobikub3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBGdShuLmVsZW1lbnQsIGUuc2VsZWN0b3IpOwogICAgfSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICBlLmZvY3VzTWFuYWdlci5zZXQobiwgdCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIFlkKHQsIG4sIGUpIHsKICAgIHJldHVybiBqZCh0LCBlLnNlbGVjdG9yLCBuLCAtMSk7CiAgfQoKICBmdW5jdGlvbiBxZCh0LCBuLCBlKSB7CiAgICByZXR1cm4gamQodCwgZS5zZWxlY3RvciwgbiwgMSk7CiAgfQoKICBmdW5jdGlvbiBLZChyKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHQsIG4sIGUsIG8pIHsKICAgICAgcmV0dXJuIHIodCwgbiwgZSwgbykuYmluZChmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGUuZXhlY3V0ZU9uTW92ZSA/IEdkKHQsIG4sIGUpIDogdnQuc29tZSghMCk7CiAgICAgIH0pOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIEpkKHQsIG4sIGUpIHsKICAgIHJldHVybiBlLm9uRXNjYXBlKHQsIG4pOwogIH0KCiAgZnVuY3Rpb24gJGQodCwgbiwgZSkgewogICAgcmV0dXJuIHZ0LmZyb20odFtuXSkuYmluZChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdnQuZnJvbSh0W2VdKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcm93SW5kZXg6IG4sCiAgICAgICAgICBjb2x1bW5JbmRleDogZSwKICAgICAgICAgIGNlbGw6IHQKICAgICAgICB9OwogICAgICB9KTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gUWQodCwgbiwgZSwgbykgewogICAgcmV0dXJuICRkKHQsIG4sIGVhKGUsIG8sIDAsIHRbbl0ubGVuZ3RoIC0gMSkpOwogIH0KCiAgZnVuY3Rpb24gWmQodCwgbiwgZSwgbykgewogICAgdmFyIHIgPSBlYShlLCBvLCAwLCB0Lmxlbmd0aCAtIDEpLAogICAgICAgIGkgPSB0W3JdLmxlbmd0aDsKICAgIHJldHVybiAkZCh0LCByLCBVYShuLCAwLCBpIC0gMSkpOwogIH0KCiAgZnVuY3Rpb24gdG0odCwgbiwgZSwgbykgewogICAgdmFyIHIgPSB0W25dLmxlbmd0aDsKICAgIHJldHVybiAkZCh0LCBuLCBVYShlICsgbywgMCwgciAtIDEpKTsKICB9CgogIGZ1bmN0aW9uIG5tKHQsIG4sIGUsIG8pIHsKICAgIHZhciByID0gVWEoZSArIG8sIDAsIHQubGVuZ3RoIC0gMSksCiAgICAgICAgaSA9IHRbcl0ubGVuZ3RoOwogICAgcmV0dXJuICRkKHQsIHIsIFVhKG4sIDAsIGkgLSAxKSk7CiAgfQoKICBmdW5jdGlvbiBlbShuLCBlLCB0KSB7CiAgICBlLnByZXZpb3VzU2VsZWN0b3Iobikub3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0ID0gZS5zZWxlY3RvcnM7CiAgICAgIHJldHVybiBGdShuLmVsZW1lbnQsIHQuY2VsbCk7CiAgICB9KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgIGUuZm9jdXNNYW5hZ2VyLnNldChuLCB0KTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gb20odCwgbykgewogICAgcmV0dXJuIGZ1bmN0aW9uIChuLCBlLCBpKSB7CiAgICAgIHZhciB1ID0gaS5jeWNsZXMgPyB0IDogbzsKICAgICAgcmV0dXJuIEl1KGUsIGkuc2VsZWN0b3JzLnJvdykuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBQZChwcyh0LCBpLnNlbGVjdG9ycy5jZWxsKSwgZSkuYmluZChmdW5jdGlvbiAobykgewogICAgICAgICAgdmFyIHIgPSBwcyhuLCBpLnNlbGVjdG9ycy5yb3cpOwogICAgICAgICAgcmV0dXJuIFBkKHIsIHQpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdmFyIG4sCiAgICAgICAgICAgICAgICBlID0gKG4gPSBpLCBNKHIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHBzKHQsIG4uc2VsZWN0b3JzLmNlbGwpOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHJldHVybiB1KGUsIHQsIG8pLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiB0LmNlbGw7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIHJtKG4sIGUsIG8pIHsKICAgIHJldHVybiBvLmZvY3VzTWFuYWdlci5nZXQobikuYmluZChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gby5leGVjdXRlKG4sIGUsIHQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBpbShuLCBlLCB0KSB7CiAgICBGdShuLmVsZW1lbnQsIGUuc2VsZWN0b3IpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgZS5mb2N1c01hbmFnZXIuc2V0KG4sIHQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB1bSh0LCBuLCBlKSB7CiAgICByZXR1cm4gamQodCwgZS5zZWxlY3RvciwgbiwgLTEpOwogIH0KCiAgZnVuY3Rpb24gYW0odCwgbiwgZSkgewogICAgcmV0dXJuIGpkKHQsIGUuc2VsZWN0b3IsIG4sIDEpOwogIH0KCiAgZnVuY3Rpb24gY20odCwgbiwgZSwgbykgewogICAgdmFyIHIgPSB0LmdldFN5c3RlbSgpLmJ1aWxkKG8pOwogICAgZGYodCwgciwgZSk7CiAgfQoKICBmdW5jdGlvbiBzbSh0LCBuLCBlLCBvKSB7CiAgICBWKEFnKHQpLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gTHQoby5lbGVtZW50LCB0LmVsZW1lbnQpOwogICAgfSkuZWFjaChWcyk7CiAgfQoKICBmdW5jdGlvbiBsbShuLCB0LCBlLCByLCBvKSB7CiAgICB2YXIgaSA9IEFnKG4pOwogICAgcmV0dXJuIHZ0LmZyb20oaVtyXSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBzbShuLCAwLCAwLCB0KSwgby5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgY20obiwgMCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIHZhciBlLAogICAgICAgICAgICAgIG8gPSBuOwogICAgICAgICAgSnQoZSA9IHQsIHIpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfZShlLCBvKTsKICAgICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIEVuKHQsIG8pOwogICAgICAgICAgfSk7CiAgICAgICAgfSwgdCk7CiAgICAgIH0pLCB0OwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBmbSh0LCBuKSB7CiAgICB2YXIgZSwgbzsKICAgIHJldHVybiB7CiAgICAgIGtleTogdCwKICAgICAgdmFsdWU6IHsKICAgICAgICBjb25maWc6IHt9LAogICAgICAgIG1lOiAoZSA9IHQsIG8gPSBudShuKSwgeWEoewogICAgICAgICAgZmllbGRzOiBbZm8oImVuYWJsZWQiKV0sCiAgICAgICAgICBuYW1lOiBlLAogICAgICAgICAgYWN0aXZlOiB7CiAgICAgICAgICAgIGV2ZW50czogcnQobykKICAgICAgICAgIH0KICAgICAgICB9KSksCiAgICAgICAgY29uZmlnQXNSYXc6IHJ0KHt9KSwKICAgICAgICBpbml0aWFsQ29uZmlnOiB7fSwKICAgICAgICBzdGF0ZTogeXUKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIGRtKHQsIG4pIHsKICAgIG4uaWdub3JlIHx8IChTYSh0LmVsZW1lbnQpLCBuLm9uRm9jdXModCkpOwogIH0KCiAgZnVuY3Rpb24gbW0odCwgbiwgZSkgewogICAgdmFyIG8gPSBuLmFyaWE7CiAgICBvLnVwZGF0ZSh0LCBvLCBlLmdldCgpKTsKICB9CgogIGZ1bmN0aW9uIGdtKG4sIHQsIGUpIHsKICAgIHQudG9nZ2xlQ2xhc3MuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAoZS5nZXQoKSA/IFhyIDogWXIpKG4uZWxlbWVudCwgdCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHBtKHQsIG4sIGUpIHsKICAgIEdtKHQsIG4sIGUsICFlLmdldCgpKTsKICB9CgogIGZ1bmN0aW9uIGhtKHQsIG4sIGUpIHsKICAgIGUuc2V0KCEwKSwgZ20odCwgbiwgZSksIG1tKHQsIG4sIGUpOwogIH0KCiAgZnVuY3Rpb24gdm0odCwgbiwgZSkgewogICAgZS5zZXQoITEpLCBnbSh0LCBuLCBlKSwgbW0odCwgbiwgZSk7CiAgfQoKICBmdW5jdGlvbiBibSh0LCBuLCBlKSB7CiAgICBHbSh0LCBuLCBlLCBuLnNlbGVjdGVkKTsKICB9CgogIGZ1bmN0aW9uIHltKCkgewogICAgZnVuY3Rpb24gdCh0LCBuKSB7CiAgICAgIG4uc3RvcCgpLCBicih0KTsKICAgIH0KCiAgICByZXR1cm4gW0NyKENpKCksIHQpLCBDcihSaSgpLCB0KSwgRXIoY2koKSksIEVyKGRpKCkpXTsKICB9CgogIGZ1bmN0aW9uIHhtKHQpIHsKICAgIHJldHVybiBudShmdChbdC5tYXAoZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIGl1KGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgZSh0KSwgbi5zdG9wKCk7CiAgICAgIH0pOwogICAgfSkudG9BcnJheSgpLCB5bSgpXSkpOwogIH0KCiAgZnVuY3Rpb24gd20odCkgewogICAgKE9hKHQuZWxlbWVudCkuaXNOb25lKCkgfHwgVmcuaXNGb2N1c2VkKHQpKSAmJiAoVmcuaXNGb2N1c2VkKHQpIHx8IFZnLmZvY3VzKHQpLCB2cih0LCBOZywgewogICAgICBpdGVtOiB0CiAgICB9KSk7CiAgfQoKICBmdW5jdGlvbiBTbSh0KSB7CiAgICB2cih0LCBMZywgewogICAgICBpdGVtOiB0CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIENtKHQsIG4pIHsKICAgIHJldHVybiB0LnggKyB0LndpZHRoIC8gMiAtIG4ud2lkdGggLyAyOwogIH0KCiAgZnVuY3Rpb24ga20odCwgbikgewogICAgcmV0dXJuIHQueCArIHQud2lkdGggLSBuLndpZHRoOwogIH0KCiAgZnVuY3Rpb24gT20odCwgbikgewogICAgcmV0dXJuIHQueSArIHQuaGVpZ2h0IC0gbi5oZWlnaHQ7CiAgfQoKICBmdW5jdGlvbiBfbSh0LCBuKSB7CiAgICByZXR1cm4gdC55ICsgdC5oZWlnaHQgLyAyIC0gbi5oZWlnaHQgLyAyOwogIH0KCiAgZnVuY3Rpb24gVG0odCwgbiwgZSkgewogICAgcmV0dXJuIG5hKGttKHQsIG4pLCBPbSh0LCBuKSwgZS5pbnNldFNvdXRod2VzdCgpLCBIYSgpLCAic291dGh3ZXN0Iiwgb2EodCwgewogICAgICByaWdodDogMCwKICAgICAgYm90dG9tOiAzCiAgICB9KSwgaXApOwogIH0KCiAgZnVuY3Rpb24gRW0odCwgbiwgZSkgewogICAgcmV0dXJuIG5hKHQueCwgT20odCwgbiksIGUuaW5zZXRTb3V0aGVhc3QoKSwgUGEoKSwgInNvdXRoZWFzdCIsIG9hKHQsIHsKICAgICAgbGVmdDogMSwKICAgICAgYm90dG9tOiAzCiAgICB9KSwgaXApOwogIH0KCiAgZnVuY3Rpb24gRG0odCwgbiwgZSkgewogICAgcmV0dXJuIG5hKGttKHQsIG4pLCB0LnksIGUuaW5zZXROb3J0aHdlc3QoKSwgVmEoKSwgIm5vcnRod2VzdCIsIG9hKHQsIHsKICAgICAgcmlnaHQ6IDAsCiAgICAgIHRvcDogMgogICAgfSksIGlwKTsKICB9CgogIGZ1bmN0aW9uIEJtKHQsIG4sIGUpIHsKICAgIHJldHVybiBuYSh0LngsIHQueSwgZS5pbnNldE5vcnRoZWFzdCgpLCBSYSgpLCAibm9ydGhlYXN0Iiwgb2EodCwgewogICAgICBsZWZ0OiAxLAogICAgICB0b3A6IDIKICAgIH0pLCBpcCk7CiAgfQoKICBmdW5jdGlvbiBNbSh0LCBuLCBlKSB7CiAgICByZXR1cm4gbmEoa20odCwgbiksIF9tKHQsIG4pLCBlLmluc2V0RWFzdCgpLCBXYSgpLCAiZWFzdCIsIG9hKHQsIHsKICAgICAgcmlnaHQ6IDAKICAgIH0pLCBpcCk7CiAgfQoKICBmdW5jdGlvbiBBbSh0LCBuLCBlKSB7CiAgICByZXR1cm4gbmEodC54LCBfbSh0LCBuKSwgZS5pbnNldFdlc3QoKSwgTGEoKSwgIndlc3QiLCBvYSh0LCB7CiAgICAgIGxlZnQ6IDEKICAgIH0pLCBpcCk7CiAgfQoKICBmdW5jdGlvbiBGbSh0KSB7CiAgICBzd2l0Y2ggKHQpIHsKICAgICAgY2FzZSAibm9ydGgiOgogICAgICAgIHJldHVybiB1cDsKCiAgICAgIGNhc2UgIm5vcnRoZWFzdCI6CiAgICAgICAgcmV0dXJuIEJtOwoKICAgICAgY2FzZSAibm9ydGh3ZXN0IjoKICAgICAgICByZXR1cm4gRG07CgogICAgICBjYXNlICJzb3V0aCI6CiAgICAgICAgcmV0dXJuIGFwOwoKICAgICAgY2FzZSAic291dGhlYXN0IjoKICAgICAgICByZXR1cm4gRW07CgogICAgICBjYXNlICJzb3V0aHdlc3QiOgogICAgICAgIHJldHVybiBUbTsKCiAgICAgIGNhc2UgImVhc3QiOgogICAgICAgIHJldHVybiBNbTsKCiAgICAgIGNhc2UgIndlc3QiOgogICAgICAgIHJldHVybiBBbTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIEltKHQsIG4sIGUsIG8sIHIpIHsKICAgIHJldHVybiBjYyhvKS5tYXAoRm0pLmdldE9yKHVwKSh0LCBuLCBlLCBvLCByKTsKICB9CgogIGZ1bmN0aW9uIFJtKHQpIHsKICAgIHN3aXRjaCAodCkgewogICAgICBjYXNlICJub3J0aCI6CiAgICAgICAgcmV0dXJuIGFwOwoKICAgICAgY2FzZSAibm9ydGhlYXN0IjoKICAgICAgICByZXR1cm4gRW07CgogICAgICBjYXNlICJub3J0aHdlc3QiOgogICAgICAgIHJldHVybiBUbTsKCiAgICAgIGNhc2UgInNvdXRoIjoKICAgICAgICByZXR1cm4gdXA7CgogICAgICBjYXNlICJzb3V0aGVhc3QiOgogICAgICAgIHJldHVybiBCbTsKCiAgICAgIGNhc2UgInNvdXRod2VzdCI6CiAgICAgICAgcmV0dXJuIERtOwoKICAgICAgY2FzZSAiZWFzdCI6CiAgICAgICAgcmV0dXJuIEFtOwoKICAgICAgY2FzZSAid2VzdCI6CiAgICAgICAgcmV0dXJuIE1tOwogICAgfQogIH0KCiAgZnVuY3Rpb24gVm0odCwgbiwgZSwgbywgcikgewogICAgcmV0dXJuIGNjKG8pLm1hcChSbSkuZ2V0T3IodXApKHQsIG4sIGUsIG8sIHIpOwogIH0KCiAgZnVuY3Rpb24gUG0odCkgewogICAgdmFyIG4gPSB2b2lkIDAgIT09IHQudWlkICYmIG50KHQsICJ1aWQiKSA/IHQudWlkIDogZ3UoIm1lbWVudG8iKTsKICAgIHJldHVybiB7CiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KHQpIHsKICAgICAgICByZXR1cm4gdC5nZXRTeXN0ZW0oKS5nZXRCeVVpZChuKS5nZXRPckRpZSgpOwogICAgICB9LAogICAgICBnZXRPcHQ6IGZ1bmN0aW9uIGdldE9wdCh0KSB7CiAgICAgICAgcmV0dXJuIHQuZ2V0U3lzdGVtKCkuZ2V0QnlVaWQobikudG9PcHRpb25hbCgpOwogICAgICB9LAogICAgICBhc1NwZWM6IGZ1bmN0aW9uIGFzU3BlYygpIHsKICAgICAgICByZXR1cm4gX2x0KF9sdCh7fSwgdCksIHsKICAgICAgICAgIHVpZDogbgogICAgICAgIH0pOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gSG0odCkgewogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHR0KHQsIGRwKS5nZXRPcigiIW5vdCBmb3VuZCEiKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiB6bSh0LCBuKSB7CiAgICB2YXIgZSwKICAgICAgICBvID0gdC50b0xvd2VyQ2FzZSgpOwoKICAgIGlmIChscC5pc1J0bCgpKSB7CiAgICAgIHZhciByID0gQnQoZSA9IG8sICItcnRsIikgPyBlIDogZSArICItcnRsIjsKICAgICAgcmV0dXJuIFR0KG4sIHIpID8gciA6IG87CiAgICB9CgogICAgcmV0dXJuIG87CiAgfQoKICBmdW5jdGlvbiBObSh0LCBuKSB7CiAgICByZXR1cm4gdHQobiwgem0odCwgbikpOwogIH0KCiAgZnVuY3Rpb24gTG0odCwgbikgewogICAgdmFyIGUgPSBuKCk7CiAgICByZXR1cm4gTm0odCwgZSkuZ2V0T3JUaHVuayhIbShlKSk7CiAgfQoKICBmdW5jdGlvbiBXbSgpIHsKICAgIHJldHVybiBmbSgiYWRkLWZvY3VzYWJsZSIsIFtldShmdW5jdGlvbiAodCkgewogICAgICB2YXIgbiwgZSwgbzsKICAgICAgbiA9IHQuZWxlbWVudCwgZSA9ICJzdmciLCBvID0gZnVuY3Rpb24gbyh0KSB7CiAgICAgICAgcmV0dXJuIHp0KHQsIGUpOwogICAgICB9LCBWKG4uZG9tLmNoaWxkTm9kZXMsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIG8oQXQuZnJvbURvbSh0KSk7CiAgICAgIH0pLm1hcChBdC5mcm9tRG9tKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIG9uKHQsICJmb2N1c2FibGUiLCAiZmFsc2UiKTsKICAgICAgfSk7CiAgICB9KV0pOwogIH0KCiAgZnVuY3Rpb24gVW0odCwgbiwgZSwgbykgewogICAgdmFyIHIsCiAgICAgICAgaSwKICAgICAgICB1LAogICAgICAgIGEgPSAodSA9IG4sIGxwLmlzUnRsKCkgJiYgVHQoZnAsIHUpID8gWyJ0b3gtaWNvbi0tZmxpcCJdIDogW10pLAogICAgICAgIGMgPSB0dChlLCB6bShuLCBlKSkub3IobykuZ2V0T3JUaHVuayhIbShlKSk7CiAgICByZXR1cm4gewogICAgICBkb206IHsKICAgICAgICB0YWc6IHQudGFnLAogICAgICAgIGF0dHJpYnV0ZXM6IG51bGwgIT09IChyID0gdC5hdHRyaWJ1dGVzKSAmJiB2b2lkIDAgIT09IHIgPyByIDoge30sCiAgICAgICAgY2xhc3NlczogdC5jbGFzc2VzLmNvbmNhdChhKSwKICAgICAgICBpbm5lckh0bWw6IGMKICAgICAgfSwKICAgICAgYmVoYXZpb3VyczogdGMoSChIKFtdLCBudWxsICE9PSAoaSA9IHQuYmVoYXZpb3VycykgJiYgdm9pZCAwICE9PSBpID8gaSA6IFtdLCAhMCksIFtXbSgpXSwgITEpKQogICAgfTsKICB9CgogIGZ1bmN0aW9uIGptKHQsIG4sIGUsIG8pIHsKICAgIHJldHVybiB2b2lkIDAgPT09IG8gJiYgKG8gPSB2dC5ub25lKCkpLCBVbShuLCB0LCBlKCksIG8pOwogIH0KCiAgKFFsID0gJGwgPSAkbCB8fCB7fSkuT25Gb2N1c01vZGUgPSAib25Gb2N1cyIsIFFsLk9uRW50ZXJPclNwYWNlTW9kZSA9ICJvbkVudGVyT3JTcGFjZSIsIFFsLk9uQXBpTW9kZSA9ICJvbkFwaSI7CgogIGZ1bmN0aW9uIEdtKHQsIG4sIGUsIG8pIHsKICAgIChvID8gaG0gOiB2bSkodCwgbiwgZSk7CiAgfQoKICBmdW5jdGlvbiBYbSh0LCBuLCBlKSB7CiAgICBvbih0LmVsZW1lbnQsICJhcmlhLWV4cGFuZGVkIiwgZSk7CiAgfQoKICBmdW5jdGlvbiBZbSh0KSB7CiAgICByZXR1cm4gInByZXBhcmVkIiA9PT0gdC50eXBlID8gdnQuc29tZSh0Lm1lbnUpIDogdnQubm9uZSgpOwogIH0KCiAgdmFyIHFtID0gX2QoYXIoImN5Y2xpYyIsIE8pKSwKICAgICAgS20gPSBfZChhcigiY3ljbGljIiwgXykpLAogICAgICBKbSA9IE9kKFtUbygiZXhlY3V0ZSIsIFRkKSwgVG8oInVzZVNwYWNlIiwgITEpLCBUbygidXNlRW50ZXIiLCAhMCksIFRvKCJ1c2VDb250cm9sRW50ZXIiLCAhMSksIFRvKCJ1c2VEb3duIiwgITEpXSwgeXUuaW5pdCwgZnVuY3Rpb24gKHQsIG4sIGUsIG8pIHsKICAgIHZhciByID0gZS51c2VTcGFjZSAmJiAhQ2wodC5lbGVtZW50KSA/IHlkIDogW10sCiAgICAgICAgaSA9IGUudXNlRW50ZXIgPyB2ZCA6IFtdLAogICAgICAgIHUgPSBlLnVzZURvd24gPyBDZCA6IFtdOwogICAgcmV0dXJuIFtIbChJbChyLmNvbmNhdChpKS5jb25jYXQodSkpLCBEZCldLmNvbmNhdChlLnVzZUNvbnRyb2xFbnRlciA/IFtIbChSbChbUGwsIElsKHZkKV0pLCBEZCldIDogW10pOwogIH0sIGZ1bmN0aW9uICh0LCBuLCBlLCBvKSB7CiAgICByZXR1cm4gZS51c2VTcGFjZSAmJiAhQ2wodC5lbGVtZW50KSA/IFtIbChJbCh5ZCksIEVkKV0gOiBbXTsKICB9LCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdnQubm9uZSgpOwogIH0pLAogICAgICAkbSA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgZmxhdGdyaWQ6IEJkLAogICAgaW5pdDogZnVuY3Rpb24gaW5pdCh0KSB7CiAgICAgIHJldHVybiB0LnN0YXRlKHQpOwogICAgfQogIH0pLAogICAgICBRbSA9IGZ1bmN0aW9uIFFtKG4sIGUsIHQsIG8sIHIpIHsKICAgIHJldHVybiBvLmZvY3VzTWFuYWdlci5nZXQoZSkuYmluZChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gbihlLmVsZW1lbnQsIHQsIG8sIHIpOwogICAgfSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBvLmZvY3VzTWFuYWdlci5zZXQoZSwgdCksICEwOwogICAgfSk7CiAgfSwKICAgICAgWm0gPSBJZCwKICAgICAgdGcgPSBJZCwKICAgICAgbmcgPSBJZCwKICAgICAgZWcgPSBXZChmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgcmV0dXJuIHpkKHQsIG4sIGUsIG8sIC0xKTsKICB9KSwKICAgICAgb2cgPSBXZChmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgcmV0dXJuIHpkKHQsIG4sIGUsIG8sIDEpOwogIH0pLAogICAgICByZyA9IFdkKGZ1bmN0aW9uICh0LCBuLCBlLCBvKSB7CiAgICByZXR1cm4gTmQodCwgbiwgZSwgbywgLTEpOwogIH0pLAogICAgICBpZyA9IFdkKGZ1bmN0aW9uICh0LCBuLCBlLCBvKSB7CiAgICByZXR1cm4gTmQodCwgbiwgZSwgbywgMSk7CiAgfSksCiAgICAgIHVnID0gT2QoW2ZvKCJzZWxlY3RvciIpLCBUbygiZXhlY3V0ZSIsIFRkKSwgSnUoIm9uRXNjYXBlIiksIFRvKCJjYXB0dXJlVGFiIiwgITEpLCBGYSgpXSwgQmQsIHJ0KFtIbChJbCh4ZCksIEFkKGVnLCBvZykpLCBIbChJbChTZCksIEZkKGVnLCBvZykpLCBIbChJbCh3ZCksIFptKHJnKSksIEhsKElsKENkKSwgdGcoaWcpKSwgSGwoUmwoW1ZsLCBJbChoZCldKSwgVWQpLCBIbChSbChba2QsIElsKGhkKV0pLCBVZCksIEhsKElsKGJkKSwgZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgIHJldHVybiBlLm9uRXNjYXBlKHQsIG4pOwogIH0pLCBIbChJbCh5ZC5jb25jYXQodmQpKSwgZnVuY3Rpb24gKG4sIGUsIG8sIHQpIHsKICAgIHJldHVybiAociA9IG8pLmZvY3VzTWFuYWdlci5nZXQobikuYmluZChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gSXUodCwgci5zZWxlY3Rvcik7CiAgICB9KS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBvLmV4ZWN1dGUobiwgZSwgdCk7CiAgICB9KTsKICAgIHZhciByOwogIH0pXSksIHJ0KFtIbChJbCh5ZCksIEVkKV0pLCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdnQuc29tZShMZCk7CiAgfSksCiAgICAgIGFnID0gW2ZvKCJzZWxlY3RvciIpLCBUbygiZ2V0SW5pdGlhbCIsIHZ0Lm5vbmUpLCBUbygiZXhlY3V0ZSIsIFRkKSwgSnUoIm9uRXNjYXBlIiksIFRvKCJleGVjdXRlT25Nb3ZlIiwgITEpLCBUbygiYWxsb3dWZXJ0aWNhbCIsICEwKV0sCiAgICAgIGNnID0gcnQoW0hsKElsKHlkKSwgRWQpXSksCiAgICAgIHNnID0gT2QoYWcsIHl1LmluaXQsIGZ1bmN0aW9uICh0LCBuLCBlLCBvKSB7CiAgICB2YXIgciA9IHhkLmNvbmNhdChlLmFsbG93VmVydGljYWwgPyB3ZCA6IFtdKSwKICAgICAgICBpID0gU2QuY29uY2F0KGUuYWxsb3dWZXJ0aWNhbCA/IENkIDogW10pOwogICAgcmV0dXJuIFtIbChJbChyKSwgS2QoQWQoWWQsIHFkKSkpLCBIbChJbChpKSwgS2QoRmQoWWQsIHFkKSkpLCBIbChJbCh2ZCksIEdkKSwgSGwoSWwoeWQpLCBHZCksIEhsKElsKGJkKSwgSmQpXTsKICB9LCBjZywgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHZ0LnNvbWUoWGQpOwogIH0pLAogICAgICBsZyA9IFt2bygic2VsZWN0b3JzIiwgW2ZvKCJyb3ciKSwgZm8oImNlbGwiKV0pLCBUbygiY3ljbGVzIiwgITApLCBUbygicHJldmlvdXNTZWxlY3RvciIsIHZ0Lm5vbmUpLCBUbygiZXhlY3V0ZSIsIFRkKV0sCiAgICAgIGZnID0gb20oZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgIHJldHVybiBRZCh0LCBuLCBlLCAtMSk7CiAgfSwgZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgIHJldHVybiB0bSh0LCBuLCBlLCAtMSk7CiAgfSksCiAgICAgIGRnID0gb20oZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgIHJldHVybiBRZCh0LCBuLCBlLCAxKTsKICB9LCBmdW5jdGlvbiAodCwgbiwgZSkgewogICAgcmV0dXJuIHRtKHQsIG4sIGUsIDEpOwogIH0pLAogICAgICBtZyA9IG9tKGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICByZXR1cm4gWmQodCwgZSwgbiwgLTEpOwogIH0sIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICByZXR1cm4gbm0odCwgZSwgbiwgLTEpOwogIH0pLAogICAgICBnZyA9IG9tKGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICByZXR1cm4gWmQodCwgZSwgbiwgMSk7CiAgfSwgZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgIHJldHVybiBubSh0LCBlLCBuLCAxKTsKICB9KSwKICAgICAgcGcgPSBydChbSGwoSWwoeGQpLCBBZChmZywgZGcpKSwgSGwoSWwoU2QpLCBGZChmZywgZGcpKSwgSGwoSWwod2QpLCBabShtZykpLCBIbChJbChDZCksIHRnKGdnKSksIEhsKElsKHlkLmNvbmNhdCh2ZCkpLCBmdW5jdGlvbiAobiwgZSwgbykgewogICAgcmV0dXJuIE9hKG4uZWxlbWVudCkuYmluZChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gby5leGVjdXRlKG4sIGUsIHQpOwogICAgfSk7CiAgfSldKSwKICAgICAgaGcgPSBydChbSGwoSWwoeWQpLCBFZCldKSwKICAgICAgdmcgPSBPZChsZywgeXUuaW5pdCwgcGcsIGhnLCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdnQuc29tZShlbSk7CiAgfSksCiAgICAgIGJnID0gW2ZvKCJzZWxlY3RvciIpLCBUbygiZXhlY3V0ZSIsIFRkKSwgVG8oIm1vdmVPblRhYiIsICExKV0sCiAgICAgIHlnID0gcnQoW0hsKElsKHdkKSwgbmcodW0pKSwgSGwoSWwoQ2QpLCBuZyhhbSkpLCBIbChSbChbVmwsIElsKGhkKV0pLCBmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgcmV0dXJuIGUubW92ZU9uVGFiID8gbmcodW0pKHQsIG4sIGUsIG8pIDogdnQubm9uZSgpOwogIH0pLCBIbChSbChba2QsIElsKGhkKV0pLCBmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgcmV0dXJuIGUubW92ZU9uVGFiID8gbmcoYW0pKHQsIG4sIGUsIG8pIDogdnQubm9uZSgpOwogIH0pLCBIbChJbCh2ZCksIHJtKSwgSGwoSWwoeWQpLCBybSldKSwKICAgICAgeGcgPSBydChbSGwoSWwoeWQpLCBFZCldKSwKICAgICAgd2cgPSBPZChiZywgeXUuaW5pdCwgeWcsIHhnLCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdnQuc29tZShpbSk7CiAgfSksCiAgICAgIFNnID0gT2QoW0p1KCJvblNwYWNlIiksIEp1KCJvbkVudGVyIiksIEp1KCJvblNoaWZ0RW50ZXIiKSwgSnUoIm9uTGVmdCIpLCBKdSgib25SaWdodCIpLCBKdSgib25UYWIiKSwgSnUoIm9uU2hpZnRUYWIiKSwgSnUoIm9uVXAiKSwgSnUoIm9uRG93biIpLCBKdSgib25Fc2NhcGUiKSwgVG8oInN0b3BTcGFjZUtleXVwIiwgITEpLCB4bygiZm9jdXNJbiIpXSwgeXUuaW5pdCwgZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgIHJldHVybiBbSGwoSWwoeWQpLCBlLm9uU3BhY2UpLCBIbChSbChba2QsIElsKHZkKV0pLCBlLm9uRW50ZXIpLCBIbChSbChbVmwsIElsKHZkKV0pLCBlLm9uU2hpZnRFbnRlciksIEhsKFJsKFtWbCwgSWwoaGQpXSksIGUub25TaGlmdFRhYiksIEhsKFJsKFtrZCwgSWwoaGQpXSksIGUub25UYWIpLCBIbChJbCh3ZCksIGUub25VcCksIEhsKElsKENkKSwgZS5vbkRvd24pLCBIbChJbCh4ZCksIGUub25MZWZ0KSwgSGwoSWwoU2QpLCBlLm9uUmlnaHQpLCBIbChJbCh5ZCksIGUub25TcGFjZSksIEhsKElsKGJkKSwgZS5vbkVzY2FwZSldOwogIH0sIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICByZXR1cm4gZS5zdG9wU3BhY2VLZXl1cCA/IFtIbChJbCh5ZCksIEVkKV0gOiBbXTsKICB9LCBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIHQuZm9jdXNJbjsKICB9KSwKICAgICAgQ2cgPSBxbS5zY2hlbWEoKSwKICAgICAga2cgPSBLbS5zY2hlbWEoKSwKICAgICAgT2cgPSBzZy5zY2hlbWEoKSwKICAgICAgX2cgPSB1Zy5zY2hlbWEoKSwKICAgICAgVGcgPSB2Zy5zY2hlbWEoKSwKICAgICAgRWcgPSBKbS5zY2hlbWEoKSwKICAgICAgRGcgPSB3Zy5zY2hlbWEoKSwKICAgICAgQmcgPSBTZy5zY2hlbWEoKSwKICAgICAgTWcgPSB4YSh7CiAgICBicmFuY2hLZXk6ICJtb2RlIiwKICAgIGJyYW5jaGVzOiBPYmplY3QuZnJlZXplKHsKICAgICAgX19wcm90b19fOiBudWxsLAogICAgICBhY3ljbGljOiBDZywKICAgICAgY3ljbGljOiBrZywKICAgICAgZmxvdzogT2csCiAgICAgIGZsYXRncmlkOiBfZywKICAgICAgbWF0cml4OiBUZywKICAgICAgZXhlY3V0aW9uOiBFZywKICAgICAgbWVudTogRGcsCiAgICAgIHNwZWNpYWw6IEJnCiAgICB9KSwKICAgIG5hbWU6ICJrZXlpbmciLAogICAgYWN0aXZlOiB7CiAgICAgIGV2ZW50czogZnVuY3Rpb24gZXZlbnRzKHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5oYW5kbGVyLnRvRXZlbnRzKHQsIG4pOwogICAgICB9CiAgICB9LAogICAgYXBpczogewogICAgICBmb2N1c0luOiBmdW5jdGlvbiBmb2N1c0luKG4sIGUsIG8pIHsKICAgICAgICBlLnNlbmRGb2N1c0luKGUpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgbi5nZXRTeXN0ZW0oKS50cmlnZ2VyRm9jdXMobi5lbGVtZW50LCBuLmVsZW1lbnQpOwogICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB0KG4sIGUsIG8pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBzZXRHcmlkU2l6ZTogZnVuY3Rpb24gc2V0R3JpZFNpemUodCwgbiwgZSwgbywgcikgewogICAgICAgIG50KGUsICJzZXRHcmlkU2l6ZSIpID8gZS5zZXRHcmlkU2l6ZShvLCByKSA6IGNvbnNvbGUuZXJyb3IoIkxheW91dCBkb2VzIG5vdCBzdXBwb3J0IHNldEdyaWRTaXplIik7CiAgICAgIH0KICAgIH0sCiAgICBzdGF0ZTogJG0KICB9KSwKICAgICAgQWcgPSBmdW5jdGlvbiBBZyh0LCBuKSB7CiAgICByZXR1cm4gdC5jb21wb25lbnRzKCk7CiAgfSwKICAgICAgRmcgPSB5YSh7CiAgICBmaWVsZHM6IFtdLAogICAgbmFtZTogInJlcGxhY2luZyIsCiAgICBhcGlzOiBPYmplY3QuZnJlZXplKHsKICAgICAgX19wcm90b19fOiBudWxsLAogICAgICBhcHBlbmQ6IGZ1bmN0aW9uIGFwcGVuZCh0LCBuLCBlLCBvKSB7CiAgICAgICAgY20odCwgMCwgX2UsIG8pOwogICAgICB9LAogICAgICBwcmVwZW5kOiBmdW5jdGlvbiBwcmVwZW5kKHQsIG4sIGUsIG8pIHsKICAgICAgICBjbSh0LCAwLCBCbiwgbyk7CiAgICAgIH0sCiAgICAgIHJlbW92ZTogc20sCiAgICAgIHJlcGxhY2VBdDogbG0sCiAgICAgIHJlcGxhY2VCeTogZnVuY3Rpb24gcmVwbGFjZUJ5KG4sIHQsIGUsIG8sIHIpIHsKICAgICAgICByZXR1cm4gUChBZyhuKSwgbykuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGxtKG4sIDAsIDAsIHQsIHIpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uIHNldChuLCB0LCBlLCBvKSB7CiAgICAgICAgX2EoZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHQgPSBNKG8sIG4uZ2V0U3lzdGVtKCkuYnVpbGQpOwogICAgICAgICAgRnMobiwgdCk7CiAgICAgICAgfSwgbi5lbGVtZW50KTsKICAgICAgfSwKICAgICAgY29udGVudHM6IEFnCiAgICB9KQogIH0pLAogICAgICBJZyA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgZm9jdXM6IGRtLAogICAgYmx1cjogZnVuY3Rpb24gYmx1cih0LCBuKSB7CiAgICAgIG4uaWdub3JlIHx8IHQuZWxlbWVudC5kb20uYmx1cigpOwogICAgfSwKICAgIGlzRm9jdXNlZDogZnVuY3Rpb24gaXNGb2N1c2VkKHQpIHsKICAgICAgcmV0dXJuIENhKHQuZWxlbWVudCk7CiAgICB9CiAgfSksCiAgICAgIFJnID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBleGhpYml0OiBmdW5jdGlvbiBleGhpYml0KHQsIG4pIHsKICAgICAgcmV0dXJuIE5yKG4uaWdub3JlID8ge30gOiB7CiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgdGFiaW5kZXg6ICItMSIKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGV2ZW50czogZnVuY3Rpb24gZXZlbnRzKGUpIHsKICAgICAgcmV0dXJuIG51KFtDcihEaSgpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIGRtKHQsIGUpLCBuLnN0b3AoKTsKICAgICAgfSldLmNvbmNhdChlLnN0b3BNb3VzZWRvd24gPyBbQ3IoZGkoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBuLmV2ZW50LnByZXZlbnQoKTsKICAgICAgfSldIDogW10pKTsKICAgIH0KICB9KSwKICAgICAgVmcgPSB5YSh7CiAgICBmaWVsZHM6IFtLdSgib25Gb2N1cyIpLCBUbygic3RvcE1vdXNlZG93biIsICExKSwgVG8oImlnbm9yZSIsICExKV0sCiAgICBuYW1lOiAiZm9jdXNpbmciLAogICAgYWN0aXZlOiBSZywKICAgIGFwaXM6IElnCiAgfSksCiAgICAgIFBnID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBvbkxvYWQ6IGJtLAogICAgdG9nZ2xlOiBwbSwKICAgIGlzT246IGZ1bmN0aW9uIGlzT24odCwgbiwgZSkgewogICAgICByZXR1cm4gZS5nZXQoKTsKICAgIH0sCiAgICBvbjogaG0sCiAgICBvZmY6IHZtLAogICAgc2V0OiBHbQogIH0pLAogICAgICBIZyA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgZXhoaWJpdDogZnVuY3Rpb24gZXhoaWJpdCgpIHsKICAgICAgcmV0dXJuIE5yKHt9KTsKICAgIH0sCiAgICBldmVudHM6IGZ1bmN0aW9uIGV2ZW50cyh0LCBuKSB7CiAgICAgIHZhciBlLAogICAgICAgICAgbywKICAgICAgICAgIHIsCiAgICAgICAgICBpID0gKGUgPSB0LCBvID0gbiwgciA9IHBtLCBpdShmdW5jdGlvbiAodCkgewogICAgICAgIHIodCwgZSwgbyk7CiAgICAgIH0pKSwKICAgICAgICAgIHUgPSB2YSh0LCBuLCBibSk7CiAgICAgIHJldHVybiBudShmdChbdC50b2dnbGVPbkV4ZWN1dGUgPyBbaV0gOiBbXSwgW3VdXSkpOwogICAgfQogIH0pLAogICAgICB6ZyA9IHlhKHsKICAgIGZpZWxkczogW1RvKCJzZWxlY3RlZCIsICExKSwgeG8oInRvZ2dsZUNsYXNzIiksIFRvKCJ0b2dnbGVPbkV4ZWN1dGUiLCAhMCksIEVvKCJhcmlhIiwgewogICAgICBtb2RlOiAibm9uZSIKICAgIH0sIHNvKCJtb2RlIiwgewogICAgICBwcmVzc2VkOiBbVG8oInN5bmNXaXRoRXhwYW5kZWQiLCAhMSksIFp1KCJ1cGRhdGUiLCBmdW5jdGlvbiAodCwgbiwgZSkgewogICAgICAgIG9uKHQuZWxlbWVudCwgImFyaWEtcHJlc3NlZCIsIGUpLCBuLnN5bmNXaXRoRXhwYW5kZWQgJiYgWG0odCwgMCwgZSk7CiAgICAgIH0pXSwKICAgICAgY2hlY2tlZDogW1p1KCJ1cGRhdGUiLCBmdW5jdGlvbiAodCwgbiwgZSkgewogICAgICAgIG9uKHQuZWxlbWVudCwgImFyaWEtY2hlY2tlZCIsIGUpOwogICAgICB9KV0sCiAgICAgIGV4cGFuZGVkOiBbWnUoInVwZGF0ZSIsIFhtKV0sCiAgICAgIHNlbGVjdGVkOiBbWnUoInVwZGF0ZSIsIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgICAgb24odC5lbGVtZW50LCAiYXJpYS1zZWxlY3RlZCIsIGUpOwogICAgICB9KV0sCiAgICAgIG5vbmU6IFtadSgidXBkYXRlIiwgc3QpXQogICAgfSkpXSwKICAgIG5hbWU6ICJ0b2dnbGluZyIsCiAgICBhY3RpdmU6IEhnLAogICAgYXBpczogUGcsCiAgICBzdGF0ZTogewogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHZhciBuID0gVm8oITEpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIG4uZ2V0KCk7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodCkgewogICAgICAgICAgICByZXR1cm4gbi5zZXQodCk7CiAgICAgICAgICB9LAogICAgICAgICAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKCkgewogICAgICAgICAgICByZXR1cm4gbi5zZXQoITEpOwogICAgICAgICAgfSwKICAgICAgICAgIHJlYWRTdGF0ZTogZnVuY3Rpb24gcmVhZFN0YXRlKCkgewogICAgICAgICAgICByZXR1cm4gbi5nZXQoKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CiAgICB9CiAgfSksCiAgICAgIE5nID0gImFsbG95Lml0ZW0taG92ZXIiLAogICAgICBMZyA9ICJhbGxveS5pdGVtLWZvY3VzIiwKICAgICAgV2cgPSBydChOZyksCiAgICAgIFVnID0gcnQoTGcpLAogICAgICBqZyA9IFtmbygiZGF0YSIpLCBmbygiY29tcG9uZW50cyIpLCBmbygiZG9tIiksIFRvKCJoYXNTdWJtZW51IiwgITEpLCB4bygidG9nZ2xpbmciKSwgRWYoIml0ZW1CZWhhdmlvdXJzIiwgW3pnLCBWZywgTWcsIFRmXSksIFRvKCJpZ25vcmVGb2N1cyIsICExKSwgVG8oImRvbU1vZGlmaWNhdGlvbiIsIHt9KSwgWnUoImJ1aWxkZXIiLCBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIHsKICAgICAgZG9tOiB0LmRvbSwKICAgICAgZG9tTW9kaWZpY2F0aW9uOiBfbHQoX2x0KHt9LCB0LmRvbU1vZGlmaWNhdGlvbiksIHsKICAgICAgICBhdHRyaWJ1dGVzOiBfbHQoX2x0KF9sdCh7CiAgICAgICAgICByb2xlOiB0LnRvZ2dsaW5nLmlzU29tZSgpID8gIm1lbnVpdGVtY2hlY2tib3giIDogIm1lbnVpdGVtIgogICAgICAgIH0sIHQuZG9tTW9kaWZpY2F0aW9uLmF0dHJpYnV0ZXMpLCB7CiAgICAgICAgICAiYXJpYS1oYXNwb3B1cCI6IHQuaGFzU3VibWVudQogICAgICAgIH0pLCB0Lmhhc1N1Ym1lbnUgPyB7CiAgICAgICAgICAiYXJpYS1leHBhbmRlZCI6ICExCiAgICAgICAgfSA6IHt9KQogICAgICB9KSwKICAgICAgYmVoYXZpb3VyczogRGYodC5pdGVtQmVoYXZpb3VycywgW3QudG9nZ2xpbmcuZm9sZCh6Zy5yZXZva2UsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHpnLmNvbmZpZyhfbHQoewogICAgICAgICAgYXJpYTogewogICAgICAgICAgICBtb2RlOiAiY2hlY2tlZCIKICAgICAgICAgIH0KICAgICAgICB9LCB0KSk7CiAgICAgIH0pLCBWZy5jb25maWcoewogICAgICAgIGlnbm9yZTogdC5pZ25vcmVGb2N1cywKICAgICAgICBzdG9wTW91c2Vkb3duOiB0Lmlnbm9yZUZvY3VzLAogICAgICAgIG9uRm9jdXM6IGZ1bmN0aW9uIG9uRm9jdXModCkgewogICAgICAgICAgU20odCk7CiAgICAgICAgfQogICAgICB9KSwgTWcuY29uZmlnKHsKICAgICAgICBtb2RlOiAiZXhlY3V0aW9uIgogICAgICB9KSwgVGYuY29uZmlnKHsKICAgICAgICBzdG9yZTogewogICAgICAgICAgbW9kZTogIm1lbW9yeSIsCiAgICAgICAgICBpbml0aWFsVmFsdWU6IHQuZGF0YQogICAgICAgIH0KICAgICAgfSksIGZtKCJpdGVtLXR5cGUtZXZlbnRzIiwgSChIKFtdLCB5bSgpLCAhMCksIFtDcihoaSgpLCB3bSksIENyKElpKCksIFZnLmZvY3VzKV0sICExKSldKSwKICAgICAgY29tcG9uZW50czogdC5jb21wb25lbnRzLAogICAgICBldmVudE9yZGVyOiB0LmV2ZW50T3JkZXIKICAgIH07CiAgfSksIFRvKCJldmVudE9yZGVyIiwge30pXSwKICAgICAgR2cgPSBbZm8oImRvbSIpLCBmbygiY29tcG9uZW50cyIpLCBadSgiYnVpbGRlciIsIGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gewogICAgICBkb206IHQuZG9tLAogICAgICBjb21wb25lbnRzOiB0LmNvbXBvbmVudHMsCiAgICAgIGV2ZW50czogbnUoW0NyKElpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgbi5zdG9wKCk7CiAgICAgIH0pXSkKICAgIH07CiAgfSldLAogICAgICBYZyA9IHJ0KCJpdGVtLXdpZGdldCIpLAogICAgICBZZyA9IHJ0KFtxZih7CiAgICBuYW1lOiAid2lkZ2V0IiwKICAgIG92ZXJyaWRlczogZnVuY3Rpb24gb3ZlcnJpZGVzKG4pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBiZWhhdmlvdXJzOiB0YyhbVGYuY29uZmlnKHsKICAgICAgICAgIHN0b3JlOiB7CiAgICAgICAgICAgIG1vZGU6ICJtYW51YWwiLAogICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUodCkgewogICAgICAgICAgICAgIHJldHVybiBuLmRhdGE7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldFZhbHVlOiBzdAogICAgICAgICAgfQogICAgICAgIH0pXSkKICAgICAgfTsKICAgIH0KICB9KV0pLAogICAgICBxZyA9IHNvKCJ0eXBlIiwgewogICAgd2lkZ2V0OiBbZm8oInVpZCIpLCBmbygiZGF0YSIpLCBmbygiY29tcG9uZW50cyIpLCBmbygiZG9tIiksIFRvKCJhdXRvZm9jdXMiLCAhMSksIFRvKCJpZ25vcmVGb2N1cyIsICExKSwgRWYoIndpZGdldEJlaGF2aW91cnMiLCBbVGYsIFZnLCBNZ10pLCBUbygiZG9tTW9kaWZpY2F0aW9uIiwge30pLCBibChZZygpKSwgWnUoImJ1aWxkZXIiLCBmdW5jdGlvbiAoZSkgewogICAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgICByZXR1cm4gZmwodCwgZSwgIndpZGdldCIpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIE1nLmZvY3VzSW4odCksIHQ7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHQodCwgbikgewogICAgICAgIHJldHVybiBDbChuLmV2ZW50LnRhcmdldCkgfHwgZS5hdXRvZm9jdXMgJiYgbi5zZXRTb3VyY2UodC5lbGVtZW50KSwgdnQubm9uZSgpOwogICAgICB9CgogICAgICB2YXIgbiA9IHNsKFhnKCksIGUsIFlnKCkpLAogICAgICAgICAgciA9IGxsKFhnKCksIGUsIG4uaW50ZXJuYWxzKCkpOwogICAgICByZXR1cm4gewogICAgICAgIGRvbTogZS5kb20sCiAgICAgICAgY29tcG9uZW50czogciwKICAgICAgICBkb21Nb2RpZmljYXRpb246IGUuZG9tTW9kaWZpY2F0aW9uLAogICAgICAgIGV2ZW50czogbnUoW2l1KGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICBvKHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgbi5zdG9wKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KSwgQ3IoaGkoKSwgd20pLCBDcihJaSgpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgZS5hdXRvZm9jdXMgPyBvKHQpIDogVmcuZm9jdXModCk7CiAgICAgICAgfSldKSwKICAgICAgICBiZWhhdmlvdXJzOiBEZihlLndpZGdldEJlaGF2aW91cnMsIFtUZi5jb25maWcoewogICAgICAgICAgc3RvcmU6IHsKICAgICAgICAgICAgbW9kZTogIm1lbW9yeSIsCiAgICAgICAgICAgIGluaXRpYWxWYWx1ZTogZS5kYXRhCiAgICAgICAgICB9CiAgICAgICAgfSksIFZnLmNvbmZpZyh7CiAgICAgICAgICBpZ25vcmU6IGUuaWdub3JlRm9jdXMsCiAgICAgICAgICBvbkZvY3VzOiBmdW5jdGlvbiBvbkZvY3VzKHQpIHsKICAgICAgICAgICAgU20odCk7CiAgICAgICAgICB9CiAgICAgICAgfSksIE1nLmNvbmZpZyh7CiAgICAgICAgICBtb2RlOiAic3BlY2lhbCIsCiAgICAgICAgICBmb2N1c0luOiBlLmF1dG9mb2N1cyA/IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIG8odCk7CiAgICAgICAgICB9IDogb2MoKSwKICAgICAgICAgIG9uTGVmdDogdCwKICAgICAgICAgIG9uUmlnaHQ6IHQsCiAgICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gb25Fc2NhcGUodCwgbikgewogICAgICAgICAgICByZXR1cm4gVmcuaXNGb2N1c2VkKHQpIHx8IGUuYXV0b2ZvY3VzID8gKGUuYXV0b2ZvY3VzICYmIG4uc2V0U291cmNlKHQuZWxlbWVudCksIHZ0Lm5vbmUoKSkgOiAoVmcuZm9jdXModCksIHZ0LnNvbWUoITApKTsKICAgICAgICAgIH0KICAgICAgICB9KV0pCiAgICAgIH07CiAgICB9KV0sCiAgICBpdGVtOiBqZywKICAgIHNlcGFyYXRvcjogR2cKICB9KSwKICAgICAgS2cgPSBydChbJGYoewogICAgZmFjdG9yeTogewogICAgICBza2V0Y2g6IGZ1bmN0aW9uIHNrZXRjaCh0KSB7CiAgICAgICAgdmFyIG4gPSBjbygibWVudS5zcGVjIGl0ZW0iLCBxZywgdCk7CiAgICAgICAgcmV0dXJuIG4uYnVpbGRlcihuKTsKICAgICAgfQogICAgfSwKICAgIG5hbWU6ICJpdGVtcyIsCiAgICB1bml0OiAiaXRlbSIsCiAgICBkZWZhdWx0czogZnVuY3Rpb24gZGVmYXVsdHModCwgbikgewogICAgICByZXR1cm4gVHQobiwgInVpZCIpID8gbiA6IF9sdChfbHQoe30sIG4pLCB7CiAgICAgICAgdWlkOiBndSgiaXRlbSIpCiAgICAgIH0pOwogICAgfSwKICAgIG92ZXJyaWRlczogZnVuY3Rpb24gb3ZlcnJpZGVzKHQsIG4pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiBuLnR5cGUsCiAgICAgICAgaWdub3JlRm9jdXM6IHQuZmFrZUZvY3VzLAogICAgICAgIGRvbU1vZGlmaWNhdGlvbjogewogICAgICAgICAgY2xhc3NlczogW3QubWFya2Vycy5pdGVtXQogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9KV0pLAogICAgICBKZyA9IHJ0KFtmbygidmFsdWUiKSwgZm8oIml0ZW1zIiksIGZvKCJkb20iKSwgZm8oImNvbXBvbmVudHMiKSwgVG8oImV2ZW50T3JkZXIiLCB7fSksICRzKCJtZW51QmVoYXZpb3VycyIsIFtnZCwgVGYsIHVkLCBNZ10pLCBFbygibW92ZW1lbnQiLCB7CiAgICBtb2RlOiAibWVudSIsCiAgICBtb3ZlT25UYWI6ICEwCiAgfSwgc28oIm1vZGUiLCB7CiAgICBncmlkOiBbRmEoKSwgWnUoImNvbmZpZyIsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbW9kZTogImZsYXRncmlkIiwKICAgICAgICBzZWxlY3RvcjogIi4iICsgdC5tYXJrZXJzLml0ZW0sCiAgICAgICAgaW5pdFNpemU6IHsKICAgICAgICAgIG51bUNvbHVtbnM6IG4uaW5pdFNpemUubnVtQ29sdW1ucywKICAgICAgICAgIG51bVJvd3M6IG4uaW5pdFNpemUubnVtUm93cwogICAgICAgIH0sCiAgICAgICAgZm9jdXNNYW5hZ2VyOiB0LmZvY3VzTWFuYWdlcgogICAgICB9OwogICAgfSldLAogICAgbWF0cml4OiBbWnUoImNvbmZpZyIsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbW9kZTogIm1hdHJpeCIsCiAgICAgICAgc2VsZWN0b3JzOiB7CiAgICAgICAgICByb3c6IG4ucm93U2VsZWN0b3IsCiAgICAgICAgICBjZWxsOiAiLiIgKyB0Lm1hcmtlcnMuaXRlbQogICAgICAgIH0sCiAgICAgICAgZm9jdXNNYW5hZ2VyOiB0LmZvY3VzTWFuYWdlcgogICAgICB9OwogICAgfSksIGZvKCJyb3dTZWxlY3RvciIpXSwKICAgIG1lbnU6IFtUbygibW92ZU9uVGFiIiwgITApLCBadSgiY29uZmlnIiwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBtb2RlOiAibWVudSIsCiAgICAgICAgc2VsZWN0b3I6ICIuIiArIHQubWFya2Vycy5pdGVtLAogICAgICAgIG1vdmVPblRhYjogbi5tb3ZlT25UYWIsCiAgICAgICAgZm9jdXNNYW5hZ2VyOiB0LmZvY3VzTWFuYWdlcgogICAgICB9OwogICAgfSldCiAgfSkpLCBtbygibWFya2VycyIsIEFhKCkpLCBUbygiZmFrZUZvY3VzIiwgITEpLCBUbygiZm9jdXNNYW5hZ2VyIiwgTmwoKSksIEt1KCJvbkhpZ2hsaWdodCIpXSksCiAgICAgICRnID0gcnQoImFsbG95Lm1lbnUtZm9jdXMiKSwKICAgICAgUWcgPSBTbCh7CiAgICBuYW1lOiAiTWVudSIsCiAgICBjb25maWdGaWVsZHM6IEpnKCksCiAgICBwYXJ0RmllbGRzOiBLZygpLAogICAgZmFjdG9yeTogZnVuY3Rpb24gZmFjdG9yeSh0LCBuLCBlLCBvKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdWlkOiB0LnVpZCwKICAgICAgICBkb206IHQuZG9tLAogICAgICAgIG1hcmtlcnM6IHQubWFya2VycywKICAgICAgICBiZWhhdmlvdXJzOiBacyh0Lm1lbnVCZWhhdmlvdXJzLCBbZ2QuY29uZmlnKHsKICAgICAgICAgIGhpZ2hsaWdodENsYXNzOiB0Lm1hcmtlcnMuc2VsZWN0ZWRJdGVtLAogICAgICAgICAgaXRlbUNsYXNzOiB0Lm1hcmtlcnMuaXRlbSwKICAgICAgICAgIG9uSGlnaGxpZ2h0OiB0Lm9uSGlnaGxpZ2h0CiAgICAgICAgfSksIFRmLmNvbmZpZyh7CiAgICAgICAgICBzdG9yZTogewogICAgICAgICAgICBtb2RlOiAibWVtb3J5IiwKICAgICAgICAgICAgaW5pdGlhbFZhbHVlOiB0LnZhbHVlCiAgICAgICAgICB9CiAgICAgICAgfSksIHVkLmNvbmZpZyh7CiAgICAgICAgICBmaW5kOiB2dC5zb21lCiAgICAgICAgfSksIE1nLmNvbmZpZyh0Lm1vdmVtZW50LmNvbmZpZyh0LCB0Lm1vdmVtZW50KSldKSwKICAgICAgICBldmVudHM6IG51KFtDcihVZygpLCBmdW5jdGlvbiAobiwgZSkgewogICAgICAgICAgdmFyIHQgPSBlLmV2ZW50OwogICAgICAgICAgbi5nZXRTeXN0ZW0oKS5nZXRCeURvbSh0LnRhcmdldCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICBnZC5oaWdobGlnaHQobiwgdCksIGUuc3RvcCgpLCB2cihuLCAkZygpLCB7CiAgICAgICAgICAgICAgbWVudTogbiwKICAgICAgICAgICAgICBpdGVtOiB0CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSksIENyKFdnKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICB2YXIgZSA9IG4uZXZlbnQuaXRlbTsKICAgICAgICAgIGdkLmhpZ2hsaWdodCh0LCBlKTsKICAgICAgICB9KV0pLAogICAgICAgIGNvbXBvbmVudHM6IG4sCiAgICAgICAgZXZlbnRPcmRlcjogdC5ldmVudE9yZGVyLAogICAgICAgIGRvbU1vZGlmaWNhdGlvbjogewogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICByb2xlOiAibWVudSIKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfSksCiAgICAgIFpnID0gZnVuY3Rpb24gWmcoZSwgbywgciwgdCkgewogICAgcmV0dXJuIHR0KHIsIHQpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHR0KGUsIHQpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbiA9IFpnKGUsIG8sIHIsIHQpOwogICAgICAgIHJldHVybiB2dC5zb21lKFt0XS5jb25jYXQobikpOwogICAgICB9KTsKICAgIH0pLmdldE9yKFtdKTsKICB9LAogICAgICB0cCA9IGZ1bmN0aW9uIHRwKCkgewogICAgZnVuY3Rpb24gYSh0KSB7CiAgICAgIHJldHVybiBuKHQpLmJpbmQoWW0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGUodCkgewogICAgICByZXR1cm4gdHQoYy5nZXQoKSwgdCk7CiAgICB9CgogICAgdmFyIGMgPSBWbyh7fSksCiAgICAgICAgaSA9IFZvKHt9KSwKICAgICAgICBzID0gVm8oe30pLAogICAgICAgIGwgPSBkYygpLAogICAgICAgIHUgPSBWbyh7fSksCiAgICAgICAgbiA9IGZ1bmN0aW9uIG4odCkgewogICAgICByZXR1cm4gdHQoaS5nZXQoKSwgdCk7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgIHNldE1lbnVCdWlsdDogZnVuY3Rpb24gc2V0TWVudUJ1aWx0KHQsIG4pIHsKICAgICAgICB2YXIgZTsKICAgICAgICBpLnNldChfbHQoX2x0KHt9LCBpLmdldCgpKSwgKChlID0ge30pW3RdID0gewogICAgICAgICAgdHlwZTogInByZXBhcmVkIiwKICAgICAgICAgIG1lbnU6IG4KICAgICAgICB9LCBlKSkpOwogICAgICB9LAogICAgICBzZXRDb250ZW50czogZnVuY3Rpb24gc2V0Q29udGVudHModCwgbiwgZSwgbykgewogICAgICAgIGwuc2V0KHQpLCBjLnNldChlKSwgaS5zZXQobiksIHUuc2V0KG8pOwoKICAgICAgICB2YXIgciA9IGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICB2YXIgZSA9IHt9OwogICAgICAgICAgSih0LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICBTdCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIGVbdF0gPSBuOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciBvID0gbiwKICAgICAgICAgICAgICByID0gX3QobiwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBrOiB0LAogICAgICAgICAgICAgIHY6IG4KICAgICAgICAgICAgfTsKICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGkgPSBkdChyLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICByZXR1cm4gW25dLmNvbmNhdChaZyhlLCBvLCByLCBuKSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm4gZHQoZSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHR0KGksIHQpLmdldE9yKFt0XSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KG8sIGUpOwoKICAgICAgICBzLnNldChyKTsKICAgICAgfSwKICAgICAgZXhwYW5kOiBmdW5jdGlvbiBleHBhbmQoZSkgewogICAgICAgIHJldHVybiB0dChjLmdldCgpLCBlKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gdHQocy5nZXQoKSwgZSkuZ2V0T3IoW10pOwogICAgICAgICAgcmV0dXJuIFt0XS5jb25jYXQobik7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uIHJlZnJlc2godCkgewogICAgICAgIHJldHVybiB0dChzLmdldCgpLCB0KTsKICAgICAgfSwKICAgICAgY29sbGFwc2U6IGZ1bmN0aW9uIGNvbGxhcHNlKHQpIHsKICAgICAgICByZXR1cm4gdHQocy5nZXQoKSwgdCkuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIDEgPCB0Lmxlbmd0aCA/IHZ0LnNvbWUodC5zbGljZSgxKSkgOiB2dC5ub25lKCk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGxvb2t1cE1lbnU6IG4sCiAgICAgIGxvb2t1cEl0ZW06IGUsCiAgICAgIG90aGVyTWVudXM6IGZ1bmN0aW9uIG90aGVyTWVudXModCkgewogICAgICAgIHZhciBuID0gdS5nZXQoKTsKICAgICAgICByZXR1cm4gVyhrdChuKSwgdCk7CiAgICAgIH0sCiAgICAgIGdldFByaW1hcnk6IGZ1bmN0aW9uIGdldFByaW1hcnkoKSB7CiAgICAgICAgcmV0dXJuIGwuZ2V0KCkuYmluZChhKTsKICAgICAgfSwKICAgICAgZ2V0TWVudXM6IGZ1bmN0aW9uIGdldE1lbnVzKCkgewogICAgICAgIHJldHVybiBpLmdldCgpOwogICAgICB9LAogICAgICBjbGVhcjogZnVuY3Rpb24gY2xlYXIoKSB7CiAgICAgICAgYy5zZXQoe30pLCBpLnNldCh7fSksIHMuc2V0KHt9KSwgbC5jbGVhcigpOwogICAgICB9LAogICAgICBpc0NsZWFyOiBmdW5jdGlvbiBpc0NsZWFyKCkgewogICAgICAgIHJldHVybiBsLmdldCgpLmlzTm9uZSgpOwogICAgICB9LAogICAgICBnZXRUcmlnZ2VyaW5nUGF0aDogZnVuY3Rpb24gZ2V0VHJpZ2dlcmluZ1BhdGgodCwgdSkgewogICAgICAgIHZhciBuID0gRihlKHQpLnRvQXJyYXkoKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBhKHQpLmlzU29tZSgpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0dChzLmdldCgpLCB0KS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgZSA9IEwobi5jb25jYXQodCkpOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIGZvciAodmFyIG4gPSBbXSwgZSA9IDA7IGUgPCB0Lmxlbmd0aDsgZSsrKSB7CiAgICAgICAgICAgICAgdmFyIG8gPSB0W2VdOwogICAgICAgICAgICAgIGlmICghby5pc1NvbWUoKSkgcmV0dXJuIHZ0Lm5vbmUoKTsKICAgICAgICAgICAgICBuLnB1c2goby5nZXRPckRpZSgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZ0LnNvbWUobik7CiAgICAgICAgICB9KHooZSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgcmV0dXJuIG8gPSB0LCByID0gdSwgaSA9IGUuc2xpY2UoMCwgbiArIDEpLCBhKG8pLmJpbmQoZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICByZXR1cm4gZSA9IG8sIFEoYy5nZXQoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0ID09PSBlOwogICAgICAgICAgICAgIH0pLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiByKHQpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHRyaWdnZXJlZE1lbnU6IG4sCiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcmluZ0l0ZW06IHQsCiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcmluZ1BhdGg6IGkKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHZhciBlOwogICAgICAgICAgICB9KS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gbXQobC5nZXQoKSwgdCkgPyBbXSA6IFt2dC5ub25lKCldOwogICAgICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiBbdnQuc29tZSh0KV07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgbywgciwgaTsKICAgICAgICAgIH0pKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfTsKICB9LAogICAgICBucCA9IFltLAogICAgICBlcCA9IHJ0KCJjb2xsYXBzZS1pdGVtIiksCiAgICAgIG9wID0gd2woewogICAgbmFtZTogIlRpZXJlZE1lbnUiLAogICAgY29uZmlnRmllbGRzOiBbUXUoIm9uRXhlY3V0ZSIpLCBRdSgib25Fc2NhcGUiKSwgJHUoIm9uT3Blbk1lbnUiKSwgJHUoIm9uT3BlblN1Ym1lbnUiKSwgS3UoIm9uUmVwb3NpdGlvbk1lbnUiKSwgS3UoIm9uQ29sbGFwc2VNZW51IiksIFRvKCJoaWdobGlnaHRJbW1lZGlhdGVseSIsICEwKSwgdm8oImRhdGEiLCBbZm8oInByaW1hcnkiKSwgZm8oIm1lbnVzIiksIGZvKCJleHBhbnNpb25zIildKSwgVG8oImZha2VGb2N1cyIsICExKSwgS3UoIm9uSGlnaGxpZ2h0IiksIEt1KCJvbkhvdmVyIiksIFh1KCksIGZvKCJkb20iKSwgVG8oIm5hdmlnYXRlT25Ib3ZlciIsICEwKSwgVG8oInN0YXlJbkRvbSIsICExKSwgJHMoInRtZW51QmVoYXZpb3VycyIsIFtNZywgZ2QsIHVkLCBGZ10pLCBUbygiZXZlbnRPcmRlciIsIHt9KV0sCiAgICBhcGlzOiB7CiAgICAgIGNvbGxhcHNlTWVudTogZnVuY3Rpb24gY29sbGFwc2VNZW51KHQsIG4pIHsKICAgICAgICB0LmNvbGxhcHNlTWVudShuKTsKICAgICAgfSwKICAgICAgaGlnaGxpZ2h0UHJpbWFyeTogZnVuY3Rpb24gaGlnaGxpZ2h0UHJpbWFyeSh0LCBuKSB7CiAgICAgICAgdC5oaWdobGlnaHRQcmltYXJ5KG4pOwogICAgICB9LAogICAgICByZXBvc2l0aW9uTWVudXM6IGZ1bmN0aW9uIHJlcG9zaXRpb25NZW51cyh0LCBuKSB7CiAgICAgICAgdC5yZXBvc2l0aW9uTWVudXMobik7CiAgICAgIH0KICAgIH0sCiAgICBmYWN0b3J5OiBmdW5jdGlvbiBmYWN0b3J5KGEsIHQpIHsKICAgICAgZnVuY3Rpb24gZSh0KSB7CiAgICAgICAgdmFyIG8sCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIG4gPSAobyA9IHQsIHIgPSBhLmRhdGEucHJpbWFyeSwgZHQoYS5kYXRhLm1lbnVzLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgZnVuY3Rpb24gZSgpIHsKICAgICAgICAgICAgcmV0dXJuIFFnLnNrZXRjaChfbHQoX2x0KHt9LCB0KSwgewogICAgICAgICAgICAgIHZhbHVlOiBuLAogICAgICAgICAgICAgIG1hcmtlcnM6IGEubWFya2VycywKICAgICAgICAgICAgICBmYWtlRm9jdXM6IGEuZmFrZUZvY3VzLAogICAgICAgICAgICAgIG9uSGlnaGxpZ2h0OiBhLm9uSGlnaGxpZ2h0LAogICAgICAgICAgICAgIGZvY3VzTWFuYWdlcjogKGEuZmFrZUZvY3VzID8gTGwgOiBObCkoKQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG4gPT09IHIgPyB7CiAgICAgICAgICAgIHR5cGU6ICJwcmVwYXJlZCIsCiAgICAgICAgICAgIG1lbnU6IG8uZ2V0U3lzdGVtKCkuYnVpbGQoZSgpKQogICAgICAgICAgfSA6IHsKICAgICAgICAgICAgdHlwZTogIm5vdGJ1aWx0IiwKICAgICAgICAgICAgbmJNZW51OiBlCiAgICAgICAgICB9OwogICAgICAgIH0pKSwKICAgICAgICAgICAgZSA9IGR0KGEuZGF0YS5tZW51cywgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIHJldHVybiB6KHQuaXRlbXMsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiAic2VwYXJhdG9yIiA9PT0gdC50eXBlID8gW10gOiBbdC5kYXRhLnZhbHVlXTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBnLnNldENvbnRlbnRzKGEuZGF0YS5wcmltYXJ5LCBuLCBhLmRhdGEuZXhwYW5zaW9ucywgZSksIGcuZ2V0UHJpbWFyeSgpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjKHQpIHsKICAgICAgICByZXR1cm4gVGYuZ2V0VmFsdWUodCkudmFsdWU7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHUobiwgdCkgewogICAgICAgIGdkLmhpZ2hsaWdodChuLCB0KSwgZ2QuZ2V0SGlnaGxpZ2h0ZWQodCkub3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZ2QuZ2V0Rmlyc3QodCk7CiAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgeXIobiwgdC5lbGVtZW50LCBJaSgpKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcyhuLCB0KSB7CiAgICAgICAgcmV0dXJuIGV0KE0odCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBuLmxvb2t1cE1lbnUodCkuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gInByZXBhcmVkIiA9PT0gdC50eXBlID8gdnQuc29tZSh0Lm1lbnUpIDogdnQubm9uZSgpOwogICAgICAgICAgfSk7CiAgICAgICAgfSkpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBsKG4sIHQsIGUpIHsKICAgICAgICB2YXIgbyA9IHModCwgdC5vdGhlck1lbnVzKGUpKTsKICAgICAgICBTdChvLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgSnIodC5lbGVtZW50LCBbYS5tYXJrZXJzLmJhY2tncm91bmRNZW51XSksIGEuc3RheUluRG9tIHx8IEZnLnJlbW92ZShuLCB0KTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZih0LCBvKSB7CiAgICAgICAgdmFyIG47CiAgICAgICAgSigobiA9IHQsIHIuZ2V0KCkuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZSA9IHt9LAogICAgICAgICAgICAgIHQgPSBGKHBzKG4uZWxlbWVudCwgIi4iICsgYS5tYXJrZXJzLml0ZW0pLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gInRydWUiID09PSBybih0LCAiYXJpYS1oYXNwb3B1cCIpOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gU3QodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgbi5nZXRTeXN0ZW0oKS5nZXRCeURvbSh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBjKHQpOwogICAgICAgICAgICAgIGVbbl0gPSB0OwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pLCByLnNldChlKSwgZTsKICAgICAgICB9KSksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICB2YXIgZSA9IHd0KG8sIG4pOwogICAgICAgICAgb24odC5lbGVtZW50LCAiYXJpYS1leHBhbmRlZCIsIGUpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkKG8sIHIsIGkpIHsKICAgICAgICByZXR1cm4gdnQuZnJvbShpWzBdKS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gci5sb29rdXBNZW51KHQpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgaWYgKCJub3RidWlsdCIgPT09IHQudHlwZSkgcmV0dXJuIHZ0Lm5vbmUoKTsKICAgICAgICAgICAgdmFyIG4gPSB0Lm1lbnUsCiAgICAgICAgICAgICAgICBlID0gcyhyLCBpLnNsaWNlKDEpKTsKICAgICAgICAgICAgcmV0dXJuIFN0KGUsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgWHIodC5lbGVtZW50LCBhLm1hcmtlcnMuYmFja2dyb3VuZE1lbnUpOwogICAgICAgICAgICB9KSwgaGUobi5lbGVtZW50KSB8fCBGZy5hcHBlbmQobywgVHUobikpLCBKcihuLmVsZW1lbnQsIFthLm1hcmtlcnMuYmFja2dyb3VuZE1lbnVdKSwgdShvLCBuKSwgbChvLCByLCBpKSwgdnQuc29tZShuKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgbSwKICAgICAgICAgIG4sCiAgICAgICAgICByID0gZGMoKSwKICAgICAgICAgIGcgPSB0cCgpOwoKICAgICAgZnVuY3Rpb24gaShyLCBpLCB1KSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gdSAmJiAodSA9IG0uSGlnaGxpZ2h0U3VibWVudSksIGkuaGFzQ29uZmlndXJlZChkZCkgJiYgZGQuaXNEaXNhYmxlZChpKSkgcmV0dXJuIHZ0LnNvbWUoaSk7CiAgICAgICAgdmFyIHQgPSBjKGkpOwogICAgICAgIHJldHVybiBnLmV4cGFuZCh0KS5iaW5kKGZ1bmN0aW9uIChvKSB7CiAgICAgICAgICByZXR1cm4gZihyLCBvKSwgdnQuZnJvbShvWzBdKS5iaW5kKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHJldHVybiBnLmxvb2t1cE1lbnUoZSkuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHZhciBuID0gZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgICAgICAgICAgIGlmICgibm90YnVpbHQiICE9PSBlLnR5cGUpIHJldHVybiBlLm1lbnU7CiAgICAgICAgICAgICAgICB2YXIgbyA9IHQuZ2V0U3lzdGVtKCkuYnVpbGQoZS5uYk1lbnUoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZy5zZXRNZW51QnVpbHQobiwgbyksIG87CiAgICAgICAgICAgICAgfShyLCBlLCB0KTsKCiAgICAgICAgICAgICAgcmV0dXJuIGhlKG4uZWxlbWVudCkgfHwgRmcuYXBwZW5kKHIsIFR1KG4pKSwgYS5vbk9wZW5TdWJtZW51KHIsIGksIG4sIEwobykpLCB1ID09PSBtLkhpZ2hsaWdodFN1Ym1lbnUgPyAoZ2QuaGlnaGxpZ2h0Rmlyc3QobiksIGQociwgZywgbykpIDogKGdkLmRlaGlnaGxpZ2h0QWxsKG4pLCB2dC5zb21lKGkpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbyhuLCBlKSB7CiAgICAgICAgdmFyIHQgPSBjKGUpOwogICAgICAgIHJldHVybiBnLmNvbGxhcHNlKHQpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBmKG4sIHQpLCBkKG4sIGcsIHQpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gYS5vbkNvbGxhcHNlTWVudShuLCBlLCB0KSwgdDsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBwKGUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG4sIHQpIHsKICAgICAgICAgIHJldHVybiBJdSh0LmdldFNvdXJjZSgpLCAiLiIgKyBhLm1hcmtlcnMuaXRlbSkuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gbi5nZXRTeXN0ZW0oKS5nZXRCeURvbSh0KS50b09wdGlvbmFsKCkuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiBlKG4sIHQpLm1hcChfKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBoKHQpIHsKICAgICAgICByZXR1cm4gZ2QuZ2V0SGlnaGxpZ2h0ZWQodCkuYmluZChnZC5nZXRIaWdobGlnaHRlZCk7CiAgICAgIH0KCiAgICAgIChuID0gbSA9IHt9KVtuLkhpZ2hsaWdodFN1Ym1lbnUgPSAwXSA9ICJIaWdobGlnaHRTdWJtZW51IiwgbltuLkhpZ2hsaWdodFBhcmVudCA9IDFdID0gIkhpZ2hsaWdodFBhcmVudCI7CiAgICAgIHZhciB2ID0gbnUoW0NyKCRnKCksIGZ1bmN0aW9uIChlLCBvKSB7CiAgICAgICAgdmFyIHQgPSBvLmV2ZW50Lml0ZW07CiAgICAgICAgZy5sb29rdXBJdGVtKGModCkpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHQgPSBvLmV2ZW50Lm1lbnU7CiAgICAgICAgICBnZC5oaWdobGlnaHQoZSwgdCk7CiAgICAgICAgICB2YXIgbiA9IGMoby5ldmVudC5pdGVtKTsKICAgICAgICAgIGcucmVmcmVzaChuKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiBsKGUsIGcsIHQpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pLCBpdShmdW5jdGlvbiAobiwgdCkgewogICAgICAgIHZhciBlID0gdC5ldmVudC50YXJnZXQ7CiAgICAgICAgbi5nZXRTeXN0ZW0oKS5nZXRCeURvbShlKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAwID09PSBjKHQpLmluZGV4T2YoImNvbGxhcHNlLWl0ZW0iKSAmJiBvKG4sIHQpLCBpKG4sIHQsIG0uSGlnaGxpZ2h0U3VibWVudSkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGEub25FeGVjdXRlKG4sIHQpOwogICAgICAgICAgfSwgc3QpOwogICAgICAgIH0pOwogICAgICB9KSwgZXUoZnVuY3Rpb24gKG4sIHQpIHsKICAgICAgICBlKG4pLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIEZnLmFwcGVuZChuLCBUdSh0KSksIGEub25PcGVuTWVudShuLCB0KSwgYS5oaWdobGlnaHRJbW1lZGlhdGVseSAmJiB1KG4sIHQpOwogICAgICAgIH0pOwogICAgICB9KV0uY29uY2F0KGEubmF2aWdhdGVPbkhvdmVyID8gW0NyKFdnKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgdmFyIGUgPSBuLmV2ZW50Lml0ZW0sCiAgICAgICAgICAgIG8gPSB0LAogICAgICAgICAgICByID0gYyhlKTsKICAgICAgICBnLnJlZnJlc2gocikuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGYobywgdCksIGQobywgZywgdCk7CiAgICAgICAgfSksIGkodCwgZSwgbS5IaWdobGlnaHRQYXJlbnQpLCBhLm9uSG92ZXIodCwgZSk7CiAgICAgIH0pXSA6IFtdKSksCiAgICAgICAgICBiID0gewogICAgICAgIGNvbGxhcHNlTWVudTogZnVuY3Rpb24gY29sbGFwc2VNZW51KG4pIHsKICAgICAgICAgIGgobikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICBvKG4sIHQpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBoaWdobGlnaHRQcmltYXJ5OiBmdW5jdGlvbiBoaWdobGlnaHRQcmltYXJ5KG4pIHsKICAgICAgICAgIGcuZ2V0UHJpbWFyeSgpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdShuLCB0KTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgcmVwb3NpdGlvbk1lbnVzOiBmdW5jdGlvbiByZXBvc2l0aW9uTWVudXMobykgewogICAgICAgICAgZy5nZXRQcmltYXJ5KCkuYmluZChmdW5jdGlvbiAobikgewogICAgICAgICAgICByZXR1cm4gaChvKS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBjKHQpLAogICAgICAgICAgICAgICAgICBlID0gZXQoTShaKGcuZ2V0TWVudXMoKSksIG5wKSk7CiAgICAgICAgICAgICAgcmV0dXJuIGcuZ2V0VHJpZ2dlcmluZ1BhdGgobiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuID0gdCwgSyhlLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdC5nZXRTeXN0ZW0oKS5pc0Nvbm5lY3RlZCgpID8gVihnZC5nZXRDYW5kaWRhdGVzKHQpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjKHQpID09PSBuOwogICAgICAgICAgICAgICAgICB9KSA6IHZ0Lm5vbmUoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIG47CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwcmltYXJ5OiBuLAogICAgICAgICAgICAgICAgdHJpZ2dlcmluZ1BhdGg6IHQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2dC5mcm9tKG8uY29tcG9uZW50cygpWzBdKS5maWx0ZXIoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gIm1lbnUiID09PSBybih0LmVsZW1lbnQsICJyb2xlIik7CiAgICAgICAgICAgIH0pLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBhLm9uUmVwb3NpdGlvbk1lbnUobywgdCwgW10pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHZhciBuID0gdC5wcmltYXJ5LAogICAgICAgICAgICAgICAgZSA9IHQudHJpZ2dlcmluZ1BhdGg7CiAgICAgICAgICAgIGEub25SZXBvc2l0aW9uTWVudShvLCBuLCBlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIHsKICAgICAgICB1aWQ6IGEudWlkLAogICAgICAgIGRvbTogYS5kb20sCiAgICAgICAgbWFya2VyczogYS5tYXJrZXJzLAogICAgICAgIGJlaGF2aW91cnM6IFpzKGEudG1lbnVCZWhhdmlvdXJzLCBbTWcuY29uZmlnKHsKICAgICAgICAgIG1vZGU6ICJzcGVjaWFsIiwKICAgICAgICAgIG9uUmlnaHQ6IHAoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgcmV0dXJuIENsKG4uZWxlbWVudCkgPyB2dC5ub25lKCkgOiBpKHQsIG4sIG0uSGlnaGxpZ2h0U3VibWVudSk7CiAgICAgICAgICB9KSwKICAgICAgICAgIG9uTGVmdDogcChmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICByZXR1cm4gQ2wobi5lbGVtZW50KSA/IHZ0Lm5vbmUoKSA6IG8odCwgbik7CiAgICAgICAgICB9KSwKICAgICAgICAgIG9uRXNjYXBlOiBwKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgIHJldHVybiBvKHQsIG4pLm9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBhLm9uRXNjYXBlKHQsIG4pLm1hcChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSwKICAgICAgICAgIGZvY3VzSW46IGZ1bmN0aW9uIGZvY3VzSW4obiwgdCkgewogICAgICAgICAgICBnLmdldFByaW1hcnkoKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgeXIobiwgdC5lbGVtZW50LCBJaSgpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSksIGdkLmNvbmZpZyh7CiAgICAgICAgICBoaWdobGlnaHRDbGFzczogYS5tYXJrZXJzLnNlbGVjdGVkTWVudSwKICAgICAgICAgIGl0ZW1DbGFzczogYS5tYXJrZXJzLm1lbnUKICAgICAgICB9KSwgdWQuY29uZmlnKHsKICAgICAgICAgIGZpbmQ6IGZ1bmN0aW9uIGZpbmQodCkgewogICAgICAgICAgICByZXR1cm4gZ2QuZ2V0SGlnaGxpZ2h0ZWQodCk7CiAgICAgICAgICB9CiAgICAgICAgfSksIEZnLmNvbmZpZyh7fSldKSwKICAgICAgICBldmVudE9yZGVyOiBhLmV2ZW50T3JkZXIsCiAgICAgICAgYXBpczogYiwKICAgICAgICBldmVudHM6IHYKICAgICAgfTsKICAgIH0sCiAgICBleHRyYUFwaXM6IHsKICAgICAgdGllcmVkRGF0YTogZnVuY3Rpb24gdGllcmVkRGF0YSh0LCBuLCBlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHByaW1hcnk6IHQsCiAgICAgICAgICBtZW51czogbiwKICAgICAgICAgIGV4cGFuc2lvbnM6IGUKICAgICAgICB9OwogICAgICB9LAogICAgICBzaW5nbGVEYXRhOiBmdW5jdGlvbiBzaW5nbGVEYXRhKHQsIG4pIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcHJpbWFyeTogdCwKICAgICAgICAgIG1lbnVzOiBjcih0LCBuKSwKICAgICAgICAgIGV4cGFuc2lvbnM6IHt9CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgY29sbGFwc2VJdGVtOiBmdW5jdGlvbiBjb2xsYXBzZUl0ZW0odCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB2YWx1ZTogRnIoZXAoKSksCiAgICAgICAgICBtZXRhOiB7CiAgICAgICAgICAgIHRleHQ6IHQKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CiAgICB9CiAgfSksCiAgICAgIHJwID0gd2woewogICAgbmFtZTogIklubGluZVZpZXciLAogICAgY29uZmlnRmllbGRzOiBbZm8oImxhenlTaW5rIiksIEt1KCJvblNob3ciKSwgS3UoIm9uSGlkZSIpLCBrbygib25Fc2NhcGUiKSwgJHMoImlubGluZUJlaGF2aW91cnMiLCBbaGYsIFRmLCByY10pLCBfbygiZmlyZURpc21pc3NhbEV2ZW50SW5zdGVhZCIsIFtUbygiZXZlbnQiLCBYaSgpKV0pLCBfbygiZmlyZVJlcG9zaXRpb25FdmVudEluc3RlYWQiLCBbVG8oImV2ZW50IiwgWWkoKSldKSwgVG8oImdldFJlbGF0ZWQiLCB2dC5ub25lKSwgVG8oImlzRXh0cmFQYXJ0IiwgTyksIFRvKCJldmVudE9yZGVyIiwgdnQubm9uZSldLAogICAgZmFjdG9yeTogZnVuY3Rpb24gZmFjdG9yeShkLCB0KSB7CiAgICAgIGZ1bmN0aW9uIG4oZSkgewogICAgICAgIGhmLmlzT3BlbihlKSAmJiBUZi5nZXRWYWx1ZShlKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBzd2l0Y2ggKHQubW9kZSkgewogICAgICAgICAgICBjYXNlICJtZW51IjoKICAgICAgICAgICAgICBoZi5nZXRTdGF0ZShlKS5lYWNoKG9wLnJlcG9zaXRpb25NZW51cyk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJwb3NpdGlvbiI6CiAgICAgICAgICAgICAgdmFyIG4gPSBkLmxhenlTaW5rKGUpLmdldE9yRGllKCk7CiAgICAgICAgICAgICAgc2YucG9zaXRpb25XaXRoaW5Cb3VuZHMobiwgZSwgdC5jb25maWcsIHQuZ2V0Qm91bmRzKCkpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBvKHQsIG4sIGUsIG8pIHsKICAgICAgICBpKHQsIG4sIGUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBvLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gTWUodCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcih0LCBuLCBlLCBvKSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIHUsCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIGMsCiAgICAgICAgICAgIHMgPSAociA9IGQsIGkgPSB0LCB1ID0gbiwgYSA9IG8sIGMgPSAiaG9yaXpvbnRhbCIgPT09IGUudHlwZSA/IHsKICAgICAgICAgIGxheW91dHM6IHsKICAgICAgICAgICAgb25MdHI6IHBhLAogICAgICAgICAgICBvblJ0bDogaGEKICAgICAgICAgIH0KICAgICAgICB9IDoge30sIG9wLnNrZXRjaCh7CiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAiZGl2IgogICAgICAgICAgfSwKICAgICAgICAgIGRhdGE6IGUuZGF0YSwKICAgICAgICAgIG1hcmtlcnM6IGUubWVudS5tYXJrZXJzLAogICAgICAgICAgaGlnaGxpZ2h0SW1tZWRpYXRlbHk6IGUubWVudS5oaWdobGlnaHRJbW1lZGlhdGVseSwKICAgICAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiBvbkVzY2FwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGhmLmNsb3NlKGkpLCByLm9uRXNjYXBlLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiB0KGkpOwogICAgICAgICAgICB9KSwgdnQuc29tZSghMCk7CiAgICAgICAgICB9LAogICAgICAgICAgb25FeGVjdXRlOiBmdW5jdGlvbiBvbkV4ZWN1dGUoKSB7CiAgICAgICAgICAgIHJldHVybiB2dC5zb21lKCEwKTsKICAgICAgICAgIH0sCiAgICAgICAgICBvbk9wZW5NZW51OiBmdW5jdGlvbiBvbk9wZW5NZW51KHQsIG4pIHsKICAgICAgICAgICAgc2YucG9zaXRpb25XaXRoaW5Cb3VuZHMobCgpLmdldE9yRGllKCksIG4sIHUsIGEoKSk7CiAgICAgICAgICB9LAogICAgICAgICAgb25PcGVuU3VibWVudTogZnVuY3Rpb24gb25PcGVuU3VibWVudSh0LCBuLCBlLCBvKSB7CiAgICAgICAgICAgIHZhciByID0gbCgpLmdldE9yRGllKCk7CiAgICAgICAgICAgIHNmLnBvc2l0aW9uKHIsIGUsIHsKICAgICAgICAgICAgICBhbmNob3I6IF9sdCh7CiAgICAgICAgICAgICAgICB0eXBlOiAic3VibWVudSIsCiAgICAgICAgICAgICAgICBpdGVtOiBuCiAgICAgICAgICAgICAgfSwgZihvKSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgb25SZXBvc2l0aW9uTWVudTogZnVuY3Rpb24gb25SZXBvc2l0aW9uTWVudSh0LCBuLCBlKSB7CiAgICAgICAgICAgIHZhciBvID0gbCgpLmdldE9yRGllKCk7CiAgICAgICAgICAgIHNmLnBvc2l0aW9uV2l0aGluQm91bmRzKG8sIG4sIHUsIGEoKSksIFN0KGUsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBmKHQudHJpZ2dlcmluZ1BhdGgpOwogICAgICAgICAgICAgIHNmLnBvc2l0aW9uKG8sIHQudHJpZ2dlcmVkTWVudSwgewogICAgICAgICAgICAgICAgYW5jaG9yOiBfbHQoewogICAgICAgICAgICAgICAgICB0eXBlOiAic3VibWVudSIsCiAgICAgICAgICAgICAgICAgIGl0ZW06IHQudHJpZ2dlcmluZ0l0ZW0KICAgICAgICAgICAgICAgIH0sIG4pCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pKTsKCiAgICAgICAgZnVuY3Rpb24gbCgpIHsKICAgICAgICAgIHJldHVybiByLmxhenlTaW5rKGkpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZih0KSB7CiAgICAgICAgICByZXR1cm4gMiA9PT0gdC5sZW5ndGggPyBjIDoge307CiAgICAgICAgfQoKICAgICAgICBoZi5vcGVuKHQsIHMpLCBUZi5zZXRWYWx1ZSh0LCB2dC5zb21lKHsKICAgICAgICAgIG1vZGU6ICJtZW51IiwKICAgICAgICAgIG1lbnU6IHMKICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHZhciBpID0gZnVuY3Rpb24gaSh0LCBuLCBlLCBvKSB7CiAgICAgICAgdmFyIHIgPSBkLmxhenlTaW5rKHQpLmdldE9yRGllKCk7CiAgICAgICAgaGYub3BlbldoaWxlQ2xvYWtlZCh0LCBuLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gc2YucG9zaXRpb25XaXRoaW5Cb3VuZHMociwgdCwgZSwgbygpKTsKICAgICAgICB9KSwgVGYuc2V0VmFsdWUodCwgdnQuc29tZSh7CiAgICAgICAgICBtb2RlOiAicG9zaXRpb24iLAogICAgICAgICAgY29uZmlnOiBlLAogICAgICAgICAgZ2V0Qm91bmRzOiBvCiAgICAgICAgfSkpOwogICAgICB9LAogICAgICAgICAgZSA9IHsKICAgICAgICBzZXRDb250ZW50OiBmdW5jdGlvbiBzZXRDb250ZW50KHQsIG4pIHsKICAgICAgICAgIGhmLnNldENvbnRlbnQodCwgbik7CiAgICAgICAgfSwKICAgICAgICBzaG93QXQ6IGZ1bmN0aW9uIHNob3dBdCh0LCBuLCBlKSB7CiAgICAgICAgICBvKHQsIG4sIGUsIHZ0Lm5vbmUoKSk7CiAgICAgICAgfSwKICAgICAgICBzaG93V2l0aGluOiBvLAogICAgICAgIHNob3dXaXRoaW5Cb3VuZHM6IGksCiAgICAgICAgc2hvd01lbnVBdDogZnVuY3Rpb24gc2hvd01lbnVBdCh0LCBuLCBlKSB7CiAgICAgICAgICByKHQsIG4sIGUsIHZ0Lm5vbmUpOwogICAgICAgIH0sCiAgICAgICAgc2hvd01lbnVXaXRoaW5Cb3VuZHM6IHIsCiAgICAgICAgaGlkZTogZnVuY3Rpb24gaGlkZSh0KSB7CiAgICAgICAgICBoZi5pc09wZW4odCkgJiYgKFRmLnNldFZhbHVlKHQsIHZ0Lm5vbmUoKSksIGhmLmNsb3NlKHQpKTsKICAgICAgICB9LAogICAgICAgIGdldENvbnRlbnQ6IGZ1bmN0aW9uIGdldENvbnRlbnQodCkgewogICAgICAgICAgcmV0dXJuIGhmLmdldFN0YXRlKHQpOwogICAgICAgIH0sCiAgICAgICAgcmVwb3NpdGlvbjogbiwKICAgICAgICBpc09wZW46IGhmLmlzT3BlbgogICAgICB9OwoKICAgICAgcmV0dXJuIHsKICAgICAgICB1aWQ6IGQudWlkLAogICAgICAgIGRvbTogZC5kb20sCiAgICAgICAgYmVoYXZpb3VyczogWnMoZC5pbmxpbmVCZWhhdmlvdXJzLCBbaGYuY29uZmlnKHsKICAgICAgICAgIGlzUGFydE9mOiBmdW5jdGlvbiBpc1BhcnRPZih0LCBuLCBlKSB7CiAgICAgICAgICAgIHJldHVybiBIdShuLCBlKSB8fCAobyA9IGUsIGQuZ2V0UmVsYXRlZCh0KS5leGlzdHMoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gSHUodCwgbyk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgdmFyIG87CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0QXR0YWNoUG9pbnQ6IGZ1bmN0aW9uIGdldEF0dGFjaFBvaW50KHQpIHsKICAgICAgICAgICAgcmV0dXJuIGQubGF6eVNpbmsodCkuZ2V0T3JEaWUoKTsKICAgICAgICAgIH0sCiAgICAgICAgICBvbk9wZW46IGZ1bmN0aW9uIG9uT3Blbih0KSB7CiAgICAgICAgICAgIGQub25TaG93KHQpOwogICAgICAgICAgfSwKICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UodCkgewogICAgICAgICAgICBkLm9uSGlkZSh0KTsKICAgICAgICAgIH0KICAgICAgICB9KSwgVGYuY29uZmlnKHsKICAgICAgICAgIHN0b3JlOiB7CiAgICAgICAgICAgIG1vZGU6ICJtZW1vcnkiLAogICAgICAgICAgICBpbml0aWFsVmFsdWU6IHZ0Lm5vbmUoKQogICAgICAgICAgfQogICAgICAgIH0pLCByYy5jb25maWcoewogICAgICAgICAgY2hhbm5lbHM6IF9sdChfbHQoe30sIGpzKF9sdCh7CiAgICAgICAgICAgIGlzRXh0cmFQYXJ0OiB0LmlzRXh0cmFQYXJ0CiAgICAgICAgICB9LCBkLmZpcmVEaXNtaXNzYWxFdmVudEluc3RlYWQubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgZmlyZUV2ZW50SW5zdGVhZDogewogICAgICAgICAgICAgICAgZXZlbnQ6IHQuZXZlbnQKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KS5nZXRPcih7fSkpKSksIEdzKF9sdChfbHQoe30sIGQuZmlyZVJlcG9zaXRpb25FdmVudEluc3RlYWQubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgZmlyZUV2ZW50SW5zdGVhZDogewogICAgICAgICAgICAgICAgZXZlbnQ6IHQuZXZlbnQKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KS5nZXRPcih7fSkpLCB7CiAgICAgICAgICAgIGRvUmVwb3NpdGlvbjogbgogICAgICAgICAgfSkpKQogICAgICAgIH0pXSksCiAgICAgICAgZXZlbnRPcmRlcjogZC5ldmVudE9yZGVyLAogICAgICAgIGFwaXM6IGUKICAgICAgfTsKICAgIH0sCiAgICBhcGlzOiB7CiAgICAgIHNob3dBdDogZnVuY3Rpb24gc2hvd0F0KHQsIG4sIGUsIG8pIHsKICAgICAgICB0LnNob3dBdChuLCBlLCBvKTsKICAgICAgfSwKICAgICAgc2hvd1dpdGhpbjogZnVuY3Rpb24gc2hvd1dpdGhpbih0LCBuLCBlLCBvLCByKSB7CiAgICAgICAgdC5zaG93V2l0aGluKG4sIGUsIG8sIHIpOwogICAgICB9LAogICAgICBzaG93V2l0aGluQm91bmRzOiBmdW5jdGlvbiBzaG93V2l0aGluQm91bmRzKHQsIG4sIGUsIG8sIHIpIHsKICAgICAgICB0LnNob3dXaXRoaW5Cb3VuZHMobiwgZSwgbywgcik7CiAgICAgIH0sCiAgICAgIHNob3dNZW51QXQ6IGZ1bmN0aW9uIHNob3dNZW51QXQodCwgbiwgZSwgbykgewogICAgICAgIHQuc2hvd01lbnVBdChuLCBlLCBvKTsKICAgICAgfSwKICAgICAgc2hvd01lbnVXaXRoaW5Cb3VuZHM6IGZ1bmN0aW9uIHNob3dNZW51V2l0aGluQm91bmRzKHQsIG4sIGUsIG8sIHIpIHsKICAgICAgICB0LnNob3dNZW51V2l0aGluQm91bmRzKG4sIGUsIG8sIHIpOwogICAgICB9LAogICAgICBoaWRlOiBmdW5jdGlvbiBoaWRlKHQsIG4pIHsKICAgICAgICB0LmhpZGUobik7CiAgICAgIH0sCiAgICAgIGlzT3BlbjogZnVuY3Rpb24gaXNPcGVuKHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5pc09wZW4obik7CiAgICAgIH0sCiAgICAgIGdldENvbnRlbnQ6IGZ1bmN0aW9uIGdldENvbnRlbnQodCwgbikgewogICAgICAgIHJldHVybiB0LmdldENvbnRlbnQobik7CiAgICAgIH0sCiAgICAgIHNldENvbnRlbnQ6IGZ1bmN0aW9uIHNldENvbnRlbnQodCwgbiwgZSkgewogICAgICAgIHQuc2V0Q29udGVudChuLCBlKTsKICAgICAgfSwKICAgICAgcmVwb3NpdGlvbjogZnVuY3Rpb24gcmVwb3NpdGlvbih0LCBuKSB7CiAgICAgICAgdC5yZXBvc2l0aW9uKG4pOwogICAgICB9CiAgICB9CiAgfSksCiAgICAgIGlwID0gImxheW91dC1pbnNldCIsCiAgICAgIHVwID0gZnVuY3Rpb24gdXAodCwgbiwgZSkgewogICAgcmV0dXJuIG5hKENtKHQsIG4pLCB0LnksIGUuaW5zZXROb3J0aCgpLCB6YSgpLCAibm9ydGgiLCBvYSh0LCB7CiAgICAgIHRvcDogMgogICAgfSksIGlwKTsKICB9LAogICAgICBhcCA9IGZ1bmN0aW9uIGFwKHQsIG4sIGUpIHsKICAgIHJldHVybiBuYShDbSh0LCBuKSwgT20odCwgbiksIGUuaW5zZXRTb3V0aCgpLCBOYSgpLCAic291dGgiLCBvYSh0LCB7CiAgICAgIGJvdHRvbTogMwogICAgfSksIGlwKTsKICB9LAogICAgICBjcCA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCJ0aW55bWNlLnV0aWwuRGVsYXkiKSwKICAgICAgc3AgPSB3bCh7CiAgICBuYW1lOiAiQnV0dG9uIiwKICAgIGZhY3Rvcnk6IGZ1bmN0aW9uIGZhY3RvcnkodCkgewogICAgICBmdW5jdGlvbiBlKG4pIHsKICAgICAgICByZXR1cm4gdHQodC5kb20sICJhdHRyaWJ1dGVzIikuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHR0KHQsIG4pOwogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgbiA9IHhtKHQuYWN0aW9uKSwKICAgICAgICAgIG8gPSB0LmRvbS50YWc7CiAgICAgIHJldHVybiB7CiAgICAgICAgdWlkOiB0LnVpZCwKICAgICAgICBkb206IHQuZG9tLAogICAgICAgIGNvbXBvbmVudHM6IHQuY29tcG9uZW50cywKICAgICAgICBldmVudHM6IG4sCiAgICAgICAgYmVoYXZpb3VyczogRGYodC5idXR0b25CZWhhdmlvdXJzLCBbVmcuY29uZmlnKHt9KSwgTWcuY29uZmlnKHsKICAgICAgICAgIG1vZGU6ICJleGVjdXRpb24iLAogICAgICAgICAgdXNlU3BhY2U6ICEwLAogICAgICAgICAgdXNlRW50ZXI6ICEwCiAgICAgICAgfSldKSwKICAgICAgICBkb21Nb2RpZmljYXRpb246IHsKICAgICAgICAgIGF0dHJpYnV0ZXM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCJidXR0b24iICE9PSBvKSByZXR1cm4gewogICAgICAgICAgICAgIHJvbGU6IGUoInJvbGUiKS5nZXRPcigiYnV0dG9uIikKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIHQgPSBlKCJ0eXBlIikuZ2V0T3IoImJ1dHRvbiIpLAogICAgICAgICAgICAgICAgbiA9IGUoInJvbGUiKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcm9sZTogdAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pLmdldE9yKHt9KTsKICAgICAgICAgICAgcmV0dXJuIF9sdCh7CiAgICAgICAgICAgICAgdHlwZTogdAogICAgICAgICAgICB9LCBuKTsKICAgICAgICAgIH0oKQogICAgICAgIH0sCiAgICAgICAgZXZlbnRPcmRlcjogdC5ldmVudE9yZGVyCiAgICAgIH07CiAgICB9LAogICAgY29uZmlnRmllbGRzOiBbVG8oInVpZCIsIHZvaWQgMCksIGZvKCJkb20iKSwgVG8oImNvbXBvbmVudHMiLCBbXSksIEVmKCJidXR0b25CZWhhdmlvdXJzIiwgW1ZnLCBNZ10pLCB4bygiYWN0aW9uIiksIHhvKCJyb2xlIiksIFRvKCJldmVudE9yZGVyIiwge30pXQogIH0pLAogICAgICBscCA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCJ0aW55bWNlLnV0aWwuSTE4biIpLAogICAgICBmcCA9IHsKICAgIGluZGVudDogITAsCiAgICBvdXRkZW50OiAhMCwKICAgICJ0YWJsZS1pbnNlcnQtY29sdW1uLWFmdGVyIjogITAsCiAgICAidGFibGUtaW5zZXJ0LWNvbHVtbi1iZWZvcmUiOiAhMCwKICAgICJwYXN0ZS1jb2x1bW4tYWZ0ZXIiOiAhMCwKICAgICJwYXN0ZS1jb2x1bW4tYmVmb3JlIjogITAsCiAgICAidW5vcmRlcmVkLWxpc3QiOiAhMCwKICAgICJsaXN0LWJ1bGwtY2lyY2xlIjogITAsCiAgICAibGlzdC1idWxsLWRlZmF1bHQiOiAhMCwKICAgICJsaXN0LWJ1bGwtc3F1YXJlIjogITAKICB9LAogICAgICBkcCA9ICJ0ZW1wb3JhcnktcGxhY2Vob2xkZXIiLAogICAgICBtcCA9IHsKICAgIHN1Y2Nlc3M6ICJjaGVja21hcmsiLAogICAgZXJyb3I6ICJ3YXJuaW5nIiwKICAgIGVycjogImVycm9yIiwKICAgIHdhcm5pbmc6ICJ3YXJuaW5nIiwKICAgIHdhcm46ICJ3YXJuaW5nIiwKICAgIGluZm86ICJpbmZvIgogIH0sCiAgICAgIGdwID0gd2woewogICAgbmFtZTogIk5vdGlmaWNhdGlvbiIsCiAgICBmYWN0b3J5OiBmdW5jdGlvbiBmYWN0b3J5KG4pIHsKICAgICAgZnVuY3Rpb24gZSh0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGRvbTogewogICAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgICBjbGFzc2VzOiBbInRveC1iYXIiXSwKICAgICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICAgIHN0eWxlOiAid2lkdGg6ICIgKyB0ICsgIiUiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgIGNsYXNzZXM6IFsidG94LXRleHQiXSwKICAgICAgICAgICAgaW5uZXJIdG1sOiB0ICsgIiUiCiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgdmFyIHQsCiAgICAgICAgICByLAogICAgICAgICAgaSwKICAgICAgICAgIHUsCiAgICAgICAgICBhID0gUG0oewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAicCIsCiAgICAgICAgICBpbm5lckh0bWw6IG4udHJhbnNsYXRpb25Qcm92aWRlcihuLnRleHQpCiAgICAgICAgfSwKICAgICAgICBiZWhhdmlvdXJzOiB0YyhbRmcuY29uZmlnKHt9KV0pCiAgICAgIH0pLAogICAgICAgICAgYyA9IFBtKHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBuLnByb2dyZXNzID8gWyJ0b3gtcHJvZ3Jlc3MtYmFyIiwgInRveC1wcm9ncmVzcy1pbmRpY2F0b3IiXSA6IFsidG94LXByb2dyZXNzLWJhciJdCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiBbewogICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgIGNsYXNzZXM6IFsidG94LWJhci1jb250YWluZXIiXQogICAgICAgICAgfSwKICAgICAgICAgIGNvbXBvbmVudHM6IFtlKDApXQogICAgICAgIH0sIG8oMCldLAogICAgICAgIGJlaGF2aW91cnM6IHRjKFtGZy5jb25maWcoe30pXSkKICAgICAgfSksCiAgICAgICAgICBzID0gewogICAgICAgIHVwZGF0ZVByb2dyZXNzOiBmdW5jdGlvbiB1cGRhdGVQcm9ncmVzcyh0LCBuKSB7CiAgICAgICAgICB0LmdldFN5c3RlbSgpLmlzQ29ubmVjdGVkKCkgJiYgYy5nZXRPcHQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICBGZy5zZXQodCwgW3sKICAgICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgICAgICBjbGFzc2VzOiBbInRveC1iYXItY29udGFpbmVyIl0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNvbXBvbmVudHM6IFtlKG4pXQogICAgICAgICAgICB9LCBvKG4pXSk7CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHVwZGF0ZVRleHQ6IGZ1bmN0aW9uIHVwZGF0ZVRleHQodCwgbikgewogICAgICAgICAgdmFyIGU7CiAgICAgICAgICB0LmdldFN5c3RlbSgpLmlzQ29ubmVjdGVkKCkgJiYgKGUgPSBhLmdldCh0KSwgRmcuc2V0KGUsIFtvaShuKV0pKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgICAgICBsID0gZnQoW24uaWNvbi50b0FycmF5KCksIG4ubGV2ZWwudG9BcnJheSgpLCBuLmxldmVsLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdnQuZnJvbShtcFt0XSk7CiAgICAgIH0pLnRvQXJyYXkoKV0pLAogICAgICAgICAgZiA9IFBtKHNwLnNrZXRjaCh7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJidXR0b24iLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtbm90aWZpY2F0aW9uX19kaXNtaXNzIiwgInRveC1idXR0b24iLCAidG94LWJ1dHRvbi0tbmFrZWQiLCAidG94LWJ1dHRvbi0taWNvbiJdCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiBbam0oImNsb3NlIiwgewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LWljb24iXSwKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgImFyaWEtbGFiZWwiOiBuLnRyYW5zbGF0aW9uUHJvdmlkZXIoIkNsb3NlIikKICAgICAgICAgIH0KICAgICAgICB9LCBuLmljb25Qcm92aWRlcildLAogICAgICAgIGFjdGlvbjogZnVuY3Rpb24gYWN0aW9uKHQpIHsKICAgICAgICAgIG4ub25BY3Rpb24odCk7CiAgICAgICAgfQogICAgICB9KSksCiAgICAgICAgICBkID0gWyh0ID0gbCwgciA9IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LW5vdGlmaWNhdGlvbl9faWNvbiJdCiAgICAgIH0sIGkgPSBuLmljb25Qcm92aWRlciwgdSA9IGkoKSwgVW0ociwgVih0LCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBUdCh1LCB6bSh0LCB1KSk7CiAgICAgIH0pLmdldE9yKGRwKSwgdSwgdnQubm9uZSgpKSksIHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1ub3RpZmljYXRpb25fX2JvZHkiXQogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogW2EuYXNTcGVjKCldLAogICAgICAgIGJlaGF2aW91cnM6IHRjKFtGZy5jb25maWcoe30pXSkKICAgICAgfV07CiAgICAgIHJldHVybiB7CiAgICAgICAgdWlkOiBuLnVpZCwKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgIHJvbGU6ICJhbGVydCIKICAgICAgICAgIH0sCiAgICAgICAgICBjbGFzc2VzOiBuLmxldmVsLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gWyJ0b3gtbm90aWZpY2F0aW9uIiwgInRveC1ub3RpZmljYXRpb24tLWluIiwgInRveC1ub3RpZmljYXRpb24tLSIgKyB0XTsKICAgICAgICAgIH0pLmdldE9yKFsidG94LW5vdGlmaWNhdGlvbiIsICJ0b3gtbm90aWZpY2F0aW9uLS1pbiJdKQogICAgICAgIH0sCiAgICAgICAgYmVoYXZpb3VyczogdGMoW1ZnLmNvbmZpZyh7fSksIGZtKCJub3RpZmljYXRpb24tZXZlbnRzIiwgW0NyKHZpKCksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBmLmdldE9wdCh0KS5lYWNoKFZnLmZvY3VzKTsKICAgICAgICB9KV0pXSksCiAgICAgICAgY29tcG9uZW50czogZC5jb25jYXQobi5wcm9ncmVzcyA/IFtjLmFzU3BlYygpXSA6IFtdKS5jb25jYXQobi5jbG9zZUJ1dHRvbiA/IFtmLmFzU3BlYygpXSA6IFtdKSwKICAgICAgICBhcGlzOiBzCiAgICAgIH07CiAgICB9LAogICAgY29uZmlnRmllbGRzOiBbeG8oImxldmVsIiksIGZvKCJwcm9ncmVzcyIpLCBmbygiaWNvbiIpLCBmbygib25BY3Rpb24iKSwgZm8oInRleHQiKSwgZm8oImljb25Qcm92aWRlciIpLCBmbygidHJhbnNsYXRpb25Qcm92aWRlciIpLCBBbygiY2xvc2VCdXR0b24iLCAhMCldLAogICAgYXBpczogewogICAgICB1cGRhdGVQcm9ncmVzczogZnVuY3Rpb24gdXBkYXRlUHJvZ3Jlc3ModCwgbiwgZSkgewogICAgICAgIHQudXBkYXRlUHJvZ3Jlc3MobiwgZSk7CiAgICAgIH0sCiAgICAgIHVwZGF0ZVRleHQ6IGZ1bmN0aW9uIHVwZGF0ZVRleHQodCwgbiwgZSkgewogICAgICAgIHQudXBkYXRlVGV4dChuLCBlKTsKICAgICAgfQogICAgfQogIH0pOwoKICBmdW5jdGlvbiBwcChlLCBvKSB7CiAgICBmdW5jdGlvbiByKCkgewogICAgICBiKGkpIHx8IChjbGVhclRpbWVvdXQoaSksIGkgPSBudWxsKTsKICAgIH0KCiAgICB2YXIgaSA9IG51bGw7CiAgICByZXR1cm4gewogICAgICBjYW5jZWw6IHIsCiAgICAgIHRocm90dGxlOiBmdW5jdGlvbiB0aHJvdHRsZSgpIHsKICAgICAgICBmb3IgKHZhciB0ID0gW10sIG4gPSAwOyBuIDwgYXJndW1lbnRzLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICB0W25dID0gYXJndW1lbnRzW25dOwogICAgICAgIH0KCiAgICAgICAgcigpLCBpID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpID0gbnVsbCwgZS5hcHBseShudWxsLCB0KTsKICAgICAgICB9LCBvKTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIGhwKG8sIHQsIG4sIGUsIHIpIHsKICAgIHZhciBpID0gRXAobywgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIChuID0gbykuaXNCbG9jayhlID0gdCkgfHwgd3QoWyJCUiIsICJJTUciLCAiSFIiLCAiSU5QVVQiXSwgZS5ub2RlTmFtZSkgfHwgImZhbHNlIiA9PT0gbi5nZXRDb250ZW50RWRpdGFibGUoZSk7CiAgICAgIHZhciBuLCBlOwogICAgfSk7CiAgICByZXR1cm4gdnQuZnJvbShpLmJhY2t3YXJkcyh0LCBuLCBlLCByKSk7CiAgfQoKICBmdW5jdGlvbiB2cChlLCBuKSB7CiAgICByZXR1cm4gRHAoQXQuZnJvbURvbShlLnNlbGVjdGlvbi5nZXROb2RlKCkpKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGksCiAgICAgICAgICBfdTIsCiAgICAgICAgICB0ID0gQXQuZnJvbUh0bWwoJzxzcGFuIGRhdGEtbWNlLWF1dG9jb21wbGV0ZXI9IjEiIGRhdGEtbWNlLWJvZ3VzPSIxIj48L3NwYW4+JywgZS5nZXREb2MoKSk7CgogICAgICByZXR1cm4gX2UodCwgQXQuZnJvbURvbShuLmV4dHJhY3RDb250ZW50cygpKSksIG4uaW5zZXJ0Tm9kZSh0LmRvbSksIFl0KHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdC5kb20ubm9ybWFsaXplKCk7CiAgICAgIH0pLCBpID0gZ3MsIChfdTIgPSBmdW5jdGlvbiB1KHQpIHsKICAgICAgICBmb3IgKHZhciBuID0gS3QodCksIGUgPSBuLmxlbmd0aCAtIDE7IDAgPD0gZTsgZS0tKSB7CiAgICAgICAgICB2YXIgbyA9IG5bZV07CiAgICAgICAgICBpZiAoaShvKSkgcmV0dXJuIHZ0LnNvbWUobyk7CgogICAgICAgICAgdmFyIHIgPSBfdTIobyk7CgogICAgICAgICAgaWYgKHIuaXNTb21lKCkpIHJldHVybiByOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZ0Lm5vbmUoKTsKICAgICAgfSkodCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG47CiAgICAgICAgZS5zZWxlY3Rpb24uc2V0Q3Vyc29yTG9jYXRpb24odC5kb20sICJpbWciID09PSBGdChuID0gdCkgPyAxIDogbXMobikuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gS3QobikubGVuZ3RoOwogICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC5sZW5ndGg7CiAgICAgICAgfSkpOwogICAgICB9KSwgdDsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gYnAodCkgewogICAgcmV0dXJuIHQudG9TdHJpbmcoKS5yZXBsYWNlKC9cdTAwQTAvZywgIiAiKS5yZXBsYWNlKC9cdUZFRkYvZywgIiIpOwogIH0KCiAgZnVuY3Rpb24geXAodCkgewogICAgcmV0dXJuICIiICE9PSB0ICYmIC0xICE9PSAiIFx4YTBcZlxuXHJcdFx2Ii5pbmRleE9mKHQpOwogIH0KCiAgZnVuY3Rpb24geHAodCwgbikgewogICAgcmV0dXJuIHQuc3Vic3RyaW5nKG4ubGVuZ3RoKTsKICB9CgogIGZ1bmN0aW9uIHdwKG8sIHQsIHIsIG4pIHsKICAgIHJldHVybiB2b2lkIDAgPT09IG4gJiYgKG4gPSAwKSwgRHAoQXQuZnJvbURvbSh0LnN0YXJ0Q29udGFpbmVyKSkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAodCwgbywgaSwgcikgewogICAgICAgIGlmICh2b2lkIDAgPT09IHIgJiYgKHIgPSAwKSwgIW8uY29sbGFwc2VkIHx8IDMgIT09IG8uc3RhcnRDb250YWluZXIubm9kZVR5cGUpIHJldHVybiB2dC5ub25lKCk7CiAgICAgICAgdmFyIG4gPSB0LmdldFBhcmVudChvLnN0YXJ0Q29udGFpbmVyLCB0LmlzQmxvY2spIHx8IHQuZ2V0Um9vdCgpOwogICAgICAgIHJldHVybiBocCh0LCBvLnN0YXJ0Q29udGFpbmVyLCBvLnN0YXJ0T2Zmc2V0LCBmdW5jdGlvbiAodCwgciwgbikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgIGZvciAodmFyIGUgPSByIC0gMTsgMCA8PSBlOyBlLS0pIHsKICAgICAgICAgICAgICB2YXIgbyA9IHQuY2hhckF0KGUpOwogICAgICAgICAgICAgIGlmICh5cChvKSkgcmV0dXJuIHZ0Lm5vbmUoKTsKICAgICAgICAgICAgICBpZiAobyA9PT0gbikgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2dC5zb21lKGUpOwogICAgICAgICAgfShuLCBpKS5nZXRPcihyKTsKICAgICAgICB9LCBuKS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgbiA9IG8uY2xvbmVSYW5nZSgpOwogICAgICAgICAgaWYgKG4uc2V0U3RhcnQodC5jb250YWluZXIsIHQub2Zmc2V0KSwgbi5zZXRFbmQoby5lbmRDb250YWluZXIsIG8uZW5kT2Zmc2V0KSwgbi5jb2xsYXBzZWQpIHJldHVybiB2dC5ub25lKCk7CiAgICAgICAgICB2YXIgZSA9IGJwKG4pOwogICAgICAgICAgcmV0dXJuIDAgIT09IGUubGFzdEluZGV4T2YoaSkgfHwgeHAoZSwgaSkubGVuZ3RoIDwgciA/IHZ0Lm5vbmUoKSA6IHZ0LnNvbWUoewogICAgICAgICAgICB0ZXh0OiB4cChlLCBpKSwKICAgICAgICAgICAgcmFuZ2U6IG4sCiAgICAgICAgICAgIHRyaWdnZXJDaGFyOiBpCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfShvLCB0LCByLCBuKTsKICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuID0gby5jcmVhdGVSbmcoKTsKICAgICAgbi5zZWxlY3ROb2RlKHQuZG9tKTsKICAgICAgdmFyIGUgPSBicChuKTsKICAgICAgcmV0dXJuIHZ0LnNvbWUoewogICAgICAgIHJhbmdlOiBuLAogICAgICAgIHRleHQ6IHhwKGUsIHIpLAogICAgICAgIHRyaWdnZXJDaGFyOiByCiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBTcCh0LCBuKSB7CiAgICByZXR1cm4gewogICAgICBjb250YWluZXI6IHQsCiAgICAgIG9mZnNldDogbgogICAgfTsKICB9CgogIGZ1bmN0aW9uIENwKHQpIHsKICAgIHJldHVybiB1bygidG9vbGJhcmJ1dHRvbiIsIFBwLCB0KTsKICB9CgogIGZ1bmN0aW9uIGtwKHQpIHsKICAgIHJldHVybiB1bygiVG9nZ2xlQnV0dG9uIiwgenAsIHQpOwogIH0KCiAgZnVuY3Rpb24gT3AobiwgdCwgZSwgbykgewogICAgdm9pZCAwID09PSBvICYmIChvID0ge30pOwogICAgdmFyIHIgPSB0KCksCiAgICAgICAgaSA9IG4uc2VsZWN0aW9uLmdldFJuZygpLnN0YXJ0Q29udGFpbmVyLm5vZGVWYWx1ZSwKICAgICAgICB1ID0gRihyLmxvb2t1cEJ5Q2hhcihlLnRyaWdnZXJDaGFyKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIGUudGV4dC5sZW5ndGggPj0gdC5taW5DaGFycyAmJiB0Lm1hdGNoZXMuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGUgPSBuLmRvbSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gQXAodC5zdGFydENvbnRhaW5lciwgdC5zdGFydE9mZnNldCk7CiAgICAgICAgICByZXR1cm4gIWhwKGUsIG4uY29udGFpbmVyLCBuLm9mZnNldCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgcmV0dXJuIDAgPT09IG4gPyAtMSA6IG47CiAgICAgICAgICB9LCBlLmdldFJvb3QoKSkuZmlsdGVyKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiAheXAodC5jb250YWluZXIuZGF0YS5jaGFyQXQodC5vZmZzZXQgLSAxKSk7CiAgICAgICAgICB9KS5pc1NvbWUoKTsKICAgICAgICB9OwogICAgICAgIHZhciBlOwogICAgICB9KShlLnJhbmdlLCBpLCBlLnRleHQpOwogICAgfSk7CiAgICBpZiAoMCA9PT0gdS5sZW5ndGgpIHJldHVybiB2dC5ub25lKCk7CiAgICB2YXIgYSA9IEJwLmFsbChNKHUsIGZ1bmN0aW9uIChuKSB7CiAgICAgIHJldHVybiBuLmZldGNoKGUudGV4dCwgbi5tYXhSZXN1bHRzLCBvKS50aGVuKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG1hdGNoVGV4dDogZS50ZXh0LAogICAgICAgICAgaXRlbXM6IHQsCiAgICAgICAgICBjb2x1bW5zOiBuLmNvbHVtbnMsCiAgICAgICAgICBvbkFjdGlvbjogbi5vbkFjdGlvbiwKICAgICAgICAgIGhpZ2hsaWdodE9uOiBuLmhpZ2hsaWdodE9uCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KSk7CiAgICByZXR1cm4gdnQuc29tZSh7CiAgICAgIGxvb2t1cERhdGE6IGEsCiAgICAgIGNvbnRleHQ6IGUKICAgIH0pOwogIH0KCiAgdmFyIF9wLAogICAgICBUcCwKICAgICAgRXAgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgidGlueW1jZS5kb20uVGV4dFNlZWtlciIpLAogICAgICBEcCA9IGZ1bmN0aW9uIERwKHQpIHsKICAgIHJldHVybiBJdSh0LCAiW2RhdGEtbWNlLWF1dG9jb21wbGV0ZXJdIik7CiAgfSwKICAgICAgQnAgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgidGlueW1jZS51dGlsLlByb21pc2UiKSwKICAgICAgTXAgPSBmdW5jdGlvbiBNcCh0KSB7CiAgICBpZiAoMyA9PT0gdC5ub2RlVHlwZSkgcmV0dXJuIFNwKHQsIHQuZGF0YS5sZW5ndGgpOwogICAgdmFyIG4gPSB0LmNoaWxkTm9kZXM7CiAgICByZXR1cm4gMCA8IG4ubGVuZ3RoID8gTXAobltuLmxlbmd0aCAtIDFdKSA6IFNwKHQsIG4ubGVuZ3RoKTsKICB9LAogICAgICBBcCA9IGZ1bmN0aW9uIEFwKHQsIG4pIHsKICAgIHZhciBlID0gdC5jaGlsZE5vZGVzOwogICAgcmV0dXJuIDAgPCBlLmxlbmd0aCAmJiBuIDwgZS5sZW5ndGggPyBBcChlW25dLCAwKSA6IDAgPCBlLmxlbmd0aCAmJiAxID09PSB0Lm5vZGVUeXBlICYmIGUubGVuZ3RoID09PSBuID8gTXAoZVtlLmxlbmd0aCAtIDFdKSA6IFNwKHQsIG4pOwogIH0sCiAgICAgIEZwID0gSm8oW2dvKCJ0eXBlIiksIENvKCJ0ZXh0IildKSwKICAgICAgSXAgPSBKbyhbVG8oInR5cGUiLCAiYXV0b2NvbXBsZXRlaXRlbSIpLCBUbygiYWN0aXZlIiwgITEpLCBUbygiZGlzYWJsZWQiLCAhMSksIFRvKCJtZXRhIiwge30pLCBnbygidmFsdWUiKSwgQ28oInRleHQiKSwgQ28oImljb24iKV0pLAogICAgICBScCA9IEpvKFtnbygidHlwZSIpLCBnbygiY2giKSwgRG8oIm1pbkNoYXJzIiwgMSksIFRvKCJjb2x1bW5zIiwgMSksIERvKCJtYXhSZXN1bHRzIiwgMTApLCBrbygibWF0Y2hlcyIpLCBobygiZmV0Y2giKSwgaG8oIm9uQWN0aW9uIiksIElvKCJoaWdobGlnaHRPbiIsIFtdLCB0cildKSwKICAgICAgVnAgPSBbQW8oImRpc2FibGVkIiwgITEpLCBDbygidG9vbHRpcCIpLCBDbygiaWNvbiIpLCBDbygidGV4dCIpLCBGbygib25TZXR1cCIsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBzdDsKICB9KV0sCiAgICAgIFBwID0gSm8oW2dvKCJ0eXBlIiksIGhvKCJvbkFjdGlvbiIpXS5jb25jYXQoVnApKSwKICAgICAgSHAgPSBbQW8oImFjdGl2ZSIsICExKV0uY29uY2F0KFZwKSwKICAgICAgenAgPSBKbyhIcC5jb25jYXQoW2dvKCJ0eXBlIiksIGhvKCJvbkFjdGlvbiIpXSkpLAogICAgICBOcCA9IFtGbygicHJlZGljYXRlIiwgTyksIE1vKCJzY29wZSIsICJub2RlIiwgWyJub2RlIiwgImVkaXRvciJdKSwgTW8oInBvc2l0aW9uIiwgInNlbGVjdGlvbiIsIFsibm9kZSIsICJzZWxlY3Rpb24iLCAibGluZSJdKV0sCiAgICAgIExwID0gVnAuY29uY2F0KFtUbygidHlwZSIsICJjb250ZXh0Zm9ybWJ1dHRvbiIpLCBUbygicHJpbWFyeSIsICExKSwgaG8oIm9uQWN0aW9uIiksIGFyKCJvcmlnaW5hbCIsIGgpXSksCiAgICAgIFdwID0gSHAuY29uY2F0KFtUbygidHlwZSIsICJjb250ZXh0Zm9ybWJ1dHRvbiIpLCBUbygicHJpbWFyeSIsICExKSwgaG8oIm9uQWN0aW9uIiksIGFyKCJvcmlnaW5hbCIsIGgpXSksCiAgICAgIFVwID0gVnAuY29uY2F0KFtUbygidHlwZSIsICJjb250ZXh0Zm9ybWJ1dHRvbiIpXSksCiAgICAgIGpwID0gSHAuY29uY2F0KFtUbygidHlwZSIsICJjb250ZXh0Zm9ybXRvZ2dsZWJ1dHRvbiIpXSksCiAgICAgIEdwID0gc28oInR5cGUiLCB7CiAgICBjb250ZXh0Zm9ybWJ1dHRvbjogTHAsCiAgICBjb250ZXh0Zm9ybXRvZ2dsZWJ1dHRvbjogV3AKICB9KSwKICAgICAgWHAgPSBKbyhbVG8oInR5cGUiLCAiY29udGV4dGZvcm0iKSwgRm8oImluaXRWYWx1ZSIsIHJ0KCIiKSksIENvKCJsYWJlbCIpLCB5bygiY29tbWFuZHMiLCBHcCksIHdvKCJsYXVuY2giLCBzbygidHlwZSIsIHsKICAgIGNvbnRleHRmb3JtYnV0dG9uOiBVcCwKICAgIGNvbnRleHRmb3JtdG9nZ2xlYnV0dG9uOiBqcAogIH0pKV0uY29uY2F0KE5wKSksCiAgICAgIFlwID0gSm8oW1RvKCJ0eXBlIiwgImNvbnRleHR0b29sYmFyIiksIGdvKCJpdGVtcyIpXS5jb25jYXQoTnApKTsKCiAgZnVuY3Rpb24gcXAodCkgewogICAgcmV0dXJuIHR0KGtoLCB0KS5nZXRPcih3aCk7CiAgfQoKICBmdW5jdGlvbiBLcCh0KSB7CiAgICByZXR1cm4gewogICAgICBiYWNrZ3JvdW5kTWVudTogInRveC1iYWNrZ3JvdW5kLW1lbnUiLAogICAgICBzZWxlY3RlZE1lbnU6ICJ0b3gtc2VsZWN0ZWQtbWVudSIsCiAgICAgIHNlbGVjdGVkSXRlbTogInRveC1jb2xsZWN0aW9uX19pdGVtLS1hY3RpdmUiLAogICAgICBoYXNJY29uczogInRveC1tZW51LS1oYXMtaWNvbnMiLAogICAgICBtZW51OiAiY29sb3IiID09PSB0ID8gInRveC1zd2F0Y2hlcyIgOiAidG94LW1lbnUiLAogICAgICB0aWVyZWRNZW51OiAidG94LXRpZXJlZC1tZW51IgogICAgfTsKICB9CgogIGZ1bmN0aW9uIEpwKHQpIHsKICAgIHZhciBuID0gS3AodCk7CiAgICByZXR1cm4gewogICAgICBiYWNrZ3JvdW5kTWVudTogbi5iYWNrZ3JvdW5kTWVudSwKICAgICAgc2VsZWN0ZWRNZW51OiBuLnNlbGVjdGVkTWVudSwKICAgICAgbWVudTogbi5tZW51LAogICAgICBzZWxlY3RlZEl0ZW06IG4uc2VsZWN0ZWRJdGVtLAogICAgICBpdGVtOiBxcCh0KQogICAgfTsKICB9CgogIGZ1bmN0aW9uICRwKHQsIG4sIGUpIHsKICAgIHJldHVybiB7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogZnQoW1tLcChlKS50aWVyZWRNZW51XV0pCiAgICAgIH0sCiAgICAgIG1hcmtlcnM6IEpwKGUpCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gUXAobiwgZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBNKEIodCwgZSksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGRvbTogbiwKICAgICAgICAgIGNvbXBvbmVudHM6IHQKICAgICAgICB9OwogICAgICB9KTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBacCh0LCBlKSB7CiAgICB2YXIgbyA9IFtdLAogICAgICAgIHIgPSBbXTsKICAgIHJldHVybiBTdCh0LCBmdW5jdGlvbiAodCwgbikgewogICAgICBlKHQsIG4pID8gKDAgPCByLmxlbmd0aCAmJiBvLnB1c2gociksIHIgPSBbXSwgVHQodC5kb20sICJpbm5lckh0bWwiKSAmJiByLnB1c2godCkpIDogci5wdXNoKHQpOwogICAgfSksIDAgPCByLmxlbmd0aCAmJiBvLnB1c2gociksIE0obywgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1jb2xsZWN0aW9uX19ncm91cCJdCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiB0CiAgICAgIH07CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHRoKG4sIGUpIHsKICAgIHJldHVybiB7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtbWVudSIsICJ0b3gtY29sbGVjdGlvbiJdLmNvbmNhdCgxID09PSBuID8gWyJ0b3gtY29sbGVjdGlvbi0tbGlzdCJdIDogWyJ0b3gtY29sbGVjdGlvbi0tZ3JpZCJdKQogICAgICB9LAogICAgICBjb21wb25lbnRzOiBbUWcucGFydHMuaXRlbXMoewogICAgICAgIHByZXByb2Nlc3M6IGZ1bmN0aW9uIHByZXByb2Nlc3ModCkgewogICAgICAgICAgcmV0dXJuICJhdXRvIiAhPT0gbiAmJiAxIDwgbiA/IFFwKHsKICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgY2xhc3NlczogWyJ0b3gtY29sbGVjdGlvbl9fZ3JvdXAiXQogICAgICAgICAgfSwgbikodCkgOiBacCh0LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICByZXR1cm4gInNlcGFyYXRvciIgPT09IGVbbl0udHlwZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSldCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gbmgodCkgewogICAgcmV0dXJuIFQodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuICJpY29uIiBpbiB0ICYmIHZvaWQgMCAhPT0gdC5pY29uOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBlaCh0KSB7CiAgICByZXR1cm4gY29uc29sZS5lcnJvcihpcih0KSksIGNvbnNvbGUubG9nKHQpLCB2dC5ub25lKCk7CiAgfQoKICBmdW5jdGlvbiBvaCh0LCBuLCBlLCBvLCByKSB7CiAgICB2YXIgaSwKICAgICAgICB1ID0gKGkgPSBlLCB7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtY29sbGVjdGlvbiIsICJ0b3gtY29sbGVjdGlvbi0taG9yaXpvbnRhbCJdCiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IFtRZy5wYXJ0cy5pdGVtcyh7CiAgICAgICAgcHJlcHJvY2VzczogZnVuY3Rpb24gcHJlcHJvY2Vzcyh0KSB7CiAgICAgICAgICByZXR1cm4gWnAodCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgcmV0dXJuICJzZXBhcmF0b3IiID09PSBpW25dLnR5cGU7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pXQogICAgfSk7CiAgICByZXR1cm4gewogICAgICB2YWx1ZTogdCwKICAgICAgZG9tOiB1LmRvbSwKICAgICAgY29tcG9uZW50czogdS5jb21wb25lbnRzLAogICAgICBpdGVtczogZQogICAgfTsKICB9CgogIGZ1bmN0aW9uIHJoKHQsIG4sIGUsIG8sIHIpIHsKICAgIHZhciBpLCB1OwogICAgcmV0dXJuICJjb2xvciIgPT09IHIgPyB7CiAgICAgIHZhbHVlOiB0LAogICAgICBkb206IChpID0gewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LW1lbnUiLCAidG94LXN3YXRjaGVzLW1lbnUiXQogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogW3sKICAgICAgICAgIGRvbTogewogICAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgICBjbGFzc2VzOiBbInRveC1zd2F0Y2hlcyJdCiAgICAgICAgICB9LAogICAgICAgICAgY29tcG9uZW50czogW1FnLnBhcnRzLml0ZW1zKHsKICAgICAgICAgICAgcHJlcHJvY2VzczogImF1dG8iICE9PSBvID8gUXAoewogICAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgICAgY2xhc3NlczogWyJ0b3gtc3dhdGNoZXNfX3JvdyJdCiAgICAgICAgICAgIH0sIG8pIDogaAogICAgICAgICAgfSldCiAgICAgICAgfV0KICAgICAgfSkuZG9tLAogICAgICBjb21wb25lbnRzOiBpLmNvbXBvbmVudHMsCiAgICAgIGl0ZW1zOiBlCiAgICB9IDogIm5vcm1hbCIgPT09IHIgJiYgImF1dG8iID09PSBvID8gewogICAgICB2YWx1ZTogdCwKICAgICAgZG9tOiAoaSA9IHRoKG8sIGUpKS5kb20sCiAgICAgIGNvbXBvbmVudHM6IGkuY29tcG9uZW50cywKICAgICAgaXRlbXM6IGUKICAgIH0gOiAibm9ybWFsIiA9PT0gciAmJiAxID09PSBvID8gewogICAgICB2YWx1ZTogdCwKICAgICAgZG9tOiAoaSA9IHRoKDEsIGUpKS5kb20sCiAgICAgIGNvbXBvbmVudHM6IGkuY29tcG9uZW50cywKICAgICAgaXRlbXM6IGUKICAgIH0gOiAibm9ybWFsIiA9PT0gciA/IHsKICAgICAgdmFsdWU6IHQsCiAgICAgIGRvbTogKGkgPSB0aChvLCBlKSkuZG9tLAogICAgICBjb21wb25lbnRzOiBpLmNvbXBvbmVudHMsCiAgICAgIGl0ZW1zOiBlCiAgICB9IDogImxpc3RwcmV2aWV3IiAhPT0gciB8fCAiYXV0byIgPT09IG8gPyB7CiAgICAgIHZhbHVlOiB0LAogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IGZ0KFtbKHUgPSBLcChyKSkubWVudSwgInRveC1tZW51LSIgKyBvICsgIi1jb2x1bW4iXSwgbiA/IFt1Lmhhc0ljb25zXSA6IFtdXSkKICAgICAgfSwKICAgICAgY29tcG9uZW50czogQWgsCiAgICAgIGl0ZW1zOiBlCiAgICB9IDogewogICAgICB2YWx1ZTogdCwKICAgICAgZG9tOiAoaSA9IHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1tZW51IiwgInRveC1jb2xsZWN0aW9uIiwgInRveC1jb2xsZWN0aW9uLS10b29sYmFyIiwgInRveC1jb2xsZWN0aW9uLS10b29sYmFyLWxnIl0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IFtRZy5wYXJ0cy5pdGVtcyh7CiAgICAgICAgICBwcmVwcm9jZXNzOiBRcCh7CiAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgIGNsYXNzZXM6IFsidG94LWNvbGxlY3Rpb25fX2dyb3VwIl0KICAgICAgICAgIH0sIG8pCiAgICAgICAgfSldCiAgICAgIH0pLmRvbSwKICAgICAgY29tcG9uZW50czogaS5jb21wb25lbnRzLAogICAgICBpdGVtczogZQogICAgfTsKICB9CgogIGZ1bmN0aW9uIGloKHQsIG8sIG4pIHsKICAgIHZhciByID0gcHModC5lbGVtZW50LCAiLiIgKyBuKTsKCiAgICBpZiAoMCA8IHIubGVuZ3RoKSB7CiAgICAgIHZhciBlID0gUChyLCBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBuID0gdC5kb20uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wLAogICAgICAgICAgICBlID0gclswXS5kb20uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wOwogICAgICAgIHJldHVybiBNYXRoLmFicyhuIC0gZSkgPiBvOwogICAgICB9KS5nZXRPcihyLmxlbmd0aCk7CiAgICAgIHJldHVybiB2dC5zb21lKHsKICAgICAgICBudW1Db2x1bW5zOiBlLAogICAgICAgIG51bVJvd3M6IE1hdGguY2VpbChyLmxlbmd0aCAvIGUpCiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiB2dC5ub25lKCk7CiAgfQoKICBmdW5jdGlvbiB1aCh0LCBuLCBlKSB7CiAgICB0LmdldFN5c3RlbSgpLmJyb2FkY2FzdE9uKFtxaF0sIHt9KTsKICB9CgogIGZ1bmN0aW9uIGFoKHQpIHsKICAgIHJldHVybiB0LmdldFBhcmFtKCJoZWlnaHQiLCBNYXRoLm1heCh0LmdldEVsZW1lbnQoKS5vZmZzZXRIZWlnaHQsIDIwMCkpOwogIH0KCiAgZnVuY3Rpb24gY2godCkgewogICAgcmV0dXJuIHQuZ2V0UGFyYW0oIndpZHRoIiwgdHYuRE9NLmdldFN0eWxlKHQuZ2V0RWxlbWVudCgpLCAid2lkdGgiKSk7CiAgfQoKICBmdW5jdGlvbiBzaCh0KSB7CiAgICByZXR1cm4gdnQuZnJvbSh0LmdldFBhcmFtKCJtaW5fd2lkdGgiKSkuZmlsdGVyKHUpOwogIH0KCiAgZnVuY3Rpb24gbGgodCkgewogICAgcmV0dXJuIHZ0LmZyb20odC5nZXRQYXJhbSgibWluX2hlaWdodCIpKS5maWx0ZXIodSk7CiAgfQoKICBmdW5jdGlvbiBmaCh0KSB7CiAgICByZXR1cm4gdnQuZnJvbSh0LmdldFBhcmFtKCJtYXhfd2lkdGgiKSkuZmlsdGVyKHUpOwogIH0KCiAgZnVuY3Rpb24gZGgodCkgewogICAgcmV0dXJuIHZ0LmZyb20odC5nZXRQYXJhbSgibWF4X2hlaWdodCIpKS5maWx0ZXIodSk7CiAgfQoKICBmdW5jdGlvbiBtaCh0KSB7CiAgICByZXR1cm4gITEgIT09IHQuZ2V0UGFyYW0oIm1lbnViYXIiLCAhMCwgImJvb2xlYW4iKTsKICB9CgogIGZ1bmN0aW9uIGdoKHQpIHsKICAgIHZhciBuID0gdC5nZXRQYXJhbSgidG9vbGJhciIsICEwKSwKICAgICAgICBlID0gITAgPT09IG4sCiAgICAgICAgbyA9IHkobiksCiAgICAgICAgciA9IGMobikgJiYgMCA8IG4ubGVuZ3RoOwogICAgcmV0dXJuICFldih0KSAmJiAociB8fCBvIHx8IGUpOwogIH0KCiAgZnVuY3Rpb24gcGgobikgewogICAgdmFyIHQgPSBGKEQoOSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIG4uZ2V0UGFyYW0oInRvb2xiYXIiICsgKHQgKyAxKSwgITEsICJzdHJpbmciKTsKICAgIH0pLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIHQ7CiAgICB9KTsKICAgIHJldHVybiAwIDwgdC5sZW5ndGggPyB2dC5zb21lKHQpIDogdnQubm9uZSgpOwogIH0KCiAgKFRwID0gX3AgPSB7fSlbVHAuQ0xPU0VfT05fRVhFQ1VURSA9IDBdID0gIkNMT1NFX09OX0VYRUNVVEUiLCBUcFtUcC5CVUJCTEVfVE9fU0FOREJPWCA9IDFdID0gIkJVQkJMRV9UT19TQU5EQk9YIjsKCiAgdmFyIGhoLAogICAgICB2aCwKICAgICAgYmgsCiAgICAgIHloLAogICAgICB4aCA9IF9wLAogICAgICB3aCA9ICJ0b3gtbWVudS1uYXZfX2pzIiwKICAgICAgU2ggPSAidG94LWNvbGxlY3Rpb25fX2l0ZW0iLAogICAgICBDaCA9ICJ0b3gtc3dhdGNoIiwKICAgICAga2ggPSB7CiAgICBub3JtYWw6IHdoLAogICAgY29sb3I6IENoCiAgfSwKICAgICAgT2ggPSAidG94LWNvbGxlY3Rpb25fX2l0ZW0tLWVuYWJsZWQiLAogICAgICBfaCA9ICJ0b3gtY29sbGVjdGlvbl9faXRlbS1pY29uIiwKICAgICAgVGggPSAidG94LWNvbGxlY3Rpb25fX2l0ZW0tbGFiZWwiLAogICAgICBFaCA9ICJ0b3gtY29sbGVjdGlvbl9faXRlbS1jYXJldCIsCiAgICAgIERoID0gInRveC1jb2xsZWN0aW9uX19pdGVtLS1hY3RpdmUiLAogICAgICBCaCA9ICJ0b3gtY29sbGVjdGlvbl9faXRlbS1jb250YWluZXIiLAogICAgICBNaCA9ICJ0b3gtY29sbGVjdGlvbl9faXRlbS1jb250YWluZXItLXJvdyIsCiAgICAgIEFoID0gW1FnLnBhcnRzLml0ZW1zKHt9KV0sCiAgICAgIEZoID0gW2dvKCJ0eXBlIiksIGdvKCJzcmMiKSwgQ28oImFsdCIpLCBJbygiY2xhc3NlcyIsIFtdLCB0cildLAogICAgICBJaCA9IEpvKEZoKSwKICAgICAgUmggPSBbZ28oInR5cGUiKSwgZ28oInRleHQiKSwgQ28oIm5hbWUiKSwgSW8oImNsYXNzZXMiLCBbInRveC1jb2xsZWN0aW9uX19pdGVtLWxhYmVsIl0sIHRyKV0sCiAgICAgIFZoID0gSm8oUmgpLAogICAgICBQaCA9IFFlKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBvbygidHlwZSIsIHsKICAgICAgY2FyZGltYWdlOiBJaCwKICAgICAgY2FyZHRleHQ6IFZoLAogICAgICBjYXJkY29udGFpbmVyOiBIaAogICAgfSk7CiAgfSksCiAgICAgIEhoID0gSm8oW2dvKCJ0eXBlIiksIEJvKCJkaXJlY3Rpb24iLCAiaG9yaXpvbnRhbCIpLCBCbygiYWxpZ24iLCAibGVmdCIpLCBCbygidmFsaWduIiwgIm1pZGRsZSIpLCB5bygiaXRlbXMiLCBQaCldKSwKICAgICAgemggPSBbQW8oImRpc2FibGVkIiwgITEpLCBDbygidGV4dCIpLCBDbygic2hvcnRjdXQiKSwgdXIoInZhbHVlIiwgInZhbHVlIiwgVWUoZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIEZyKCJtZW51aXRlbS12YWx1ZSIpOwogIH0pLCBRbygpKSwgVG8oIm1ldGEiLCB7fSldLAogICAgICBOaCA9IEpvKFtnbygidHlwZSIpLCBDbygibGFiZWwiKSwgeW8oIml0ZW1zIiwgUGgpLCBGbygib25TZXR1cCIsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBzdDsKICB9KSwgRm8oIm9uQWN0aW9uIiwgc3QpXS5jb25jYXQoemgpKSwKICAgICAgTGggPSBKbyhbZ28oInR5cGUiKSwgQW8oImFjdGl2ZSIsICExKSwgQ28oImljb24iKV0uY29uY2F0KHpoKSksCiAgICAgIFdoID0gW2dvKCJ0eXBlIiksIGdvKCJmYW5jeXR5cGUiKSwgRm8oIm9uQWN0aW9uIiwgc3QpXSwKICAgICAgVWggPSBzbygiZmFuY3l0eXBlIiwgewogICAgaW5zZXJ0dGFibGU6IFtUbygiaW5pdERhdGEiLCB7fSldLmNvbmNhdChXaCksCiAgICBjb2xvcnN3YXRjaDogW1JvKCJpbml0RGF0YSIsIHt9LCBbQW8oImFsbG93Q3VzdG9tQ29sb3JzIiwgITApLCBPbygiY29sb3JzIiwgUW8oKSldKV0uY29uY2F0KFdoKQogIH0pLAogICAgICBqaCA9IEpvKFtnbygidHlwZSIpLCBGbygib25TZXR1cCIsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBzdDsKICB9KSwgRm8oIm9uQWN0aW9uIiwgc3QpLCBDbygiaWNvbiIpXS5jb25jYXQoemgpKSwKICAgICAgR2ggPSBKbyhbZ28oInR5cGUiKSwgaG8oImdldFN1Ym1lbnVJdGVtcyIpLCBGbygib25TZXR1cCIsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBzdDsKICB9KSwgQ28oImljb24iKV0uY29uY2F0KHpoKSksCiAgICAgIFhoID0gSm8oW2dvKCJ0eXBlIiksIENvKCJpY29uIiksIEFvKCJhY3RpdmUiLCAhMSksIEZvKCJvblNldHVwIiwgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHN0OwogIH0pLCBobygib25BY3Rpb24iKV0uY29uY2F0KHpoKSksCiAgICAgIFloID0gZnVuY3Rpb24gWWgodCkgewogICAgcmV0dXJuIG4gPSBGcigidW5uYW1lZC1ldmVudHMiKSwgdGMoW2ZtKG4sIHQpXSk7CiAgICB2YXIgbjsKICB9LAogICAgICBxaCA9IEZyKCJ0b29sdGlwLmV4Y2x1c2l2ZSIpLAogICAgICBLaCA9IEZyKCJ0b29sdGlwLnNob3ciKSwKICAgICAgSmggPSBGcigidG9vbHRpcC5oaWRlIiksCiAgICAgICRoID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBoaWRlQWxsRXhjbHVzaXZlOiB1aCwKICAgIHNldENvbXBvbmVudHM6IGZ1bmN0aW9uIHNldENvbXBvbmVudHModCwgbiwgZSwgbykgewogICAgICBlLmdldFRvb2x0aXAoKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdC5nZXRTeXN0ZW0oKS5pc0Nvbm5lY3RlZCgpICYmIEZnLnNldCh0LCBvKTsKICAgICAgfSk7CiAgICB9CiAgfSksCiAgICAgIFFoID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBldmVudHM6IGZ1bmN0aW9uIGV2ZW50cyhyLCBpKSB7CiAgICAgIGZ1bmN0aW9uIGUobikgewogICAgICAgIGkuZ2V0VG9vbHRpcCgpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIFZzKHQpLCByLm9uSGlkZShuLCB0KSwgaS5jbGVhclRvb2x0aXAoKTsKICAgICAgICB9KSwgaS5jbGVhclRpbWVyKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBudShmdChbW0NyKEtoLCBmdW5jdGlvbiAobykgewogICAgICAgIGkucmVzZXRUaW1lcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdCwKICAgICAgICAgICAgICBuLAogICAgICAgICAgICAgIGUgPSBvOwogICAgICAgICAgaS5pc1Nob3dpbmcoKSB8fCAodWgoZSksIHQgPSByLmxhenlTaW5rKGUpLmdldE9yRGllKCksIG4gPSBlLmdldFN5c3RlbSgpLmJ1aWxkKHsKICAgICAgICAgICAgZG9tOiByLnRvb2x0aXBEb20sCiAgICAgICAgICAgIGNvbXBvbmVudHM6IHIudG9vbHRpcENvbXBvbmVudHMsCiAgICAgICAgICAgIGV2ZW50czogbnUoIm5vcm1hbCIgPT09IHIubW9kZSA/IFtDcihoaSgpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIGhyKGUsIEtoKTsKICAgICAgICAgICAgfSksIENyKGdpKCksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgaHIoZSwgSmgpOwogICAgICAgICAgICB9KV0gOiBbXSksCiAgICAgICAgICAgIGJlaGF2aW91cnM6IHRjKFtGZy5jb25maWcoe30pXSkKICAgICAgICAgIH0pLCBpLnNldFRvb2x0aXAobiksIElzKHQsIG4pLCByLm9uU2hvdyhlLCBuKSwgc2YucG9zaXRpb24odCwgbiwgewogICAgICAgICAgICBhbmNob3I6IHIuYW5jaG9yKGUpCiAgICAgICAgICB9KSk7CiAgICAgICAgfSwgci5kZWxheSk7CiAgICAgIH0pLCBDcihKaCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICBpLnJlc2V0VGltZXIoZnVuY3Rpb24gKCkgewogICAgICAgICAgZSh0KTsKICAgICAgICB9LCByLmRlbGF5KTsKICAgICAgfSksIENyKEFpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgbi51bml2ZXJzYWwgfHwgd3Qobi5jaGFubmVscywgcWgpICYmIGUodCk7CiAgICAgIH0pLCBvdShmdW5jdGlvbiAodCkgewogICAgICAgIGUodCk7CiAgICAgIH0pXSwgIm5vcm1hbCIgPT09IHIubW9kZSA/IFtDcih2aSgpLCBmdW5jdGlvbiAodCkgewogICAgICAgIGhyKHQsIEtoKTsKICAgICAgfSksIENyKEJpKCksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaHIodCwgSmgpOwogICAgICB9KSwgQ3IoaGkoKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICBocih0LCBLaCk7CiAgICAgIH0pLCBDcihnaSgpLCBmdW5jdGlvbiAodCkgewogICAgICAgIGhyKHQsIEpoKTsKICAgICAgfSldIDogW0NyKFFpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgaHIodCwgS2gpOwogICAgICB9KSwgQ3IoWmkoKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICBocih0LCBKaCk7CiAgICAgIH0pXV0pKTsKICAgIH0KICB9KSwKICAgICAgWmggPSB5YSh7CiAgICBmaWVsZHM6IFtmbygibGF6eVNpbmsiKSwgZm8oInRvb2x0aXBEb20iKSwgVG8oImV4Y2x1c2l2ZSIsICEwKSwgVG8oInRvb2x0aXBDb21wb25lbnRzIiwgW10pLCBUbygiZGVsYXkiLCAzMDApLCBNbygibW9kZSIsICJub3JtYWwiLCBbIm5vcm1hbCIsICJmb2xsb3ctaGlnaGxpZ2h0Il0pLCBUbygiYW5jaG9yIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAiaG90c3BvdCIsCiAgICAgICAgaG90c3BvdDogdCwKICAgICAgICBsYXlvdXRzOiB7CiAgICAgICAgICBvbkx0cjogcnQoW0phLCBLYSwgR2EsIFlhLCBYYSwgcWFdKSwKICAgICAgICAgIG9uUnRsOiBydChbSmEsIEthLCBHYSwgWWEsIFhhLCBxYV0pCiAgICAgICAgfQogICAgICB9OwogICAgfSksIEt1KCJvbkhpZGUiKSwgS3UoIm9uU2hvdyIpXSwKICAgIG5hbWU6ICJ0b29sdGlwcGluZyIsCiAgICBhY3RpdmU6IFFoLAogICAgc3RhdGU6IE9iamVjdC5mcmVlemUoewogICAgICBfX3Byb3RvX186IG51bGwsCiAgICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgZnVuY3Rpb24gZSgpIHsKICAgICAgICAgIG8ub24oY2xlYXJUaW1lb3V0KTsKICAgICAgICB9CgogICAgICAgIHZhciBvID0gZGMoKSwKICAgICAgICAgICAgdCA9IGRjKCksCiAgICAgICAgICAgIG4gPSBydCgibm90LWltcGxlbWVudGVkIik7CiAgICAgICAgcmV0dXJuIHh1KHsKICAgICAgICAgIGdldFRvb2x0aXA6IHQuZ2V0LAogICAgICAgICAgaXNTaG93aW5nOiB0LmlzU2V0LAogICAgICAgICAgc2V0VG9vbHRpcDogdC5zZXQsCiAgICAgICAgICBjbGVhclRvb2x0aXA6IHQuY2xlYXIsCiAgICAgICAgICBjbGVhclRpbWVyOiBlLAogICAgICAgICAgcmVzZXRUaW1lcjogZnVuY3Rpb24gcmVzZXRUaW1lcih0LCBuKSB7CiAgICAgICAgICAgIGUoKSwgby5zZXQoc2V0VGltZW91dCh0LCBuKSk7CiAgICAgICAgICB9LAogICAgICAgICAgcmVhZFN0YXRlOiBuCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pLAogICAgYXBpczogJGgKICB9KSwKICAgICAgdHYgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgidGlueW1jZS5kb20uRE9NVXRpbHMiKSwKICAgICAgbnYgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgidGlueW1jZS5FZGl0b3JNYW5hZ2VyIiksCiAgICAgIGV2ID0gZnVuY3Rpb24gZXYodCkgewogICAgcmV0dXJuIHBoKHQpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gMCA8IHQuZ2V0UGFyYW0oInRvb2xiYXIiLCBbXSwgInN0cmluZ1tdIikubGVuZ3RoOwogICAgfSwgXyk7CiAgfTsKCiAgZnVuY3Rpb24gb3YodCkgewogICAgcmV0dXJuIHQuZ2V0UGFyYW0oInRvb2xiYXJfbW9kZSIsICIiLCAic3RyaW5nIik7CiAgfQoKICBmdW5jdGlvbiBydih0KSB7CiAgICByZXR1cm4gdC5nZXRQYXJhbSgidG9vbGJhcl9sb2NhdGlvbiIsIGJoLmF1dG8sICJzdHJpbmciKTsKICB9CgogIGZ1bmN0aW9uIGl2KHQpIHsKICAgIHJldHVybiBydih0KSA9PT0gYmguYm90dG9tOwogIH0KCiAgZnVuY3Rpb24gdXYodCkgewogICAgaWYgKCF0LmlubGluZSkgcmV0dXJuIHZ0Lm5vbmUoKTsKICAgIHZhciBuID0gdC5nZXRQYXJhbSgiZml4ZWRfdG9vbGJhcl9jb250YWluZXIiLCAiIiwgInN0cmluZyIpOwogICAgaWYgKDAgPCBuLmxlbmd0aCkgcmV0dXJuIEZ1KHZlKCksIG4pOwogICAgdmFyIGUgPSB0LmdldFBhcmFtKCJmaXhlZF90b29sYmFyX2NvbnRhaW5lcl90YXJnZXQiKTsKICAgIHJldHVybiBkKGUpID8gdnQuc29tZShBdC5mcm9tRG9tKGUpKSA6IHZ0Lm5vbmUoKTsKICB9CgogIGZ1bmN0aW9uIGF2KHQpIHsKICAgIHJldHVybiB0LmlubGluZSAmJiB1dih0KS5pc1NvbWUoKTsKICB9CgogIGZ1bmN0aW9uIGN2KHQpIHsKICAgIHJldHVybiB1dih0KS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRuKG1lKEF0LmZyb21Eb20odC5nZXRFbGVtZW50KCkpKSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHN2KHQpIHsKICAgIHJldHVybiB0LmlubGluZSAmJiAhbWgodCkgJiYgIWdoKHQpICYmICFldih0KTsKICB9CgogIGZ1bmN0aW9uIGx2KHQpIHsKICAgIHJldHVybiAodC5nZXRQYXJhbSgidG9vbGJhcl9zdGlja3kiLCAhMSwgImJvb2xlYW4iKSB8fCB0LmlubGluZSkgJiYgIWF2KHQpICYmICFzdih0KTsKICB9CgogIGZ1bmN0aW9uIGZ2KHQsIG4pIHsKICAgIHZhciBlID0gdC5vdXRlckNvbnRhaW5lci5lbGVtZW50OwogICAgbiAmJiAodC5tb3RoZXJzaGlwLmJyb2FkY2FzdE9uKFt2ZigpXSwgewogICAgICB0YXJnZXQ6IGUKICAgIH0pLCB0LnVpTW90aGVyc2hpcC5icm9hZGNhc3RPbihbdmYoKV0sIHsKICAgICAgdGFyZ2V0OiBlCiAgICB9KSksIHQubW90aGVyc2hpcC5icm9hZGNhc3RPbihbWXZdLCB7CiAgICAgIHJlYWRvbmx5OiBuCiAgICB9KSwgdC51aU1vdGhlcnNoaXAuYnJvYWRjYXN0T24oW1l2XSwgewogICAgICByZWFkb25seTogbgogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBkdih0LCBuKSB7CiAgICB0Lm9uKCJpbml0IiwgZnVuY3Rpb24gKCkgewogICAgICB0Lm1vZGUuaXNSZWFkT25seSgpICYmIGZ2KG4sICEwKTsKICAgIH0pLCB0Lm9uKCJTd2l0Y2hNb2RlIiwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gZnYobiwgdC5tb2RlLmlzUmVhZE9ubHkoKSk7CiAgICB9KSwgdC5nZXRQYXJhbSgicmVhZG9ubHkiLCAhMSwgImJvb2xlYW4iKSAmJiB0LnNldE1vZGUoInJlYWRvbmx5Iik7CiAgfQoKICBmdW5jdGlvbiBtdigpIHsKICAgIHZhciB0OwogICAgcmV0dXJuIHJjLmNvbmZpZyh7CiAgICAgIGNoYW5uZWxzOiAoKHQgPSB7fSlbWXZdID0gewogICAgICAgIHNjaGVtYTogcXYsCiAgICAgICAgb25SZWNlaXZlOiBmdW5jdGlvbiBvblJlY2VpdmUodCwgbikgewogICAgICAgICAgZGQuc2V0KHQsIG4ucmVhZG9ubHkpOwogICAgICAgIH0KICAgICAgfSwgdCkKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZ3YodCwgbikgewogICAgdmFyIGUgPSB0LmdldEFwaShuKTsKICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICB0KGUpOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIHB2KGUsIG8pIHsKICAgIHJldHVybiBldShmdW5jdGlvbiAodCkgewogICAgICBndihlLCB0KShmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBuID0gZS5vblNldHVwKHQpOwogICAgICAgIG0obikgJiYgby5zZXQobik7CiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBodihuLCBlKSB7CiAgICByZXR1cm4gb3UoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIGd2KG4sIHQpKGUuZ2V0KCkpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB2dih0LCBuLCBlLCBvKSB7CiAgICB2YXIgciwKICAgICAgICBpLAogICAgICAgIHUgPSBWbyhzdCk7CiAgICByZXR1cm4gewogICAgICB0eXBlOiAiaXRlbSIsCiAgICAgIGRvbTogbi5kb20sCiAgICAgIGNvbXBvbmVudHM6IFF2KG4ub3B0Q29tcG9uZW50cyksCiAgICAgIGRhdGE6IHQuZGF0YSwKICAgICAgZXZlbnRPcmRlcjogJHYsCiAgICAgIGhhc1N1Ym1lbnU6IHQudHJpZ2dlcnNTdWJtZW51LAogICAgICBpdGVtQmVoYXZpb3VyczogdGMoW2ZtKCJpdGVtLWV2ZW50cyIsIFsociA9IHQsIGkgPSBlLCBpdShmdW5jdGlvbiAodCwgbikgewogICAgICAgIGd2KHIsIHQpKHIub25BY3Rpb24pLCByLnRyaWdnZXJzU3VibWVudSB8fCBpICE9PSB4aC5DTE9TRV9PTl9FWEVDVVRFIHx8IChocih0LCBQaSgpKSwgbi5zdG9wKCkpOwogICAgICB9KSksIHB2KHQsIHUpLCBodih0LCB1KV0pLCBkZC5jb25maWcoewogICAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiBkaXNhYmxlZCgpIHsKICAgICAgICAgIHJldHVybiB0LmRpc2FibGVkIHx8IG8uaXNEaXNhYmxlZCgpOwogICAgICAgIH0sCiAgICAgICAgZGlzYWJsZUNsYXNzOiAidG94LWNvbGxlY3Rpb25fX2l0ZW0tLXN0YXRlLWRpc2FibGVkIgogICAgICB9KSwgbXYoKSwgRmcuY29uZmlnKHt9KV0uY29uY2F0KHQuaXRlbUJlaGF2aW91cnMpKQogICAgfTsKICB9CgogIGZ1bmN0aW9uIGJ2KHQpIHsKICAgIHJldHVybiB7CiAgICAgIHZhbHVlOiB0LnZhbHVlLAogICAgICBtZXRhOiBfbHQoewogICAgICAgIHRleHQ6IHQudGV4dC5nZXRPcigiIikKICAgICAgfSwgdC5tZXRhKQogICAgfTsKICB9CgogIGZ1bmN0aW9uIHl2KHQsIG4sIGUpIHsKICAgIHJldHVybiBqbSh0LCB7CiAgICAgIHRhZzogImRpdiIsCiAgICAgIGNsYXNzZXM6IGUgPSB2b2lkIDAgPT09IGUgPyBbX2hdIDogZQogICAgfSwgbik7CiAgfQoKICBmdW5jdGlvbiB4dih0KSB7CiAgICByZXR1cm4gewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFtUaF0KICAgICAgfSwKICAgICAgY29tcG9uZW50czogW29pKGxwLnRyYW5zbGF0ZSh0KSldCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gd3YodCwgbikgewogICAgcmV0dXJuIHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBuLAogICAgICAgIGlubmVySHRtbDogdAogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gU3YodCwgbikgewogICAgcmV0dXJuIHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbVGhdCiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IFt7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6IHQudGFnLAogICAgICAgICAgc3R5bGVzOiB0LnN0eWxlcwogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogW29pKGxwLnRyYW5zbGF0ZShuKSldCiAgICAgIH1dCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gQ3YodCkgewogICAgcmV0dXJuIHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbInRveC1jb2xsZWN0aW9uX19pdGVtLWFjY2Vzc29yeSJdLAogICAgICAgIGlubmVySHRtbDogKGUgPSBadi5tYWMgPyB7CiAgICAgICAgICBhbHQ6ICImI3gyMzI1OyIsCiAgICAgICAgICBjdHJsOiAiJiN4MjMwMzsiLAogICAgICAgICAgc2hpZnQ6ICImI3gyMUU3OyIsCiAgICAgICAgICBtZXRhOiAiJiN4MjMxODsiLAogICAgICAgICAgYWNjZXNzOiAiJiN4MjMwMzsmI3gyMzI1OyIKICAgICAgICB9IDogewogICAgICAgICAgbWV0YTogIkN0cmwiLAogICAgICAgICAgYWNjZXNzOiAiU2hpZnQrQWx0IgogICAgICAgIH0sIG4gPSBNKHQuc3BsaXQoIisiKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gdC50b0xvd2VyQ2FzZSgpLnRyaW0oKTsKICAgICAgICAgIHJldHVybiBUdChlLCBuKSA/IGVbbl0gOiB0OwogICAgICAgIH0pLCBadi5tYWMgPyBuLmpvaW4oIiIpIDogbi5qb2luKCIrIikpCiAgICAgIH0KICAgIH07CiAgICB2YXIgZSwgbjsKICB9CgogIGZ1bmN0aW9uIGt2KHQpIHsKICAgIHJldHVybiB5digiY2hlY2ttYXJrIiwgdCwgWyJ0b3gtY29sbGVjdGlvbl9faXRlbS1jaGVja21hcmsiXSk7CiAgfQoKICBmdW5jdGlvbiBPdih0KSB7CiAgICB2YXIgbiA9IHQubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgdGl0bGU6IGxwLnRyYW5zbGF0ZSh0KQogICAgICAgIH0KICAgICAgfTsKICAgIH0pLmdldE9yKHt9KTsKICAgIHJldHVybiBfbHQoewogICAgICB0YWc6ICJkaXYiLAogICAgICBjbGFzc2VzOiBbd2gsIFNoXQogICAgfSwgbik7CiAgfQoKICBmdW5jdGlvbiBfdih0LCBuLCBlLCBvKSB7CiAgICByZXR1cm4gdm9pZCAwID09PSBvICYmIChvID0gdnQubm9uZSgpKSwgImNvbG9yIiA9PT0gdC5wcmVzZXRzID8gKHIgPSBuLCBpID0gbywgYyA9IHQuYXJpYUxhYmVsLCBzID0gdC52YWx1ZSwgewogICAgICBkb206ICh1ID0gdC5pY29uQ29udGVudC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gbiA9IHIuaWNvbnMsIGUgPSBpLCBObSh0LCBvID0gbigpKS5vcihlKS5nZXRPclRodW5rKEhtKG8pKTsKICAgICAgICB2YXIgbiwgZSwgbzsKICAgICAgfSkuZ2V0T3IoIiIpLCBhID0gewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgYXR0cmlidXRlczogYy5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRpdGxlOiByLnRyYW5zbGF0ZSh0KQogICAgICAgICAgfTsKICAgICAgICB9KS5nZXRPcih7fSksCiAgICAgICAgY2xhc3NlczogWyJ0b3gtc3dhdGNoIl0KICAgICAgfSwgX2x0KF9sdCh7fSwgYSksICJjdXN0b20iID09PSBzID8gewogICAgICAgIHRhZzogImJ1dHRvbiIsCiAgICAgICAgY2xhc3NlczogSChIKFtdLCBhLmNsYXNzZXMsICEwKSwgWyJ0b3gtc3dhdGNoZXNfX3BpY2tlci1idG4iXSwgITEpLAogICAgICAgIGlubmVySHRtbDogdQogICAgICB9IDogInJlbW92ZSIgPT09IHMgPyB7CiAgICAgICAgY2xhc3NlczogSChIKFtdLCBhLmNsYXNzZXMsICEwKSwgWyJ0b3gtc3dhdGNoLS1yZW1vdmUiXSwgITEpLAogICAgICAgIGlubmVySHRtbDogdQogICAgICB9IDogewogICAgICAgIGF0dHJpYnV0ZXM6IF9sdChfbHQoe30sIGEuYXR0cmlidXRlcyksIHsKICAgICAgICAgICJkYXRhLW1jZS1jb2xvciI6IHMKICAgICAgICB9KSwKICAgICAgICBzdHlsZXM6IHsKICAgICAgICAgICJiYWNrZ3JvdW5kLWNvbG9yIjogcwogICAgICAgIH0KICAgICAgfSkpLAogICAgICBvcHRDb21wb25lbnRzOiBbXQogICAgfSkgOiAobCA9IHQsIGYgPSBuLCBkID0gbywgbSA9IHsKICAgICAgdGFnOiAiZGl2IiwKICAgICAgY2xhc3NlczogW19oXQogICAgfSwgZyA9IGUgPyBsLmljb25Db250ZW50Lm1hcChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gam0odCwgbSwgZi5pY29ucywgZCk7CiAgICB9KS5vclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHZ0LnNvbWUoewogICAgICAgIGRvbTogbQogICAgICB9KTsKICAgIH0pIDogdnQubm9uZSgpLCBwID0gbC5jaGVja01hcmssIGggPSB2dC5mcm9tKGwubWV0YSkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB4djsKICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBUdCh0LCAic3R5bGUiKSA/IFMoU3YsIHQuc3R5bGUpIDogeHY7CiAgICB9KSwgdiA9IGwuaHRtbENvbnRlbnQuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBsLnRleHRDb250ZW50Lm1hcChoKTsKICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB2dC5zb21lKHd2KHQsIFtUaF0pKTsKICAgIH0pLCB7CiAgICAgIGRvbTogT3YobC5hcmlhTGFiZWwpLAogICAgICBvcHRDb21wb25lbnRzOiBbZywgdiwgbC5zaG9ydGN1dENvbnRlbnQubWFwKEN2KSwgcCwgbC5jYXJldF0KICAgIH0pOwogICAgdmFyIHIsIGksIHUsIGEsIGMsIHMsIGwsIGYsIGQsIG0sIGcsIHAsIGgsIHY7CiAgfQoKICBmdW5jdGlvbiBUdih0LCBuKSB7CiAgICByZXR1cm4gdHQodCwgInRvb2x0aXBXb3JrZXIiKS5tYXAoZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIFtaaC5jb25maWcoewogICAgICAgIGxhenlTaW5rOiBuLmdldFNpbmssCiAgICAgICAgdG9vbHRpcERvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LXRvb2x0aXAtd29ya2VyLWNvbnRhaW5lciJdCiAgICAgICAgfSwKICAgICAgICB0b29sdGlwQ29tcG9uZW50czogW10sCiAgICAgICAgYW5jaG9yOiBmdW5jdGlvbiBhbmNob3IodCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHlwZTogInN1Ym1lbnUiLAogICAgICAgICAgICBpdGVtOiB0LAogICAgICAgICAgICBvdmVycmlkZXM6IHsKICAgICAgICAgICAgICBtYXhIZWlnaHRGdW5jdGlvbjogSWMKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIG1vZGU6ICJmb2xsb3ctaGlnaGxpZ2h0IiwKICAgICAgICBvblNob3c6IGZ1bmN0aW9uIG9uU2hvdyhuLCB0KSB7CiAgICAgICAgICBlKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIFpoLnNldENvbXBvbmVudHMobiwgW2t1KHsKICAgICAgICAgICAgICBlbGVtZW50OiBBdC5mcm9tRG9tKHQpCiAgICAgICAgICAgIH0pXSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pXTsKICAgIH0pLmdldE9yKFtdKTsKICB9CgogIGZ1bmN0aW9uIEV2KHQsIG4pIHsKICAgIHZhciBlID0gbHAudHJhbnNsYXRlKHQpLAogICAgICAgIG8gPSB0di5ET00uZW5jb2RlKGUpOwoKICAgIGlmICgwIDwgbi5sZW5ndGgpIHsKICAgICAgdmFyIHIgPSBuZXcgUmVnRXhwKG4ucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xdXFxdL2csICJcXCQmIiksICJnaSIpOwogICAgICByZXR1cm4gby5yZXBsYWNlKHIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0idG94LWF1dG9jb21wbGV0ZXItaGlnaGxpZ2h0Ij4nICsgdCArICI8L3NwYW4+IjsKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIG87CiAgfQoKICBmdW5jdGlvbiBEdih0KSB7CiAgICByZXR1cm4gewogICAgICB2YWx1ZTogdAogICAgfTsKICB9CgogIGZ1bmN0aW9uIEJ2KHQpIHsKICAgIHJldHVybiBlYi50ZXN0KHQpIHx8IG9iLnRlc3QodCk7CiAgfQoKICBmdW5jdGlvbiBNdih0KSB7CiAgICB2YXIgbiA9IHQudG9TdHJpbmcoMTYpOwogICAgcmV0dXJuICgxID09PSBuLmxlbmd0aCA/ICIwIiArIG4gOiBuKS50b1VwcGVyQ2FzZSgpOwogIH0KCiAgZnVuY3Rpb24gQXYodCkgewogICAgcmV0dXJuIER2KE12KHQucmVkKSArIE12KHQuZ3JlZW4pICsgTXYodC5ibHVlKSk7CiAgfQoKICBmdW5jdGlvbiBGdih0LCBuLCBlLCBvKSB7CiAgICByZXR1cm4gewogICAgICByZWQ6IHQsCiAgICAgIGdyZWVuOiBuLAogICAgICBibHVlOiBlLAogICAgICBhbHBoYTogbwogICAgfTsKICB9CgogIGZ1bmN0aW9uIEl2KHQpIHsKICAgIHZhciBuID0gcGFyc2VJbnQodCwgMTApOwogICAgcmV0dXJuIG4udG9TdHJpbmcoKSA9PT0gdCAmJiAwIDw9IG4gJiYgbiA8PSAyNTU7CiAgfQoKICBmdW5jdGlvbiBSdih0KSB7CiAgICB2YXIgbiwKICAgICAgICBlLAogICAgICAgIG8sCiAgICAgICAgciA9ICh0Lmh1ZSB8fCAwKSAlIDM2MCwKICAgICAgICBpID0gdC5zYXR1cmF0aW9uIC8gMTAwLAogICAgICAgIHUgPSB0LnZhbHVlIC8gMTAwLAogICAgICAgIGkgPSBpYigwLCByYihpLCAxKSksCiAgICAgICAgdSA9IGliKDAsIHJiKHUsIDEpKTsKICAgIGlmICgwID09PSBpKSByZXR1cm4gRnYobiA9IGUgPSBvID0gdWIoMjU1ICogdSksIGUsIG8sIDEpOwogICAgdmFyIGEgPSByIC8gNjAsCiAgICAgICAgYyA9IHUgKiBpLAogICAgICAgIHMgPSBjICogKDEgLSBNYXRoLmFicyhhICUgMiAtIDEpKSwKICAgICAgICBsID0gdSAtIGM7CgogICAgc3dpdGNoIChNYXRoLmZsb29yKGEpKSB7CiAgICAgIGNhc2UgMDoKICAgICAgICBuID0gYywgZSA9IHMsIG8gPSAwOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAxOgogICAgICAgIG4gPSBzLCBlID0gYywgbyA9IDA7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDI6CiAgICAgICAgbiA9IDAsIGUgPSBjLCBvID0gczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgMzoKICAgICAgICBuID0gMCwgZSA9IHMsIG8gPSBjOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSA0OgogICAgICAgIG4gPSBzLCBlID0gMCwgbyA9IGM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlIDU6CiAgICAgICAgbiA9IGMsIGUgPSAwLCBvID0gczsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgbiA9IGUgPSBvID0gMDsKICAgIH0KCiAgICByZXR1cm4gRnYobiA9IHViKDI1NSAqIChuICsgbCkpLCBlID0gdWIoMjU1ICogKGUgKyBsKSksIG8gPSB1YigyNTUgKiAobyArIGwpKSwgMSk7CiAgfQoKICBmdW5jdGlvbiBWdih0KSB7CiAgICB2YXIgbiwKICAgICAgICBlLAogICAgICAgIG8gPSAobiA9IHsKICAgICAgdmFsdWU6IHQudmFsdWUucmVwbGFjZShlYiwgZnVuY3Rpb24gKHQsIG4sIGUsIG8pIHsKICAgICAgICByZXR1cm4gbiArIG4gKyBlICsgZSArIG8gKyBvOwogICAgICB9KQogICAgfSwgbnVsbCA9PT0gKGUgPSBvYi5leGVjKG4udmFsdWUpKSA/IFsiRkZGRkZGIiwgIkZGIiwgIkZGIiwgIkZGIl0gOiBlKTsKICAgIHJldHVybiBGdihwYXJzZUludChvWzFdLCAxNiksIHBhcnNlSW50KG9bMl0sIDE2KSwgcGFyc2VJbnQob1szXSwgMTYpLCAxKTsKICB9CgogIGZ1bmN0aW9uIFB2KHQsIG4sIGUsIG8pIHsKICAgIHJldHVybiBGdihwYXJzZUludCh0LCAxMCksIHBhcnNlSW50KG4sIDEwKSwgcGFyc2VJbnQoZSwgMTApLCBwYXJzZUZsb2F0KG8pKTsKICB9CgogIGZ1bmN0aW9uIEh2KHQpIHsKICAgIGlmICgidHJhbnNwYXJlbnQiID09PSB0KSByZXR1cm4gdnQuc29tZShGdigwLCAwLCAwLCAwKSk7CiAgICB2YXIgbiA9IGFiLmV4ZWModCk7CiAgICBpZiAobnVsbCAhPT0gbikgcmV0dXJuIHZ0LnNvbWUoUHYoblsxXSwgblsyXSwgblszXSwgIjEiKSk7CiAgICB2YXIgZSA9IGNiLmV4ZWModCk7CiAgICByZXR1cm4gbnVsbCAhPT0gZSA/IHZ0LnNvbWUoUHYoZVsxXSwgZVsyXSwgZVszXSwgZVs0XSkpIDogdnQubm9uZSgpOwogIH0KCiAgZnVuY3Rpb24genYodCkgewogICAgcmV0dXJuICJyZ2JhKCIgKyB0LnJlZCArICIsIiArIHQuZ3JlZW4gKyAiLCIgKyB0LmJsdWUgKyAiLCIgKyB0LmFscGhhICsgIikiOwogIH0KCiAgZnVuY3Rpb24gTnYodCwgbikgewogICAgcmV0dXJuIHQuZmlyZSgiUmVzaXplQ29udGVudCIsIG4pOwogIH0KCiAgZnVuY3Rpb24gTHYodCwgbiwgZSkgewogICAgcmV0dXJuIHsKICAgICAgaHVlOiB0LAogICAgICBzYXR1cmF0aW9uOiBuLAogICAgICB2YWx1ZTogZQogICAgfTsKICB9CgogIGZ1bmN0aW9uIFd2KHQpIHsKICAgIHZhciBuLAogICAgICAgIGUsCiAgICAgICAgbyA9IDAsCiAgICAgICAgciA9IHQucmVkIC8gMjU1LAogICAgICAgIGkgPSB0LmdyZWVuIC8gMjU1LAogICAgICAgIHUgPSB0LmJsdWUgLyAyNTUsCiAgICAgICAgYSA9IE1hdGgubWluKHIsIE1hdGgubWluKGksIHUpKSwKICAgICAgICBjID0gTWF0aC5tYXgociwgTWF0aC5tYXgoaSwgdSkpOwogICAgcmV0dXJuIGEgPT09IGMgPyBMdigwLCAwLCAxMDAgKiAobyA9IGEpKSA6IChlID0gNjAgKiAoKHIgPT09IGEgPyAzIDogdSA9PT0gYSA/IDEgOiA1KSAtIChyID09PSBhID8gaSAtIHUgOiB1ID09PSBhID8gciAtIGkgOiB1IC0gcikgLyAoYyAtIGEpKSwgbiA9IChjIC0gYSkgLyBjLCBvID0gYywgTHYoTWF0aC5yb3VuZChlKSwgTWF0aC5yb3VuZCgxMDAgKiBuKSwgTWF0aC5yb3VuZCgxMDAgKiBvKSkpOwogIH0KCiAgZnVuY3Rpb24gVXYodCkgewogICAgcmV0dXJuIEF2KFJ2KHQpKTsKICB9CgogIGZ1bmN0aW9uIGp2KG8pIHsKICAgIHJldHVybiAoQnYobiA9IG8pID8gdnQuc29tZSh7CiAgICAgIHZhbHVlOiAoRHQodCA9IG4sICIjIikgPyB0LnN1YnN0cmluZygiIyIubGVuZ3RoKSA6IHQpLnRvVXBwZXJDYXNlKCkKICAgIH0pIDogdnQubm9uZSgpKS5vclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIEh2KG8pLm1hcChBdik7CiAgICB9KS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgICAgdC5oZWlnaHQgPSAxLCB0LndpZHRoID0gMTsKICAgICAgdmFyIG4gPSB0LmdldENvbnRleHQoIjJkIik7CiAgICAgIG4uY2xlYXJSZWN0KDAsIDAsIHQud2lkdGgsIHQuaGVpZ2h0KSwgbi5maWxsU3R5bGUgPSAiI0ZGRkZGRiIsIG4uZmlsbFN0eWxlID0gbywgbi5maWxsUmVjdCgwLCAwLCAxLCAxKTsKICAgICAgdmFyIGUgPSBuLmdldEltYWdlRGF0YSgwLCAwLCAxLCAxKS5kYXRhOwogICAgICByZXR1cm4gQXYoRnYoZVswXSwgZVsxXSwgZVsyXSwgZVszXSkpOwogICAgfSk7CiAgICB2YXIgdCwgbjsKICB9CgogICh2aCA9IGhoID0gaGggfHwge30pLmRlZmF1bHQgPSAid3JhcCIsIHZoLmZsb2F0aW5nID0gImZsb2F0aW5nIiwgdmguc2xpZGluZyA9ICJzbGlkaW5nIiwgdmguc2Nyb2xsaW5nID0gInNjcm9sbGluZyIsICh5aCA9IGJoID0gYmggfHwge30pLmF1dG8gPSAiYXV0byIsIHloLnRvcCA9ICJ0b3AiLCB5aC5ib3R0b20gPSAiYm90dG9tIjsKCiAgZnVuY3Rpb24gR3YodCkgewogICAgcmV0dXJuIGRkLmNvbmZpZyh7CiAgICAgIGRpc2FibGVkOiB0LAogICAgICBkaXNhYmxlQ2xhc3M6ICJ0b3gtdGJ0bi0tZGlzYWJsZWQiCiAgICB9KTsKICB9CgogIHZhciBYdiwKICAgICAgWXYgPSAic2lsdmVyLnJlYWRvbmx5IiwKICAgICAgcXYgPSBKbyhbbW8oInJlYWRvbmx5IiwgbnIpXSksCiAgICAgIEt2ID0gZnVuY3Rpb24gS3YodCkgewogICAgcmV0dXJuIGRkLmNvbmZpZyh7CiAgICAgIGRpc2FibGVkOiB0CiAgICB9KTsKICB9LAogICAgICBKdiA9IGZ1bmN0aW9uIEp2KHQpIHsKICAgIHJldHVybiBkZC5jb25maWcoewogICAgICBkaXNhYmxlZDogdCwKICAgICAgZGlzYWJsZUNsYXNzOiAidG94LXRidG4tLWRpc2FibGVkIiwKICAgICAgdXNlTmF0aXZlOiAhMQogICAgfSk7CiAgfSwKICAgICAgJHYgPSAoKFh2ID0ge30pW0ZpKCldID0gWyJkaXNhYmxpbmciLCAiYWxsb3kuYmFzZS5iZWhhdmlvdXIiLCAidG9nZ2xpbmciLCAiaXRlbS1ldmVudHMiXSwgWHYpLAogICAgICBRdiA9IGV0LAogICAgICBadiA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCJ0aW55bWNlLkVudiIpLAogICAgICB0YiA9IGZ1bmN0aW9uIHRiKHQsIGEpIHsKICAgIHJldHVybiBNKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHN3aXRjaCAodC50eXBlKSB7CiAgICAgICAgY2FzZSAiY2FyZGNvbnRhaW5lciI6CiAgICAgICAgICByZXR1cm4gciA9IHRiKChvID0gdCkuaXRlbXMsIGEpLCBpID0gInZlcnRpY2FsIiA9PT0gby5kaXJlY3Rpb24gPyAidG94LWNvbGxlY3Rpb25fX2l0ZW0tY29udGFpbmVyLS1jb2x1bW4iIDogTWgsIHUgPSAibGVmdCIgPT09IG8uYWxpZ24gPyAidG94LWNvbGxlY3Rpb25fX2l0ZW0tY29udGFpbmVyLS1hbGlnbi1sZWZ0IiA6ICJ0b3gtY29sbGVjdGlvbl9faXRlbS1jb250YWluZXItLWFsaWduLXJpZ2h0IiwgewogICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgICAgIGNsYXNzZXM6IFtCaCwgaSwgdSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc3dpdGNoIChvLnZhbGlnbikgewogICAgICAgICAgICAgICAgICBjYXNlICJ0b3AiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAidG94LWNvbGxlY3Rpb25fX2l0ZW0tY29udGFpbmVyLS12YWxpZ24tdG9wIjsKCiAgICAgICAgICAgICAgICAgIGNhc2UgIm1pZGRsZSI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJ0b3gtY29sbGVjdGlvbl9faXRlbS1jb250YWluZXItLXZhbGlnbi1taWRkbGUiOwoKICAgICAgICAgICAgICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gInRveC1jb2xsZWN0aW9uX19pdGVtLWNvbnRhaW5lci0tdmFsaWduLWJvdHRvbSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSgpXQogICAgICAgICAgICB9LAogICAgICAgICAgICBjb21wb25lbnRzOiByCiAgICAgICAgICB9OwoKICAgICAgICBjYXNlICJjYXJkaW1hZ2UiOgogICAgICAgICAgcmV0dXJuIGUgPSB0LnNyYywgewogICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICB0YWc6ICJpbWciLAogICAgICAgICAgICAgIGNsYXNzZXM6IHQuY2xhc3NlcywKICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgICAgICBzcmM6IGUsCiAgICAgICAgICAgICAgICBhbHQ6IHQuYWx0LmdldE9yKCIiKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgY2FzZSAiY2FyZHRleHQiOgogICAgICAgICAgdmFyIG4gPSB0Lm5hbWUuZXhpc3RzKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB3dChhLmNhcmRUZXh0LmhpZ2hsaWdodE9uLCB0KTsKICAgICAgICAgIH0pID8gdnQuZnJvbShhLmNhcmRUZXh0Lm1hdGNoVGV4dCkuZ2V0T3IoIiIpIDogIiI7CiAgICAgICAgICByZXR1cm4gd3YoRXYodC50ZXh0LCBuKSwgdC5jbGFzc2VzKTsKICAgICAgfQoKICAgICAgdmFyIGUsIG8sIHIsIGksIHU7CiAgICB9KTsKICB9LAogICAgICBuYiA9IGlsKFhnKCksIFlnKCkpLAogICAgICBlYiA9IC9eIz8oW2EtZlxkXSkoW2EtZlxkXSkoW2EtZlxkXSkkL2ksCiAgICAgIG9iID0gL14jPyhbYS1mXGRdezJ9KShbYS1mXGRdezJ9KShbYS1mXGRdezJ9KSQvaSwKICAgICAgcmIgPSBNYXRoLm1pbiwKICAgICAgaWIgPSBNYXRoLm1heCwKICAgICAgdWIgPSBNYXRoLnJvdW5kLAogICAgICBhYiA9IC9ecmdiXCgoXGQrKSxccyooXGQrKSxccyooXGQrKVwpLywKICAgICAgY2IgPSAvXnJnYmFcKChcZCspLFxzKihcZCspLFxzKihcZCspLFxzKihcZD8oPzpcLlxkKyk/KVwpLywKICAgICAgc2IgPSBGdigyNTUsIDAsIDAsIDEpLAogICAgICBsYiA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCJ0aW55bWNlLnV0aWwuTG9jYWxTdG9yYWdlIiksCiAgICAgIGZiID0gInRpbnltY2UtY3VzdG9tLWNvbG9ycyI7CgogIGZ1bmN0aW9uIGRiKHQpIHsKICAgIHJldHVybiAhMSAhPT0gdC5nZXRQYXJhbSgiY3VzdG9tX2NvbG9ycyIpOwogIH0KCiAgZnVuY3Rpb24gbWIodCkgewogICAgdmFyIG4gPSB0LmdldFBhcmFtKCJjb2xvcl9tYXAiKTsKICAgIHJldHVybiB2b2lkIDAgIT09IG4gPyBmdW5jdGlvbiAodCkgewogICAgICBmb3IgKHZhciBuID0gW10sIGUgPSAwOyBlIDwgdC5sZW5ndGg7IGUgKz0gMikgewogICAgICAgIG4ucHVzaCh7CiAgICAgICAgICB0ZXh0OiB0W2UgKyAxXSwKICAgICAgICAgIHZhbHVlOiAiIyIgKyBqdih0W2VdKS52YWx1ZSwKICAgICAgICAgIHR5cGU6ICJjaG9pY2VpdGVtIgogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0obikgOiBFYjsKICB9CgogIGZ1bmN0aW9uIGdiKHQpIHsKICAgIERiLmFkZCh0KTsKICB9CgogIGZ1bmN0aW9uIHBiKHQpIHsKICAgIHZhciBuLAogICAgICAgIGUgPSAobiA9IG1iKHQpLmxlbmd0aCwgTWF0aC5tYXgoNSwgTWF0aC5jZWlsKE1hdGguc3FydChuKSkpKTsKICAgIHJldHVybiB0LmdldFBhcmFtKCJjb2xvcl9jb2xzIiwgZSwgIm51bWJlciIpOwogIH0KCiAgZnVuY3Rpb24gaGIodCkgewogICAgdmFyIG4gPSAiY2hvaWNlaXRlbSIsCiAgICAgICAgZSA9IHsKICAgICAgdHlwZTogbiwKICAgICAgdGV4dDogIlJlbW92ZSBjb2xvciIsCiAgICAgIGljb246ICJjb2xvci1zd2F0Y2gtcmVtb3ZlLWNvbG9yIiwKICAgICAgdmFsdWU6ICJyZW1vdmUiCiAgICB9OwogICAgcmV0dXJuIHQgPyBbZSwgewogICAgICB0eXBlOiBuLAogICAgICB0ZXh0OiAiQ3VzdG9tIGNvbG9yIiwKICAgICAgaWNvbjogImNvbG9yLXBpY2tlciIsCiAgICAgIHZhbHVlOiAiY3VzdG9tIgogICAgfV0gOiBbZV07CiAgfQoKICBmdW5jdGlvbiB2YihuLCBlLCB0LCBvKSB7CiAgICAiY3VzdG9tIiA9PT0gdCA/IEJiKG4pKGZ1bmN0aW9uICh0KSB7CiAgICAgIHQuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIGdiKHQpLCBuLmV4ZWNDb21tYW5kKCJtY2VBcHBseVRleHRjb2xvciIsIGUsIHQpLCBvKHQpOwogICAgICB9KTsKICAgIH0sICIjMDAwMDAwIikgOiAicmVtb3ZlIiA9PT0gdCA/IChvKCIiKSwgbi5leGVjQ29tbWFuZCgibWNlUmVtb3ZlVGV4dGNvbG9yIiwgZSkpIDogKG8odCksIG4uZXhlY0NvbW1hbmQoIm1jZUFwcGx5VGV4dGNvbG9yIiwgZSwgdCkpOwogIH0KCiAgZnVuY3Rpb24gYmIodCwgbikgewogICAgcmV0dXJuIHQuY29uY2F0KE0oRGIuc3RhdGUoKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiBUYiwKICAgICAgICB0ZXh0OiB0LAogICAgICAgIHZhbHVlOiB0CiAgICAgIH07CiAgICB9KS5jb25jYXQoaGIobikpKTsKICB9CgogIGZ1bmN0aW9uIHliKG4sIGUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICB0KGJiKG4sIGUpKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiB4Yih0LCBuLCBlKSB7CiAgICB0LnNldEljb25GaWxsKCJmb3JlY29sb3IiID09PSBuID8gInRveC1pY29uLXRleHQtY29sb3JfX2NvbG9yIiA6ICJ0b3gtaWNvbi1oaWdobGlnaHQtYmctY29sb3JfX2NvbG9yIiwgZSk7CiAgfQoKICBmdW5jdGlvbiB3YihpLCBlLCB1LCB0LCBvKSB7CiAgICBpLnVpLnJlZ2lzdHJ5LmFkZFNwbGl0QnV0dG9uKGUsIHsKICAgICAgdG9vbHRpcDogdCwKICAgICAgcHJlc2V0czogImNvbG9yIiwKICAgICAgaWNvbjogImZvcmVjb2xvciIgPT09IGUgPyAidGV4dC1jb2xvciIgOiAiaGlnaGxpZ2h0LWJnLWNvbG9yIiwKICAgICAgc2VsZWN0OiBmdW5jdGlvbiBzZWxlY3QoZSkgewogICAgICAgIHZhciBvLCByOwogICAgICAgIHJldHVybiB2dC5mcm9tKChvID0gdSwgaS5kb20uZ2V0UGFyZW50cyhpLnNlbGVjdGlvbi5nZXRTdGFydCgpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIG47CiAgICAgICAgICAobiA9IHQuc3R5bGVbImZvcmVjb2xvciIgPT09IG8gPyAiY29sb3IiIDogImJhY2tncm91bmQtY29sb3IiXSkgJiYgKHIgPSByIHx8IG4pOwogICAgICAgIH0pLCByKSkuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIEh2KHQpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICB2YXIgbiA9IEF2KHQpLnZhbHVlOwogICAgICAgICAgICByZXR1cm4gdXQoZS50b0xvd2VyQ2FzZSgpLCBuKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pLmdldE9yKCExKTsKICAgICAgfSwKICAgICAgY29sdW1uczogcGIoaSksCiAgICAgIGZldGNoOiB5YihtYihpKSwgZGIoaSkpLAogICAgICBvbkFjdGlvbjogZnVuY3Rpb24gb25BY3Rpb24odCkgewogICAgICAgIG51bGwgIT09IG8uZ2V0KCkgJiYgdmIoaSwgdSwgby5nZXQoKSwgc3QpOwogICAgICB9LAogICAgICBvbkl0ZW1BY3Rpb246IGZ1bmN0aW9uIG9uSXRlbUFjdGlvbih0LCBuKSB7CiAgICAgICAgdmIoaSwgdSwgbiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIG8uc2V0KHQpLCBpLmZpcmUoIlRleHRDb2xvckNoYW5nZSIsIHsKICAgICAgICAgICAgbmFtZTogZSwKICAgICAgICAgICAgY29sb3I6IHQKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBvblNldHVwOiBmdW5jdGlvbiBvblNldHVwKG4pIHsKICAgICAgICBmdW5jdGlvbiB0KHQpIHsKICAgICAgICAgIHQubmFtZSA9PT0gZSAmJiB4YihuLCB0Lm5hbWUsIHQuY29sb3IpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGwgIT09IG8uZ2V0KCkgJiYgeGIobiwgZSwgby5nZXQoKSksIGkub24oIlRleHRDb2xvckNoYW5nZSIsIHQpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpLm9mZigiVGV4dENvbG9yQ2hhbmdlIiwgdCk7CiAgICAgICAgfTsKICAgICAgfQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBTYihuLCB0LCBlLCBvKSB7CiAgICBuLnVpLnJlZ2lzdHJ5LmFkZE5lc3RlZE1lbnVJdGVtKHQsIHsKICAgICAgdGV4dDogbywKICAgICAgaWNvbjogImZvcmVjb2xvciIgPT09IHQgPyAidGV4dC1jb2xvciIgOiAiaGlnaGxpZ2h0LWJnLWNvbG9yIiwKICAgICAgZ2V0U3VibWVudUl0ZW1zOiBmdW5jdGlvbiBnZXRTdWJtZW51SXRlbXMoKSB7CiAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICB0eXBlOiAiZmFuY3ltZW51aXRlbSIsCiAgICAgICAgICBmYW5jeXR5cGU6ICJjb2xvcnN3YXRjaCIsCiAgICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gb25BY3Rpb24odCkgewogICAgICAgICAgICB2YihuLCBlLCB0LnZhbHVlLCBzdCk7CiAgICAgICAgICB9CiAgICAgICAgfV07CiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gQ2IodCwgbiwgZSwgbywgciwgaSwgdSwgYSkgewogICAgcmV0dXJuIHJoKHQsIG5oKG4pLCBNYihuLCBlLCBvLCAiY29sb3IiICE9PSByID8gIm5vcm1hbCIgOiAiY29sb3IiLCBpLCB1LCBhKSwgbywgcik7CiAgfQoKICBmdW5jdGlvbiBrYih0LCBuKSB7CiAgICB2YXIgZSA9IEpwKG4pOwogICAgcmV0dXJuIDEgPT09IHQgPyB7CiAgICAgIG1vZGU6ICJtZW51IiwKICAgICAgbW92ZU9uVGFiOiAhMAogICAgfSA6ICJhdXRvIiA9PT0gdCA/IHsKICAgICAgbW9kZTogImdyaWQiLAogICAgICBzZWxlY3RvcjogIi4iICsgZS5pdGVtLAogICAgICBpbml0U2l6ZTogewogICAgICAgIG51bUNvbHVtbnM6IDEsCiAgICAgICAgbnVtUm93czogMQogICAgICB9CiAgICB9IDogewogICAgICBtb2RlOiAibWF0cml4IiwKICAgICAgcm93U2VsZWN0b3I6ICIuIiArICgiY29sb3IiID09PSBuID8gInRveC1zd2F0Y2hlc19fcm93IiA6ICJ0b3gtY29sbGVjdGlvbl9fZ3JvdXAiKQogICAgfTsKICB9CgogIHZhciBPYiwKICAgICAgX2IsCiAgICAgIFRiID0gImNob2ljZWl0ZW0iLAogICAgICBFYiA9IFt7CiAgICB0eXBlOiBUYiwKICAgIHRleHQ6ICJMaWdodCBHcmVlbiIsCiAgICB2YWx1ZTogIiNCRkVERDIiCiAgfSwgewogICAgdHlwZTogVGIsCiAgICB0ZXh0OiAiTGlnaHQgWWVsbG93IiwKICAgIHZhbHVlOiAiI0ZCRUVCOCIKICB9LCB7CiAgICB0eXBlOiBUYiwKICAgIHRleHQ6ICJMaWdodCBSZWQiLAogICAgdmFsdWU6ICIjRjhDQUM2IgogIH0sIHsKICAgIHR5cGU6IFRiLAogICAgdGV4dDogIkxpZ2h0IFB1cnBsZSIsCiAgICB2YWx1ZTogIiNFQ0NBRkEiCiAgfSwgewogICAgdHlwZTogVGIsCiAgICB0ZXh0OiAiTGlnaHQgQmx1ZSIsCiAgICB2YWx1ZTogIiNDMkUwRjQiCiAgfSwgewogICAgdHlwZTogVGIsCiAgICB0ZXh0OiAiR3JlZW4iLAogICAgdmFsdWU6ICIjMkRDMjZCIgogIH0sIHsKICAgIHR5cGU6IFRiLAogICAgdGV4dDogIlllbGxvdyIsCiAgICB2YWx1ZTogIiNGMUM0MEYiCiAgfSwgewogICAgdHlwZTogVGIsCiAgICB0ZXh0OiAiUmVkIiwKICAgIHZhbHVlOiAiI0UwM0UyRCIKICB9LCB7CiAgICB0eXBlOiBUYiwKICAgIHRleHQ6ICJQdXJwbGUiLAogICAgdmFsdWU6ICIjQjk2QUQ5IgogIH0sIHsKICAgIHR5cGU6IFRiLAogICAgdGV4dDogIkJsdWUiLAogICAgdmFsdWU6ICIjMzU5OERCIgogIH0sIHsKICAgIHR5cGU6IFRiLAogICAgdGV4dDogIkRhcmsgVHVycXVvaXNlIiwKICAgIHZhbHVlOiAiIzE2OTE3OSIKICB9LCB7CiAgICB0eXBlOiBUYiwKICAgIHRleHQ6ICJPcmFuZ2UiLAogICAgdmFsdWU6ICIjRTY3RTIzIgogIH0sIHsKICAgIHR5cGU6IFRiLAogICAgdGV4dDogIkRhcmsgUmVkIiwKICAgIHZhbHVlOiAiI0JBMzcyQSIKICB9LCB7CiAgICB0eXBlOiBUYiwKICAgIHRleHQ6ICJEYXJrIFB1cnBsZSIsCiAgICB2YWx1ZTogIiM4NDNGQTEiCiAgfSwgewogICAgdHlwZTogVGIsCiAgICB0ZXh0OiAiRGFyayBCbHVlIiwKICAgIHZhbHVlOiAiIzIzNkZBMSIKICB9LCB7CiAgICB0eXBlOiBUYiwKICAgIHRleHQ6ICJMaWdodCBHcmF5IiwKICAgIHZhbHVlOiAiI0VDRjBGMSIKICB9LCB7CiAgICB0eXBlOiBUYiwKICAgIHRleHQ6ICJNZWRpdW0gR3JheSIsCiAgICB2YWx1ZTogIiNDRUQ0RDkiCiAgfSwgewogICAgdHlwZTogVGIsCiAgICB0ZXh0OiAiR3JheSIsCiAgICB2YWx1ZTogIiM5NUE1QTYiCiAgfSwgewogICAgdHlwZTogVGIsCiAgICB0ZXh0OiAiRGFyayBHcmF5IiwKICAgIHZhbHVlOiAiIzdFOEM4RCIKICB9LCB7CiAgICB0eXBlOiBUYiwKICAgIHRleHQ6ICJOYXZ5IEJsdWUiLAogICAgdmFsdWU6ICIjMzQ0OTVFIgogIH0sIHsKICAgIHR5cGU6IFRiLAogICAgdGV4dDogIkJsYWNrIiwKICAgIHZhbHVlOiAiIzAwMDAwMCIKICB9LCB7CiAgICB0eXBlOiBUYiwKICAgIHRleHQ6ICJXaGl0ZSIsCiAgICB2YWx1ZTogIiNmZmZmZmYiCiAgfV0sCiAgICAgIERiID0gZnVuY3Rpb24gKGUpIHsKICAgIHZvaWQgMCA9PT0gZSAmJiAoZSA9IDEwKTsKCiAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgaS5zcGxpY2UodCwgMSk7CiAgICB9CgogICAgdmFyIHQsCiAgICAgICAgbiA9IGxiLmdldEl0ZW0oZmIpLAogICAgICAgIHIgPSB5KG4pID8gSlNPTi5wYXJzZShuKSA6IFtdLAogICAgICAgIGkgPSBlIC0gKHQgPSByKS5sZW5ndGggPCAwID8gdC5zbGljZSgwLCBlKSA6IHQ7CiAgICByZXR1cm4gewogICAgICBhZGQ6IGZ1bmN0aW9uIGFkZCh0KSB7CiAgICAgICAgdmFyIG47CiAgICAgICAgKC0xID09PSAobiA9IHAoaSwgdCkpID8gdnQubm9uZSgpIDogdnQuc29tZShuKSkuZWFjaChvKSwgaS51bnNoaWZ0KHQpLCBpLmxlbmd0aCA+IGUgJiYgaS5wb3AoKSwgbGIuc2V0SXRlbShmYiwgSlNPTi5zdHJpbmdpZnkoaSkpOwogICAgICB9LAogICAgICBzdGF0ZTogZnVuY3Rpb24gc3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIGkuc2xpY2UoMCk7CiAgICAgIH0KICAgIH07CiAgfSgxMCksCiAgICAgIEJiID0gZnVuY3Rpb24gQmIocikgewogICAgcmV0dXJuIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgIHZhciBvID0gITE7CiAgICAgIHIud2luZG93TWFuYWdlci5vcGVuKHsKICAgICAgICB0aXRsZTogIkNvbG9yIFBpY2tlciIsCiAgICAgICAgc2l6ZTogIm5vcm1hbCIsCiAgICAgICAgYm9keTogewogICAgICAgICAgdHlwZTogInBhbmVsIiwKICAgICAgICAgIGl0ZW1zOiBbewogICAgICAgICAgICB0eXBlOiAiY29sb3JwaWNrZXIiLAogICAgICAgICAgICBuYW1lOiAiY29sb3JwaWNrZXIiLAogICAgICAgICAgICBsYWJlbDogIkNvbG9yIgogICAgICAgICAgfV0KICAgICAgICB9LAogICAgICAgIGJ1dHRvbnM6IFt7CiAgICAgICAgICB0eXBlOiAiY2FuY2VsIiwKICAgICAgICAgIG5hbWU6ICJjYW5jZWwiLAogICAgICAgICAgdGV4dDogIkNhbmNlbCIKICAgICAgICB9LCB7CiAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgIG5hbWU6ICJzYXZlIiwKICAgICAgICAgIHRleHQ6ICJTYXZlIiwKICAgICAgICAgIHByaW1hcnk6ICEwCiAgICAgICAgfV0sCiAgICAgICAgaW5pdGlhbERhdGE6IHsKICAgICAgICAgIGNvbG9ycGlja2VyOiB0CiAgICAgICAgfSwKICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gb25BY3Rpb24odCwgbikgewogICAgICAgICAgImhleC12YWxpZCIgPT09IG4ubmFtZSAmJiAobyA9IG4udmFsdWUpOwogICAgICAgIH0sCiAgICAgICAgb25TdWJtaXQ6IGZ1bmN0aW9uIG9uU3VibWl0KHQpIHsKICAgICAgICAgIHZhciBuID0gdC5nZXREYXRhKCkuY29sb3JwaWNrZXI7CiAgICAgICAgICBvID8gKGUodnQuZnJvbShuKSksIHQuY2xvc2UoKSkgOiByLndpbmRvd01hbmFnZXIuYWxlcnQoci50cmFuc2xhdGUoWyJJbnZhbGlkIGhleCBjb2xvciBjb2RlOiB7MH0iLCBuXSkpOwogICAgICAgIH0sCiAgICAgICAgb25DbG9zZTogc3QsCiAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uIG9uQ2FuY2VsKCkgewogICAgICAgICAgZSh2dC5ub25lKCkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwogIH0sCiAgICAgIE1iID0gZnVuY3Rpb24gTWIoZSwgbywgciwgaSwgdSwgYSwgYykgewogICAgcmV0dXJuIGV0KE0oZSwgZnVuY3Rpb24gKG4pIHsKICAgICAgcmV0dXJuICJjaG9pY2VpdGVtIiA9PT0gbi50eXBlID8gdW8oImNob2ljZW1lbnVpdGVtIiwgTGgsIG4pLmZvbGQoZWgsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHZ0LnNvbWUoZnVuY3Rpb24gKG4sIHQsIGUsIG8sIHIsIGksIHUsIGEpIHsKICAgICAgICAgIHZvaWQgMCA9PT0gYSAmJiAoYSA9ICEwKTsKCiAgICAgICAgICB2YXIgYyA9IF92KHsKICAgICAgICAgICAgcHJlc2V0czogZSwKICAgICAgICAgICAgdGV4dENvbnRlbnQ6IHQgPyBuLnRleHQgOiB2dC5ub25lKCksCiAgICAgICAgICAgIGh0bWxDb250ZW50OiB2dC5ub25lKCksCiAgICAgICAgICAgIGFyaWFMYWJlbDogbi50ZXh0LAogICAgICAgICAgICBpY29uQ29udGVudDogbi5pY29uLAogICAgICAgICAgICBzaG9ydGN1dENvbnRlbnQ6IHQgPyBuLnNob3J0Y3V0IDogdnQubm9uZSgpLAogICAgICAgICAgICBjaGVja01hcms6IHQgPyB2dC5zb21lKGt2KHUuaWNvbnMpKSA6IHZ0Lm5vbmUoKSwKICAgICAgICAgICAgY2FyZXQ6IHZ0Lm5vbmUoKSwKICAgICAgICAgICAgdmFsdWU6IG4udmFsdWUKICAgICAgICAgIH0sIHUsIGEpOwoKICAgICAgICAgIHJldHVybiBYbyh2dih7CiAgICAgICAgICAgIGRhdGE6IGJ2KG4pLAogICAgICAgICAgICBkaXNhYmxlZDogbi5kaXNhYmxlZCwKICAgICAgICAgICAgZ2V0QXBpOiBmdW5jdGlvbiBnZXRBcGkobikgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBzZXRBY3RpdmU6IGZ1bmN0aW9uIHNldEFjdGl2ZSh0KSB7CiAgICAgICAgICAgICAgICAgIHpnLnNldChuLCB0KTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc0FjdGl2ZTogZnVuY3Rpb24gaXNBY3RpdmUoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB6Zy5pc09uKG4pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQ6IGZ1bmN0aW9uIGlzRGlzYWJsZWQoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBkZC5pc0Rpc2FibGVkKG4pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHNldERpc2FibGVkOiBmdW5jdGlvbiBzZXREaXNhYmxlZCh0KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBkZC5zZXQobiwgdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uIG9uQWN0aW9uKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gbyhuLnZhbHVlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25TZXR1cDogZnVuY3Rpb24gb25TZXR1cCh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQuc2V0QWN0aXZlKHIpLCBzdDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdHJpZ2dlcnNTdWJtZW51OiAhMSwKICAgICAgICAgICAgaXRlbUJlaGF2aW91cnM6IFtdCiAgICAgICAgICB9LCBjLCBpLCB1KSwgewogICAgICAgICAgICB0b2dnbGluZzogewogICAgICAgICAgICAgIHRvZ2dsZUNsYXNzOiBPaCwKICAgICAgICAgICAgICB0b2dnbGVPbkV4ZWN1dGU6ICExLAogICAgICAgICAgICAgIHNlbGVjdGVkOiBuLmFjdGl2ZQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KHQsIDEgPT09IHIsIGksIG8sIGEobi52YWx1ZSksIHUsIGMsIG5oKGUpKSk7CiAgICAgIH0pIDogdnQubm9uZSgpOwogICAgfSkpOwogIH0sCiAgICAgIEFiID0gRnIoImNlbGwtb3ZlciIpLAogICAgICBGYiA9IEZyKCJjZWxsLWV4ZWN1dGUiKSwKICAgICAgSWIgPSB7CiAgICBpbnNlcnR0YWJsZTogZnVuY3Rpb24gaW5zZXJ0dGFibGUobykgewogICAgICB2YXIgdCA9IEZyKCJzaXplLWxhYmVsIiksCiAgICAgICAgICBpID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICBmb3IgKHZhciBuID0gW10sIGUgPSAwOyBlIDwgMTA7IGUrKykgewogICAgICAgICAgZm9yICh2YXIgbyA9IFtdLCByID0gMDsgciA8IDEwOyByKyspIHsKICAgICAgICAgICAgby5wdXNoKGZ1bmN0aW9uIChuLCBlLCB0KSB7CiAgICAgICAgICAgICAgZnVuY3Rpb24gbyh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdnIodCwgRmIsIHsKICAgICAgICAgICAgICAgICAgcm93OiBuLAogICAgICAgICAgICAgICAgICBjb2w6IGUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZnVuY3Rpb24gcih0LCBuKSB7CiAgICAgICAgICAgICAgICBuLnN0b3AoKSwgbyh0KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBpOwogICAgICAgICAgICAgIHJldHVybiBfdSh7CiAgICAgICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogKChpID0gewogICAgICAgICAgICAgICAgICAgIHJvbGU6ICJidXR0b24iCiAgICAgICAgICAgICAgICAgIH0pWyJhcmlhLWxhYmVsbGVkYnkiXSA9IHQsIGkpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmVoYXZpb3VyczogdGMoW2ZtKCJpbnNlcnQtdGFibGUtcGlja2VyLWNlbGwiLCBbQ3IoaGkoKSwgVmcuZm9jdXMpLCBDcihGaSgpLCBvKSwgQ3IoQ2koKSwgciksIENyKFJpKCksIHIpXSksIHpnLmNvbmZpZyh7CiAgICAgICAgICAgICAgICAgIHRvZ2dsZUNsYXNzOiAidG94LWluc2VydC10YWJsZS1waWNrZXJfX3NlbGVjdGVkIiwKICAgICAgICAgICAgICAgICAgdG9nZ2xlT25FeGVjdXRlOiAhMQogICAgICAgICAgICAgICAgfSksIFZnLmNvbmZpZyh7CiAgICAgICAgICAgICAgICAgIG9uRm9jdXM6IGZ1bmN0aW9uIG9uRm9jdXModCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB2cih0LCBBYiwgewogICAgICAgICAgICAgICAgICAgICAgcm93OiBuLAogICAgICAgICAgICAgICAgICAgICAgY29sOiBlCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pXSkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfShlLCByLCB0KSk7CiAgICAgICAgICB9CgogICAgICAgICAgbi5wdXNoKG8pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG47CiAgICAgIH0odCksCiAgICAgICAgICB1ID0gUG0oewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAic3BhbiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1pbnNlcnQtdGFibGUtcGlja2VyX19sYWJlbCJdLAogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICBpZDogdAogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogW29pKCIweDAiKV0sCiAgICAgICAgYmVoYXZpb3VyczogdGMoW0ZnLmNvbmZpZyh7fSldKQogICAgICB9KTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogIndpZGdldCIsCiAgICAgICAgZGF0YTogewogICAgICAgICAgdmFsdWU6IEZyKCJ3aWRnZXQtaWQiKQogICAgICAgIH0sCiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtZmFuY3ltZW51aXRlbSJdCiAgICAgICAgfSwKICAgICAgICBhdXRvZm9jdXM6ICEwLAogICAgICAgIGNvbXBvbmVudHM6IFtuYi53aWRnZXQoewogICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgIGNsYXNzZXM6IFsidG94LWluc2VydC10YWJsZS1waWNrZXIiXQogICAgICAgICAgfSwKICAgICAgICAgIGNvbXBvbmVudHM6IHooaSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIE0odCwgVHUpOwogICAgICAgICAgfSkuY29uY2F0KHUuYXNTcGVjKCkpLAogICAgICAgICAgYmVoYXZpb3VyczogdGMoW2ZtKCJpbnNlcnQtdGFibGUtcGlja2VyIiwgW1RyKEFiLCBmdW5jdGlvbiAodCwgbiwgZSkgewogICAgICAgICAgICB2YXIgbyA9IGUuZXZlbnQucm93LAogICAgICAgICAgICAgICAgciA9IGUuZXZlbnQuY29sOwogICAgICAgICAgICAhZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBvID0gMDsgbyA8IDEwOyBvKyspIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgMTA7IHIrKykgewogICAgICAgICAgICAgICAgICB6Zy5zZXQodFtvXVtyXSwgbyA8PSBuICYmIHIgPD0gZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KGksIG8sIHIpLCBGZy5zZXQodS5nZXQodCksIFtvaShyICsgMSArICJ4IiArIChvICsgMSkpXSk7CiAgICAgICAgICB9KSwgVHIoRmIsIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgICAgICAgIG8ub25BY3Rpb24oewogICAgICAgICAgICAgIG51bVJvd3M6IGUuZXZlbnQucm93ICsgMSwKICAgICAgICAgICAgICBudW1Db2x1bW5zOiBlLmV2ZW50LmNvbCArIDEKICAgICAgICAgICAgfSksIGhyKHQsIFBpKCkpOwogICAgICAgICAgfSldKSwgTWcuY29uZmlnKHsKICAgICAgICAgICAgaW5pdFNpemU6IHsKICAgICAgICAgICAgICBudW1Sb3dzOiAxMCwKICAgICAgICAgICAgICBudW1Db2x1bW5zOiAxMAogICAgICAgICAgICB9LAogICAgICAgICAgICBtb2RlOiAiZmxhdGdyaWQiLAogICAgICAgICAgICBzZWxlY3RvcjogJ1tyb2xlPSJidXR0b24iXScKICAgICAgICAgIH0pXSkKICAgICAgICB9KV0KICAgICAgfTsKICAgIH0sCiAgICBjb2xvcnN3YXRjaDogZnVuY3Rpb24gY29sb3Jzd2F0Y2gobiwgdCkgewogICAgICB2YXIgZSwKICAgICAgICAgIG8sCiAgICAgICAgICByLAogICAgICAgICAgaSA9IChvID0gdCwgciA9IChlID0gbikuaW5pdERhdGEuYWxsb3dDdXN0b21Db2xvcnMgJiYgby5jb2xvcmlucHV0Lmhhc0N1c3RvbUNvbG9ycygpLCBlLmluaXREYXRhLmNvbG9ycy5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gYmIoby5jb2xvcmlucHV0LmdldENvbG9ycygpLCByKTsKICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdC5jb25jYXQoaGIocikpOwogICAgICB9KSksCiAgICAgICAgICB1ID0gdC5jb2xvcmlucHV0LmdldENvbG9yQ29scygpLAogICAgICAgICAgYSA9IENiKEZyKCJtZW51LXZhbHVlIiksIGksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgbi5vbkFjdGlvbih7CiAgICAgICAgICB2YWx1ZTogdAogICAgICAgIH0pOwogICAgICB9LCB1LCAiY29sb3IiLCB4aC5DTE9TRV9PTl9FWEVDVVRFLCBPLCB0LnNoYXJlZC5wcm92aWRlcnMpLAogICAgICAgICAgYyA9IF9sdChfbHQoe30sIGEpLCB7CiAgICAgICAgbWFya2VyczogSnAoImNvbG9yIiksCiAgICAgICAgbW92ZW1lbnQ6IGtiKHUsICJjb2xvciIpCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAid2lkZ2V0IiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICB2YWx1ZTogRnIoIndpZGdldC1pZCIpCiAgICAgICAgfSwKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1mYW5jeW1lbnVpdGVtIl0KICAgICAgICB9LAogICAgICAgIGF1dG9mb2N1czogITAsCiAgICAgICAgY29tcG9uZW50czogW25iLndpZGdldChRZy5za2V0Y2goYykpXQogICAgICB9OwogICAgfQogIH0sCiAgICAgIFJiID0gZnVuY3Rpb24gUmIodCkgewogICAgdmFyIG4gPSB0LnRleHQuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB7fTsKICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaW5uZXJIdG1sOiB0CiAgICAgIH07CiAgICB9KTsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6ICJzZXBhcmF0b3IiLAogICAgICBkb206IF9sdCh7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbU2gsICJ0b3gtY29sbGVjdGlvbl9fZ3JvdXAtaGVhZGluZyJdCiAgICAgIH0sIG4pLAogICAgICBjb21wb25lbnRzOiBbXQogICAgfTsKICB9LAogICAgICBWYiA9IGZ1bmN0aW9uIFZiKHQsIG4sIGUsIG8pIHsKICAgIHZvaWQgMCA9PT0gbyAmJiAobyA9ICEwKTsKCiAgICB2YXIgciA9IF92KHsKICAgICAgcHJlc2V0czogIm5vcm1hbCIsCiAgICAgIGljb25Db250ZW50OiB0Lmljb24sCiAgICAgIHRleHRDb250ZW50OiB0LnRleHQsCiAgICAgIGh0bWxDb250ZW50OiB2dC5ub25lKCksCiAgICAgIGFyaWFMYWJlbDogdC50ZXh0LAogICAgICBjYXJldDogdnQubm9uZSgpLAogICAgICBjaGVja01hcms6IHZ0Lm5vbmUoKSwKICAgICAgc2hvcnRjdXRDb250ZW50OiB0LnNob3J0Y3V0CiAgICB9LCBlLCBvKTsKCiAgICByZXR1cm4gdnYoewogICAgICBkYXRhOiBidih0KSwKICAgICAgZ2V0QXBpOiBmdW5jdGlvbiBnZXRBcGkobikgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbiBpc0Rpc2FibGVkKCkgewogICAgICAgICAgICByZXR1cm4gZGQuaXNEaXNhYmxlZChuKTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXREaXNhYmxlZDogZnVuY3Rpb24gc2V0RGlzYWJsZWQodCkgewogICAgICAgICAgICByZXR1cm4gZGQuc2V0KG4sIHQpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0sCiAgICAgIGRpc2FibGVkOiB0LmRpc2FibGVkLAogICAgICBvbkFjdGlvbjogdC5vbkFjdGlvbiwKICAgICAgb25TZXR1cDogdC5vblNldHVwLAogICAgICB0cmlnZ2Vyc1N1Ym1lbnU6ICExLAogICAgICBpdGVtQmVoYXZpb3VyczogW10KICAgIH0sIHIsIG4sIGUpOwogIH0sCiAgICAgIFBiID0gZnVuY3Rpb24gUGIodCwgbiwgZSwgbywgcikgewogICAgdm9pZCAwID09PSBvICYmIChvID0gITApOwoKICAgIHZhciBpID0gKHIgPSB2b2lkIDAgIT09IHIgJiYgcikgPyB5digiY2hldnJvbi1kb3duIiwgZS5pY29ucywgW0VoXSkgOiB5digiY2hldnJvbi1yaWdodCIsIGUuaWNvbnMsIFtFaF0pLAogICAgICAgIHUgPSBfdih7CiAgICAgIHByZXNldHM6ICJub3JtYWwiLAogICAgICBpY29uQ29udGVudDogdC5pY29uLAogICAgICB0ZXh0Q29udGVudDogdC50ZXh0LAogICAgICBodG1sQ29udGVudDogdnQubm9uZSgpLAogICAgICBhcmlhTGFiZWw6IHQudGV4dCwKICAgICAgY2FyZXQ6IHZ0LnNvbWUoaSksCiAgICAgIGNoZWNrTWFyazogdnQubm9uZSgpLAogICAgICBzaG9ydGN1dENvbnRlbnQ6IHQuc2hvcnRjdXQKICAgIH0sIGUsIG8pOwoKICAgIHJldHVybiB2dih7CiAgICAgIGRhdGE6IGJ2KHQpLAogICAgICBnZXRBcGk6IGZ1bmN0aW9uIGdldEFwaShuKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGlzRGlzYWJsZWQ6IGZ1bmN0aW9uIGlzRGlzYWJsZWQoKSB7CiAgICAgICAgICAgIHJldHVybiBkZC5pc0Rpc2FibGVkKG4pOwogICAgICAgICAgfSwKICAgICAgICAgIHNldERpc2FibGVkOiBmdW5jdGlvbiBzZXREaXNhYmxlZCh0KSB7CiAgICAgICAgICAgIHJldHVybiBkZC5zZXQobiwgdCk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgZGlzYWJsZWQ6IHQuZGlzYWJsZWQsCiAgICAgIG9uQWN0aW9uOiBzdCwKICAgICAgb25TZXR1cDogdC5vblNldHVwLAogICAgICB0cmlnZ2Vyc1N1Ym1lbnU6ICEwLAogICAgICBpdGVtQmVoYXZpb3VyczogW10KICAgIH0sIHUsIG4sIGUpOwogIH0sCiAgICAgIEhiID0gZnVuY3Rpb24gSGIodCwgbiwgZSwgbykgewogICAgdm9pZCAwID09PSBvICYmIChvID0gITApOwoKICAgIHZhciByID0gX3YoewogICAgICBpY29uQ29udGVudDogdC5pY29uLAogICAgICB0ZXh0Q29udGVudDogdC50ZXh0LAogICAgICBodG1sQ29udGVudDogdnQubm9uZSgpLAogICAgICBhcmlhTGFiZWw6IHQudGV4dCwKICAgICAgY2hlY2tNYXJrOiB2dC5zb21lKGt2KGUuaWNvbnMpKSwKICAgICAgY2FyZXQ6IHZ0Lm5vbmUoKSwKICAgICAgc2hvcnRjdXRDb250ZW50OiB0LnNob3J0Y3V0LAogICAgICBwcmVzZXRzOiAibm9ybWFsIiwKICAgICAgbWV0YTogdC5tZXRhCiAgICB9LCBlLCBvKTsKCiAgICByZXR1cm4gWG8odnYoewogICAgICBkYXRhOiBidih0KSwKICAgICAgZGlzYWJsZWQ6IHQuZGlzYWJsZWQsCiAgICAgIGdldEFwaTogZnVuY3Rpb24gZ2V0QXBpKG4pIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgc2V0QWN0aXZlOiBmdW5jdGlvbiBzZXRBY3RpdmUodCkgewogICAgICAgICAgICB6Zy5zZXQobiwgdCk7CiAgICAgICAgICB9LAogICAgICAgICAgaXNBY3RpdmU6IGZ1bmN0aW9uIGlzQWN0aXZlKCkgewogICAgICAgICAgICByZXR1cm4gemcuaXNPbihuKTsKICAgICAgICAgIH0sCiAgICAgICAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbiBpc0Rpc2FibGVkKCkgewogICAgICAgICAgICByZXR1cm4gZGQuaXNEaXNhYmxlZChuKTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXREaXNhYmxlZDogZnVuY3Rpb24gc2V0RGlzYWJsZWQodCkgewogICAgICAgICAgICByZXR1cm4gZGQuc2V0KG4sIHQpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0sCiAgICAgIG9uQWN0aW9uOiB0Lm9uQWN0aW9uLAogICAgICBvblNldHVwOiB0Lm9uU2V0dXAsCiAgICAgIHRyaWdnZXJzU3VibWVudTogITEsCiAgICAgIGl0ZW1CZWhhdmlvdXJzOiBbXQogICAgfSwgciwgbiwgZSksIHsKICAgICAgdG9nZ2xpbmc6IHsKICAgICAgICB0b2dnbGVDbGFzczogT2gsCiAgICAgICAgdG9nZ2xlT25FeGVjdXRlOiAhMSwKICAgICAgICBzZWxlY3RlZDogdC5hY3RpdmUKICAgICAgfQogICAgfSk7CiAgfSwKICAgICAgemIgPSBmdW5jdGlvbiB6YihuLCBlKSB7CiAgICByZXR1cm4gdHQoSWIsIG4uZmFuY3l0eXBlKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQobiwgZSk7CiAgICB9KTsKICB9OwoKICBmdW5jdGlvbiBOYih0LCB1LCBhLCBuLCBjLCBzLCBsKSB7CiAgICB2YXIgZSA9IDEgPT09IG4sCiAgICAgICAgbyA9ICFlIHx8IG5oKHQpOwogICAgcmV0dXJuIGV0KE0odCwgZnVuY3Rpb24gKHQpIHsKICAgICAgc3dpdGNoICh0LnR5cGUpIHsKICAgICAgICBjYXNlICJzZXBhcmF0b3IiOgogICAgICAgICAgcmV0dXJuIHVvKCJBdXRvY29tcGxldGVyLlNlcGFyYXRvciIsIEZwLCB0KS5mb2xkKGVoLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdnQuc29tZShSYih0KSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgY2FzZSAiY2FyZG1lbnVpdGVtIjoKICAgICAgICAgIHJldHVybiB1bygiY2FyZG1lbnVpdGVtIiwgTmgsIHQpLmZvbGQoZWgsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHJldHVybiB2dC5zb21lKCh0ID0gX2x0KF9sdCh7fSwgbiksIHsKICAgICAgICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gb25BY3Rpb24odCkgewogICAgICAgICAgICAgICAgbi5vbkFjdGlvbih0KSwgYShuLnZhbHVlLCBuLm1ldGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksIGUgPSBjLCBvID0gcywgciA9IHsKICAgICAgICAgICAgICBpdGVtQmVoYXZpb3VyczogVHYobi5tZXRhLCBzKSwKICAgICAgICAgICAgICBjYXJkVGV4dDogewogICAgICAgICAgICAgICAgbWF0Y2hUZXh0OiB1LAogICAgICAgICAgICAgICAgaGlnaGxpZ2h0T246IGwKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGkgPSB7CiAgICAgICAgICAgICAgZG9tOiBPdih0LmxhYmVsKSwKICAgICAgICAgICAgICBvcHRDb21wb25lbnRzOiBbdnQuc29tZSh7CiAgICAgICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgICAgICAgY2xhc3NlczogW0JoLCBNaF0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb21wb25lbnRzOiB0Yih0Lml0ZW1zLCByKQogICAgICAgICAgICAgIH0pXQogICAgICAgICAgICB9LCB2dih7CiAgICAgICAgICAgICAgZGF0YTogYnYoX2x0KHsKICAgICAgICAgICAgICAgIHRleHQ6IHZ0Lm5vbmUoKQogICAgICAgICAgICAgIH0sIHQpKSwKICAgICAgICAgICAgICBkaXNhYmxlZDogdC5kaXNhYmxlZCwKICAgICAgICAgICAgICBnZXRBcGk6IGZ1bmN0aW9uIGdldEFwaShlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbiBpc0Rpc2FibGVkKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkZC5pc0Rpc2FibGVkKGUpOwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBzZXREaXNhYmxlZDogZnVuY3Rpb24gc2V0RGlzYWJsZWQobikgewogICAgICAgICAgICAgICAgICAgIGRkLnNldChlLCBuKSwgU3QocHMoZS5lbGVtZW50LCAiKiIpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICAgICAgZS5nZXRTeXN0ZW0oKS5nZXRCeURvbSh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHQuaGFzQ29uZmlndXJlZChkZCkgJiYgZGQuc2V0KHQsIG4pOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBvbkFjdGlvbjogdC5vbkFjdGlvbiwKICAgICAgICAgICAgICBvblNldHVwOiB0Lm9uU2V0dXAsCiAgICAgICAgICAgICAgdHJpZ2dlcnNTdWJtZW51OiAhMSwKICAgICAgICAgICAgICBpdGVtQmVoYXZpb3VyczogdnQuZnJvbShyLml0ZW1CZWhhdmlvdXJzKS5nZXRPcihbXSkKICAgICAgICAgICAgfSwgaSwgZSwgby5wcm92aWRlcnMpKSk7CiAgICAgICAgICAgIHZhciB0LCBlLCBvLCByLCBpOwogICAgICAgICAgfSk7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gdW8oIkF1dG9jb21wbGV0ZXIuSXRlbSIsIElwLCB0KS5mb2xkKGVoLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdnQuc29tZShmdW5jdGlvbiAobiwgZSwgdCwgbywgciwgaSwgdSwgYSkgewogICAgICAgICAgICAgIHZvaWQgMCA9PT0gYSAmJiAoYSA9ICEwKTsKCiAgICAgICAgICAgICAgdmFyIGMgPSBfdih7CiAgICAgICAgICAgICAgICBwcmVzZXRzOiBvLAogICAgICAgICAgICAgICAgdGV4dENvbnRlbnQ6IHZ0Lm5vbmUoKSwKICAgICAgICAgICAgICAgIGh0bWxDb250ZW50OiB0ID8gbi50ZXh0Lm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gRXYodCwgZSk7CiAgICAgICAgICAgICAgICB9KSA6IHZ0Lm5vbmUoKSwKICAgICAgICAgICAgICAgIGFyaWFMYWJlbDogbi50ZXh0LAogICAgICAgICAgICAgICAgaWNvbkNvbnRlbnQ6IG4uaWNvbiwKICAgICAgICAgICAgICAgIHNob3J0Y3V0Q29udGVudDogdnQubm9uZSgpLAogICAgICAgICAgICAgICAgY2hlY2tNYXJrOiB2dC5ub25lKCksCiAgICAgICAgICAgICAgICBjYXJldDogdnQubm9uZSgpLAogICAgICAgICAgICAgICAgdmFsdWU6IG4udmFsdWUKICAgICAgICAgICAgICB9LCB1LnByb3ZpZGVycywgYSwgbi5pY29uKTsKCiAgICAgICAgICAgICAgcmV0dXJuIHZ2KHsKICAgICAgICAgICAgICAgIGRhdGE6IGJ2KG4pLAogICAgICAgICAgICAgICAgZGlzYWJsZWQ6IG4uZGlzYWJsZWQsCiAgICAgICAgICAgICAgICBnZXRBcGk6IHJ0KHt9KSwKICAgICAgICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiBvbkFjdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiByKG4udmFsdWUsIG4ubWV0YSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb25TZXR1cDogcnQoc3QpLAogICAgICAgICAgICAgICAgdHJpZ2dlcnNTdWJtZW51OiAhMSwKICAgICAgICAgICAgICAgIGl0ZW1CZWhhdmlvdXJzOiBUdihuLm1ldGEsIHUpCiAgICAgICAgICAgICAgfSwgYywgaSwgdS5wcm92aWRlcnMpOwogICAgICAgICAgICB9KHQsIHUsIGUsICJub3JtYWwiLCBhLCBjLCBzLCBvKSk7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSkpOwogIH0KCiAgZnVuY3Rpb24gTGIodCwgbiwgZSwgbywgcikgewogICAgdmFyIGkgPSBuaChuKSwKICAgICAgICB1ID0gZXQoTShuLCBmdW5jdGlvbiAodCkgewogICAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQsIG4sIGUsIG8sIHIpIHsKICAgICAgICAgIGZ1bmN0aW9uIGkodCkgewogICAgICAgICAgICByZXR1cm4gciA/IF9sdChfbHQoe30sIHQpLCB7CiAgICAgICAgICAgICAgc2hvcnRjdXQ6IHZ0Lm5vbmUoKSwKICAgICAgICAgICAgICBpY29uOiB0LnRleHQuaXNTb21lKCkgPyB2dC5ub25lKCkgOiB0Lmljb24KICAgICAgICAgICAgfSkgOiB0OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB1ID0gZS5zaGFyZWQucHJvdmlkZXJzOwoKICAgICAgICAgIHN3aXRjaCAodC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgIm1lbnVpdGVtIjoKICAgICAgICAgICAgICByZXR1cm4gdW8oIm1lbnVpdGVtIiwgamgsIHQpLmZvbGQoZWgsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdnQuc29tZShWYihpKHQpLCBuLCB1LCBvKSk7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlICJuZXN0ZWRtZW51aXRlbSI6CiAgICAgICAgICAgICAgcmV0dXJuIHVvKCJuZXN0ZWRtZW51aXRlbSIsIEdoLCB0KS5mb2xkKGVoLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHZ0LnNvbWUoUGIoaSh0KSwgbiwgdSwgbywgcikpOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAidG9nZ2xlbWVudWl0ZW0iOgogICAgICAgICAgICAgIHJldHVybiB1bygidG9nZ2xlbWVudWl0ZW0iLCBYaCwgdCkuZm9sZChlaCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2dC5zb21lKEhiKGkodCksIG4sIHUsIG8pKTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgInNlcGFyYXRvciI6CiAgICAgICAgICAgICAgcmV0dXJuIHVvKCJzZXBhcmF0b3JtZW51aXRlbSIsIEZwLCB0KS5mb2xkKGVoLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHZ0LnNvbWUoUmIodCkpOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAiZmFuY3ltZW51aXRlbSI6CiAgICAgICAgICAgICAgcmV0dXJuIHVvKCJmYW5jeW1lbnVpdGVtIiwgVWgsIHQpLmZvbGQoZWgsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gemIoaSh0KSwgZSk7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKCJVbmtub3duIGl0ZW0gaW4gZ2VuZXJhbCBtZW51IiwgdCksIHZ0Lm5vbmUoKTsKICAgICAgICAgIH0KICAgICAgICB9KHQsIGUsIG8sIHIgPyAhVHQodCwgInRleHQiKSA6IGksIHIpOwogICAgICB9CgogICAgICByZXR1cm4gIm5lc3RlZG1lbnVpdGVtIiA9PT0gdC50eXBlICYmIHQuZ2V0U3VibWVudUl0ZW1zKCkubGVuZ3RoIDw9IDAgPyBuKF9sdChfbHQoe30sIHQpLCB7CiAgICAgICAgZGlzYWJsZWQ6ICEwCiAgICAgIH0pKSA6IG4odCk7CiAgICB9KSk7CiAgICByZXR1cm4gKHIgPyBvaCA6IHJoKSh0LCBpLCB1LCAxLCAibm9ybWFsIik7CiAgfQoKICBmdW5jdGlvbiBXYih0KSB7CiAgICByZXR1cm4gb3Auc2luZ2xlRGF0YSh0LnZhbHVlLCB0KTsKICB9CgogIGZ1bmN0aW9uIFViKHQsIG4sIGUpIHsKICAgIHJldHVybiBJdSh0LCBuLCBlKS5pc1NvbWUoKTsKICB9CgogIGZ1bmN0aW9uIGpiKGUsIG8pIHsKICAgIHZhciByID0gbnVsbDsKICAgIHJldHVybiB7CiAgICAgIGNhbmNlbDogZnVuY3Rpb24gY2FuY2VsKCkgewogICAgICAgIG51bGwgIT09IHIgJiYgKGNsZWFyVGltZW91dChyKSwgciA9IG51bGwpOwogICAgICB9LAogICAgICBzY2hlZHVsZTogZnVuY3Rpb24gc2NoZWR1bGUoKSB7CiAgICAgICAgZm9yICh2YXIgdCA9IFtdLCBuID0gMDsgbiA8IGFyZ3VtZW50cy5sZW5ndGg7IG4rKykgewogICAgICAgICAgdFtuXSA9IGFyZ3VtZW50c1tuXTsKICAgICAgICB9CgogICAgICAgIHIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGUuYXBwbHkobnVsbCwgdCksIHIgPSBudWxsOwogICAgICAgIH0sIG8pOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gR2IodCkgewogICAgdmFyIG4gPSB0LnJhdzsKICAgIHJldHVybiB2b2lkIDAgPT09IG4udG91Y2hlcyB8fCAxICE9PSBuLnRvdWNoZXMubGVuZ3RoID8gdnQubm9uZSgpIDogdnQuc29tZShuLnRvdWNoZXNbMF0pOwogIH0KCiAgZnVuY3Rpb24gWGIoKSB7CiAgICByZXR1cm4gc2UoKS5icm93c2VyLmlzRmlyZWZveCgpOwogIH0KCiAgZnVuY3Rpb24gWWIobiwgdCkgewogICAgdmFyIGUsCiAgICAgICAgbywKICAgICAgICByLAogICAgICAgIGksCiAgICAgICAgdSwKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICAgcywKICAgICAgICBsLAogICAgICAgIGYgPSBfbHQoewogICAgICBzdG9wQmFja3NwYWNlOiAhMAogICAgfSwgdCksCiAgICAgICAgZCA9ICh1ID0gZiwgYSA9IGRjKCksIGMgPSBWbyghMSksIHMgPSBqYihmdW5jdGlvbiAodCkgewogICAgICB1LnRyaWdnZXJFdmVudChWaSgpLCB0KSwgYy5zZXQoITApOwogICAgfSwgNDAwKSwgbCA9IHNyKFt7CiAgICAgIGtleTogY2koKSwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKGUpIHsKICAgICAgICByZXR1cm4gR2IoZSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgcy5jYW5jZWwoKTsKICAgICAgICAgIHZhciBuID0gewogICAgICAgICAgICB4OiB0LmNsaWVudFgsCiAgICAgICAgICAgIHk6IHQuY2xpZW50WSwKICAgICAgICAgICAgdGFyZ2V0OiBlLnRhcmdldAogICAgICAgICAgfTsKICAgICAgICAgIHMuc2NoZWR1bGUoZSksIGMuc2V0KCExKSwgYS5zZXQobik7CiAgICAgICAgfSksIHZ0Lm5vbmUoKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6IHNpKCksCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSh0KSB7CiAgICAgICAgcmV0dXJuIHMuY2FuY2VsKCksIEdiKHQpLmVhY2goZnVuY3Rpb24gKGkpIHsKICAgICAgICAgIGEub24oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdmFyIG4gPSBpLAogICAgICAgICAgICAgICAgZSA9IHQsCiAgICAgICAgICAgICAgICBvID0gTWF0aC5hYnMobi5jbGllbnRYIC0gZS54KSwKICAgICAgICAgICAgICAgIHIgPSBNYXRoLmFicyhuLmNsaWVudFkgLSBlLnkpOwogICAgICAgICAgICAoNSA8IG8gfHwgNSA8IHIpICYmIGEuY2xlYXIoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pLCB2dC5ub25lKCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiBsaSgpLAogICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUobikgewogICAgICAgIHJldHVybiBzLmNhbmNlbCgpLCBhLmdldCgpLmZpbHRlcihmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIEx0KHQudGFyZ2V0LCBuLnRhcmdldCk7CiAgICAgICAgfSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gYy5nZXQoKSA/IChuLnByZXZlbnQoKSwgITEpIDogdS50cmlnZ2VyRXZlbnQoUmkoKSwgbik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH1dKSwgewogICAgICBmaXJlSWZSZWFkeTogZnVuY3Rpb24gZmlyZUlmUmVhZHkobiwgdCkgewogICAgICAgIHJldHVybiB0dChsLCB0KS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdChuKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSksCiAgICAgICAgbSA9IE0oWyJ0b3VjaHN0YXJ0IiwgInRvdWNobW92ZSIsICJ0b3VjaGVuZCIsICJ0b3VjaGNhbmNlbCIsICJnZXN0dXJlc3RhcnQiLCAibW91c2Vkb3duIiwgIm1vdXNldXAiLCAibW91c2VvdmVyIiwgIm1vdXNlbW92ZSIsICJtb3VzZW91dCIsICJjbGljayJdLmNvbmNhdChbInNlbGVjdHN0YXJ0IiwgImlucHV0IiwgImNvbnRleHRtZW51IiwgImNoYW5nZSIsICJ0cmFuc2l0aW9uZW5kIiwgInRyYW5zaXRpb25jYW5jZWwiLCAiZHJhZyIsICJkcmFnc3RhcnQiLCAiZHJhZ2VuZCIsICJkcmFnZW50ZXIiLCAiZHJhZ2xlYXZlIiwgImRyYWdvdmVyIiwgImRyb3AiLCAia2V5dXAiXSksIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBtYyhuLCB0LCBmdW5jdGlvbiAobikgewogICAgICAgIGQuZmlyZUlmUmVhZHkobiwgdCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgdCAmJiBuLmtpbGwoKTsKICAgICAgICB9KSwgZi50cmlnZ2VyRXZlbnQodCwgbikgJiYgbi5raWxsKCk7CiAgICAgIH0pOwogICAgfSksCiAgICAgICAgZyA9IGRjKCksCiAgICAgICAgcCA9IG1jKG4sICJwYXN0ZSIsIGZ1bmN0aW9uIChuKSB7CiAgICAgIGQuZmlyZUlmUmVhZHkobiwgInBhc3RlIikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIHQgJiYgbi5raWxsKCk7CiAgICAgIH0pLCBmLnRyaWdnZXJFdmVudCgicGFzdGUiLCBuKSAmJiBuLmtpbGwoKSwgZy5zZXQoc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgZi50cmlnZ2VyRXZlbnQoTWkoKSwgbik7CiAgICAgIH0sIDApKTsKICAgIH0pLAogICAgICAgIGggPSBtYyhuLCAia2V5ZG93biIsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuOwogICAgICBmLnRyaWdnZXJFdmVudCgia2V5ZG93biIsIHQpID8gdC5raWxsKCkgOiAhZi5zdG9wQmFja3NwYWNlIHx8IChuID0gdCkucmF3LndoaWNoICE9PSBwZFswXSB8fCB3dChbImlucHV0IiwgInRleHRhcmVhIl0sIEZ0KG4udGFyZ2V0KSkgfHwgVWIobi50YXJnZXQsICdbY29udGVudGVkaXRhYmxlPSJ0cnVlIl0nKSB8fCB0LnByZXZlbnQoKTsKICAgIH0pLAogICAgICAgIHYgPSAoZSA9IG4sIG8gPSBmdW5jdGlvbiBvKHQpIHsKICAgICAgZi50cmlnZ2VyRXZlbnQoImZvY3VzaW4iLCB0KSAmJiB0LmtpbGwoKTsKICAgIH0sIFhiKCkgPyBnYyhlLCAiZm9jdXMiLCBvKSA6IG1jKGUsICJmb2N1c2luIiwgbykpLAogICAgICAgIGIgPSBkYygpLAogICAgICAgIHkgPSAociA9IG4sIGkgPSBmdW5jdGlvbiBpKHQpIHsKICAgICAgZi50cmlnZ2VyRXZlbnQoImZvY3Vzb3V0IiwgdCkgJiYgdC5raWxsKCksIGIuc2V0KHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGYudHJpZ2dlckV2ZW50KEJpKCksIHQpOwogICAgICB9LCAwKSk7CiAgICB9LCBYYigpID8gZ2MociwgImJsdXIiLCBpKSA6IG1jKHIsICJmb2N1c291dCIsIGkpKTsKCiAgICByZXR1cm4gewogICAgICB1bmJpbmQ6IGZ1bmN0aW9uIHVuYmluZCgpIHsKICAgICAgICBTdChtLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgdC51bmJpbmQoKTsKICAgICAgICB9KSwgaC51bmJpbmQoKSwgdi51bmJpbmQoKSwgeS51bmJpbmQoKSwgcC51bmJpbmQoKSwgZy5vbihjbGVhclRpbWVvdXQpLCBiLm9uKGNsZWFyVGltZW91dCk7CiAgICAgIH0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBxYih0LCBuKSB7CiAgICByZXR1cm4gVm8odHQodCwgInRhcmdldCIpLmdldE9yKG4pKTsKICB9CgogIGZ1bmN0aW9uIEtiKHQsIG8sIG4sIGUsIHIsIGkpIHsKICAgIHZhciB1LAogICAgICAgIGEsCiAgICAgICAgYyA9IHQobywgZSksCiAgICAgICAgcyA9ICh1ID0gVm8oITEpLCBhID0gVm8oITEpLCB7CiAgICAgIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7CiAgICAgICAgdS5zZXQoITApOwogICAgICB9LAogICAgICBjdXQ6IGZ1bmN0aW9uIGN1dCgpIHsKICAgICAgICBhLnNldCghMCk7CiAgICAgIH0sCiAgICAgIGlzU3RvcHBlZDogdS5nZXQsCiAgICAgIGlzQ3V0OiBhLmdldCwKICAgICAgZXZlbnQ6IG4sCiAgICAgIHNldFNvdXJjZTogci5zZXQsCiAgICAgIGdldFNvdXJjZTogci5nZXQKICAgIH0pOwogICAgcmV0dXJuIGMuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBpLmxvZ0V2ZW50Tm9IYW5kbGVycyhvLCBlKSwgb3kuY29tcGxldGUoKTsKICAgIH0sIGZ1bmN0aW9uIChuKSB7CiAgICAgIHZhciBlID0gbi5kZXNjSGFuZGxlcjsKICAgICAgcmV0dXJuIExyKGUpKHMpLCBzLmlzU3RvcHBlZCgpID8gKGkubG9nRXZlbnRTdG9wcGVkKG8sIG4uZWxlbWVudCwgZS5wdXJwb3NlKSwgb3kuc3RvcHBlZCgpKSA6IHMuaXNDdXQoKSA/IChpLmxvZ0V2ZW50Q3V0KG8sIG4uZWxlbWVudCwgZS5wdXJwb3NlKSwgb3kuY29tcGxldGUoKSkgOiBZdChuLmVsZW1lbnQpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBpLmxvZ05vUGFyZW50KG8sIG4uZWxlbWVudCwgZS5wdXJwb3NlKSwgb3kuY29tcGxldGUoKTsKICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gaS5sb2dFdmVudFJlc3BvbnNlKG8sIG4uZWxlbWVudCwgZS5wdXJwb3NlKSwgb3kucmVzdW1lKHQpOwogICAgICB9KTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gSmIoKSB7CiAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgSXIodC5lbGVtZW50KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgZGVsZXRlIGFbdF0sIGkudW5yZWdpc3RlcklkKHQpOwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgdSwKICAgICAgICBpID0gKHUgPSB7fSwgewogICAgICByZWdpc3RlcklkOiBmdW5jdGlvbiByZWdpc3RlcklkKHIsIGksIHQpIHsKICAgICAgICBKKHQsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICB2YXIgZSwKICAgICAgICAgICAgICBvID0gdm9pZCAwICE9PSB1W25dID8gdVtuXSA6IHt9OwogICAgICAgICAgb1tpXSA9IHsKICAgICAgICAgICAgY0hhbmRsZXI6IFMuYXBwbHkodm9pZCAwLCBbKGUgPSB0KS5oYW5kbGVyXS5jb25jYXQocikpLAogICAgICAgICAgICBwdXJwb3NlOiBlLnB1cnBvc2UKICAgICAgICAgIH0sIHVbbl0gPSBvOwogICAgICAgIH0pOwogICAgICB9LAogICAgICB1bnJlZ2lzdGVySWQ6IGZ1bmN0aW9uIHVucmVnaXN0ZXJJZChlKSB7CiAgICAgICAgSih1LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgVHQodCwgZSkgJiYgZGVsZXRlIHRbZV07CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGZpbHRlckJ5VHlwZTogZnVuY3Rpb24gZmlsdGVyQnlUeXBlKHQpIHsKICAgICAgICByZXR1cm4gdHQodSwgdCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gJCh0LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGlkOiBuLAogICAgICAgICAgICAgIGRlc2NIYW5kbGVyOiB0CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9KS5nZXRPcihbXSk7CiAgICAgIH0sCiAgICAgIGZpbmQ6IGZ1bmN0aW9uIGZpbmQodCwgbiwgZSkgewogICAgICAgIHJldHVybiB0dCh1LCBuKS5iaW5kKGZ1bmN0aW9uIChvKSB7CiAgICAgICAgICByZXR1cm4gZHIoZSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIG4gPSBvLCBJcihlID0gdCkuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiB0dChuLCB0KTsKICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGUsCiAgICAgICAgICAgICAgICBkZXNjSGFuZGxlcjogdAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgbiwgZTsKICAgICAgICAgIH0sIHQpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KSwKICAgICAgICBhID0ge307CiAgICByZXR1cm4gewogICAgICBmaW5kOiBmdW5jdGlvbiBmaW5kKHQsIG4sIGUpIHsKICAgICAgICByZXR1cm4gaS5maW5kKHQsIG4sIGUpOwogICAgICB9LAogICAgICBmaWx0ZXI6IGZ1bmN0aW9uIGZpbHRlcih0KSB7CiAgICAgICAgcmV0dXJuIGkuZmlsdGVyQnlUeXBlKHQpOwogICAgICB9LAogICAgICByZWdpc3RlcjogZnVuY3Rpb24gcmVnaXN0ZXIodCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgICBvID0gSXIoKGUgPSB0KS5lbGVtZW50KS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0ID0gZS5lbGVtZW50LCBuID0gRnIoZnUgKyAidWlkLSIpLCBtdSh0LCBuKSwgbjsKICAgICAgICAgIHZhciB0LCBuOwogICAgICAgIH0pOwogICAgICAgIG50KGEsIG8pICYmIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgbiA9IGFbb107CiAgICAgICAgICBpZiAobiAhPT0gdCkgdGhyb3cgbmV3IEVycm9yKCdUaGUgdGFnSWQgIicgKyBvICsgJyIgaXMgYWxyZWFkeSB1c2VkIGJ5OiAnICsgQXIobi5lbGVtZW50KSArICJcbkNhbm5vdCB1c2UgaXQgZm9yOiAiICsgQXIodC5lbGVtZW50KSArICJcblRoZSBjb25mbGljdGluZyBlbGVtZW50IGlzIiArIChoZShuLmVsZW1lbnQpID8gIiAiIDogIiBub3QgIikgKyAiYWxyZWFkeSBpbiB0aGUgRE9NIik7CiAgICAgICAgICByKHQpOwogICAgICAgIH0odCksIGkucmVnaXN0ZXJJZChbdF0sIG8sIHQuZXZlbnRzKSwgYVtvXSA9IHQ7CiAgICAgIH0sCiAgICAgIHVucmVnaXN0ZXI6IHIsCiAgICAgIGdldEJ5SWQ6IGZ1bmN0aW9uIGdldEJ5SWQodCkgewogICAgICAgIHJldHVybiB0dChhLCB0KTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uICRiKGUpIHsKICAgIGZ1bmN0aW9uIG8obikgewogICAgICByZXR1cm4gWXQoZS5lbGVtZW50KS5mb2xkKF8sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIEx0KG4sIHQpOwogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzKHQsIG4pIHsKICAgICAgcmV0dXJuIGkuZmluZChvLCB0LCBuKTsKICAgIH0KCiAgICBmdW5jdGlvbiByKG4pIHsKICAgICAgdmFyIHQgPSBpLmZpbHRlcihBaSgpKTsKICAgICAgU3QodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICBMcih0LmRlc2NIYW5kbGVyKShuKTsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIGkgPSBKYigpLAogICAgICAgIHQgPSBZYihlLmVsZW1lbnQsIHsKICAgICAgdHJpZ2dlckV2ZW50OiBmdW5jdGlvbiB0cmlnZ2VyRXZlbnQobiwgZSkgewogICAgICAgIHJldHVybiBOdShuLCBlLnRhcmdldCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBpeShzLCBuLCBlLCBlLnRhcmdldCwgdCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pLAogICAgICAgIHUgPSB7CiAgICAgIGRlYnVnSW5mbzogcnQoInJlYWwiKSwKICAgICAgdHJpZ2dlckV2ZW50OiBmdW5jdGlvbiB0cmlnZ2VyRXZlbnQobiwgZSwgbykgewogICAgICAgIE51KG4sIGUsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gaXkocywgbiwgbywgZSwgdCk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHRyaWdnZXJGb2N1czogZnVuY3Rpb24gdHJpZ2dlckZvY3VzKGEsIGMpIHsKICAgICAgICBJcihhKS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIFNhKGEpOwogICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBOdShEaSgpLCBhLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICB2YXIgbiwKICAgICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgICBvID0gcywKICAgICAgICAgICAgICAgIHIgPSBEaSgpLAogICAgICAgICAgICAgICAgaSA9IHQsCiAgICAgICAgICAgICAgICB1ID0gcWIobiA9IHsKICAgICAgICAgICAgICBvcmlnaW5hdG9yOiBjLAogICAgICAgICAgICAgIGtpbGw6IHN0LAogICAgICAgICAgICAgIHByZXZlbnQ6IHN0LAogICAgICAgICAgICAgIHRhcmdldDogYQogICAgICAgICAgICB9LCBlID0gYSk7CiAgICAgICAgICAgIHJldHVybiBLYihvLCByLCBuLCBlLCB1LCBpKSwgITE7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgdHJpZ2dlckVzY2FwZTogZnVuY3Rpb24gdHJpZ2dlckVzY2FwZSh0LCBuKSB7CiAgICAgICAgdS50cmlnZ2VyRXZlbnQoImtleWRvd24iLCB0LmVsZW1lbnQsIG4uZXZlbnQpOwogICAgICB9LAogICAgICBnZXRCeVVpZDogZnVuY3Rpb24gZ2V0QnlVaWQodCkgewogICAgICAgIHJldHVybiBnKHQpOwogICAgICB9LAogICAgICBnZXRCeURvbTogZnVuY3Rpb24gZ2V0QnlEb20odCkgewogICAgICAgIHJldHVybiBwKHQpOwogICAgICB9LAogICAgICBidWlsZDogX3UsCiAgICAgIGFkZFRvR3VpOiBmdW5jdGlvbiBhZGRUb0d1aSh0KSB7CiAgICAgICAgYyh0KTsKICAgICAgfSwKICAgICAgcmVtb3ZlRnJvbUd1aTogZnVuY3Rpb24gcmVtb3ZlRnJvbUd1aSh0KSB7CiAgICAgICAgbCh0KTsKICAgICAgfSwKICAgICAgYWRkVG9Xb3JsZDogZnVuY3Rpb24gYWRkVG9Xb3JsZCh0KSB7CiAgICAgICAgbih0KTsKICAgICAgfSwKICAgICAgcmVtb3ZlRnJvbVdvcmxkOiBmdW5jdGlvbiByZW1vdmVGcm9tV29ybGQodCkgewogICAgICAgIGEodCk7CiAgICAgIH0sCiAgICAgIGJyb2FkY2FzdDogZnVuY3Rpb24gYnJvYWRjYXN0KHQpIHsKICAgICAgICBmKHQpOwogICAgICB9LAogICAgICBicm9hZGNhc3RPbjogZnVuY3Rpb24gYnJvYWRjYXN0T24odCwgbikgewogICAgICAgIGQodCwgbik7CiAgICAgIH0sCiAgICAgIGJyb2FkY2FzdEV2ZW50OiBmdW5jdGlvbiBicm9hZGNhc3RFdmVudCh0LCBuKSB7CiAgICAgICAgbSh0LCBuKTsKICAgICAgfSwKICAgICAgaXNDb25uZWN0ZWQ6IF8KICAgIH0sCiAgICAgICAgbiA9IGZ1bmN0aW9uIG4odCkgewogICAgICB0LmNvbm5lY3QodSksIFhuKHQuZWxlbWVudCkgfHwgKGkucmVnaXN0ZXIodCksIFN0KHQuY29tcG9uZW50cygpLCBuKSwgdS50cmlnZ2VyRXZlbnQoemkoKSwgdC5lbGVtZW50LCB7CiAgICAgICAgdGFyZ2V0OiB0LmVsZW1lbnQKICAgICAgfSkpOwogICAgfSwKICAgICAgICBhID0gZnVuY3Rpb24gYSh0KSB7CiAgICAgIFhuKHQuZWxlbWVudCkgfHwgKFN0KHQuY29tcG9uZW50cygpLCBhKSwgaS51bnJlZ2lzdGVyKHQpKSwgdC5kaXNjb25uZWN0KCk7CiAgICB9LAogICAgICAgIGMgPSBmdW5jdGlvbiBjKHQpIHsKICAgICAgSXMoZSwgdCk7CiAgICB9LAogICAgICAgIGwgPSBmdW5jdGlvbiBsKHQpIHsKICAgICAgVnModCk7CiAgICB9LAogICAgICAgIGYgPSBmdW5jdGlvbiBmKHQpIHsKICAgICAgcih7CiAgICAgICAgdW5pdmVyc2FsOiAhMCwKICAgICAgICBkYXRhOiB0CiAgICAgIH0pOwogICAgfSwKICAgICAgICBkID0gZnVuY3Rpb24gZCh0LCBuKSB7CiAgICAgIHIoewogICAgICAgIHVuaXZlcnNhbDogITEsCiAgICAgICAgY2hhbm5lbHM6IHQsCiAgICAgICAgZGF0YTogbgogICAgICB9KTsKICAgIH0sCiAgICAgICAgbSA9IGZ1bmN0aW9uIG0odCwgbikgewogICAgICB2YXIgZSwKICAgICAgICAgIG8sCiAgICAgICAgICByID0gaS5maWx0ZXIodCk7CiAgICAgIHJldHVybiBvID0gewogICAgICAgIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7CiAgICAgICAgICBlLnNldCghMCk7CiAgICAgICAgfSwKICAgICAgICBjdXQ6IHN0LAogICAgICAgIGlzU3RvcHBlZDogKGUgPSBWbyghMSkpLmdldCwKICAgICAgICBpc0N1dDogTywKICAgICAgICBldmVudDogbiwKICAgICAgICBzZXRTb3VyY2U6IGsoIkNhbm5vdCBzZXQgc291cmNlIG9mIGEgYnJvYWRjYXN0ZWQgZXZlbnQiKSwKICAgICAgICBnZXRTb3VyY2U6IGsoIkNhbm5vdCBnZXQgc291cmNlIG9mIGEgYnJvYWRjYXN0ZWQgZXZlbnQiKQogICAgICB9LCBTdChyLCBmdW5jdGlvbiAodCkgewogICAgICAgIExyKHQuZGVzY0hhbmRsZXIpKG8pOwogICAgICB9KSwgby5pc1N0b3BwZWQoKTsKICAgIH0sCiAgICAgICAgZyA9IGZ1bmN0aW9uIGcodCkgewogICAgICByZXR1cm4gaS5nZXRCeUlkKHQpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBSZS5lcnJvcihuZXcgRXJyb3IoJ0NvdWxkIG5vdCBmaW5kIGNvbXBvbmVudCB3aXRoIHVpZDogIicgKyB0ICsgJyIgaW4gc3lzdGVtLicpKTsKICAgICAgfSwgUmUudmFsdWUpOwogICAgfSwKICAgICAgICBwID0gZnVuY3Rpb24gcCh0KSB7CiAgICAgIHZhciBuID0gSXIodCkuZ2V0T3IoIm5vdCBmb3VuZCIpOwogICAgICByZXR1cm4gZyhuKTsKICAgIH07CgogICAgcmV0dXJuIG4oZSksIHsKICAgICAgcm9vdDogZSwKICAgICAgZWxlbWVudDogZS5lbGVtZW50LAogICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgIHQudW5iaW5kKCksIFRlKGUuZWxlbWVudCk7CiAgICAgIH0sCiAgICAgIGFkZDogYywKICAgICAgcmVtb3ZlOiBsLAogICAgICBnZXRCeVVpZDogZywKICAgICAgZ2V0QnlEb206IHAsCiAgICAgIGFkZFRvV29ybGQ6IG4sCiAgICAgIHJlbW92ZUZyb21Xb3JsZDogYSwKICAgICAgYnJvYWRjYXN0OiBmLAogICAgICBicm9hZGNhc3RPbjogZCwKICAgICAgYnJvYWRjYXN0RXZlbnQ6IG0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBRYih0LCBuLCBlLCBvKSB7CiAgICB2YXIgciA9IG15KHQsIG4sIGUsIG8pOwogICAgcmV0dXJuIHN5LnNrZXRjaChyKTsKICB9CgogIGZ1bmN0aW9uIFpiKHQsIG4pIHsKICAgIHJldHVybiBzeS5wYXJ0cy5sYWJlbCh7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImxhYmVsIiwKICAgICAgICBjbGFzc2VzOiBbInRveC1sYWJlbCJdLAogICAgICAgIGlubmVySHRtbDogbi50cmFuc2xhdGUodCkKICAgICAgfQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB0eSh0KSB7CiAgICByZXR1cm4gdGMoW1ZnLmNvbmZpZyh7CiAgICAgIG9uRm9jdXM6IHQuc2VsZWN0T25Gb2N1cyA/IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSB0LmVsZW1lbnQsCiAgICAgICAgICAgIGUgPSAkcihuKTsKICAgICAgICBuLmRvbS5zZXRTZWxlY3Rpb25SYW5nZSgwLCBlLmxlbmd0aCk7CiAgICAgIH0gOiBzdAogICAgfSldKTsKICB9CgogIGZ1bmN0aW9uIG55KHQpIHsKICAgIHJldHVybiB7CiAgICAgIHRhZzogdC50YWcsCiAgICAgIGF0dHJpYnV0ZXM6IF9sdCh7CiAgICAgICAgdHlwZTogInRleHQiCiAgICAgIH0sIHQuaW5wdXRBdHRyaWJ1dGVzKSwKICAgICAgc3R5bGVzOiB0LmlucHV0U3R5bGVzLAogICAgICBjbGFzc2VzOiB0LmlucHV0Q2xhc3NlcwogICAgfTsKICB9CgogIChfYiA9IE9iID0ge30pW19iLkNvbnRlbnRGb2N1cyA9IDBdID0gIkNvbnRlbnRGb2N1cyIsIF9iW19iLlVpRm9jdXMgPSAxXSA9ICJVaUZvY3VzIjsKCiAgZnVuY3Rpb24gZXkoZiwgYykgewogICAgZnVuY3Rpb24gZSgpIHsKICAgICAgcmV0dXJuIHIuZ2V0KCkuaXNTb21lKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcygpIHsKICAgICAgZSgpICYmIHJwLmhpZGUoZCk7CiAgICB9CgogICAgdmFyIG8sCiAgICAgICAgdCwKICAgICAgICByID0gZGMoKSwKICAgICAgICBsID0gVm8oITEpLAogICAgICAgIGQgPSBfdShycC5za2V0Y2goewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LWF1dG9jb21wbGV0ZXIiXQogICAgICB9LAogICAgICBjb21wb25lbnRzOiBbXSwKICAgICAgZmlyZURpc21pc3NhbEV2ZW50SW5zdGVhZDoge30sCiAgICAgIGlubGluZUJlaGF2aW91cnM6IHRjKFtmbSgiZGlzbWlzc0F1dG9jb21wbGV0ZXIiLCBbQ3IoWGkoKSwgZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBtKCk7CiAgICAgIH0pXSldKSwKICAgICAgbGF6eVNpbms6IGMuZ2V0U2luawogICAgfSkpLAogICAgICAgIG0gPSBmdW5jdGlvbiBtKCkgewogICAgICB2YXIgdDsKICAgICAgZSgpICYmICh0ID0gci5nZXQoKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdC5lbGVtZW50OwogICAgICB9KSwgRHAodC5nZXRPcihBdC5mcm9tRG9tKGYuc2VsZWN0aW9uLmdldE5vZGUoKSkpKS5lYWNoKEZuKSwgcygpLCByLmNsZWFyKCksIGwuc2V0KCExKSk7CiAgICB9LAogICAgICAgIHUgPSBSdChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBlID0gZHQoZi51aS5yZWdpc3RyeS5nZXRBbGwoKS5wb3B1cHMsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHVvKCJBdXRvY29tcGxldGVyIiwgUnAsIHQpLmZvbGQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihpcih0KSk7CiAgICAgICAgfSwgaCk7CiAgICAgIH0pLCB0ID0gJChlLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0LmNoOwogICAgICB9KSwgbiA9IHt9LCBTdCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgIG5bdF0gPSB7fTsKICAgICAgfSksIG8gPSBrdChuKSwgciA9IFooZSksIHsKICAgICAgICBkYXRhc2V0OiBlLAogICAgICAgIHRyaWdnZXJDaGFyczogbywKICAgICAgICBsb29rdXBCeUNoYXI6IGZ1bmN0aW9uIGxvb2t1cEJ5Q2hhcihuKSB7CiAgICAgICAgICByZXR1cm4gRihyLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdC5jaCA9PT0gbjsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIHQsIG4sIGUsIG8sIHI7CiAgICB9KSwKICAgICAgICBnID0gZnVuY3Rpb24gZyh0KSB7CiAgICAgIHZhciBuID0gdDsKICAgICAgci5nZXQoKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gd3AoZi5kb20sIGYuc2VsZWN0aW9uLmdldFJuZygpLCB0LnRyaWdnZXJDaGFyKS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gT3AoZiwgdSwgdCwgbik7CiAgICAgICAgfSk7CiAgICAgIH0pLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuID0gZiwgdCA9IChlID0gdSkoKSwgbyA9IG4uc2VsZWN0aW9uLmdldFJuZygpLCByID0gbi5kb20sIGkgPSBvLCBLKHQudHJpZ2dlckNoYXJzLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHdwKHIsIGksIHQpOwogICAgICAgIH0pLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBPcChuLCBlLCB0KTsKICAgICAgICB9KTsKICAgICAgICB2YXIgbiwgZSwgdCwgbywgciwgaTsKICAgICAgfSkuZm9sZChtLCBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICBuID0gYS5jb250ZXh0OwogICAgICAgIGUoKSB8fCAodCA9IHZwKGYsIG4ucmFuZ2UpLCByLnNldCh7CiAgICAgICAgICB0cmlnZ2VyQ2hhcjogbi50cmlnZ2VyQ2hhciwKICAgICAgICAgIGVsZW1lbnQ6IHQsCiAgICAgICAgICBtYXRjaExlbmd0aDogbi50ZXh0Lmxlbmd0aAogICAgICAgIH0pLCBsLnNldCghMSkpLCBhLmxvb2t1cERhdGEudGhlbihmdW5jdGlvbiAodSkgewogICAgICAgICAgci5nZXQoKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdmFyIG4sCiAgICAgICAgICAgICAgICBlLAogICAgICAgICAgICAgICAgbywKICAgICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgICBpID0gYS5jb250ZXh0OwogICAgICAgICAgICB0LnRyaWdnZXJDaGFyID09PSBpLnRyaWdnZXJDaGFyICYmIChlID0gaS50cmlnZ2VyQ2hhciwgciA9IEsobyA9IHUsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHZ0LmZyb20odC5jb2x1bW5zKTsKICAgICAgICAgICAgfSkuZ2V0T3IoMSksIDAgPCAobiA9IHoobywgZnVuY3Rpb24gKGkpIHsKICAgICAgICAgICAgICByZXR1cm4gTmIoaS5pdGVtcywgaS5tYXRjaFRleHQsIGZ1bmN0aW9uIChvLCByKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IGYuc2VsZWN0aW9uLmdldFJuZygpOwogICAgICAgICAgICAgICAgd3AoZi5kb20sIHQsIGUpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcigiTG9zdCBjb250ZXh0LiBDdXJzb3IgcHJvYmFibHkgbW92ZWQiKTsKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBuID0gdC5yYW5nZSwKICAgICAgICAgICAgICAgICAgICAgIGUgPSB7CiAgICAgICAgICAgICAgICAgICAgaGlkZTogZnVuY3Rpb24gaGlkZSgpIHsKICAgICAgICAgICAgICAgICAgICAgIG0oKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHJlbG9hZDogZnVuY3Rpb24gcmVsb2FkKHQpIHsKICAgICAgICAgICAgICAgICAgICAgIHMoKSwgZyh0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIGwuc2V0KCEwKSwgaS5vbkFjdGlvbihlLCBuLCBvLCByKSwgbC5zZXQoITEpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSwgciwgeGguQlVCQkxFX1RPX1NBTkRCT1gsIGMsIGkuaGlnaGxpZ2h0T24pOwogICAgICAgICAgICB9KSkubGVuZ3RoID8gZnVuY3Rpb24gKHQsIG4sIGUsIG8pIHsKICAgICAgICAgICAgICB0Lm1hdGNoTGVuZ3RoID0gbi50ZXh0Lmxlbmd0aDsKICAgICAgICAgICAgICB2YXIgciwKICAgICAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICAgICAgdSwKICAgICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgICAgYywKICAgICAgICAgICAgICAgICAgcywKICAgICAgICAgICAgICAgICAgbCA9IEsoZSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2dC5mcm9tKHQuY29sdW1ucyk7CiAgICAgICAgICAgICAgfSkuZ2V0T3IoMSk7CiAgICAgICAgICAgICAgcnAuc2hvd0F0KGQsIFFnLnNrZXRjaCgociA9IHJoKCJhdXRvY29tcGxldGVyLXZhbHVlIiwgITAsIG8sIGwsICJub3JtYWwiKSwgaSA9IGwsIGEgPSAoKHUgPSBPYi5Db250ZW50Rm9jdXMpID09PSBPYi5Db250ZW50Rm9jdXMgPyBMbCA6IE5sKSgpLCBjID0ga2IoaSwgIm5vcm1hbCIpLCBzID0gSnAoIm5vcm1hbCIpLCB7CiAgICAgICAgICAgICAgICBkb206IHIuZG9tLAogICAgICAgICAgICAgICAgY29tcG9uZW50czogci5jb21wb25lbnRzLAogICAgICAgICAgICAgICAgaXRlbXM6IHIuaXRlbXMsCiAgICAgICAgICAgICAgICB2YWx1ZTogci52YWx1ZSwKICAgICAgICAgICAgICAgIG1hcmtlcnM6IHsKICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtOiBzLnNlbGVjdGVkSXRlbSwKICAgICAgICAgICAgICAgICAgaXRlbTogcy5pdGVtCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbW92ZW1lbnQ6IGMsCiAgICAgICAgICAgICAgICBmYWtlRm9jdXM6IHUgPT09IE9iLkNvbnRlbnRGb2N1cywKICAgICAgICAgICAgICAgIGZvY3VzTWFuYWdlcjogYSwKICAgICAgICAgICAgICAgIG1lbnVCZWhhdmlvdXJzOiBZaCgiYXV0byIgIT09IGkgPyBbXSA6IFtldShmdW5jdGlvbiAobywgdCkgewogICAgICAgICAgICAgICAgICBpaChvLCA0LCBzLml0ZW0pLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHQubnVtQ29sdW1ucywKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHQubnVtUm93czsKICAgICAgICAgICAgICAgICAgICBNZy5zZXRHcmlkU2l6ZShvLCBlLCBuKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KV0pCiAgICAgICAgICAgICAgfSkpLCB7CiAgICAgICAgICAgICAgICBhbmNob3I6IHsKICAgICAgICAgICAgICAgICAgdHlwZTogIm5vZGUiLAogICAgICAgICAgICAgICAgICByb290OiBBdC5mcm9tRG9tKGYuZ2V0Qm9keSgpKSwKICAgICAgICAgICAgICAgICAgbm9kZTogdnQuZnJvbSh0LmVsZW1lbnQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSksIHJwLmdldENvbnRlbnQoZCkuZWFjaChnZC5oaWdobGlnaHRGaXJzdCk7CiAgICAgICAgICAgIH0odCwgaSwgdSwgbikgOiAoMTAgPD0gaS50ZXh0Lmxlbmd0aCAtIHQubWF0Y2hMZW5ndGggPyBtIDogcykoKSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgICAgIG4gPSB7CiAgICAgIG9uS2V5cHJlc3M6IHBwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgMjcgIT09IHQud2hpY2ggJiYgZygpOwogICAgICB9LCA1MCksCiAgICAgIGNhbmNlbElmTmVjZXNzYXJ5OiBtLAogICAgICBpc01lbnVPcGVuOiBmdW5jdGlvbiBpc01lbnVPcGVuKCkgewogICAgICAgIHJldHVybiBycC5pc09wZW4oZCk7CiAgICAgIH0sCiAgICAgIGlzQWN0aXZlOiBlLAogICAgICBpc1Byb2Nlc3NpbmdBY3Rpb246IGwuZ2V0LAogICAgICBnZXRWaWV3OiBmdW5jdGlvbiBnZXRWaWV3KCkgewogICAgICAgIHJldHVybiBycC5nZXRDb250ZW50KGQpOwogICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIGkodCwgbikgewogICAgICB2cih0LCB5aSgpLCB7CiAgICAgICAgcmF3OiBuCiAgICAgIH0pOwogICAgfQoKICAgICExID09PSBmLmhhc1BsdWdpbigicnRjIikgJiYgKG8gPSBuLCAodCA9IGYpLm9uKCJrZXlwcmVzcyBjb21wb3NpdGlvbmVuZCIsIG8ub25LZXlwcmVzcy50aHJvdHRsZSksIHQub24oInJlbW92ZSIsIG8ub25LZXlwcmVzcy5jYW5jZWwpLCB0Lm9uKCJrZXlkb3duIiwgZnVuY3Rpb24gKG4pIHsKICAgICAgZnVuY3Rpb24gdCgpIHsKICAgICAgICByZXR1cm4gby5nZXRWaWV3KCkuYmluZChnZC5nZXRIaWdobGlnaHRlZCk7CiAgICAgIH0KCiAgICAgIDggPT09IG4ud2hpY2ggJiYgby5vbktleXByZXNzLnRocm90dGxlKG4pLCBvLmlzQWN0aXZlKCkgJiYgKDI3ID09PSBuLndoaWNoICYmIG8uY2FuY2VsSWZOZWNlc3NhcnkoKSwgby5pc01lbnVPcGVuKCkgPyAxMyA9PT0gbi53aGljaCA/ICh0KCkuZWFjaChiciksIG4ucHJldmVudERlZmF1bHQoKSkgOiA0MCA9PT0gbi53aGljaCA/ICh0KCkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgby5nZXRWaWV3KCkuZWFjaChnZC5oaWdobGlnaHRGaXJzdCk7CiAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaSh0LCBuKTsKICAgICAgfSksIG4ucHJldmVudERlZmF1bHQoKSwgbi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSkgOiAzNyAhPT0gbi53aGljaCAmJiAzOCAhPT0gbi53aGljaCAmJiAzOSAhPT0gbi53aGljaCB8fCB0KCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIGkodCwgbiksIG4ucHJldmVudERlZmF1bHQoKSwgbi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgfSkgOiAxMyAhPT0gbi53aGljaCAmJiAzOCAhPT0gbi53aGljaCAmJiA0MCAhPT0gbi53aGljaCB8fCBvLmNhbmNlbElmTmVjZXNzYXJ5KCkpOwogICAgfSksIHQub24oIk5vZGVDaGFuZ2UiLCBmdW5jdGlvbiAodCkgewogICAgICBvLmlzQWN0aXZlKCkgJiYgIW8uaXNQcm9jZXNzaW5nQWN0aW9uKCkgJiYgRHAoQXQuZnJvbURvbSh0LmVsZW1lbnQpKS5pc05vbmUoKSAmJiBvLmNhbmNlbElmTmVjZXNzYXJ5KCk7CiAgICB9KSk7CiAgfQoKICB2YXIgb3kgPSBQbyhbewogICAgc3RvcHBlZDogW10KICB9LCB7CiAgICByZXN1bWU6IFsiZWxlbWVudCJdCiAgfSwgewogICAgY29tcGxldGU6IFtdCiAgfV0pLAogICAgICByeSA9IGZ1bmN0aW9uIHJ5KG4sIGUsIG8sIHQsIHIsIGkpIHsKICAgIHJldHVybiBLYihuLCBlLCBvLCB0LCByLCBpKS5mb2xkKF8sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiByeShuLCBlLCBvLCB0LCByLCBpKTsKICAgIH0sIE8pOwogIH0sCiAgICAgIGl5ID0gZnVuY3Rpb24gaXkodCwgbiwgZSwgbywgcikgewogICAgdmFyIGkgPSBxYihlLCBvKTsKICAgIHJldHVybiByeSh0LCBuLCBlLCBvLCBpLCByKTsKICB9LAogICAgICB1eSA9IHdsKHsKICAgIG5hbWU6ICJDb250YWluZXIiLAogICAgZmFjdG9yeTogZnVuY3Rpb24gZmFjdG9yeSh0KSB7CiAgICAgIHZhciBuID0gdC5kb20sCiAgICAgICAgICBlID0gbi5hdHRyaWJ1dGVzLAogICAgICAgICAgbyA9IHMobiwgWyJhdHRyaWJ1dGVzIl0pOwogICAgICByZXR1cm4gewogICAgICAgIHVpZDogdC51aWQsCiAgICAgICAgZG9tOiBfbHQoewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGF0dHJpYnV0ZXM6IF9sdCh7CiAgICAgICAgICAgIHJvbGU6ICJwcmVzZW50YXRpb24iCiAgICAgICAgICB9LCBlKQogICAgICAgIH0sIG8pLAogICAgICAgIGNvbXBvbmVudHM6IHQuY29tcG9uZW50cywKICAgICAgICBiZWhhdmlvdXJzOiBRcyh0LmNvbnRhaW5lckJlaGF2aW91cnMpLAogICAgICAgIGV2ZW50czogdC5ldmVudHMsCiAgICAgICAgZG9tTW9kaWZpY2F0aW9uOiB0LmRvbU1vZGlmaWNhdGlvbiwKICAgICAgICBldmVudE9yZGVyOiB0LmV2ZW50T3JkZXIKICAgICAgfTsKICAgIH0sCiAgICBjb25maWdGaWVsZHM6IFtUbygiY29tcG9uZW50cyIsIFtdKSwgJHMoImNvbnRhaW5lckJlaGF2aW91cnMiLCBbXSksIFRvKCJldmVudHMiLCB7fSksIFRvKCJkb21Nb2RpZmljYXRpb24iLCB7fSksIFRvKCJldmVudE9yZGVyIiwge30pXQogIH0pLAogICAgICBheSA9IHJ0KFtUbygicHJlZml4IiwgImZvcm0tZmllbGQiKSwgJHMoImZpZWxkQmVoYXZpb3VycyIsIFt1ZCwgVGZdKV0pLAogICAgICBjeSA9IHJ0KFtKZih7CiAgICBzY2hlbWE6IFtmbygiZG9tIildLAogICAgbmFtZTogImxhYmVsIgogIH0pLCBKZih7CiAgICBmYWN0b3J5OiB7CiAgICAgIHNrZXRjaDogZnVuY3Rpb24gc2tldGNoKHQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdWlkOiB0LnVpZCwKICAgICAgICAgIGRvbTogewogICAgICAgICAgICB0YWc6ICJzcGFuIiwKICAgICAgICAgICAgc3R5bGVzOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogIm5vbmUiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgICAiYXJpYS1oaWRkZW4iOiAidHJ1ZSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW5uZXJIdG1sOiB0LnRleHQKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CiAgICB9LAogICAgc2NoZW1hOiBbZm8oInRleHQiKV0sCiAgICBuYW1lOiAiYXJpYS1kZXNjcmlwdG9yIgogIH0pLCBxZih7CiAgICBmYWN0b3J5OiB7CiAgICAgIHNrZXRjaDogZnVuY3Rpb24gc2tldGNoKHQpIHsKICAgICAgICB2YXIgZSwKICAgICAgICAgICAgbywKICAgICAgICAgICAgbiA9IChlID0gWyJmYWN0b3J5Il0sIG8gPSB7fSwgSih0LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgd3QoZSwgbikgfHwgKG9bbl0gPSB0KTsKICAgICAgICB9KSwgbyk7CiAgICAgICAgcmV0dXJuIHQuZmFjdG9yeS5za2V0Y2gobik7CiAgICAgIH0KICAgIH0sCiAgICBzY2hlbWE6IFtmbygiZmFjdG9yeSIpXSwKICAgIG5hbWU6ICJmaWVsZCIKICB9KV0pLAogICAgICBzeSA9IFNsKHsKICAgIG5hbWU6ICJGb3JtRmllbGQiLAogICAgY29uZmlnRmllbGRzOiBheSgpLAogICAgcGFydEZpZWxkczogY3koKSwKICAgIGZhY3Rvcnk6IGZ1bmN0aW9uIGZhY3RvcnkociwgdCwgbiwgZSkgewogICAgICB2YXIgbyA9IFpzKHIuZmllbGRCZWhhdmlvdXJzLCBbdWQuY29uZmlnKHsKICAgICAgICBmaW5kOiBmdW5jdGlvbiBmaW5kKHQpIHsKICAgICAgICAgIHJldHVybiBmbCh0LCByLCAiZmllbGQiKTsKICAgICAgICB9CiAgICAgIH0pLCBUZi5jb25maWcoewogICAgICAgIHN0b3JlOiB7CiAgICAgICAgICBtb2RlOiAibWFudWFsIiwKICAgICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSh0KSB7CiAgICAgICAgICAgIHJldHVybiB1ZC5nZXRDdXJyZW50KHQpLmJpbmQoVGYuZ2V0VmFsdWUpOwogICAgICAgICAgfSwKICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh0LCBuKSB7CiAgICAgICAgICAgIHVkLmdldEN1cnJlbnQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIFRmLnNldFZhbHVlKHQsIG4pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pXSksCiAgICAgICAgICBpID0gbnUoW2V1KGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgdmFyIG8gPSBtbCh0LCByLCBbImxhYmVsIiwgImZpZWxkIiwgImFyaWEtZGVzY3JpcHRvciJdKTsKICAgICAgICBvLmZpZWxkKCkuZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIG4gPSBGcihyLnByZWZpeCk7CiAgICAgICAgICBvLmxhYmVsKCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICBvbih0LmVsZW1lbnQsICJmb3IiLCBuKSwgb24oZS5lbGVtZW50LCAiaWQiLCBuKTsKICAgICAgICAgIH0pLCBvWyJhcmlhLWRlc2NyaXB0b3IiXSgpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdmFyIG4gPSBGcihyLnByZWZpeCk7CiAgICAgICAgICAgIG9uKHQuZWxlbWVudCwgImlkIiwgbiksIG9uKGUuZWxlbWVudCwgImFyaWEtZGVzY3JpYmVkYnkiLCBuKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KV0pOwogICAgICByZXR1cm4gewogICAgICAgIHVpZDogci51aWQsCiAgICAgICAgZG9tOiByLmRvbSwKICAgICAgICBjb21wb25lbnRzOiB0LAogICAgICAgIGJlaGF2aW91cnM6IG8sCiAgICAgICAgZXZlbnRzOiBpLAogICAgICAgIGFwaXM6IHsKICAgICAgICAgIGdldEZpZWxkOiBmdW5jdGlvbiBnZXRGaWVsZCh0KSB7CiAgICAgICAgICAgIHJldHVybiBmbCh0LCByLCAiZmllbGQiKTsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXRMYWJlbDogZnVuY3Rpb24gZ2V0TGFiZWwodCkgewogICAgICAgICAgICByZXR1cm4gZmwodCwgciwgImxhYmVsIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgfSwKICAgIGFwaXM6IHsKICAgICAgZ2V0RmllbGQ6IGZ1bmN0aW9uIGdldEZpZWxkKHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5nZXRGaWVsZChuKTsKICAgICAgfSwKICAgICAgZ2V0TGFiZWw6IGZ1bmN0aW9uIGdldExhYmVsKHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5nZXRMYWJlbChuKTsKICAgICAgfQogICAgfQogIH0pLAogICAgICBseSA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgZXhoaWJpdDogZnVuY3Rpb24gZXhoaWJpdCh0LCBuKSB7CiAgICAgIHJldHVybiBOcih7CiAgICAgICAgYXR0cmlidXRlczogc3IoW3sKICAgICAgICAgIGtleTogbi50YWJBdHRyLAogICAgICAgICAgdmFsdWU6ICJ0cnVlIgogICAgICAgIH1dKQogICAgICB9KTsKICAgIH0KICB9KSwKICAgICAgZnkgPSB5YSh7CiAgICBmaWVsZHM6IFtUbygidGFiQXR0ciIsICJkYXRhLWFsbG95LXRhYnN0b3AiKV0sCiAgICBuYW1lOiAidGFic3RvcHBpbmciLAogICAgYWN0aXZlOiBseQogIH0pLAogICAgICBkeSA9IHRpbnltY2UudXRpbC5Ub29scy5yZXNvbHZlKCJ0aW55bWNlLmh0bWwuRW50aXRpZXMiKSwKICAgICAgbXkgPSBmdW5jdGlvbiBteSh0LCBuLCBlLCBvKSB7CiAgICByZXR1cm4gewogICAgICBkb206IGd5KGUpLAogICAgICBjb21wb25lbnRzOiB0LnRvQXJyYXkoKS5jb25jYXQoW25dKSwKICAgICAgZmllbGRCZWhhdmlvdXJzOiB0YyhvKQogICAgfTsKICB9LAogICAgICBneSA9IGZ1bmN0aW9uIGd5KHQpIHsKICAgIHJldHVybiB7CiAgICAgIHRhZzogImRpdiIsCiAgICAgIGNsYXNzZXM6IFsidG94LWZvcm1fX2dyb3VwIl0uY29uY2F0KHQpCiAgICB9OwogIH0sCiAgICAgIHB5ID0gRnIoImZvcm0tY29tcG9uZW50LWNoYW5nZSIpLAogICAgICBoeSA9IEZyKCJmb3JtLWNsb3NlIiksCiAgICAgIHZ5ID0gRnIoImZvcm0tY2FuY2VsIiksCiAgICAgIGJ5ID0gRnIoImZvcm0tYWN0aW9uIiksCiAgICAgIHl5ID0gRnIoImZvcm0tc3VibWl0IiksCiAgICAgIHh5ID0gRnIoImZvcm0tYmxvY2siKSwKICAgICAgd3kgPSBGcigiZm9ybS11bmJsb2NrIiksCiAgICAgIFN5ID0gRnIoImZvcm0tdGFiY2hhbmdlIiksCiAgICAgIEN5ID0gRnIoImZvcm0tcmVzaXplIiksCiAgICAgIGt5ID0gcnQoW3hvKCJkYXRhIiksIFRvKCJpbnB1dEF0dHJpYnV0ZXMiLCB7fSksIFRvKCJpbnB1dFN0eWxlcyIsIHt9KSwgVG8oInRhZyIsICJpbnB1dCIpLCBUbygiaW5wdXRDbGFzc2VzIiwgW10pLCBLdSgib25TZXRWYWx1ZSIpLCBUbygic3R5bGVzIiwge30pLCBUbygiZXZlbnRPcmRlciIsIHt9KSwgJHMoImlucHV0QmVoYXZpb3VycyIsIFtUZiwgVmddKSwgVG8oInNlbGVjdE9uRm9jdXMiLCAhMCldKSwKICAgICAgT3kgPSB3bCh7CiAgICBuYW1lOiAiSW5wdXQiLAogICAgY29uZmlnRmllbGRzOiBreSgpLAogICAgZmFjdG9yeTogZnVuY3Rpb24gZmFjdG9yeSh0LCBuKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdWlkOiB0LnVpZCwKICAgICAgICBkb206IG55KHQpLAogICAgICAgIGNvbXBvbmVudHM6IFtdLAogICAgICAgIGJlaGF2aW91cnM6IF9sdChfbHQoe30sIHR5KGUgPSB0KSksIFpzKGUuaW5wdXRCZWhhdmlvdXJzLCBbVGYuY29uZmlnKHsKICAgICAgICAgIHN0b3JlOiBfbHQoX2x0KHsKICAgICAgICAgICAgbW9kZTogIm1hbnVhbCIKICAgICAgICAgIH0sIGUuZGF0YS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBpbml0aWFsVmFsdWU6IHQKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pLmdldE9yKHt9KSksIHsKICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gJHIodC5lbGVtZW50KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKHQsIG4pIHsKICAgICAgICAgICAgICAkcih0LmVsZW1lbnQpICE9PSBuICYmIFFyKHQuZWxlbWVudCwgbik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLAogICAgICAgICAgb25TZXRWYWx1ZTogZS5vblNldFZhbHVlCiAgICAgICAgfSldKSksCiAgICAgICAgZXZlbnRPcmRlcjogdC5ldmVudE9yZGVyCiAgICAgIH07CiAgICAgIHZhciBlOwogICAgfQogIH0pLAogICAgICBfeSA9IHt9LAogICAgICBUeSA9IHsKICAgIGV4cG9ydHM6IF95CiAgfTsKCiAgZnVuY3Rpb24gRXkodCkgewogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIHRocm93IHQ7CiAgICB9LCAwKTsKICB9CgogIGZ1bmN0aW9uIER5KHQpIHsKICAgIHZhciBuID0gRnQodCk7CiAgICByZXR1cm4gd3QoV3ksIG4pOwogIH0KCiAgZnVuY3Rpb24gQnkodCwgbikgewogICAgWXIobi5nZXRSb290KHQpLmdldE9yKHQuZWxlbWVudCksIG4uaW52YWxpZENsYXNzKSwgbi5ub3RpZnkuZWFjaChmdW5jdGlvbiAobikgewogICAgICBEeSh0LmVsZW1lbnQpICYmIG9uKHQuZWxlbWVudCwgImFyaWEtaW52YWxpZCIsICExKSwgbi5nZXRDb250YWluZXIodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIE1yKHQsIG4udmFsaWRIdG1sKTsKICAgICAgfSksIG4ub25WYWxpZCh0KTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gTXkobiwgdCwgZSwgbykgewogICAgWHIodC5nZXRSb290KG4pLmdldE9yKG4uZWxlbWVudCksIHQuaW52YWxpZENsYXNzKSwgdC5ub3RpZnkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICBEeShuLmVsZW1lbnQpICYmIG9uKG4uZWxlbWVudCwgImFyaWEtaW52YWxpZCIsICEwKSwgdC5nZXRDb250YWluZXIobikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIE1yKHQsIG8pOwogICAgICB9KSwgdC5vbkludmFsaWQobiwgbyk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIEF5KG4sIHQsIGUpIHsKICAgIHJldHVybiB0LnZhbGlkYXRvci5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIEx5KFJlLnZhbHVlKCEwKSk7CiAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdC52YWxpZGF0ZShuKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gRnkobiwgZSwgdCkgewogICAgcmV0dXJuIGUubm90aWZ5LmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgdC5vblZhbGlkYXRlKG4pOwogICAgfSksIEF5KG4sIGUpLm1hcChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gbi5nZXRTeXN0ZW0oKS5pc0Nvbm5lY3RlZCgpID8gdC5mb2xkKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIE15KG4sIGUsIDAsIHQpLCBSZS5lcnJvcih0KTsKICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gQnkobiwgZSksIFJlLnZhbHVlKHQpOwogICAgICB9KSA6IFJlLmVycm9yKCJObyBsb25nZXIgaW4gc3lzdGVtIik7CiAgICB9KTsKICB9CgogICFmdW5jdGlvbiAoKSB7CiAgICB2YXIgdCA9IHRoaXMsCiAgICAgICAgbiA9IGZ1bmN0aW9uIG4oKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGUsCiAgICAgICAgICBvID0gewogICAgICAgIGV4cG9ydHM6IHt9CiAgICAgIH07CgogICAgICBmdW5jdGlvbiByKCkge30KCiAgICAgIGZ1bmN0aW9uIGkodCkgewogICAgICAgIGlmICgib2JqZWN0IiAhPSBfdHlwZW9mKHRoaXMpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJQcm9taXNlcyBtdXN0IGJlIGNvbnN0cnVjdGVkIHZpYSBuZXciKTsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgdCkgdGhyb3cgbmV3IFR5cGVFcnJvcigibm90IGEgZnVuY3Rpb24iKTsKICAgICAgICB0aGlzLl9zdGF0ZSA9IDAsIHRoaXMuX2hhbmRsZWQgPSAhMSwgdGhpcy5fdmFsdWUgPSB2b2lkIDAsIHRoaXMuX2RlZmVycmVkcyA9IFtdLCBmKHQsIHRoaXMpOwogICAgICB9CgogICAgICBmdW5jdGlvbiB1KGUsIG8pIHsKICAgICAgICBmb3IgKDsgMyA9PT0gZS5fc3RhdGU7KSB7CiAgICAgICAgICBlID0gZS5fdmFsdWU7CiAgICAgICAgfQoKICAgICAgICAwICE9PSBlLl9zdGF0ZSA/IChlLl9oYW5kbGVkID0gITAsIGkuX2ltbWVkaWF0ZUZuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0LAogICAgICAgICAgICAgIG4gPSAxID09PSBlLl9zdGF0ZSA/IG8ub25GdWxmaWxsZWQgOiBvLm9uUmVqZWN0ZWQ7CgogICAgICAgICAgaWYgKG51bGwgIT09IG4pIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB0ID0gbihlLl92YWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gdm9pZCBjKG8ucHJvbWlzZSwgdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGEoby5wcm9taXNlLCB0KTsKICAgICAgICAgIH0gZWxzZSAoMSA9PT0gZS5fc3RhdGUgPyBhIDogYykoby5wcm9taXNlLCBlLl92YWx1ZSk7CiAgICAgICAgfSkpIDogZS5fZGVmZXJyZWRzLnB1c2gobyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGEobiwgdCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAodCA9PT0gbikgdGhyb3cgbmV3IFR5cGVFcnJvcigiQSBwcm9taXNlIGNhbm5vdCBiZSByZXNvbHZlZCB3aXRoIGl0c2VsZi4iKTsKCiAgICAgICAgICBpZiAodCAmJiAoIm9iamVjdCIgPT0gX3R5cGVvZih0KSB8fCAiZnVuY3Rpb24iID09IHR5cGVvZiB0KSkgewogICAgICAgICAgICB2YXIgZSA9IHQudGhlbjsKICAgICAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBpKSByZXR1cm4gbi5fc3RhdGUgPSAzLCBuLl92YWx1ZSA9IHQsIHZvaWQgcyhuKTsKICAgICAgICAgICAgaWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGUpIHJldHVybiB2b2lkIGYoKG8gPSBlLCByID0gdCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIG8uYXBwbHkociwgYXJndW1lbnRzKTsKICAgICAgICAgICAgfSksIG4pOwogICAgICAgICAgfQoKICAgICAgICAgIG4uX3N0YXRlID0gMSwgbi5fdmFsdWUgPSB0LCBzKG4pOwogICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgIGMobiwgdCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbywgcjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYyh0LCBuKSB7CiAgICAgICAgdC5fc3RhdGUgPSAyLCB0Ll92YWx1ZSA9IG4sIHModCk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHModCkgewogICAgICAgIDIgPT09IHQuX3N0YXRlICYmIDAgPT09IHQuX2RlZmVycmVkcy5sZW5ndGggJiYgaS5faW1tZWRpYXRlRm4oZnVuY3Rpb24gKCkgewogICAgICAgICAgdC5faGFuZGxlZCB8fCBpLl91bmhhbmRsZWRSZWplY3Rpb25Gbih0Ll92YWx1ZSk7CiAgICAgICAgfSk7CgogICAgICAgIGZvciAodmFyIG4gPSAwLCBlID0gdC5fZGVmZXJyZWRzLmxlbmd0aDsgbiA8IGU7IG4rKykgewogICAgICAgICAgdSh0LCB0Ll9kZWZlcnJlZHNbbl0pOwogICAgICAgIH0KCiAgICAgICAgdC5fZGVmZXJyZWRzID0gbnVsbDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbCh0LCBuLCBlKSB7CiAgICAgICAgdGhpcy5vbkZ1bGZpbGxlZCA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgPyB0IDogbnVsbCwgdGhpcy5vblJlamVjdGVkID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgbiA/IG4gOiBudWxsLCB0aGlzLnByb21pc2UgPSBlOwogICAgICB9CgogICAgICBmdW5jdGlvbiBmKHQsIG4pIHsKICAgICAgICB2YXIgZSA9ICExOwoKICAgICAgICB0cnkgewogICAgICAgICAgdChmdW5jdGlvbiAodCkgewogICAgICAgICAgICBlIHx8IChlID0gITAsIGEobiwgdCkpOwogICAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgZSB8fCAoZSA9ICEwLCBjKG4sIHQpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgIGlmIChlKSByZXR1cm47CiAgICAgICAgICBlID0gITAsIGMobiwgdCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0ID0gbywgbiA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWxUaGlzID8gZ2xvYmFsVGhpcyA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgPyB3aW5kb3cgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsID8gZ2xvYmFsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgPyBzZWxmIDoge30sIGUgPSBzZXRUaW1lb3V0LCBpLnByb3RvdHlwZS5jYXRjaCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGhlbihudWxsLCB0KTsKICAgICAgfSwgaS5wcm90b3R5cGUudGhlbiA9IGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgdmFyIGUgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihyKTsKICAgICAgICByZXR1cm4gdSh0aGlzLCBuZXcgbCh0LCBuLCBlKSksIGU7CiAgICAgIH0sIGkuYWxsID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgYSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHQpOwogICAgICAgIHJldHVybiBuZXcgaShmdW5jdGlvbiAociwgaSkgewogICAgICAgICAgaWYgKDAgPT09IGEubGVuZ3RoKSByZXR1cm4gcihbXSk7CgogICAgICAgICAgZm9yICh2YXIgdSA9IGEubGVuZ3RoLCB0ID0gMDsgdCA8IGEubGVuZ3RoOyB0KyspIHsKICAgICAgICAgICAgIWZ1bmN0aW9uIG4oZSwgdCkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAodCAmJiAoIm9iamVjdCIgPT0gX3R5cGVvZih0KSB8fCAiZnVuY3Rpb24iID09IHR5cGVvZiB0KSkgewogICAgICAgICAgICAgICAgICB2YXIgbyA9IHQudGhlbjsKICAgICAgICAgICAgICAgICAgaWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIG8pIHJldHVybiBvLmNhbGwodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgICBuKGUsIHQpOwogICAgICAgICAgICAgICAgICB9LCBpKSwgMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBhW2VdID0gdCwgMCA9PSAtLXUgJiYgcihhKTsKICAgICAgICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICAgICAgICBpKHQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSh0LCBhW3RdKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwgaS5yZXNvbHZlID0gZnVuY3Rpb24gKG4pIHsKICAgICAgICByZXR1cm4gbiAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKG4pICYmIG4uY29uc3RydWN0b3IgPT09IGkgPyBuIDogbmV3IGkoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHQobik7CiAgICAgICAgfSk7CiAgICAgIH0sIGkucmVqZWN0ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICByZXR1cm4gbmV3IGkoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIG4oZSk7CiAgICAgICAgfSk7CiAgICAgIH0sIGkucmFjZSA9IGZ1bmN0aW9uIChyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBpKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICBmb3IgKHZhciBlID0gMCwgbyA9IHIubGVuZ3RoOyBlIDwgbzsgZSsrKSB7CiAgICAgICAgICAgIHJbZV0udGhlbih0LCBuKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwgaS5faW1tZWRpYXRlRm4gPSAiZnVuY3Rpb24iID09IHR5cGVvZiBzZXRJbW1lZGlhdGUgPyBmdW5jdGlvbiAodCkgewogICAgICAgIHNldEltbWVkaWF0ZSh0KTsKICAgICAgfSA6IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgZSh0LCAwKTsKICAgICAgfSwgaS5fdW5oYW5kbGVkUmVqZWN0aW9uRm4gPSBmdW5jdGlvbiAodCkgewogICAgICAgICJ1bmRlZmluZWQiICE9IHR5cGVvZiBjb25zb2xlICYmIGNvbnNvbGUgJiYgY29uc29sZS53YXJuKCJQb3NzaWJsZSBVbmhhbmRsZWQgUHJvbWlzZSBSZWplY3Rpb246IiwgdCk7CiAgICAgIH0sIGkuX3NldEltbWVkaWF0ZUZuID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICBpLl9pbW1lZGlhdGVGbiA9IHQ7CiAgICAgIH0sIGkuX3NldFVuaGFuZGxlZFJlamVjdGlvbkZuID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICBpLl91bmhhbmRsZWRSZWplY3Rpb25GbiA9IHQ7CiAgICAgIH0sIHQuZXhwb3J0cyA/IHQuZXhwb3J0cyA9IGkgOiBuLlByb21pc2UgfHwgKG4uUHJvbWlzZSA9IGkpOwogICAgICB2YXIgZCA9IG8uZXhwb3J0czsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2x0RXhwb3J0OiAoInVuZGVmaW5lZCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IEZ1bmN0aW9uKCJyZXR1cm4gdGhpczsiKSgpKS5Qcm9taXNlIHx8IGQKICAgICAgfTsKICAgIH07CgogICAgIm9iamVjdCIgPT0gX3R5cGVvZihfeSkgJiYgdm9pZCAwICE9PSBUeSA/IFR5LmV4cG9ydHMgPSBuKCkgOiAodCA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWxUaGlzID8gZ2xvYmFsVGhpcyA6IHQgfHwgc2VsZikuRXBob3hDb250YWN0V3JhcHBlciA9IG4oKTsKICB9KCk7CgogIHZhciBJeSwKICAgICAgUnksCiAgICAgIFZ5ID0gVHkuZXhwb3J0cy5ib2x0RXhwb3J0LAogICAgICBQeSA9IGZ1bmN0aW9uIFB5KHQpIHsKICAgIGZ1bmN0aW9uIG8odCkgewogICAgICByKCkgPyBpKHQpIDogbi5wdXNoKHQpOwogICAgfQoKICAgIHZhciBlID0gdnQubm9uZSgpLAogICAgICAgIG4gPSBbXSwKICAgICAgICByID0gZnVuY3Rpb24gcigpIHsKICAgICAgcmV0dXJuIGUuaXNTb21lKCk7CiAgICB9LAogICAgICAgIGkgPSBmdW5jdGlvbiBpKG4pIHsKICAgICAgZS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBuKHQpOwogICAgICAgIH0sIDApOwogICAgICB9KTsKICAgIH07CgogICAgcmV0dXJuIHQoZnVuY3Rpb24gKHQpIHsKICAgICAgcigpIHx8IChlID0gdnQuc29tZSh0KSwgU3QobiwgaSksIG4gPSBbXSk7CiAgICB9KSwgewogICAgICBnZXQ6IG8sCiAgICAgIG1hcDogZnVuY3Rpb24gbWFwKGUpIHsKICAgICAgICByZXR1cm4gUHkoZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIG8oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgbihlKHQpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBpc1JlYWR5OiByCiAgICB9OwogIH0sCiAgICAgIEh5ID0gewogICAgbnU6IFB5LAogICAgcHVyZTogZnVuY3Rpb24gcHVyZShuKSB7CiAgICAgIHJldHVybiBQeShmdW5jdGlvbiAodCkgewogICAgICAgIHQobik7CiAgICAgIH0pOwogICAgfQogIH0sCiAgICAgIHp5ID0gZnVuY3Rpb24genkoZSkgewogICAgZnVuY3Rpb24gdCh0KSB7CiAgICAgIGUoKS50aGVuKHQsIEV5KTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBtYXA6IGZ1bmN0aW9uIG1hcCh0KSB7CiAgICAgICAgcmV0dXJuIHp5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBlKCkudGhlbih0KTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgYmluZDogZnVuY3Rpb24gYmluZChuKSB7CiAgICAgICAgcmV0dXJuIHp5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBlKCkudGhlbihmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gbih0KS50b1Byb21pc2UoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBhbm9uQmluZDogZnVuY3Rpb24gYW5vbkJpbmQodCkgewogICAgICAgIHJldHVybiB6eShmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZSgpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdC50b1Byb21pc2UoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICB0b0xhenk6IGZ1bmN0aW9uIHRvTGF6eSgpIHsKICAgICAgICByZXR1cm4gSHkubnUodCk7CiAgICAgIH0sCiAgICAgIHRvQ2FjaGVkOiBmdW5jdGlvbiB0b0NhY2hlZCgpIHsKICAgICAgICB2YXIgdCA9IG51bGw7CiAgICAgICAgcmV0dXJuIHp5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0ID0gbnVsbCA9PT0gdCA/IGUoKSA6IHQ7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHRvUHJvbWlzZTogZSwKICAgICAgZ2V0OiB0CiAgICB9OwogIH0sCiAgICAgIE55ID0gZnVuY3Rpb24gTnkodCkgewogICAgcmV0dXJuIHp5KGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIG5ldyBWeSh0KTsKICAgIH0pOwogIH0sCiAgICAgIEx5ID0gZnVuY3Rpb24gTHkodCkgewogICAgcmV0dXJuIHp5KGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFZ5LnJlc29sdmUodCk7CiAgICB9KTsKICB9LAogICAgICBXeSA9IFsiaW5wdXQiLCAidGV4dGFyZWEiXSwKICAgICAgVXkgPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIG1hcmtWYWxpZDogQnksCiAgICBtYXJrSW52YWxpZDogTXksCiAgICBxdWVyeTogQXksCiAgICBydW46IEZ5LAogICAgaXNJbnZhbGlkOiBmdW5jdGlvbiBpc0ludmFsaWQodCwgbikgewogICAgICByZXR1cm4gcXIobi5nZXRSb290KHQpLmdldE9yKHQuZWxlbWVudCksIG4uaW52YWxpZENsYXNzKTsKICAgIH0KICB9KSwKICAgICAgankgPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGV2ZW50czogZnVuY3Rpb24gZXZlbnRzKG4sIHQpIHsKICAgICAgcmV0dXJuIG4udmFsaWRhdG9yLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBudShbQ3IodC5vbkV2ZW50LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgRnkodCwgbikuZ2V0KGgpOwogICAgICAgIH0pXS5jb25jYXQodC52YWxpZGF0ZU9uTG9hZCA/IFtldShmdW5jdGlvbiAodCkgewogICAgICAgICAgRnkodCwgbikuZ2V0KHN0KTsKICAgICAgICB9KV0gOiBbXSkpOwogICAgICB9KS5nZXRPcih7fSk7CiAgICB9CiAgfSksCiAgICAgIEd5ID0geWEoewogICAgZmllbGRzOiBbZm8oImludmFsaWRDbGFzcyIpLCBUbygiZ2V0Um9vdCIsIHZ0Lm5vbmUpLCBfbygibm90aWZ5IiwgW1RvKCJhcmlhIiwgImFsZXJ0IiksIFRvKCJnZXRDb250YWluZXIiLCB2dC5ub25lKSwgVG8oInZhbGlkSHRtbCIsICIiKSwgS3UoIm9uVmFsaWQiKSwgS3UoIm9uSW52YWxpZCIpLCBLdSgib25WYWxpZGF0ZSIpXSksIF9vKCJ2YWxpZGF0b3IiLCBbZm8oInZhbGlkYXRlIiksIFRvKCJvbkV2ZW50IiwgImlucHV0IiksIFRvKCJ2YWxpZGF0ZU9uTG9hZCIsICEwKV0pXSwKICAgIG5hbWU6ICJpbnZhbGlkYXRpbmciLAogICAgYWN0aXZlOiBqeSwKICAgIGFwaXM6IFV5LAogICAgZXh0cmE6IHsKICAgICAgdmFsaWRhdGlvbjogZnVuY3Rpb24gdmFsaWRhdGlvbihlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgbiA9IFRmLmdldFZhbHVlKHQpOwogICAgICAgICAgcmV0dXJuIEx5KGUobikpOwogICAgICAgIH07CiAgICAgIH0KICAgIH0KICB9KSwKICAgICAgWHkgPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdldENvdXBsZWQ6IGZ1bmN0aW9uIGdldENvdXBsZWQodCwgbiwgZSwgbykgewogICAgICByZXR1cm4gZS5nZXRPckNyZWF0ZSh0LCBuLCBvKTsKICAgIH0KICB9KSwKICAgICAgWXkgPSB5YSh7CiAgICBmaWVsZHM6IFttbygib3RoZXJzIiwgaW8oUmUudmFsdWUsIFFvKCkpKV0sCiAgICBuYW1lOiAiY291cGxpbmciLAogICAgYXBpczogWHksCiAgICBzdGF0ZTogT2JqZWN0LmZyZWV6ZSh7CiAgICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB2YXIgaSA9IHt9LAogICAgICAgICAgICB0ID0gcnQoe30pOwogICAgICAgIHJldHVybiB4dSh7CiAgICAgICAgICByZWFkU3RhdGU6IHQsCiAgICAgICAgICBnZXRPckNyZWF0ZTogZnVuY3Rpb24gZ2V0T3JDcmVhdGUoZSwgbywgcikgewogICAgICAgICAgICB2YXIgdCA9IGt0KG8ub3RoZXJzKTsKICAgICAgICAgICAgaWYgKHQpIHJldHVybiB0dChpLCByKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgdCA9IHR0KG8ub3RoZXJzLCByKS5nZXRPckRpZSgiTm8gaW5mb3JtYXRpb24gZm91bmQgZm9yIGNvdXBsZWQgY29tcG9uZW50OiAiICsgcikoZSksCiAgICAgICAgICAgICAgICAgIG4gPSBlLmdldFN5c3RlbSgpLmJ1aWxkKHQpOwogICAgICAgICAgICAgIHJldHVybiBpW3JdID0gbjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgY291cGxlZCBjb21wb25lbnQ6ICIgKyByICsgIi4gS25vd24gY291cGxlZCBjb21wb25lbnRzOiAiICsgSlNPTi5zdHJpbmdpZnkodCwgbnVsbCwgMikpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9KQogIH0pLAogICAgICBxeSA9IHJ0KCJzaW5rIiksCiAgICAgIEt5ID0gcnQoSmYoewogICAgbmFtZTogcXkoKSwKICAgIG92ZXJyaWRlczogcnQoewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiCiAgICAgIH0sCiAgICAgIGJlaGF2aW91cnM6IHRjKFtzZi5jb25maWcoewogICAgICAgIHVzZUZpeGVkOiBfCiAgICAgIH0pXSksCiAgICAgIGV2ZW50czogbnUoW0VyKHlpKCkpLCBFcihkaSgpKSwgRXIoQ2koKSldKQogICAgfSkKICB9KSk7CgogIGZ1bmN0aW9uIEp5KHQsIG4pIHsKICAgIHZhciBlID0gdC5nZXRIb3RzcG90KG4pLmdldE9yKG4pLAogICAgICAgIG8gPSB0LmdldEFuY2hvck92ZXJyaWRlcygpOwogICAgcmV0dXJuIHQubGF5b3V0cy5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAiaG90c3BvdCIsCiAgICAgICAgaG90c3BvdDogZSwKICAgICAgICBvdmVycmlkZXM6IG8KICAgICAgfTsKICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogImhvdHNwb3QiLAogICAgICAgIGhvdHNwb3Q6IGUsCiAgICAgICAgb3ZlcnJpZGVzOiBvLAogICAgICAgIGxheW91dHM6IHQKICAgICAgfTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gJHkodCwgbiwgZSwgbywgciwgaSwgdSkgewogICAgdmFyIGEsCiAgICAgICAgYyA9IEp5KHQsIGUpLAogICAgICAgIHMgPSBlLAogICAgICAgIGwgPSBvLAogICAgICAgIGYgPSByLAogICAgICAgIGQgPSB1LAogICAgICAgIG0gPSBuLAogICAgICAgIGcgPSAoMCwgKGEgPSB0KS5mZXRjaCkocykubWFwKG0pLAogICAgICAgIHAgPSBzdyhzLCBhKTsKICAgIHJldHVybiBnLm1hcChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdC5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHZ0LmZyb20ob3Auc2tldGNoKF9sdChfbHQoe30sIGYubWVudSgpKSwgewogICAgICAgICAgdWlkOiBndSgiIiksCiAgICAgICAgICBkYXRhOiB0LAogICAgICAgICAgaGlnaGxpZ2h0SW1tZWRpYXRlbHk6IGQgPT09IEl5LkhpZ2hsaWdodEZpcnN0LAogICAgICAgICAgb25PcGVuTWVudTogZnVuY3Rpb24gb25PcGVuTWVudSh0LCBuKSB7CiAgICAgICAgICAgIHZhciBlID0gcCgpLmdldE9yRGllKCk7CiAgICAgICAgICAgIHNmLnBvc2l0aW9uKGUsIG4sIHsKICAgICAgICAgICAgICBhbmNob3I6IGMKICAgICAgICAgICAgfSksIGhmLmRlY2xvYWsobCk7CiAgICAgICAgICB9LAogICAgICAgICAgb25PcGVuU3VibWVudTogZnVuY3Rpb24gb25PcGVuU3VibWVudSh0LCBuLCBlKSB7CiAgICAgICAgICAgIHZhciBvID0gcCgpLmdldE9yRGllKCk7CiAgICAgICAgICAgIHNmLnBvc2l0aW9uKG8sIGUsIHsKICAgICAgICAgICAgICBhbmNob3I6IHsKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWJtZW51IiwKICAgICAgICAgICAgICAgIGl0ZW06IG4KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLCBoZi5kZWNsb2FrKGwpOwogICAgICAgICAgfSwKICAgICAgICAgIG9uUmVwb3NpdGlvbk1lbnU6IGZ1bmN0aW9uIG9uUmVwb3NpdGlvbk1lbnUodCwgbiwgZSkgewogICAgICAgICAgICB2YXIgbyA9IHAoKS5nZXRPckRpZSgpOwogICAgICAgICAgICBzZi5wb3NpdGlvbihvLCBuLCB7CiAgICAgICAgICAgICAgYW5jaG9yOiBjCiAgICAgICAgICAgIH0pLCBTdChlLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHNmLnBvc2l0aW9uKG8sIHQudHJpZ2dlcmVkTWVudSwgewogICAgICAgICAgICAgICAgYW5jaG9yOiB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWJtZW51IiwKICAgICAgICAgICAgICAgICAgaXRlbTogdC50cmlnZ2VyaW5nSXRlbQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gb25Fc2NhcGUoKSB7CiAgICAgICAgICAgIHJldHVybiBWZy5mb2N1cyhzKSwgaGYuY2xvc2UobCksIHZ0LnNvbWUoITApOwogICAgICAgICAgfQogICAgICAgIH0pKSk7CiAgICAgIH0pOwogICAgfSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0LmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgIGhmLmlzT3BlbihvKSAmJiBoZi5jbG9zZShvKTsKICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICBoZi5jbG9hayhvKSwgaGYub3BlbihvLCB0KSwgaShvKTsKICAgICAgfSksIG87CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIFF5KHQsIG4sIGUsIG8sIHIsIGkpIHsKICAgIHZhciB1ID0gWXkuZ2V0Q291cGxlZChlLCAic2FuZGJveCIpOwogICAgcmV0dXJuIChoZi5pc09wZW4odSkgPyBmdW5jdGlvbiAodCwgbiwgZSwgbywgciwgaSwgdSkgewogICAgICByZXR1cm4gaGYuY2xvc2UobyksIEx5KG8pOwogICAgfSA6ICR5KSh0LCBuLCBlLCB1LCBvLCByLCBpKTsKICB9CgogIGZ1bmN0aW9uIFp5KHQpIHsKICAgIGhmLmdldFN0YXRlKHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgb3AucmVwb3NpdGlvbk1lbnVzKHQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB0eChzLCBsLCBmKSB7CiAgICB2YXIgZCA9IFJ1KCksCiAgICAgICAgdCA9IHN3KGwsIHMpOwogICAgcmV0dXJuIHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBzLnNhbmRib3hDbGFzc2VzLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGlkOiBkLmlkLAogICAgICAgICAgcm9sZTogImxpc3Rib3giCiAgICAgICAgfQogICAgICB9LAogICAgICBiZWhhdmlvdXJzOiBEZihzLnNhbmRib3hCZWhhdmlvdXJzLCBbVGYuY29uZmlnKHsKICAgICAgICBzdG9yZTogewogICAgICAgICAgbW9kZTogIm1lbW9yeSIsCiAgICAgICAgICBpbml0aWFsVmFsdWU6IGwKICAgICAgICB9CiAgICAgIH0pLCBoZi5jb25maWcoewogICAgICAgIG9uT3BlbjogZnVuY3Rpb24gb25PcGVuKHQsIG4pIHsKICAgICAgICAgIHZhciBlLAogICAgICAgICAgICAgIG8sCiAgICAgICAgICAgICAgciwKICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgIHUsCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBjID0gSnkocywgbCk7CiAgICAgICAgICBkLmxpbmsobC5lbGVtZW50KSwgcy5tYXRjaFdpZHRoICYmIChlID0gYy5ob3RzcG90LCBvID0gbiwgciA9IHMudXNlTWluV2lkdGgsIHUgPSB1ZC5nZXRDdXJyZW50KG8pLmdldE9yKG8pLCBhID0ga24oZS5lbGVtZW50KSwgciA/IGZuKHUuZWxlbWVudCwgIm1pbi13aWR0aCIsIGEgKyAicHgiKSA6IChpID0gdS5lbGVtZW50LCBrZS5zZXQoaSwgYSkpKSwgcy5vbk9wZW4oYywgdCwgbiksIHZvaWQgMCAhPT0gZiAmJiB2b2lkIDAgIT09IGYub25PcGVuICYmIGYub25PcGVuKHQsIG4pOwogICAgICAgIH0sCiAgICAgICAgb25DbG9zZTogZnVuY3Rpb24gb25DbG9zZSh0LCBuKSB7CiAgICAgICAgICBkLnVubGluayhsLmVsZW1lbnQpLCB2b2lkIDAgIT09IGYgJiYgdm9pZCAwICE9PSBmLm9uQ2xvc2UgJiYgZi5vbkNsb3NlKHQsIG4pOwogICAgICAgIH0sCiAgICAgICAgaXNQYXJ0T2Y6IGZ1bmN0aW9uIGlzUGFydE9mKHQsIG4sIGUpIHsKICAgICAgICAgIHJldHVybiBIdShuLCBlKSB8fCBIdShsLCBlKTsKICAgICAgICB9LAogICAgICAgIGdldEF0dGFjaFBvaW50OiBmdW5jdGlvbiBnZXRBdHRhY2hQb2ludCgpIHsKICAgICAgICAgIHJldHVybiB0KCkuZ2V0T3JEaWUoKTsKICAgICAgICB9CiAgICAgIH0pLCB1ZC5jb25maWcoewogICAgICAgIGZpbmQ6IGZ1bmN0aW9uIGZpbmQodCkgewogICAgICAgICAgcmV0dXJuIGhmLmdldFN0YXRlKHQpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHVkLmdldEN1cnJlbnQodCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLCByYy5jb25maWcoewogICAgICAgIGNoYW5uZWxzOiBfbHQoX2x0KHt9LCBqcyh7CiAgICAgICAgICBpc0V4dHJhUGFydDogTwogICAgICAgIH0pKSwgR3MoewogICAgICAgICAgZG9SZXBvc2l0aW9uOiBaeQogICAgICAgIH0pKQogICAgICB9KV0pCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gbngodCkgewogICAgWnkoWXkuZ2V0Q291cGxlZCh0LCAic2FuZGJveCIpKTsKICB9CgogIGZ1bmN0aW9uIGV4KCkgewogICAgcmV0dXJuIFtUbygic2FuZGJveENsYXNzZXMiLCBbXSksIEVmKCJzYW5kYm94QmVoYXZpb3VycyIsIFt1ZCwgcmMsIGhmLCBUZl0pXTsKICB9CgogIGZ1bmN0aW9uIG94KG4pIHsKICAgIHJldHVybiBKZih7CiAgICAgIG5hbWU6IG4gKyAiLWVkZ2UiLAogICAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIG92ZXJyaWRlcyh0KSB7CiAgICAgICAgcmV0dXJuIHQubW9kZWwubWFuYWdlci5lZGdlQWN0aW9uc1tuXS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICB9LCBmdW5jdGlvbiAobykgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZXZlbnRzOiBudShba3IoY2koKSwgZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgICAgICAgICByZXR1cm4gbyh0LCBlKTsKICAgICAgICAgICAgfSwgW3RdKSwga3IoZGkoKSwgZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgICAgICAgICByZXR1cm4gbyh0LCBlKTsKICAgICAgICAgICAgfSwgW3RdKSwga3IobWkoKSwgZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgICAgICAgICBlLm1vdXNlSXNEb3duLmdldCgpICYmIG8odCwgZSk7CiAgICAgICAgICAgIH0sIFt0XSldKQogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiByeCh0KSB7CiAgICB2YXIgbiA9IHQuZXZlbnQucmF3OwogICAgcmV0dXJuIC0xID09PSBuLnR5cGUuaW5kZXhPZigidG91Y2giKSA/IHZvaWQgMCAhPT0gbi5jbGllbnRYID8gdnQuc29tZShuKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIFNlKHQuY2xpZW50WCwgdC5jbGllbnRZKTsKICAgIH0pIDogdnQubm9uZSgpIDogdm9pZCAwICE9PSBuLnRvdWNoZXMgJiYgMSA9PT0gbi50b3VjaGVzLmxlbmd0aCA/IHZ0LnNvbWUobi50b3VjaGVzWzBdKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIFNlKHQuY2xpZW50WCwgdC5jbGllbnRZKTsKICAgIH0pIDogdnQubm9uZSgpOwogIH0KCiAgZnVuY3Rpb24gaXgodCkgewogICAgcmV0dXJuIHQubW9kZWwubWluWDsKICB9CgogIGZ1bmN0aW9uIHV4KHQpIHsKICAgIHJldHVybiB0Lm1vZGVsLm1pblk7CiAgfQoKICBmdW5jdGlvbiBheCh0KSB7CiAgICByZXR1cm4gdC5tb2RlbC5taW5YIC0gMTsKICB9CgogIGZ1bmN0aW9uIGN4KHQpIHsKICAgIHJldHVybiB0Lm1vZGVsLm1pblkgLSAxOwogIH0KCiAgZnVuY3Rpb24gc3godCkgewogICAgcmV0dXJuIHQubW9kZWwubWF4WDsKICB9CgogIGZ1bmN0aW9uIGx4KHQpIHsKICAgIHJldHVybiB0Lm1vZGVsLm1heFk7CiAgfQoKICBmdW5jdGlvbiBmeCh0KSB7CiAgICByZXR1cm4gdC5tb2RlbC5tYXhYICsgMTsKICB9CgogIGZ1bmN0aW9uIGR4KHQpIHsKICAgIHJldHVybiB0Lm1vZGVsLm1heFkgKyAxOwogIH0KCiAgZnVuY3Rpb24gbXgodCwgbiwgZSkgewogICAgcmV0dXJuIG4odCkgLSBlKHQpOwogIH0KCiAgZnVuY3Rpb24gZ3godCkgewogICAgcmV0dXJuIG14KHQsIHN4LCBpeCk7CiAgfQoKICBmdW5jdGlvbiBweCh0KSB7CiAgICByZXR1cm4gbXgodCwgbHgsIHV4KTsKICB9CgogIGZ1bmN0aW9uIGh4KHQpIHsKICAgIHJldHVybiBneCh0KSAvIDI7CiAgfQoKICBmdW5jdGlvbiB2eCh0KSB7CiAgICByZXR1cm4gcHgodCkgLyAyOwogIH0KCiAgZnVuY3Rpb24gYngodCkgewogICAgcmV0dXJuIHQuc3RlcFNpemU7CiAgfQoKICBmdW5jdGlvbiB5eCh0KSB7CiAgICByZXR1cm4gdC5zbmFwVG9HcmlkOwogIH0KCiAgZnVuY3Rpb24geHgodCkgewogICAgcmV0dXJuIHQuc25hcFN0YXJ0OwogIH0KCiAgZnVuY3Rpb24gd3godCkgewogICAgcmV0dXJuIHQucm91bmRlZDsKICB9CgogIGZ1bmN0aW9uIFN4KHQsIG4pIHsKICAgIHJldHVybiB2b2lkIDAgIT09IHRbbiArICItZWRnZSJdOwogIH0KCiAgZnVuY3Rpb24gQ3godCkgewogICAgcmV0dXJuIFN4KHQsICJsZWZ0Iik7CiAgfQoKICBmdW5jdGlvbiBreCh0KSB7CiAgICByZXR1cm4gU3godCwgInJpZ2h0Iik7CiAgfQoKICBmdW5jdGlvbiBPeCh0KSB7CiAgICByZXR1cm4gU3godCwgInRvcCIpOwogIH0KCiAgZnVuY3Rpb24gX3godCkgewogICAgcmV0dXJuIFN4KHQsICJib3R0b20iKTsKICB9CgogIGZ1bmN0aW9uIFR4KHQpIHsKICAgIHJldHVybiB0Lm1vZGVsLnZhbHVlLmdldCgpOwogIH0KCiAgZnVuY3Rpb24gRXgodCwgbikgewogICAgcmV0dXJuIHsKICAgICAgeDogdCwKICAgICAgeTogbgogICAgfTsKICB9CgogIGZ1bmN0aW9uIER4KHQsIG4pIHsKICAgIHZyKHQsIF93KCksIHsKICAgICAgdmFsdWU6IG4KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gQngodCwgbiwgZSwgbykgewogICAgcmV0dXJuIHQgPCBuID8gdCA6IGUgPCB0ID8gZSA6IHQgPT09IG4gPyBuIC0gMSA6IE1hdGgubWF4KG4sIHQgLSBvKTsKICB9CgogIGZ1bmN0aW9uIE14KHQsIG4sIGUsIG8pIHsKICAgIHJldHVybiBlIDwgdCA/IHQgOiB0IDwgbiA/IG4gOiB0ID09PSBlID8gZSArIDEgOiBNYXRoLm1pbihlLCB0ICsgbyk7CiAgfQoKICBmdW5jdGlvbiBBeCh0LCBuLCBlKSB7CiAgICByZXR1cm4gTWF0aC5tYXgobiwgTWF0aC5taW4oZSwgdCkpOwogIH0KCiAgZnVuY3Rpb24gRngodCkgewogICAgdmFyIG4gPSB0Lm1pbiwKICAgICAgICBlID0gdC5tYXgsCiAgICAgICAgbyA9IHQucmFuZ2UsCiAgICAgICAgciA9IHQudmFsdWUsCiAgICAgICAgaSA9IHQuc3RlcCwKICAgICAgICB1ID0gdC5zbmFwLAogICAgICAgIGEgPSB0LnNuYXBTdGFydCwKICAgICAgICBjID0gdC5yb3VuZGVkLAogICAgICAgIHMgPSB0Lmhhc01pbkVkZ2UsCiAgICAgICAgbCA9IHQuaGFzTWF4RWRnZSwKICAgICAgICBmID0gdC5taW5Cb3VuZCwKICAgICAgICBkID0gdC5tYXhCb3VuZCwKICAgICAgICBtID0gdC5zY3JlZW5SYW5nZSwKICAgICAgICBnID0gcyA/IG4gLSAxIDogbiwKICAgICAgICBwID0gbCA/IGUgKyAxIDogZTsKICAgIGlmIChyIDwgZikgcmV0dXJuIGc7CiAgICBpZiAoZCA8IHIpIHJldHVybiBwOwogICAgdmFyIGgsCiAgICAgICAgdiwKICAgICAgICBiLAogICAgICAgIHksCiAgICAgICAgeCwKICAgICAgICB3ID0gQXgoKHggPSBmLCBNYXRoLm1pbihkLCBNYXRoLm1heChyLCB4KSkgLSB4KSAvIG0gKiBvICsgbiwgZywgcCk7CiAgICByZXR1cm4gdSAmJiBuIDw9IHcgJiYgdyA8PSBlID8gKGggPSB3LCB2ID0gbiwgYiA9IGUsIHkgPSBpLCBhLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICB2YXIgdCA9IE1hdGgucm91bmQoKGggLSB2KSAvIHkpICogeTsKICAgICAgcmV0dXJuIEF4KHYgKyB0LCB2IC0gMSwgYiArIDEpOwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSBNYXRoLnJvdW5kKChoIC0gdCkgJSB5IC8geSksCiAgICAgICAgICBlID0gTWF0aC5mbG9vcigoaCAtIHQpIC8geSksCiAgICAgICAgICBvID0gTWF0aC5mbG9vcigoYiAtIHQpIC8geSksCiAgICAgICAgICByID0gTWF0aC5taW4obywgZSArIG4pOwogICAgICByZXR1cm4gTWF0aC5tYXgodCwgdCArIHIgKiB5KTsKICAgIH0pKSA6IGMgPyBNYXRoLnJvdW5kKHcpIDogdzsKICB9CgogIGZ1bmN0aW9uIEl4KHQpIHsKICAgIHZhciBuID0gdC5taW4sCiAgICAgICAgZSA9IHQubWF4LAogICAgICAgIG8gPSB0LnJhbmdlLAogICAgICAgIHIgPSB0LnZhbHVlLAogICAgICAgIGkgPSB0Lmhhc01pbkVkZ2UsCiAgICAgICAgdSA9IHQuaGFzTWF4RWRnZSwKICAgICAgICBhID0gdC5tYXhCb3VuZCwKICAgICAgICBjID0gdC5tYXhPZmZzZXQsCiAgICAgICAgcyA9IHQuY2VudGVyTWluRWRnZSwKICAgICAgICBsID0gdC5jZW50ZXJNYXhFZGdlOwogICAgcmV0dXJuIHIgPCBuID8gaSA/IDAgOiBzIDogZSA8IHIgPyB1ID8gYSA6IGwgOiAociAtIG4pIC8gbyAqIGM7CiAgfQoKICBmdW5jdGlvbiBSeCh0KSB7CiAgICByZXR1cm4gdC5lbGVtZW50LmRvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICB9CgogIGZ1bmN0aW9uIFZ4KHQpIHsKICAgIHJldHVybiBSeCh0KVtUd107CiAgfQoKICBmdW5jdGlvbiBQeCh0KSB7CiAgICByZXR1cm4gUngodCkucmlnaHQ7CiAgfQoKICBmdW5jdGlvbiBIeCh0KSB7CiAgICByZXR1cm4gUngodCkudG9wOwogIH0KCiAgZnVuY3Rpb24gengodCkgewogICAgcmV0dXJuIFJ4KHQpLmJvdHRvbTsKICB9CgogIGZ1bmN0aW9uIE54KHQpIHsKICAgIHJldHVybiBSeCh0KS53aWR0aDsKICB9CgogIGZ1bmN0aW9uIEx4KHQpIHsKICAgIHJldHVybiBSeCh0KS5oZWlnaHQ7CiAgfQoKICBmdW5jdGlvbiBXeCh0LCBuKSB7CiAgICB2YXIgZSA9IFJ4KHQpLAogICAgICAgIG8gPSBSeChuKTsKICAgIHJldHVybiAoZVtUd10gKyBlLnJpZ2h0KSAvIDIgLSBvW1R3XTsKICB9CgogIGZ1bmN0aW9uIFV4KHQsIG4pIHsKICAgIHZhciBlID0gUngodCksCiAgICAgICAgbyA9IFJ4KG4pOwogICAgcmV0dXJuIChlLnRvcCArIGUuYm90dG9tKSAvIDIgLSBvLnRvcDsKICB9CgogIGZ1bmN0aW9uIGp4KHQsIG4pIHsKICAgIHZyKHQsIF93KCksIHsKICAgICAgdmFsdWU6IG4KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gR3godCwgbiwgZSkgewogICAgcmV0dXJuIEZ4KHsKICAgICAgbWluOiBpeChuKSwKICAgICAgbWF4OiBzeChuKSwKICAgICAgcmFuZ2U6IGd4KG4pLAogICAgICB2YWx1ZTogZSwKICAgICAgc3RlcDogYngobiksCiAgICAgIHNuYXA6IHl4KG4pLAogICAgICBzbmFwU3RhcnQ6IHh4KG4pLAogICAgICByb3VuZGVkOiB3eChuKSwKICAgICAgaGFzTWluRWRnZTogQ3gobiksCiAgICAgIGhhc01heEVkZ2U6IGt4KG4pLAogICAgICBtaW5Cb3VuZDogVngodCksCiAgICAgIG1heEJvdW5kOiBQeCh0KSwKICAgICAgc2NyZWVuUmFuZ2U6IE54KHQpCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIFh4KHIpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gangodCwgewogICAgICAgIHg6IG8gPSAoMCA8IHIgPyBNeCA6IEJ4KShUeChlID0gbikueCwgaXgoZSksIHN4KGUpLCBieChlKSkKICAgICAgfSksIHZ0LnNvbWUobykubWFwKF8pOwogICAgICB2YXIgZSwgbzsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBZeCh0LCBuLCBlLCBvLCByLCBpKSB7CiAgICB2YXIgdSwKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICAgcywKICAgICAgICBsLAogICAgICAgIGYsCiAgICAgICAgZCwKICAgICAgICBtLAogICAgICAgIGcgPSAoYSA9IGksIGMgPSBlLCBzID0gbywgbCA9IHIsIGYgPSBOeCh1ID0gbiksIGQgPSBzLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHZ0LnNvbWUoV3godCwgdSkpOwogICAgfSkuZ2V0T3IoMCksIG0gPSBsLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHZ0LnNvbWUoV3godCwgdSkpOwogICAgfSkuZ2V0T3IoZiksIEl4KHsKICAgICAgbWluOiBpeChhKSwKICAgICAgbWF4OiBzeChhKSwKICAgICAgcmFuZ2U6IGd4KGEpLAogICAgICB2YWx1ZTogYywKICAgICAgaGFzTWluRWRnZTogQ3goYSksCiAgICAgIGhhc01heEVkZ2U6IGt4KGEpLAogICAgICBtaW5Cb3VuZDogVngodSksCiAgICAgIG1pbk9mZnNldDogMCwKICAgICAgbWF4Qm91bmQ6IFB4KHUpLAogICAgICBtYXhPZmZzZXQ6IGYsCiAgICAgIGNlbnRlck1pbkVkZ2U6IGQsCiAgICAgIGNlbnRlck1heEVkZ2U6IG0KICAgIH0pKTsKICAgIHJldHVybiBWeChuKSAtIFZ4KHQpICsgZzsKICB9CgogIGZ1bmN0aW9uIHF4KHQsIG4pIHsKICAgIHZyKHQsIF93KCksIHsKICAgICAgdmFsdWU6IG4KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gS3godCwgbiwgZSkgewogICAgcmV0dXJuIEZ4KHsKICAgICAgbWluOiB1eChuKSwKICAgICAgbWF4OiBseChuKSwKICAgICAgcmFuZ2U6IHB4KG4pLAogICAgICB2YWx1ZTogZSwKICAgICAgc3RlcDogYngobiksCiAgICAgIHNuYXA6IHl4KG4pLAogICAgICBzbmFwU3RhcnQ6IHh4KG4pLAogICAgICByb3VuZGVkOiB3eChuKSwKICAgICAgaGFzTWluRWRnZTogT3gobiksCiAgICAgIGhhc01heEVkZ2U6IF94KG4pLAogICAgICBtaW5Cb3VuZDogSHgodCksCiAgICAgIG1heEJvdW5kOiB6eCh0KSwKICAgICAgc2NyZWVuUmFuZ2U6IEx4KHQpCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIEp4KHIpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gcXgodCwgewogICAgICAgIHk6IG8gPSAoMCA8IHIgPyBNeCA6IEJ4KShUeChlID0gbikueSwgdXgoZSksIGx4KGUpLCBieChlKSkKICAgICAgfSksIHZ0LnNvbWUobykubWFwKF8pOwogICAgICB2YXIgZSwgbzsKICAgIH07CiAgfQoKICBmdW5jdGlvbiAkeCh0LCBuLCBlLCBvLCByLCBpKSB7CiAgICB2YXIgdSwKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICAgcywKICAgICAgICBsLAogICAgICAgIGYsCiAgICAgICAgZCwKICAgICAgICBtLAogICAgICAgIGcgPSAoYSA9IGksIGMgPSBlLCBzID0gbywgbCA9IHIsIGYgPSBMeCh1ID0gbiksIGQgPSBzLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHZ0LnNvbWUoVXgodCwgdSkpOwogICAgfSkuZ2V0T3IoMCksIG0gPSBsLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHZ0LnNvbWUoVXgodCwgdSkpOwogICAgfSkuZ2V0T3IoZiksIEl4KHsKICAgICAgbWluOiB1eChhKSwKICAgICAgbWF4OiBseChhKSwKICAgICAgcmFuZ2U6IHB4KGEpLAogICAgICB2YWx1ZTogYywKICAgICAgaGFzTWluRWRnZTogT3goYSksCiAgICAgIGhhc01heEVkZ2U6IF94KGEpLAogICAgICBtaW5Cb3VuZDogSHgodSksCiAgICAgIG1pbk9mZnNldDogMCwKICAgICAgbWF4Qm91bmQ6IHp4KHUpLAogICAgICBtYXhPZmZzZXQ6IGYsCiAgICAgIGNlbnRlck1pbkVkZ2U6IGQsCiAgICAgIGNlbnRlck1heEVkZ2U6IG0KICAgIH0pKTsKICAgIHJldHVybiBIeChuKSAtIEh4KHQpICsgZzsKICB9CgogIGZ1bmN0aW9uIFF4KHQsIG4pIHsKICAgIHZyKHQsIF93KCksIHsKICAgICAgdmFsdWU6IG4KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gWngodCwgbikgewogICAgcmV0dXJuIHsKICAgICAgeDogdCwKICAgICAgeTogbgogICAgfTsKICB9CgogIGZ1bmN0aW9uIHQwKHUsIGEpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gbyA9IG4sIHIgPSAwIDwgdSA/IE14IDogQngsIFF4KHQsIFp4KGkgPSAoZSA9IGEpID8gVHgobykueCA6IHIoVHgobykueCwgaXgobyksIHN4KG8pLCBieChvKSksIGUgPyByKFR4KG8pLnksIHV4KG8pLCBseChvKSwgYngobykpIDogVHgobykueSkpLCB2dC5zb21lKGkpLm1hcChfKTsKICAgICAgdmFyIGUsIG8sIHIsIGk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gbjAodCkgewogICAgcmV0dXJuICI8YWxsb3kuZmllbGQuIiArIHQgKyAiPiI7CiAgfQoKICBmdW5jdGlvbiBlMChmLCBkLCBtLCBnKSB7CiAgICBmdW5jdGlvbiBwKHQsIG4sIGUsIG8sIHIpIHsKICAgICAgdmFyIGksCiAgICAgICAgICB1LAogICAgICAgICAgYSA9IGYoZVMgKyAicmFuZ2UiKSwKICAgICAgICAgIGMgPSBbc3kucGFydHMubGFiZWwoewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAibGFiZWwiLAogICAgICAgICAgaW5uZXJIdG1sOiBlLAogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICAiYXJpYS1sYWJlbCI6IG8KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pLCBzeS5wYXJ0cy5maWVsZCh7CiAgICAgICAgZGF0YTogciwKICAgICAgICBmYWN0b3J5OiBPeSwKICAgICAgICBpbnB1dEF0dHJpYnV0ZXM6IF9sdCh7CiAgICAgICAgICB0eXBlOiAidGV4dCIKICAgICAgICB9LCAiaGV4IiA9PT0gbiA/IHsKICAgICAgICAgICJhcmlhLWxpdmUiOiAicG9saXRlIgogICAgICAgIH0gOiB7fSksCiAgICAgICAgaW5wdXRDbGFzc2VzOiBbZCgidGV4dGZpZWxkIildLAogICAgICAgIGlucHV0QmVoYXZpb3VyczogdGMoWyhpID0gbiwgdSA9IHQsIEd5LmNvbmZpZyh7CiAgICAgICAgICBpbnZhbGlkQ2xhc3M6IGQoImludmFsaWQiKSwKICAgICAgICAgIG5vdGlmeTogewogICAgICAgICAgICBvblZhbGlkYXRlOiBmdW5jdGlvbiBvblZhbGlkYXRlKHQpIHsKICAgICAgICAgICAgICB2cih0LCBuUywgewogICAgICAgICAgICAgICAgdHlwZTogaQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblZhbGlkOiBmdW5jdGlvbiBvblZhbGlkKHQpIHsKICAgICAgICAgICAgICB2cih0LCBadywgewogICAgICAgICAgICAgICAgdHlwZTogaSwKICAgICAgICAgICAgICAgIHZhbHVlOiBUZi5nZXRWYWx1ZSh0KQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvbkludmFsaWQ6IGZ1bmN0aW9uIG9uSW52YWxpZCh0KSB7CiAgICAgICAgICAgICAgdnIodCwgdFMsIHsKICAgICAgICAgICAgICAgIHR5cGU6IGksCiAgICAgICAgICAgICAgICB2YWx1ZTogVGYuZ2V0VmFsdWUodCkKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHZhbGlkYXRvcjogewogICAgICAgICAgICB2YWxpZGF0ZTogZnVuY3Rpb24gdmFsaWRhdGUodCkgewogICAgICAgICAgICAgIHZhciBuID0gVGYuZ2V0VmFsdWUodCksCiAgICAgICAgICAgICAgICAgIGUgPSB1KG4pID8gUmUudmFsdWUoITApIDogUmUuZXJyb3IoZigiYXJpYS5pbnB1dC5pbnZhbGlkIikpOwogICAgICAgICAgICAgIHJldHVybiBMeShlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdmFsaWRhdGVPbkxvYWQ6ICExCiAgICAgICAgICB9CiAgICAgICAgfSkpLCBmeS5jb25maWcoe30pXSksCiAgICAgICAgb25TZXRWYWx1ZTogZnVuY3Rpb24gb25TZXRWYWx1ZSh0KSB7CiAgICAgICAgICBHeS5pc0ludmFsaWQodCkgJiYgR3kucnVuKHQpLmdldChzdCk7CiAgICAgICAgfQogICAgICB9KV0sCiAgICAgICAgICBzID0gImhleCIgIT09IG4gPyBbc3kucGFydHNbImFyaWEtZGVzY3JpcHRvciJdKHsKICAgICAgICB0ZXh0OiBhCiAgICAgIH0pXSA6IFtdOwogICAgICByZXR1cm4gewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgcm9sZTogInByZXNlbnRhdGlvbiIKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IGMuY29uY2F0KHMpCiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gaCh0LCBuKSB7CiAgICAgIHZhciBlID0gbi5yZWQsCiAgICAgICAgICBvID0gbi5ncmVlbiwKICAgICAgICAgIHIgPSBuLmJsdWU7CiAgICAgIFRmLnNldFZhbHVlKHQsIHsKICAgICAgICByZWQ6IGUsCiAgICAgICAgZ3JlZW46IG8sCiAgICAgICAgYmx1ZTogcgogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiB2KHQsIG4pIHsKICAgICAgYi5nZXRPcHQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIGZuKHQuZWxlbWVudCwgImJhY2tncm91bmQtY29sb3IiLCAiIyIgKyBuLnZhbHVlKTsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIGIgPSBQbSh7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogW2QoInJnYmEtcHJldmlldyIpXSwKICAgICAgICBzdHlsZXM6IHsKICAgICAgICAgICJiYWNrZ3JvdW5kLWNvbG9yIjogIndoaXRlIgogICAgICAgIH0sCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgcm9sZTogInByZXNlbnRhdGlvbiIKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHdsKHsKICAgICAgZmFjdG9yeTogZnVuY3Rpb24gZmFjdG9yeSgpIHsKICAgICAgICBmdW5jdGlvbiBhKHQpIHsKICAgICAgICAgIHJldHVybiBvW3RdLmdldCgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYyh0LCBuKSB7CiAgICAgICAgICBvW3RdLnNldChuKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG4odCwgbikgewogICAgICAgICAgdmFyIGUgPSBuLmV2ZW50OwogICAgICAgICAgImhleCIgIT09IGUudHlwZSA/IGMoZS50eXBlLCB2dC5ub25lKCkpIDogZyh0KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGUodCwgbikgewogICAgICAgICAgdmFyIHIsCiAgICAgICAgICAgICAgZSwKICAgICAgICAgICAgICBvLAogICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgdSA9IG4uZXZlbnQ7CiAgICAgICAgICAiaGV4IiA9PT0gdS50eXBlID8gZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgbSh0KTsKICAgICAgICAgICAgdmFyIGUgPSBEdihuKTsKICAgICAgICAgICAgYygiaGV4IiwgdnQuc29tZShuKSk7CiAgICAgICAgICAgIHZhciBvID0gVnYoZSk7CiAgICAgICAgICAgIGgodCwgbyksIHMobyksIHZyKHQsIHF3LCB7CiAgICAgICAgICAgICAgaGV4OiBlCiAgICAgICAgICAgIH0pLCB2KHQsIGUpOwogICAgICAgICAgfSh0LCB1LnZhbHVlKSA6IChyID0gdCwgZSA9IHUudHlwZSwgbyA9IHUudmFsdWUsIGkgPSBwYXJzZUludChvLCAxMCksIGMoZSwgdnQuc29tZShpKSksIGEoInJlZCIpLmJpbmQoZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgcmV0dXJuIGEoImdyZWVuIikuYmluZChmdW5jdGlvbiAobikgewogICAgICAgICAgICAgIHJldHVybiBhKCJibHVlIikubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRnYoZSwgbiwgdCwgMSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICB2YXIgbiwKICAgICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgICBvID0gKG4gPSByLCBlID0gQXYodCksIFF3LmdldEZpZWxkKG4sICJoZXgiKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgVmcuaXNGb2N1c2VkKHQpIHx8IFRmLnNldFZhbHVlKG4sIHsKICAgICAgICAgICAgICAgIGhleDogZS52YWx1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KSwgZSk7CiAgICAgICAgICAgIHZyKHIsIHF3LCB7CiAgICAgICAgICAgICAgaGV4OiBvCiAgICAgICAgICAgIH0pLCB2KHIsIG8pOwogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdCh0KSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsYWJlbDogZihlUyArIHQgKyAiLmxhYmVsIiksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBmKGVTICsgdCArICIuZGVzY3JpcHRpb24iKQogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHModCkgewogICAgICAgICAgdmFyIG4gPSB0LnJlZCwKICAgICAgICAgICAgICBlID0gdC5ncmVlbiwKICAgICAgICAgICAgICBvID0gdC5ibHVlOwogICAgICAgICAgYygicmVkIiwgdnQuc29tZShuKSksIGMoImdyZWVuIiwgdnQuc29tZShlKSksIGMoImJsdWUiLCB2dC5zb21lKG8pKTsKICAgICAgICB9CgogICAgICAgIHZhciBvID0gewogICAgICAgICAgcmVkOiBWbyh2dC5zb21lKDI1NSkpLAogICAgICAgICAgZ3JlZW46IFZvKHZ0LnNvbWUoMjU1KSksCiAgICAgICAgICBibHVlOiBWbyh2dC5zb21lKDI1NSkpLAogICAgICAgICAgaGV4OiBWbyh2dC5zb21lKCJmZmZmZmYiKSkKICAgICAgICB9LAogICAgICAgICAgICByID0gdCgicmVkIiksCiAgICAgICAgICAgIGkgPSB0KCJncmVlbiIpLAogICAgICAgICAgICB1ID0gdCgiYmx1ZSIpLAogICAgICAgICAgICBsID0gdCgiaGV4Iik7CiAgICAgICAgcmV0dXJuIFhvKFF3LnNrZXRjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgICAgdGFnOiAiZm9ybSIsCiAgICAgICAgICAgICAgY2xhc3NlczogW2QoInJnYi1mb3JtIildLAogICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgICAgICJhcmlhLWxhYmVsIjogZigiYXJpYS5jb2xvci5waWNrZXIiKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29tcG9uZW50czogW3QuZmllbGQoInJlZCIsIHN5LnNrZXRjaChwKEl2LCAicmVkIiwgci5sYWJlbCwgci5kZXNjcmlwdGlvbiwgMjU1KSkpLCB0LmZpZWxkKCJncmVlbiIsIHN5LnNrZXRjaChwKEl2LCAiZ3JlZW4iLCBpLmxhYmVsLCBpLmRlc2NyaXB0aW9uLCAyNTUpKSksIHQuZmllbGQoImJsdWUiLCBzeS5za2V0Y2gocChJdiwgImJsdWUiLCB1LmxhYmVsLCB1LmRlc2NyaXB0aW9uLCAyNTUpKSksIHQuZmllbGQoImhleCIsIHN5LnNrZXRjaChwKEJ2LCAiaGV4IiwgbC5sYWJlbCwgbC5kZXNjcmlwdGlvbiwgImZmZmZmZiIpKSksIGIuYXNTcGVjKCldLAogICAgICAgICAgICBmb3JtQmVoYXZpb3VyczogdGMoW0d5LmNvbmZpZyh7CiAgICAgICAgICAgICAgaW52YWxpZENsYXNzOiBkKCJmb3JtLWludmFsaWQiKQogICAgICAgICAgICB9KSwgZm0oInJnYi1mb3JtLWV2ZW50cyIsIFtDcihadywgZSksIENyKHRTLCBuKSwgQ3IoblMsIG4pXSldKQogICAgICAgICAgfTsKICAgICAgICB9KSwgewogICAgICAgICAgYXBpczogewogICAgICAgICAgICB1cGRhdGVIZXg6IGZ1bmN0aW9uIHVwZGF0ZUhleCh0LCBuKSB7CiAgICAgICAgICAgICAgdmFyIGU7CiAgICAgICAgICAgICAgVGYuc2V0VmFsdWUodCwgewogICAgICAgICAgICAgICAgaGV4OiBuLnZhbHVlCiAgICAgICAgICAgICAgfSksIGgodCwgZSA9IFZ2KG4pKSwgcyhlKSwgdih0LCBuKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LAogICAgICBuYW1lOiAiUmdiRm9ybSIsCiAgICAgIGNvbmZpZ0ZpZWxkczogW10sCiAgICAgIGFwaXM6IHsKICAgICAgICB1cGRhdGVIZXg6IGZ1bmN0aW9uIHVwZGF0ZUhleCh0LCBuLCBlKSB7CiAgICAgICAgICB0LnVwZGF0ZUhleChuLCBlKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGV4dHJhQXBpczoge30KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gbzAoeCwgdykgewogICAgcmV0dXJuIHdsKHsKICAgICAgbmFtZTogIkNvbG91clBpY2tlciIsCiAgICAgIGNvbmZpZ0ZpZWxkczogW2ZvKCJkb20iKSwgVG8oIm9uVmFsaWRIZXgiLCBzdCksIFRvKCJvbkludmFsaWRIZXgiLCBzdCldLAogICAgICBmYWN0b3J5OiBmdW5jdGlvbiBmYWN0b3J5KHQpIHsKICAgICAgICBmdW5jdGlvbiBuKHQsIG4sIGUpIHsKICAgICAgICAgIHYuZ2V0T3B0KHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgZy5zZXRIdWUodCwgZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGUodCwgbikgewogICAgICAgICAgYi5nZXRPcHQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICBtLnVwZGF0ZUhleCh0LCBuKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcihuLCBlLCBvLCB0KSB7CiAgICAgICAgICB2YXIgciA9IG8sCiAgICAgICAgICAgICAgaSA9IFZ2KGUpOwogICAgICAgICAgcC5wYWxldHRlUmdiYS5zZXQoaSksIHAucGFsZXR0ZUh1ZS5zZXQociksIFN0KHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHQobiwgZSwgbyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBvLAogICAgICAgICAgICBpLAogICAgICAgICAgICB1LAogICAgICAgICAgICBhLAogICAgICAgICAgICBjLAogICAgICAgICAgICBzLAogICAgICAgICAgICBsLAogICAgICAgICAgICBmLAogICAgICAgICAgICBkLAogICAgICAgICAgICBtID0gZTAoeCwgdywgdC5vblZhbGlkSGV4LCB0Lm9uSW52YWxpZEhleCksCiAgICAgICAgICAgIGcgPSAobCA9IHcsIGYgPSBZdy5wYXJ0cy5zcGVjdHJ1bSh7CiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAiY2FudmFzIiwKICAgICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICAgIHJvbGU6ICJwcmVzZW50YXRpb24iCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzZXM6IFtsKCJzdi1wYWxldHRlLXNwZWN0cnVtIildCiAgICAgICAgICB9CiAgICAgICAgfSksIGQgPSBZdy5wYXJ0cy50aHVtYih7CiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICAgIHJvbGU6ICJwcmVzZW50YXRpb24iCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsYXNzZXM6IFtsKCJzdi1wYWxldHRlLXRodW1iIildLAogICAgICAgICAgICBpbm5lckh0bWw6ICI8ZGl2IGNsYXNzPSIgKyBsKCJzdi1wYWxldHRlLWlubmVyLXRodW1iIikgKyAnIHJvbGU9InByZXNlbnRhdGlvbiI+PC9kaXY+JwogICAgICAgICAgfQogICAgICAgIH0pLCB3bCh7CiAgICAgICAgICBmYWN0b3J5OiBmdW5jdGlvbiBmYWN0b3J5KHQpIHsKICAgICAgICAgICAgdmFyIG4gPSBydCh7CiAgICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgICB5OiAwCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgZSA9IHRjKFt1ZC5jb25maWcoewogICAgICAgICAgICAgIGZpbmQ6IHZ0LnNvbWUKICAgICAgICAgICAgfSksIFZnLmNvbmZpZyh7fSldKTsKICAgICAgICAgICAgcmV0dXJuIFl3LnNrZXRjaCh7CiAgICAgICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICAgICAgICByb2xlOiAicHJlc2VudGF0aW9uIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsYXNzZXM6IFtsKCJzdi1wYWxldHRlIildCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICAgICAgbW9kZTogInh5IiwKICAgICAgICAgICAgICAgIGdldEluaXRpYWxWYWx1ZTogbgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcm91bmRlZDogITEsCiAgICAgICAgICAgICAgY29tcG9uZW50czogW2YsIGRdLAogICAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZSh0LCBuLCBlKSB7CiAgICAgICAgICAgICAgICB2cih0LCBKdywgewogICAgICAgICAgICAgICAgICB2YWx1ZTogZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBvbkluaXQ6IGZ1bmN0aW9uIG9uSW5pdCh0LCBuLCBlLCBvKSB7CiAgICAgICAgICAgICAgICB5KGUuZWxlbWVudC5kb20sIHp2KHNiKSk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzbGlkZXJCZWhhdmlvdXJzOiBlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIG5hbWU6ICJTYXR1cmF0aW9uQnJpZ2h0bmVzc1BhbGV0dGUiLAogICAgICAgICAgY29uZmlnRmllbGRzOiBbXSwKICAgICAgICAgIGFwaXM6IHsKICAgICAgICAgICAgc2V0SHVlOiBmdW5jdGlvbiBzZXRIdWUodCwgbiwgZSkgewogICAgICAgICAgICAgIHZhciBvID0gZTsKICAgICAgICAgICAgICB5KG4uY29tcG9uZW50cygpWzBdLmVsZW1lbnQuZG9tLCB6dihSdihMdihvLCAxMDAsIDEwMCkpKSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldFRodW1iOiBmdW5jdGlvbiBzZXRUaHVtYih0LCBuLCBlKSB7CiAgICAgICAgICAgICAgdmFyIG8gPSBuLAogICAgICAgICAgICAgICAgICByID0gV3YoVnYoZSkpOwogICAgICAgICAgICAgIFl3LnNldFZhbHVlKG8sIHsKICAgICAgICAgICAgICAgIHg6IHIuc2F0dXJhdGlvbiwKICAgICAgICAgICAgICAgIHk6IDEwMCAtIHIudmFsdWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGV4dHJhQXBpczoge30KICAgICAgICB9KSksCiAgICAgICAgICAgIHAgPSB7CiAgICAgICAgICBwYWxldHRlUmdiYTogVm8oc2IpLAogICAgICAgICAgcGFsZXR0ZUh1ZTogVm8oMCkKICAgICAgICB9LAogICAgICAgICAgICBoID0gUG0oKGkgPSBZdy5wYXJ0cy5zcGVjdHJ1bSh7CiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgY2xhc3NlczogWyhvID0gdykoImh1ZS1zbGlkZXItc3BlY3RydW0iKV0sCiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgICByb2xlOiAicHJlc2VudGF0aW9uIgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSksIHUgPSBZdy5wYXJ0cy50aHVtYih7CiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgY2xhc3NlczogW28oImh1ZS1zbGlkZXItdGh1bWIiKV0sCiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgICByb2xlOiAicHJlc2VudGF0aW9uIgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSksIFl3LnNrZXRjaCh7CiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgY2xhc3NlczogW28oImh1ZS1zbGlkZXIiKV0sCiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgICByb2xlOiAicHJlc2VudGF0aW9uIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgcm91bmRlZDogITEsCiAgICAgICAgICBtb2RlbDogewogICAgICAgICAgICBtb2RlOiAieSIsCiAgICAgICAgICAgIGdldEluaXRpYWxWYWx1ZTogcnQoewogICAgICAgICAgICAgIHk6IDAKICAgICAgICAgICAgfSkKICAgICAgICAgIH0sCiAgICAgICAgICBjb21wb25lbnRzOiBbaSwgdV0sCiAgICAgICAgICBzbGlkZXJCZWhhdmlvdXJzOiB0YyhbVmcuY29uZmlnKHt9KV0pLAogICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKHQsIG4sIGUpIHsKICAgICAgICAgICAgdnIodCwgS3csIHsKICAgICAgICAgICAgICB2YWx1ZTogZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KSkpLAogICAgICAgICAgICB2ID0gUG0oZy5za2V0Y2goe30pKSwKICAgICAgICAgICAgYiA9IFBtKG0uc2tldGNoKHt9KSk7CgogICAgICAgIGZ1bmN0aW9uIHkodCwgbikgewogICAgICAgICAgdmFyIGUsCiAgICAgICAgICAgICAgbywKICAgICAgICAgICAgICByID0gdC53aWR0aCwKICAgICAgICAgICAgICBpID0gdC5oZWlnaHQsCiAgICAgICAgICAgICAgdSA9IHQuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICAgIG51bGwgIT09IHUgJiYgKHUuZmlsbFN0eWxlID0gbiwgdS5maWxsUmVjdCgwLCAwLCByLCBpKSwgKGUgPSB1LmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIHIsIDApKS5hZGRDb2xvclN0b3AoMCwgInJnYmEoMjU1LDI1NSwyNTUsMSkiKSwgZS5hZGRDb2xvclN0b3AoMSwgInJnYmEoMjU1LDI1NSwyNTUsMCkiKSwgdS5maWxsU3R5bGUgPSBlLCB1LmZpbGxSZWN0KDAsIDAsIHIsIGkpLCAobyA9IHUuY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgMCwgaSkpLmFkZENvbG9yU3RvcCgwLCAicmdiYSgwLDAsMCwwKSIpLCBvLmFkZENvbG9yU3RvcCgxLCAicmdiYSgwLDAsMCwxKSIpLCB1LmZpbGxTdHlsZSA9IG8sIHUuZmlsbFJlY3QoMCwgMCwgciwgaSkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHVpZDogdC51aWQsCiAgICAgICAgICBkb206IHQuZG9tLAogICAgICAgICAgY29tcG9uZW50czogW3YuYXNTcGVjKCksIGguYXNTcGVjKCksIGIuYXNTcGVjKCldLAogICAgICAgICAgYmVoYXZpb3VyczogdGMoW2ZtKCJjb2xvdXItcGlja2VyLWV2ZW50cyIsIFtDcihxdywgKHMgPSBbbiwgZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgICAgICAgaC5nZXRPcHQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIFl3LnNldFZhbHVlKHQsIHsKICAgICAgICAgICAgICAgIHk6IDEwMCAtIGUgLyAzNjAgKiAxMDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICB2LmdldE9wdCh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgZy5zZXRUaHVtYih0LCBuKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9XSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgdmFyIGUgPSBuLmV2ZW50LmhleDsKICAgICAgICAgICAgcih0LCBlLCBXdihWdihlKSkuaHVlLCBzKTsKICAgICAgICAgIH0pKSwgQ3IoSncsIChjID0gW2VdLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICB2YXIgZSA9IG4uZXZlbnQudmFsdWUsCiAgICAgICAgICAgICAgICBvID0gcC5wYWxldHRlSHVlLmdldCgpOwogICAgICAgICAgICByKHQsIFV2KEx2KG8sIGUueCwgMTAwIC0gZS55KSksIG8sIGMpOwogICAgICAgICAgfSkpLCBDcihLdywgKGEgPSBbbiwgZV0sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgIHZhciBlID0gKDEwMCAtIG4uZXZlbnQudmFsdWUueSkgLyAxMDAgKiAzNjAsCiAgICAgICAgICAgICAgICBvID0gV3YocC5wYWxldHRlUmdiYS5nZXQoKSk7CiAgICAgICAgICAgIHIodCwgVXYoTHYoZSwgby5zYXR1cmF0aW9uLCBvLnZhbHVlKSksIGUsIGEpOwogICAgICAgICAgfSkpXSksIHVkLmNvbmZpZyh7CiAgICAgICAgICAgIGZpbmQ6IGZ1bmN0aW9uIGZpbmQodCkgewogICAgICAgICAgICAgIHJldHVybiBiLmdldE9wdCh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSksIE1nLmNvbmZpZyh7CiAgICAgICAgICAgIG1vZGU6ICJhY3ljbGljIgogICAgICAgICAgfSldKQogICAgICAgIH07CiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gcjAodCkgewogICAgcmV0dXJuIGlTW3RdOwogIH0KCiAgZnVuY3Rpb24gaTAodCwgbiwgZSkgewogICAgcmV0dXJuIFRmLmNvbmZpZyhYbyh7CiAgICAgIHN0b3JlOiB7CiAgICAgICAgbW9kZTogIm1hbnVhbCIsCiAgICAgICAgZ2V0VmFsdWU6IG4sCiAgICAgICAgc2V0VmFsdWU6IGUKICAgICAgfQogICAgfSwgdC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBzdG9yZTogewogICAgICAgICAgaW5pdGlhbFZhbHVlOiB0CiAgICAgICAgfQogICAgICB9OwogICAgfSkuZ2V0T3Ioe30pKSk7CiAgfQoKICBmdW5jdGlvbiB1MChyLCBpKSB7CiAgICBmdW5jdGlvbiBuKHQsIG4pIHsKICAgICAgbi5zdG9wKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZSh0KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAobiwgZSkgewogICAgICAgIFN0KHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB0KG4sIGUpOwogICAgICAgIH0pOwogICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIG8odCwgbikgewogICAgICB2YXIgZTsKICAgICAgZGQuaXNEaXNhYmxlZCh0KSB8fCAoZSA9IG4uZXZlbnQucmF3LCBhKHQsIGUuZGF0YVRyYW5zZmVyLmZpbGVzKSk7CiAgICB9CgogICAgZnVuY3Rpb24gdSh0LCBuKSB7CiAgICAgIHZhciBlID0gbi5ldmVudC5yYXcudGFyZ2V0OwogICAgICBhKHQsIGUuZmlsZXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGEodCwgbikgewogICAgICB2YXIgZSwgbzsKICAgICAgVGYuc2V0VmFsdWUodCwgKGUgPSBuLCBvID0gYVMuZXhwbG9kZShpLmdldFNldHRpbmcoImltYWdlc19maWxlX3R5cGVzIiwgImpwZWcsanBnLGpwZSxqZmksamlmLGpmaWYscG5nLGdpZixibXAsd2VicCIsICJzdHJpbmciKSksIEYoQ3QoZSksIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgcmV0dXJuIFQobywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBCdChuLm5hbWUudG9Mb3dlckNhc2UoKSwgIi4iICsgdC50b0xvd2VyQ2FzZSgpKTsKICAgICAgICB9KTsKICAgICAgfSkpKSwgdnIodCwgcHksIHsKICAgICAgICBuYW1lOiByLm5hbWUKICAgICAgfSk7CiAgICB9CgogICAgdmFyIGMgPSBQbSh7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImlucHV0IiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB0eXBlOiAiZmlsZSIsCiAgICAgICAgICBhY2NlcHQ6ICJpbWFnZS8qIgogICAgICAgIH0sCiAgICAgICAgc3R5bGVzOiB7CiAgICAgICAgICBkaXNwbGF5OiAibm9uZSIKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGJlaGF2aW91cnM6IHRjKFtmbSgiaW5wdXQtZmlsZS1ldmVudHMiLCBbRXIoQ2koKSksIEVyKFJpKCkpXSldKQogICAgfSk7CiAgICByZXR1cm4gUWIoci5sYWJlbC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIFpiKHQsIGkpOwogICAgfSksIHN5LnBhcnRzLmZpZWxkKHsKICAgICAgZmFjdG9yeTogewogICAgICAgIHNrZXRjaDogZnVuY3Rpb24gc2tldGNoKHQpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHVpZDogdC51aWQsCiAgICAgICAgICAgIGRvbTogewogICAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgICAgY2xhc3NlczogWyJ0b3gtZHJvcHpvbmUtY29udGFpbmVyIl0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgYmVoYXZpb3VyczogdGMoW2ZTKFtdKSwgb3coKSwgZGQuY29uZmlnKHt9KSwgemcuY29uZmlnKHsKICAgICAgICAgICAgICB0b2dnbGVDbGFzczogImRyYWdlbnRlciIsCiAgICAgICAgICAgICAgdG9nZ2xlT25FeGVjdXRlOiAhMQogICAgICAgICAgICB9KSwgZm0oImRyb3B6b25lLWV2ZW50cyIsIFtDcigiZHJhZ2VudGVyIiwgZShbbiwgemcudG9nZ2xlXSkpLCBDcigiZHJhZ2xlYXZlIiwgZShbbiwgemcudG9nZ2xlXSkpLCBDcigiZHJhZ292ZXIiLCBuKSwgQ3IoImRyb3AiLCBlKFtuLCBvXSkpLCBDcihTaSgpLCB1KV0pXSksCiAgICAgICAgICAgIGNvbXBvbmVudHM6IFt7CiAgICAgICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgICAgICAgY2xhc3NlczogWyJ0b3gtZHJvcHpvbmUiXSwKICAgICAgICAgICAgICAgIHN0eWxlczoge30KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNvbXBvbmVudHM6IFt7CiAgICAgICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICAgICAgdGFnOiAicCIsCiAgICAgICAgICAgICAgICAgIGlubmVySHRtbDogaS50cmFuc2xhdGUoIkRyb3AgYW4gaW1hZ2UgaGVyZSIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgc3Auc2tldGNoKHsKICAgICAgICAgICAgICAgIGRvbTogewogICAgICAgICAgICAgICAgICB0YWc6ICJidXR0b24iLAogICAgICAgICAgICAgICAgICBpbm5lckh0bWw6IGkudHJhbnNsYXRlKCJCcm93c2UgZm9yIGFuIGltYWdlIiksCiAgICAgICAgICAgICAgICAgIHN0eWxlczogewogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGNsYXNzZXM6IFsidG94LWJ1dHRvbiIsICJ0b3gtYnV0dG9uLS1zZWNvbmRhcnkiXQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbXBvbmVudHM6IFtjLmFzU3BlYygpXSwKICAgICAgICAgICAgICAgIGFjdGlvbjogZnVuY3Rpb24gYWN0aW9uKHQpIHsKICAgICAgICAgICAgICAgICAgYy5nZXQodCkuZWxlbWVudC5kb20uY2xpY2soKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBidXR0b25CZWhhdmlvdXJzOiB0YyhbZnkuY29uZmlnKHt9KSwgS3YoaS5pc0Rpc2FibGVkKSwgbXYoKV0pCiAgICAgICAgICAgICAgfSldCiAgICAgICAgICAgIH1dCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfQogICAgfSksIFsidG94LWZvcm1fX2dyb3VwLS1zdHJldGNoZWQiXSwgW10pOwogIH0KCiAgZnVuY3Rpb24gYTAodCkgewogICAgcmV0dXJuIHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBzdHlsZXM6IHsKICAgICAgICAgIHdpZHRoOiAiMXB4IiwKICAgICAgICAgIGhlaWdodDogIjFweCIsCiAgICAgICAgICBvdXRsaW5lOiAibm9uZSIKICAgICAgICB9LAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHRhYmluZGV4OiAiMCIKICAgICAgICB9LAogICAgICAgIGNsYXNzZXM6IHQKICAgICAgfSwKICAgICAgYmVoYXZpb3VyczogdGMoW1ZnLmNvbmZpZyh7CiAgICAgICAgaWdub3JlOiAhMAogICAgICB9KSwgZnkuY29uZmlnKHt9KV0pCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gYzAodCkgewogICAgcmV0dXJuIHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbInRveC1uYXZvYmoiXQogICAgICB9LAogICAgICBjb21wb25lbnRzOiBbYTAoW2RTXSksIHQsIGEwKFttU10pXSwKICAgICAgYmVoYXZpb3VyczogdGMoW3JTKDEpXSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBzMCh0LCBuKSB7CiAgICB2cih0LCB5aSgpLCB7CiAgICAgIHJhdzogewogICAgICAgIHdoaWNoOiA5LAogICAgICAgIHNoaWZ0S2V5OiBuCiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gbDAodCwgbikgewogICAgdmFyIGUgPSBuLmVsZW1lbnQ7CiAgICBxcihlLCBkUykgPyBzMCh0LCAhMCkgOiBxcihlLCBtUykgJiYgczAodCwgITEpOwogIH0KCiAgZnVuY3Rpb24gZjAodCkgewogICAgcmV0dXJuIFViKHQsIFsiLiIgKyBkUywgIi4iICsgbVNdLmpvaW4oIiwiKSwgTyk7CiAgfQoKICBmdW5jdGlvbiBkMCh0LCBuKSB7CiAgICByZXR1cm4gaFMoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIiksIHQsIG4pOwogIH0KCiAgZnVuY3Rpb24gbTAodCkgewogICAgdmFyIG4gPSBkMCh0LndpZHRoLCB0LmhlaWdodCk7CiAgICByZXR1cm4gcFMobikuZHJhd0ltYWdlKHQsIDAsIDApLCBuOwogIH0KCiAgZnVuY3Rpb24gZzAodCkgewogICAgcmV0dXJuIHQubmF0dXJhbFdpZHRoIHx8IHQud2lkdGg7CiAgfQoKICBmdW5jdGlvbiBwMCh0KSB7CiAgICByZXR1cm4gdC5uYXR1cmFsSGVpZ2h0IHx8IHQuaGVpZ2h0OwogIH0KCiAgZnVuY3Rpb24gaDAodCwgbywgcikgewogICAgcmV0dXJuIG8gPSBvIHx8ICJpbWFnZS9wbmciLCBtKEhUTUxDYW52YXNFbGVtZW50LnByb3RvdHlwZS50b0Jsb2IpID8gbmV3IFZ5KGZ1bmN0aW9uIChuLCBlKSB7CiAgICAgIHQudG9CbG9iKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdCA/IG4odCkgOiBlKCk7CiAgICAgIH0sIG8sIHIpOwogICAgfSkgOiAoZyA9IHQudG9EYXRhVVJMKG8sIHIpLCBuZXcgVnkoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgIWZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IGcuc3BsaXQoIiwiKSwKICAgICAgICAgICAgbiA9IC9kYXRhOihbXjtdKykvLmV4ZWModFswXSk7CiAgICAgICAgaWYgKCFuKSByZXR1cm4gdnQubm9uZSgpOwoKICAgICAgICBmb3IgKHZhciBlID0gblsxXSwgbyA9IHRbMV0sIHIgPSBhdG9iKG8pLCBpID0gci5sZW5ndGgsIHUgPSBNYXRoLmNlaWwoaSAvIDEwMjQpLCBhID0gbmV3IEFycmF5KHUpLCBjID0gMDsgYyA8IHU7ICsrYykgewogICAgICAgICAgZm9yICh2YXIgcyA9IDEwMjQgKiBjLCBsID0gTWF0aC5taW4oMTAyNCArIHMsIGkpLCBmID0gbmV3IEFycmF5KGwgLSBzKSwgZCA9IHMsIG0gPSAwOyBkIDwgbDsgKyttLCArK2QpIHsKICAgICAgICAgICAgZlttXSA9IHJbZF0uY2hhckNvZGVBdCgwKTsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2NdID0gbmV3IFVpbnQ4QXJyYXkoZik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdnQuc29tZShuZXcgQmxvYihhLCB7CiAgICAgICAgICB0eXBlOiBlCiAgICAgICAgfSkpOwogICAgICB9KCkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgbigidXJpIGlzIG5vdCBiYXNlNjQ6ICIgKyBnKTsKICAgICAgfSwgdCk7CiAgICB9KSk7CiAgICB2YXIgZzsKICB9CgogIGZ1bmN0aW9uIHYwKHQsIG4sIGUpIHsKICAgIGZ1bmN0aW9uIG8obiwgZSkgewogICAgICByZXR1cm4gdC50aGVuKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHQudG9EYXRhVVJMKG4gfHwgImltYWdlL3BuZyIsIGUpOwogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBnZXRUeXBlOiBydChuLnR5cGUpLAogICAgICB0b0Jsb2I6IGZ1bmN0aW9uIHRvQmxvYigpIHsKICAgICAgICByZXR1cm4gVnkucmVzb2x2ZShuKTsKICAgICAgfSwKICAgICAgdG9EYXRhVVJMOiBydChlKSwKICAgICAgdG9CYXNlNjQ6IGZ1bmN0aW9uIHRvQmFzZTY0KCkgewogICAgICAgIHJldHVybiBlLnNwbGl0KCIsIilbMV07CiAgICAgIH0sCiAgICAgIHRvQWRqdXN0ZWRCbG9iOiBmdW5jdGlvbiB0b0FkanVzdGVkQmxvYihuLCBlKSB7CiAgICAgICAgcmV0dXJuIHQudGhlbihmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGgwKHQsIG4sIGUpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICB0b0FkanVzdGVkRGF0YVVSTDogbywKICAgICAgdG9BZGp1c3RlZEJhc2U2NDogZnVuY3Rpb24gdG9BZGp1c3RlZEJhc2U2NCh0LCBuKSB7CiAgICAgICAgcmV0dXJuIG8odCwgbikudGhlbihmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHQuc3BsaXQoIiwiKVsxXTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgdG9DYW52YXM6IGZ1bmN0aW9uIHRvQ2FudmFzKCkgewogICAgICAgIHJldHVybiB0LnRoZW4obTApOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gYjAobiwgdCkgewogICAgcmV0dXJuIGgwKG4sIHQpLnRoZW4oZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHYwKFZ5LnJlc29sdmUobiksIHQsIG4udG9EYXRhVVJMKCkpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB5MChuKSB7CiAgICByZXR1cm4gZSA9IG4sIG5ldyBWeShmdW5jdGlvbiAodCkgewogICAgICB2YXIgbiA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIG4ub25sb2FkZW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgIHQobi5yZXN1bHQpOwogICAgICB9LCBuLnJlYWRBc0RhdGFVUkwoZSk7CiAgICB9KS50aGVuKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB2MCgoYSA9IG4sIG5ldyBWeShmdW5jdGlvbiAodCwgbikgewogICAgICAgIGZ1bmN0aW9uIGUoKSB7CiAgICAgICAgICByLnJlbW92ZUV2ZW50TGlzdGVuZXIoImxvYWQiLCBpKSwgci5yZW1vdmVFdmVudExpc3RlbmVyKCJlcnJvciIsIHUpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG8gPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGEpLAogICAgICAgICAgICByID0gbmV3IEltYWdlKCksCiAgICAgICAgICAgIGkgPSBmdW5jdGlvbiBpKCkgewogICAgICAgICAgZSgpLCB0KHIpOwogICAgICAgIH0sCiAgICAgICAgICAgIHUgPSBmdW5jdGlvbiB1KCkgewogICAgICAgICAgZSgpLCBuKCJVbmFibGUgdG8gbG9hZCBkYXRhIG9mIHR5cGUgIiArIGEudHlwZSArICI6ICIgKyBvKTsKICAgICAgICB9OwoKICAgICAgICByLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCBpKSwgci5hZGRFdmVudExpc3RlbmVyKCJlcnJvciIsIHUpLCByLnNyYyA9IG8sIHIuY29tcGxldGUgJiYgc2V0VGltZW91dChpLCAwKTsKICAgICAgfSkudGhlbihmdW5jdGlvbiAodCkgewogICAgICAgIHZTKHQpOwogICAgICAgIHZhciBuID0gZDAoZzAodCksIHAwKHQpKTsKICAgICAgICByZXR1cm4gcFMobikuZHJhd0ltYWdlKHQsIDAsIDApLCBuOwogICAgICB9KSksIG4sIHQpOwogICAgICB2YXIgYTsKICAgIH0pOwogICAgdmFyIGU7CiAgfQoKICBmdW5jdGlvbiB4MCh0LCBuLCBlKSB7CiAgICB2YXIgbyA9ICJzdHJpbmciID09IHR5cGVvZiB0ID8gcGFyc2VGbG9hdCh0KSA6IHQ7CiAgICByZXR1cm4gZSA8IG8gPyBvID0gZSA6IG8gPCBuICYmIChvID0gbiksIG87CiAgfQoKICBmdW5jdGlvbiB3MCgpIHsKICAgIHJldHVybiBbMSwgMCwgMCwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMCwgMV07CiAgfQoKICBmdW5jdGlvbiBTMCh0LCBuKSB7CiAgICBmb3IgKHZhciBlID0gW10sIG8gPSBuZXcgQXJyYXkoMjUpLCByID0gMDsgciA8IDU7IHIrKykgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDU7IGkrKykgewogICAgICAgIGVbaV0gPSBuW2kgKyA1ICogcl07CiAgICAgIH0KCiAgICAgIGZvciAoaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBmb3IgKHZhciB1ID0gMCwgYSA9IDA7IGEgPCA1OyBhKyspIHsKICAgICAgICAgIHUgKz0gdFtpICsgNSAqIGFdICogZVthXTsKICAgICAgICB9CgogICAgICAgIG9baSArIDUgKiByXSA9IHU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gbzsKICB9CgogIGZ1bmN0aW9uIEMwKG4sIGUpIHsKICAgIHJldHVybiBuLnRvQ2FudmFzKCkudGhlbihmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4geVModCwgbi5nZXRUeXBlKCksIGUpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBrMChlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIEMwKHQsIGUodzAoKSwgbikpOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIE8wKHQsIG4pIHsKICAgIHZvaWQgMCA9PT0gbiAmJiAobiA9IDIpOwogICAgdmFyIGUgPSBNYXRoLnBvdygxMCwgbiksCiAgICAgICAgbyA9IE1hdGgucm91bmQodCAqIGUpOwogICAgcmV0dXJuIE1hdGguY2VpbChvIC8gZSk7CiAgfQoKICBmdW5jdGlvbiBfMCh0KSB7CiAgICByZXR1cm4geFModCk7CiAgfQoKICBmdW5jdGlvbiBUMCh0KSB7CiAgICByZXR1cm4gQ1ModCk7CiAgfQoKICBmdW5jdGlvbiBFMCh0LCBuKSB7CiAgICByZXR1cm4ga1ModCwgbik7CiAgfQoKICBmdW5jdGlvbiBEMCh0LCBuKSB7CiAgICByZXR1cm4gd1ModCwgbik7CiAgfQoKICBmdW5jdGlvbiBCMCh0LCBuKSB7CiAgICByZXR1cm4gU1ModCwgbik7CiAgfQoKICBmdW5jdGlvbiBNMCh0LCBuKSB7CiAgICByZXR1cm4gbyA9IG4sIChlID0gdCkudG9DYW52YXMoKS50aGVuKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBFUyh0LCBlLmdldFR5cGUoKSwgbyk7CiAgICB9KTsKICAgIHZhciBlLCBvOwogIH0KCiAgZnVuY3Rpb24gQTAodCwgbikgewogICAgcmV0dXJuIG8gPSBuLCAoZSA9IHQpLnRvQ2FudmFzKCkudGhlbihmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gVFModCwgZS5nZXRUeXBlKCksIG8pOwogICAgfSk7CiAgICB2YXIgZSwgbzsKICB9CgogIGZ1bmN0aW9uIEYwKHQsIG4sIGUpIHsKICAgIHJldHVybiBqbSh0LCB7CiAgICAgIHRhZzogInNwYW4iLAogICAgICBjbGFzc2VzOiBbInRveC1pY29uIiwgInRveC10YnRuX19pY29uLXdyYXAiXSwKICAgICAgYmVoYXZpb3VyczogZQogICAgfSwgbik7CiAgfQoKICBmdW5jdGlvbiBJMCh0LCBuKSB7CiAgICByZXR1cm4gRjAodCwgbiwgW10pOwogIH0KCiAgZnVuY3Rpb24gUjAodCwgbikgewogICAgcmV0dXJuIEYwKHQsIG4sIFtGZy5jb25maWcoe30pXSk7CiAgfQoKICBmdW5jdGlvbiBWMCh0LCBuLCBlKSB7CiAgICByZXR1cm4gewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJzcGFuIiwKICAgICAgICBpbm5lckh0bWw6IGUudHJhbnNsYXRlKHQpLAogICAgICAgIGNsYXNzZXM6IFtuICsgIl9fc2VsZWN0LWxhYmVsIl0KICAgICAgfSwKICAgICAgYmVoYXZpb3VyczogdGMoW0ZnLmNvbmZpZyh7fSldKQogICAgfTsKICB9CgogIGZ1bmN0aW9uIFAwKG4sIGUsIG8pIHsKICAgIGZ1bmN0aW9uIHQodCwgbikgewogICAgICB2YXIgZSA9IFRmLmdldFZhbHVlKHQpOwogICAgICByZXR1cm4gVmcuZm9jdXMoZSksIHZyKGUsICJrZXlkb3duIiwgewogICAgICAgIHJhdzogbi5ldmVudC5yYXcKICAgICAgfSksIGR3LmNsb3NlKGUpLCB2dC5zb21lKCEwKTsKICAgIH0KCiAgICB2YXIgciA9IFZvKHN0KSwKICAgICAgICBpID0gbi50ZXh0Lm1hcChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gUG0oVjAodCwgZSwgby5wcm92aWRlcnMpKTsKICAgIH0pLAogICAgICAgIHUgPSBuLmljb24ubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBQbShSMCh0LCBvLnByb3ZpZGVycy5pY29ucykpOwogICAgfSksCiAgICAgICAgYSA9IG4ucm9sZS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHt9OwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICByb2xlOiB0CiAgICAgIH07CiAgICB9KSwKICAgICAgICBjID0gbi50b29sdGlwLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4ge307CiAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICB2YXIgbiA9IG8ucHJvdmlkZXJzLnRyYW5zbGF0ZSh0KTsKICAgICAgcmV0dXJuIHsKICAgICAgICB0aXRsZTogbiwKICAgICAgICAiYXJpYS1sYWJlbCI6IG4KICAgICAgfTsKICAgIH0pLAogICAgICAgIHMgPSBqbSgiY2hldnJvbi1kb3duIiwgewogICAgICB0YWc6ICJkaXYiLAogICAgICBjbGFzc2VzOiBbZSArICJfX3NlbGVjdC1jaGV2cm9uIl0KICAgIH0sIG8ucHJvdmlkZXJzLmljb25zKTsKICAgIHJldHVybiBQbShkdy5za2V0Y2goX2x0KF9sdChfbHQoe30sIG4udWlkID8gewogICAgICB1aWQ6IG4udWlkCiAgICB9IDoge30pLCBhKSwgewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJidXR0b24iLAogICAgICAgIGNsYXNzZXM6IFtlLCBlICsgIi0tc2VsZWN0Il0uY29uY2F0KE0obi5jbGFzc2VzLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGUgKyAiLS0iICsgdDsKICAgICAgICB9KSksCiAgICAgICAgYXR0cmlidXRlczogX2x0KHt9LCBjKQogICAgICB9LAogICAgICBjb21wb25lbnRzOiBRdihbdS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdC5hc1NwZWMoKTsKICAgICAgfSksIGkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHQuYXNTcGVjKCk7CiAgICAgIH0pLCB2dC5zb21lKHMpXSksCiAgICAgIG1hdGNoV2lkdGg6ICEwLAogICAgICB1c2VNaW5XaWR0aDogITAsCiAgICAgIGRyb3Bkb3duQmVoYXZpb3VyczogdGMoSChIKFtdLCBuLmRyb3Bkb3duQmVoYXZpb3VycywgITApLCBbS3YoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuLmRpc2FibGVkIHx8IG8ucHJvdmlkZXJzLmlzRGlzYWJsZWQoKTsKICAgICAgfSksIG12KCksIG13LmNvbmZpZyh7fSksIEZnLmNvbmZpZyh7fSksIGZtKCJkcm9wZG93bi1ldmVudHMiLCBbcHYobiwgciksIGh2KG4sIHIpXSksIGZtKCJtZW51YnV0dG9uLXVwZGF0ZS1kaXNwbGF5LXRleHQiLCBbQ3IoQVMsIGZ1bmN0aW9uIChuLCBlKSB7CiAgICAgICAgaS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC5nZXRPcHQobik7CiAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgRmcuc2V0KHQsIFtvaShvLnByb3ZpZGVycy50cmFuc2xhdGUoZS5ldmVudC50ZXh0KSldKTsKICAgICAgICB9KTsKICAgICAgfSksIENyKEZTLCBmdW5jdGlvbiAobiwgZSkgewogICAgICAgIHUuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHQuZ2V0T3B0KG4pOwogICAgICAgIH0pLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIEZnLnNldCh0LCBbUjAoZS5ldmVudC5pY29uLCBvLnByb3ZpZGVycy5pY29ucyldKTsKICAgICAgICB9KTsKICAgICAgfSldKV0sICExKSksCiAgICAgIGV2ZW50T3JkZXI6IFhvKE1TLCB7CiAgICAgICAgbW91c2Vkb3duOiBbImZvY3VzaW5nIiwgImFsbG95LmJhc2UuYmVoYXZpb3VyIiwgIml0ZW0tdHlwZS1ldmVudHMiLCAibm9ybWFsLWRyb3Bkb3duLWV2ZW50cyJdCiAgICAgIH0pLAogICAgICBzYW5kYm94QmVoYXZpb3VyczogdGMoW01nLmNvbmZpZyh7CiAgICAgICAgbW9kZTogInNwZWNpYWwiLAogICAgICAgIG9uTGVmdDogdCwKICAgICAgICBvblJpZ2h0OiB0CiAgICAgIH0pXSksCiAgICAgIGxhenlTaW5rOiBvLmdldFNpbmssCiAgICAgIHRvZ2dsZUNsYXNzOiBlICsgIi0tYWN0aXZlIiwKICAgICAgcGFydHM6IHsKICAgICAgICBtZW51OiAkcCgwLCBuLmNvbHVtbnMsIG4ucHJlc2V0cykKICAgICAgfSwKICAgICAgZmV0Y2g6IGZ1bmN0aW9uIGZldGNoKHQpIHsKICAgICAgICByZXR1cm4gTnkoUyhuLmZldGNoLCB0KSk7CiAgICAgIH0KICAgIH0pKSkuYXNTcGVjKCk7CiAgfQoKICBmdW5jdGlvbiBIMCh0KSB7CiAgICByZXR1cm4gInNlcGFyYXRvciIgPT09IHQudHlwZTsKICB9CgogIGZ1bmN0aW9uIHowKHQsIGUsIG8sIG4pIHsKICAgIHZhciByID0gRnIoInByaW1hcnktbWVudSIpLAogICAgICAgIGkgPSBSUyh0LCBvLnNoYXJlZC5wcm92aWRlcnMubWVudUl0ZW1zKCkpOwogICAgaWYgKDAgPT09IGkuaXRlbXMubGVuZ3RoKSByZXR1cm4gdnQubm9uZSgpOwogICAgdmFyIHUgPSBMYihyLCBpLml0ZW1zLCBlLCBvLCBuKSwKICAgICAgICBhID0gZHQoaS5tZW51cywgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIExiKG4sIHQsIGUsIG8sICExKTsKICAgIH0pLAogICAgICAgIGMgPSBYbyhhLCBjcihyLCB1KSk7CiAgICByZXR1cm4gdnQuZnJvbShvcC50aWVyZWREYXRhKHIsIGMsIGkuZXhwYW5zaW9ucykpOwogIH0KCiAgZnVuY3Rpb24gTjAoZSkgewogICAgcmV0dXJuIHsKICAgICAgaXNEaXNhYmxlZDogZnVuY3Rpb24gaXNEaXNhYmxlZCgpIHsKICAgICAgICByZXR1cm4gZGQuaXNEaXNhYmxlZChlKTsKICAgICAgfSwKICAgICAgc2V0RGlzYWJsZWQ6IGZ1bmN0aW9uIHNldERpc2FibGVkKHQpIHsKICAgICAgICByZXR1cm4gZGQuc2V0KGUsIHQpOwogICAgICB9LAogICAgICBzZXRBY3RpdmU6IGZ1bmN0aW9uIHNldEFjdGl2ZSh0KSB7CiAgICAgICAgdmFyIG4gPSBlLmVsZW1lbnQ7CiAgICAgICAgdCA/IChYcihuLCAidG94LXRidG4tLWVuYWJsZWQiKSwgb24obiwgImFyaWEtcHJlc3NlZCIsICEwKSkgOiAoWXIobiwgInRveC10YnRuLS1lbmFibGVkIiksIGNuKG4sICJhcmlhLXByZXNzZWQiKSk7CiAgICAgIH0sCiAgICAgIGlzQWN0aXZlOiBmdW5jdGlvbiBpc0FjdGl2ZSgpIHsKICAgICAgICByZXR1cm4gcXIoZS5lbGVtZW50LCAidG94LXRidG4tLWVuYWJsZWQiKTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIEwwKGUsIHQsIG8sIG4pIHsKICAgIHJldHVybiBQMCh7CiAgICAgIHRleHQ6IGUudGV4dCwKICAgICAgaWNvbjogZS5pY29uLAogICAgICB0b29sdGlwOiBlLnRvb2x0aXAsCiAgICAgIHJvbGU6IG4sCiAgICAgIGZldGNoOiBmdW5jdGlvbiBmZXRjaCh0LCBuKSB7CiAgICAgICAgZS5mZXRjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgbih6MCh0LCB4aC5DTE9TRV9PTl9FWEVDVVRFLCBvLCAhMSkpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBvblNldHVwOiBlLm9uU2V0dXAsCiAgICAgIGdldEFwaTogTjAsCiAgICAgIGNvbHVtbnM6IDEsCiAgICAgIHByZXNldHM6ICJub3JtYWwiLAogICAgICBjbGFzc2VzOiBbXSwKICAgICAgZHJvcGRvd25CZWhhdmlvdXJzOiBbZnkuY29uZmlnKHt9KV0KICAgIH0sIHQsIG8uc2hhcmVkKTsKICB9CgogIGZ1bmN0aW9uIFcwKHQsIG4sIGUsIG8sIHIsIGkpIHsKICAgIHZvaWQgMCA9PT0gZSAmJiAoZSA9IFtdKTsKCiAgICB2YXIgdSA9IG4uZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB7fTsKICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYWN0aW9uOiB0CiAgICAgIH07CiAgICB9KSwKICAgICAgICBhID0gX2x0KHsKICAgICAgYnV0dG9uQmVoYXZpb3VyczogdGMoW0t2KGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdC5kaXNhYmxlZCB8fCBpLmlzRGlzYWJsZWQoKTsKICAgICAgfSksIG12KCksIGZ5LmNvbmZpZyh7fSksIGZtKCJidXR0b24gcHJlc3MiLCBbU3IoImNsaWNrIiksIFNyKCJtb3VzZWRvd24iKV0pXS5jb25jYXQoZSkpLAogICAgICBldmVudE9yZGVyOiB7CiAgICAgICAgY2xpY2s6IFsiYnV0dG9uIHByZXNzIiwgImFsbG95LmJhc2UuYmVoYXZpb3VyIl0sCiAgICAgICAgbW91c2Vkb3duOiBbImJ1dHRvbiBwcmVzcyIsICJhbGxveS5iYXNlLmJlaGF2aW91ciJdCiAgICAgIH0KICAgIH0sIHUpLAogICAgICAgIGMgPSBYbyhhLCB7CiAgICAgIGRvbTogbwogICAgfSk7CgogICAgcmV0dXJuIFhvKGMsIHsKICAgICAgY29tcG9uZW50czogcgogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBVMCh0LCBuLCBlLCBvKSB7CiAgICB2b2lkIDAgPT09IG8gJiYgKG8gPSBbXSk7CiAgICB2YXIgciA9IHsKICAgICAgdGFnOiAiYnV0dG9uIiwKICAgICAgY2xhc3NlczogWyJ0b3gtdGJ0biJdLAogICAgICBhdHRyaWJ1dGVzOiB0LnRvb2x0aXAubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICJhcmlhLWxhYmVsIjogZS50cmFuc2xhdGUodCksCiAgICAgICAgICB0aXRsZTogZS50cmFuc2xhdGUodCkKICAgICAgICB9OwogICAgICB9KS5nZXRPcih7fSkKICAgIH0sCiAgICAgICAgaSA9IHQuaWNvbi5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIEkwKHQsIGUuaWNvbnMpOwogICAgfSk7CiAgICByZXR1cm4gVzAodCwgbiwgbywgciwgUXYoW2ldKSwgZSk7CiAgfQoKICBmdW5jdGlvbiBqMCh0LCBuLCBlLCBvKSB7CiAgICB2b2lkIDAgPT09IG8gJiYgKG8gPSBbXSk7CiAgICB2YXIgciA9IFUwKHQsIHZ0LnNvbWUobiksIGUsIG8pOwogICAgcmV0dXJuIHNwLnNrZXRjaChyKTsKICB9CgogIGZ1bmN0aW9uIEcwKHQsIG4sIGUsIG8sIHIpIHsKICAgIHZvaWQgMCA9PT0gbyAmJiAobyA9IFtdKSwgdm9pZCAwID09PSByICYmIChyID0gW10pOwogICAgdmFyIGkgPSBlLnRyYW5zbGF0ZSh0LnRleHQpLAogICAgICAgIHUgPSB0Lmljb24gPyB0Lmljb24ubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBJMCh0LCBlLmljb25zKTsKICAgIH0pIDogdnQubm9uZSgpLAogICAgICAgIGEgPSB1LmlzU29tZSgpID8gUXYoW3VdKSA6IFtdLAogICAgICAgIGMgPSB1LmlzU29tZSgpID8ge30gOiB7CiAgICAgIGlubmVySHRtbDogaQogICAgfSwKICAgICAgICBzID0gSChIKEgoSChbXSwgdC5wcmltYXJ5IHx8IHQuYm9yZGVybGVzcyA/IFsidG94LWJ1dHRvbiJdIDogWyJ0b3gtYnV0dG9uIiwgInRveC1idXR0b24tLXNlY29uZGFyeSJdLCAhMCksIHUuaXNTb21lKCkgPyBbInRveC1idXR0b24tLWljb24iXSA6IFtdLCAhMCksIHQuYm9yZGVybGVzcyA/IFsidG94LWJ1dHRvbi0tbmFrZWQiXSA6IFtdLCAhMCksIHIsICEwKTsKICAgIHJldHVybiBXMCh0LCBuLCBvLCBfbHQoX2x0KHsKICAgICAgdGFnOiAiYnV0dG9uIiwKICAgICAgY2xhc3NlczogcwogICAgfSwgYyksIHsKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHRpdGxlOiBpCiAgICAgIH0KICAgIH0pLCBhLCBlKTsKICB9CgogIGZ1bmN0aW9uIFgwKHQsIG4sIGUsIG8sIHIpIHsKICAgIHZvaWQgMCA9PT0gbyAmJiAobyA9IFtdKSwgdm9pZCAwID09PSByICYmIChyID0gW10pOwogICAgdmFyIGkgPSBHMCh0LCB2dC5zb21lKG4pLCBlLCBvLCByKTsKICAgIHJldHVybiBzcC5za2V0Y2goaSk7CiAgfQoKICBmdW5jdGlvbiBZMChuLCBlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgImN1c3RvbSIgPT09IGUgPyB2cih0LCBieSwgewogICAgICAgIG5hbWU6IG4sCiAgICAgICAgdmFsdWU6IHt9CiAgICAgIH0pIDogInN1Ym1pdCIgPT09IGUgPyBocih0LCB5eSkgOiAiY2FuY2VsIiA9PT0gZSA/IGhyKHQsIHZ5KSA6IGNvbnNvbGUuZXJyb3IoIlVua25vd24gYnV0dG9uIHR5cGU6ICIsIGUpOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIHEwKG4sIHQsIGUpIHsKICAgIGlmICgibWVudSIgPT09IHQpIHsKICAgICAgdmFyIG8gPSBuLAogICAgICAgICAgciA9IFBtKEwwKF9sdChfbHQoe30sIG4pLCB7CiAgICAgICAgb25TZXR1cDogZnVuY3Rpb24gb25TZXR1cCh0KSB7CiAgICAgICAgICByZXR1cm4gdC5zZXREaXNhYmxlZChuLmRpc2FibGVkKSwgc3Q7CiAgICAgICAgfSwKICAgICAgICBmZXRjaDogKGkgPSBvLml0ZW1zLCB1ID0gZnVuY3Rpb24gdSgpIHsKICAgICAgICAgIHJldHVybiByOwogICAgICAgIH0sIGEgPSBlLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgdChNKGksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgICAgZSwKICAgICAgICAgICAgICAgIG8gPSB0LnRleHQuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0ZXh0OiB0CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBfbHQoX2x0KHsKICAgICAgICAgICAgICB0eXBlOiB0LnR5cGUsCiAgICAgICAgICAgICAgYWN0aXZlOiAhMQogICAgICAgICAgICB9LCBvKSwgewogICAgICAgICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiBvbkFjdGlvbih0KSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9ICF0LmlzQWN0aXZlKCk7CiAgICAgICAgICAgICAgICB0LnNldEFjdGl2ZShuKSwgZS5zdG9yYWdlLnNldChuKSwgYS5zaGFyZWQuZ2V0U2luaygpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgdSgpLmdldE9wdCh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgICAgU2EodC5lbGVtZW50KSwgdnIodCwgYnksIHsKICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGUubmFtZSwKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBlLnN0b3JhZ2UuZ2V0KCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIG9uU2V0dXA6IChuID0gZSA9IHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICB0LnNldEFjdGl2ZShuLnN0b3JhZ2UuZ2V0KCkpOwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkpOwogICAgICAgIH0pCiAgICAgIH0pLCAidG94LXRidG4iLCBlLCB2dC5ub25lKCkpKTsKICAgICAgcmV0dXJuIHIuYXNTcGVjKCk7CiAgICB9CgogICAgdmFyIGksIHUsIGE7CgogICAgaWYgKCJjdXN0b20iID09PSB0IHx8ICJjYW5jZWwiID09PSB0IHx8ICJzdWJtaXQiID09PSB0KSB7CiAgICAgIHZhciBjID0gWTAobi5uYW1lLCB0KTsKICAgICAgcmV0dXJuIFgwKF9sdChfbHQoe30sIG4pLCB7CiAgICAgICAgYm9yZGVybGVzczogITEKICAgICAgfSksIGMsIGUuc2hhcmVkLnByb3ZpZGVycywgW10pOwogICAgfQoKICAgIGNvbnNvbGUuZXJyb3IoIlVua25vd24gZm9vdGVyIGJ1dHRvbiB0eXBlOiAiLCB0KTsKICB9CgogIGZ1bmN0aW9uIEswKHQsIG4pIHsKICAgIHJldHVybiBxZih7CiAgICAgIGZhY3Rvcnk6IHN5LAogICAgICBuYW1lOiB0LAogICAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIG92ZXJyaWRlcyhvKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGZpZWxkQmVoYXZpb3VyczogdGMoW2ZtKCJjb3VwbGVkLWlucHV0LWJlaGF2aW91ciIsIFtDcih3aSgpLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBmbChlLCBvLCBuKS5iaW5kKHVkLmdldEN1cnJlbnQpLmVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICBmbChlLCBvLCAibG9jayIpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHpnLmlzT24odCkgJiYgby5vbkxvY2tlZENoYW5nZShlLCBuLCB0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KV0pXSkKICAgICAgICB9OwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIEowKHQpIHsKICAgIHZhciBuID0gL15ccyooXGQrKD86XC5cZCspPylccyoofGNtfG1tfGlufHB4fHB0fHBjfGVtfGV4fGNofHJlbXx2d3x2aHx2bWlufHZtYXh8JSlccyokLy5leGVjKHQpOwogICAgaWYgKG51bGwgPT09IG4pIHJldHVybiBSZS5lcnJvcih0KTsKICAgIHZhciBlID0gcGFyc2VGbG9hdChuWzFdKSwKICAgICAgICBvID0gblsyXTsKICAgIHJldHVybiBSZS52YWx1ZSh7CiAgICAgIHZhbHVlOiBlLAogICAgICB1bml0OiBvCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uICQwKHQsIG4pIHsKICAgIGZ1bmN0aW9uIGUodCkgewogICAgICByZXR1cm4gVHQobywgdCk7CiAgICB9CgogICAgdmFyIG8gPSB7CiAgICAgICIiOiA5NiwKICAgICAgcHg6IDk2LAogICAgICBwdDogNzIsCiAgICAgIGNtOiAyLjU0LAogICAgICBwYzogMTIsCiAgICAgIG1tOiAyNS40LAogICAgICBpbjogMQogICAgfTsKICAgIHJldHVybiB0LnVuaXQgPT09IG4gPyB2dC5zb21lKHQudmFsdWUpIDogZSh0LnVuaXQpICYmIGUobikgPyBvW3QudW5pdF0gPT09IG9bbl0gPyB2dC5zb21lKHQudmFsdWUpIDogdnQuc29tZSh0LnZhbHVlIC8gb1t0LnVuaXRdICogb1tuXSkgOiB2dC5ub25lKCk7CiAgfQoKICBmdW5jdGlvbiBRMCh0KSB7CiAgICByZXR1cm4gdnQubm9uZSgpOwogIH0KCiAgZnVuY3Rpb24gWjAobywgbikgewogICAgZnVuY3Rpb24gdCh0KSB7CiAgICAgIHJldHVybiBqbSh0LCB7CiAgICAgICAgdGFnOiAic3BhbiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtaWNvbiIsICJ0b3gtbG9jay1pY29uX18iICsgdF0KICAgICAgfSwgbi5pY29ucyk7CiAgICB9CgogICAgZnVuY3Rpb24gZSh0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtZm9ybV9fZ3JvdXAiXQogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogdAogICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIHIoZSkgewogICAgICByZXR1cm4gc3kucGFydHMuZmllbGQoewogICAgICAgIGZhY3Rvcnk6IE95LAogICAgICAgIGlucHV0Q2xhc3NlczogWyJ0b3gtdGV4dGZpZWxkIl0sCiAgICAgICAgaW5wdXRCZWhhdmlvdXJzOiB0YyhbZGQuY29uZmlnKHsKICAgICAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiBkaXNhYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIG8uZGlzYWJsZWQgfHwgbi5pc0Rpc2FibGVkKCk7CiAgICAgICAgICB9CiAgICAgICAgfSksIG12KCksIGZ5LmNvbmZpZyh7fSksIGZtKCJzaXplLWlucHV0LWV2ZW50cyIsIFtDcih2aSgpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgdnIodCwgdSwgewogICAgICAgICAgICBpc0ZpZWxkMTogZQogICAgICAgICAgfSk7CiAgICAgICAgfSksIENyKFNpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICB2cih0LCBweSwgewogICAgICAgICAgICBuYW1lOiBvLm5hbWUKICAgICAgICAgIH0pOwogICAgICAgIH0pXSldKSwKICAgICAgICBzZWxlY3RPbkZvY3VzOiAhMQogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBpKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImxhYmVsIiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LWxhYmVsIl0sCiAgICAgICAgICBpbm5lckh0bWw6IG4udHJhbnNsYXRlKHQpCiAgICAgICAgfQogICAgICB9OwogICAgfQoKICAgIHZhciBsID0gUTAsCiAgICAgICAgdSA9IEZyKCJyYXRpby1ldmVudCIpLAogICAgICAgIGEgPSBIUy5wYXJ0cy5sb2NrKHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiYnV0dG9uIiwKICAgICAgICBjbGFzc2VzOiBbInRveC1sb2NrIiwgInRveC1idXR0b24iLCAidG94LWJ1dHRvbi0tbmFrZWQiLCAidG94LWJ1dHRvbi0taWNvbiJdLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHRpdGxlOiBuLnRyYW5zbGF0ZShvLmxhYmVsLmdldE9yKCJDb25zdHJhaW4gcHJvcG9ydGlvbnMiKSkKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IFt0KCJsb2NrIiksIHQoInVubG9jayIpXSwKICAgICAgYnV0dG9uQmVoYXZpb3VyczogdGMoW2RkLmNvbmZpZyh7CiAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uIGRpc2FibGVkKCkgewogICAgICAgICAgcmV0dXJuIG8uZGlzYWJsZWQgfHwgbi5pc0Rpc2FibGVkKCk7CiAgICAgICAgfQogICAgICB9KSwgbXYoKSwgZnkuY29uZmlnKHt9KV0pCiAgICB9KSwKICAgICAgICBjID0gSFMucGFydHMuZmllbGQxKGUoW3N5LnBhcnRzLmxhYmVsKGkoIldpZHRoIikpLCByKCEwKV0pKSwKICAgICAgICBzID0gSFMucGFydHMuZmllbGQyKGUoW3N5LnBhcnRzLmxhYmVsKGkoIkhlaWdodCIpKSwgcighMSldKSk7CiAgICByZXR1cm4gSFMuc2tldGNoKHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbInRveC1mb3JtX19ncm91cCJdCiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IFt7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtZm9ybV9fY29udHJvbHMtaC1zdGFjayJdCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiBbYywgcywgZShbaSgiJm5ic3A7IiksIGFdKV0KICAgICAgfV0sCiAgICAgIGZpZWxkMU5hbWU6ICJ3aWR0aCIsCiAgICAgIGZpZWxkMk5hbWU6ICJoZWlnaHQiLAogICAgICBsb2NrZWQ6ICEwLAogICAgICBtYXJrZXJzOiB7CiAgICAgICAgbG9ja0NsYXNzOiAidG94LWxvY2tlZCIKICAgICAgfSwKICAgICAgb25Mb2NrZWRDaGFuZ2U6IGZ1bmN0aW9uIG9uTG9ja2VkQ2hhbmdlKHQsIGksIG4pIHsKICAgICAgICBKMChUZi5nZXRWYWx1ZSh0KSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgbCh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHZhciBuLCBlLCBvLCByOwogICAgICAgICAgICBUZi5zZXRWYWx1ZShpLCAociA9IC0xICE9PSAociA9IChuID0gdCkudmFsdWUudG9GaXhlZCgoZSA9IG4udW5pdCkgaW4gKG8gPSB7CiAgICAgICAgICAgICAgIiI6IDAsCiAgICAgICAgICAgICAgcHg6IDAsCiAgICAgICAgICAgICAgcHQ6IDEsCiAgICAgICAgICAgICAgbW06IDEsCiAgICAgICAgICAgICAgcGM6IDIsCiAgICAgICAgICAgICAgZXg6IDIsCiAgICAgICAgICAgICAgZW06IDIsCiAgICAgICAgICAgICAgY2g6IDIsCiAgICAgICAgICAgICAgcmVtOiAyLAogICAgICAgICAgICAgIGNtOiAzLAogICAgICAgICAgICAgIGluOiA0LAogICAgICAgICAgICAgICIlIjogNAogICAgICAgICAgICB9KSA/IG9bZV0gOiAxKSkuaW5kZXhPZigiLiIpID8gci5yZXBsYWNlKC9cLj8wKiQvLCAiIikgOiByKSArIG4udW5pdCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgY291cGxlZEZpZWxkQmVoYXZpb3VyczogdGMoW2RkLmNvbmZpZyh7CiAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uIGRpc2FibGVkKCkgewogICAgICAgICAgcmV0dXJuIG8uZGlzYWJsZWQgfHwgbi5pc0Rpc2FibGVkKCk7CiAgICAgICAgfSwKICAgICAgICBvbkRpc2FibGVkOiBmdW5jdGlvbiBvbkRpc2FibGVkKHQpIHsKICAgICAgICAgIEhTLmdldEZpZWxkMSh0KS5iaW5kKHN5LmdldEZpZWxkKS5lYWNoKGRkLmRpc2FibGUpLCBIUy5nZXRGaWVsZDIodCkuYmluZChzeS5nZXRGaWVsZCkuZWFjaChkZC5kaXNhYmxlKSwgSFMuZ2V0TG9jayh0KS5lYWNoKGRkLmRpc2FibGUpOwogICAgICAgIH0sCiAgICAgICAgb25FbmFibGVkOiBmdW5jdGlvbiBvbkVuYWJsZWQodCkgewogICAgICAgICAgSFMuZ2V0RmllbGQxKHQpLmJpbmQoc3kuZ2V0RmllbGQpLmVhY2goZGQuZW5hYmxlKSwgSFMuZ2V0RmllbGQyKHQpLmJpbmQoc3kuZ2V0RmllbGQpLmVhY2goZGQuZW5hYmxlKSwgSFMuZ2V0TG9jayh0KS5lYWNoKGRkLmVuYWJsZSk7CiAgICAgICAgfQogICAgICB9KSwgbXYoKSwgZm0oInNpemUtaW5wdXQtZXZlbnRzMiIsIFtDcih1LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIHZhciBlLAogICAgICAgICAgICBvLAogICAgICAgICAgICByLAogICAgICAgICAgICBpID0gbi5ldmVudC5pc0ZpZWxkMSwKICAgICAgICAgICAgdSA9IGkgPyBIUy5nZXRGaWVsZDEodCkgOiBIUy5nZXRGaWVsZDIodCksCiAgICAgICAgICAgIGEgPSBpID8gSFMuZ2V0RmllbGQyKHQpIDogSFMuZ2V0RmllbGQxKHQpLAogICAgICAgICAgICBjID0gdS5tYXAoVGYuZ2V0VmFsdWUpLmdldE9yKCIiKSwKICAgICAgICAgICAgcyA9IGEubWFwKFRmLmdldFZhbHVlKS5nZXRPcigiIik7CiAgICAgICAgZSA9IHMsIG8gPSBKMChjKS50b09wdGlvbmFsKCksIHIgPSBKMChlKS50b09wdGlvbmFsKCksIGwgPSBFdChvLCByLCBmdW5jdGlvbiAodCwgbykgewogICAgICAgICAgcmV0dXJuICQwKHQsIG8udW5pdCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiBvLnZhbHVlIC8gdDsKICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gbiA9IHQsIGUgPSBvLnVuaXQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuICQwKHQsIGUpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHQgKiBuLAogICAgICAgICAgICAgICAgICB1bml0OiBlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgbiwgZTsKICAgICAgICAgIH0pLmdldE9yKFEwKTsKICAgICAgICB9KS5nZXRPcihRMCk7CiAgICAgIH0pXSldKQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB0dyhmLCBjKSB7CiAgICBmdW5jdGlvbiB0KHQsIG4sIGUsIG8pIHsKICAgICAgcmV0dXJuIFBtKFgwKHsKICAgICAgICBuYW1lOiB0LAogICAgICAgIHRleHQ6IHQsCiAgICAgICAgZGlzYWJsZWQ6IGUsCiAgICAgICAgcHJpbWFyeTogbywKICAgICAgICBpY29uOiB2dC5ub25lKCksCiAgICAgICAgYm9yZGVybGVzczogITEKICAgICAgfSwgbiwgYykpOwogICAgfQoKICAgIGZ1bmN0aW9uIG4odCwgbiwgZSwgbykgewogICAgICByZXR1cm4gUG0oajAoewogICAgICAgIG5hbWU6IHQsCiAgICAgICAgaWNvbjogdnQuc29tZSh0KSwKICAgICAgICB0b29sdGlwOiB2dC5zb21lKG4pLAogICAgICAgIGRpc2FibGVkOiBvLAogICAgICAgIHByaW1hcnk6ICExLAogICAgICAgIGJvcmRlcmxlc3M6ICExCiAgICAgIH0sIGUsIGMpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkKHQsIGUpIHsKICAgICAgdC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbiA9IHQuZ2V0KGUpOwogICAgICAgIG4uaGFzQ29uZmlndXJlZChkZCkgJiYgZGQuZGlzYWJsZShuKTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gbSh0LCBlKSB7CiAgICAgIHQubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSB0LmdldChlKTsKICAgICAgICBuLmhhc0NvbmZpZ3VyZWQoZGQpICYmIGRkLmVuYWJsZShuKTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gcih0LCBuLCBlKSB7CiAgICAgIHZyKHQsIG4sIGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGkodCkgewogICAgICByZXR1cm4gaHIodCwgVVMuZGlzYWJsZSgpKSwgMDsKICAgIH0KCiAgICBmdW5jdGlvbiB1KHQpIHsKICAgICAgcmV0dXJuIGhyKHQsIFVTLmVuYWJsZSgpKSwgMDsKICAgIH0KCiAgICBmdW5jdGlvbiBnKHQsIG4pIHsKICAgICAgaSh0KSwgcih0LCB6Uy50cmFuc2Zvcm0oKSwgewogICAgICAgIHRyYW5zZm9ybTogbgogICAgICB9KSwgdSh0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBlKHQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICBxLmdldE9wdCh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBGZy5zZXQodCwgW1ldKTsKICAgICAgICB9KTsKICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBzKHQsIG4pIHsKICAgICAgaSh0KSwgcih0LCB6Uy50cmFuc2Zvcm1BcHBseSgpLCB7CiAgICAgICAgdHJhbnNmb3JtOiBuLAogICAgICAgIHN3YXA6IGUodCkKICAgICAgfSksIHUodCk7CiAgICB9CgogICAgZnVuY3Rpb24gcCgpIHsKICAgICAgcmV0dXJuIHQoIkJhY2siLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiByKHQsIHpTLmJhY2soKSwgewogICAgICAgICAgc3dhcDogZSh0KQogICAgICAgIH0pOwogICAgICB9LCAhMSwgITEpOwogICAgfQoKICAgIGZ1bmN0aW9uIG8oKSB7CiAgICAgIHJldHVybiBQbSh7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtc3BhY2VyIl0KICAgICAgICB9LAogICAgICAgIGJlaGF2aW91cnM6IHRjKFtkZC5jb25maWcoe30pXSkKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gaCgpIHsKICAgICAgcmV0dXJuIHQoIkFwcGx5IiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gcih0LCB6Uy5hcHBseSgpLCB7CiAgICAgICAgICBzd2FwOiBlKHQpCiAgICAgICAgfSk7CiAgICAgIH0sICEwLCAhMCk7CiAgICB9CgogICAgZnVuY3Rpb24gdihuLCBlKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBuKHQsIGUpOwogICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGEodCwgbikgewogICAgICB2YXIgZSwKICAgICAgICAgIG8gPSBuOwogICAgICBpKGUgPSB0KSwgcihlLCB6Uy50ZW1wVHJhbnNmb3JtKCksIHsKICAgICAgICB0cmFuc2Zvcm06IG8KICAgICAgfSksIHUoZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYih0LCBuLCBlLCBvLCByKSB7CiAgICAgIHZhciBpID0gWXcucGFydHMubGFiZWwoewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAibGFiZWwiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtbGFiZWwiXSwKICAgICAgICAgIGlubmVySHRtbDogYy50cmFuc2xhdGUodCkKICAgICAgICB9CiAgICAgIH0pLAogICAgICAgICAgdSA9IFl3LnBhcnRzLnNwZWN0cnVtKHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1zbGlkZXJfX3JhaWwiXSwKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgcm9sZTogInByZXNlbnRhdGlvbiIKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pLAogICAgICAgICAgYSA9IFl3LnBhcnRzLnRodW1iKHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1zbGlkZXJfX2hhbmRsZSJdLAogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICByb2xlOiAicHJlc2VudGF0aW9uIgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBQbShZdy5za2V0Y2goewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LXNsaWRlciJdLAogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICByb2xlOiAicHJlc2VudGF0aW9uIgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbW9kZWw6IHsKICAgICAgICAgIG1vZGU6ICJ4IiwKICAgICAgICAgIG1pblg6IGUsCiAgICAgICAgICBtYXhYOiByLAogICAgICAgICAgZ2V0SW5pdGlhbFZhbHVlOiBydCh7CiAgICAgICAgICAgIHg6IG8KICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiBbaSwgdSwgYV0sCiAgICAgICAgc2xpZGVyQmVoYXZpb3VyczogdGMoW1ZnLmNvbmZpZyh7fSldKSwKICAgICAgICBvbkNob29zZTogbgogICAgICB9KSk7CiAgICB9CgogICAgZnVuY3Rpb24gbCh0LCBuLCBlLCBvLCByKSB7CiAgICAgIHZhciBpLAogICAgICAgICAgdSwKICAgICAgICAgIGEsCiAgICAgICAgICBjLAogICAgICAgICAgcywKICAgICAgICAgIGwsCiAgICAgICAgICBmID0gKGkgPSB0LCB1ID0gbiwgYSA9IGUsIGMgPSBvLCBzID0gciwgW3AoKSwgKGwgPSB1LCBiKGksIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgICAgZyh0LCB2KGwsIGUueCAvIDEwMCkpOwogICAgICB9LCBhLCBjLCBzKSksIGgoKV0pOwogICAgICByZXR1cm4gdXkuc2tldGNoKHsKICAgICAgICBkb206IHcsCiAgICAgICAgY29tcG9uZW50czogZi5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LmFzU3BlYygpOwogICAgICAgIH0pLAogICAgICAgIGNvbnRhaW5lckJlaGF2aW91cnM6IHRjKFtmbSgiaW1hZ2UtdG9vbHMtZmlsdGVyLXBhbmVsLWJ1dHRvbnMtZXZlbnRzIiwgW0NyKFVTLmRpc2FibGUoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIGQoZiwgdCk7CiAgICAgICAgfSksIENyKFVTLmVuYWJsZSgpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgbShmLCB0KTsKICAgICAgICB9KV0pXSkKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24geSh0KSB7CiAgICAgIHJldHVybiBiKHQsIGZ1bmN0aW9uIChsLCB0LCBuKSB7CiAgICAgICAgdmFyIGUgPSB6LmdldE9wdChsKSwKICAgICAgICAgICAgbyA9IEwuZ2V0T3B0KGwpLAogICAgICAgICAgICByID0gTi5nZXRPcHQobCk7CiAgICAgICAgZS5lYWNoKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgICBvLmVhY2goZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgci5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgdmFyIG8sCiAgICAgICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgICAgIG4gPSBUZi5nZXRWYWx1ZShzKS54IC8gMTAwLAogICAgICAgICAgICAgICAgICBlID0gVGYuZ2V0VmFsdWUodCkueCAvIDEwMCwKICAgICAgICAgICAgICAgICAgdSA9IFRmLmdldFZhbHVlKGMpLnggLyAxMDAsCiAgICAgICAgICAgICAgICAgIGEgPSAobyA9IG4sIHIgPSBlLCBpID0gdSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMCh0LCAobiA9IHIsIGUgPSBpLCBTMCh3MCgpLCBbeDAobywgMCwgMiksIDAsIDAsIDAsIDAsIDAsIHgwKG4sIDAsIDIpLCAwLCAwLCAwLCAwLCAwLCB4MChlLCAwLCAyKSwgMCwgMCwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMCwgMV0pKSk7CiAgICAgICAgICAgICAgICB2YXIgbiwgZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBnKGwsIGEpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9LCAwLCAxMDAsIDIwMCk7CiAgICB9CgogICAgZnVuY3Rpb24geChuLCBlLCBvKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICAgIHIodCwgelMuc3dhcCgpLCB7CiAgICAgICAgICB0cmFuc2Zvcm06IGUsCiAgICAgICAgICBzd2FwOiBmdW5jdGlvbiBzd2FwKCkgewogICAgICAgICAgICBxLmdldE9wdCh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgRmcuc2V0KHQsIFtuXSksIG8odCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9OwogICAgfQoKICAgIHZhciB3ID0gewogICAgICB0YWc6ICJkaXYiLAogICAgICBjbGFzc2VzOiBbInRveC1pbWFnZS10b29sc19fdG9vbGJhciIsICJ0b3gtaW1hZ2UtdG9vbHMtZWRpdC1wYW5lbCJdCiAgICB9LAogICAgICAgIFMgPSBzdCwKICAgICAgICBDID0gW3AoKSwgbygpLCB0KCJBcHBseSIsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHModCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbiwKICAgICAgICAgICAgZSwKICAgICAgICAgICAgbywKICAgICAgICAgICAgciwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgdSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgYywKICAgICAgICAgICAgcywKICAgICAgICAgICAgbCA9IGYuZ2V0UmVjdCgpOwogICAgICAgIHJldHVybiBuID0gbC54LCBlID0gbC55LCBvID0gbC53LCByID0gbC5oLCB1ID0gbiwgYSA9IGUsIGMgPSBvLCBzID0gciwgKGkgPSB0KS50b0NhbnZhcygpLnRoZW4oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBEUyh0LCBpLmdldFR5cGUoKSwgdSwgYSwgYywgcyk7CiAgICAgICAgfSk7CiAgICAgIH0pLCBmLmhpZGVDcm9wKCk7CiAgICB9LCAhMSwgITApXSwKICAgICAgICBrID0gdXkuc2tldGNoKHsKICAgICAgZG9tOiB3LAogICAgICBjb21wb25lbnRzOiBDLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0LmFzU3BlYygpOwogICAgICB9KSwKICAgICAgY29udGFpbmVyQmVoYXZpb3VyczogdGMoW2ZtKCJpbWFnZS10b29scy1jcm9wLWJ1dHRvbnMtZXZlbnRzIiwgW0NyKFVTLmRpc2FibGUoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBkKEMsIHQpOwogICAgICB9KSwgQ3IoVVMuZW5hYmxlKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgbShDLCB0KTsKICAgICAgfSldKV0pCiAgICB9KSwKICAgICAgICBPID0gUG0oWjAoewogICAgICBuYW1lOiAic2l6ZSIsCiAgICAgIGxhYmVsOiB2dC5ub25lKCksCiAgICAgIGNvbnN0cmFpbjogITAsCiAgICAgIGRpc2FibGVkOiAhMQogICAgfSwgYykpLAogICAgICAgIF8gPSBbcCgpLCBvKCksIE8sIG8oKSwgdCgiQXBwbHkiLCBmdW5jdGlvbiAoYSkgewogICAgICBPLmdldE9wdChhKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIG4gPSBUZi5nZXRWYWx1ZSh0KSwKICAgICAgICAgICAgZSA9IHBhcnNlSW50KG4ud2lkdGgsIDEwKSwKICAgICAgICAgICAgbyA9IHBhcnNlSW50KG4uaGVpZ2h0LCAxMCksCiAgICAgICAgICAgIHUgPSAociA9IGUsIGkgPSBvLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGUgPSByLCBvID0gaSwgKG4gPSB0KS50b0NhbnZhcygpLnRoZW4oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIE9TKHQsIGUsIG8pLnRoZW4oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gYjAodCwgbi5nZXRUeXBlKCkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG4sIGUsIG87CiAgICAgICAgfSk7CiAgICAgICAgcyhhLCB1KTsKICAgICAgfSk7CiAgICB9LCAhMSwgITApXSwKICAgICAgICBUID0gdXkuc2tldGNoKHsKICAgICAgZG9tOiB3LAogICAgICBjb21wb25lbnRzOiBfLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0LmFzU3BlYygpOwogICAgICB9KSwKICAgICAgY29udGFpbmVyQmVoYXZpb3VyczogdGMoW2ZtKCJpbWFnZS10b29scy1yZXNpemUtYnV0dG9ucy1ldmVudHMiLCBbQ3IoVVMuZGlzYWJsZSgpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIGQoXywgdCk7CiAgICAgIH0pLCBDcihVUy5lbmFibGUoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBtKF8sIHQpOwogICAgICB9KV0pXSkKICAgIH0pLAogICAgICAgIEUgPSB2KE0wLCAiaCIpLAogICAgICAgIEQgPSB2KE0wLCAidiIpLAogICAgICAgIEIgPSB2KEEwLCAtOTApLAogICAgICAgIE0gPSB2KEEwLCA5MCksCiAgICAgICAgQSA9IFtwKCksIG8oKSwgbigiZmxpcC1ob3Jpem9udGFsbHkiLCAiRmxpcCBob3Jpem9udGFsbHkiLCBmdW5jdGlvbiAodCkgewogICAgICBhKHQsIEUpOwogICAgfSwgITEpLCBuKCJmbGlwLXZlcnRpY2FsbHkiLCAiRmxpcCB2ZXJ0aWNhbGx5IiwgZnVuY3Rpb24gKHQpIHsKICAgICAgYSh0LCBEKTsKICAgIH0sICExKSwgbigicm90YXRlLWxlZnQiLCAiUm90YXRlIGNvdW50ZXJjbG9ja3dpc2UiLCBmdW5jdGlvbiAodCkgewogICAgICBhKHQsIEIpOwogICAgfSwgITEpLCBuKCJyb3RhdGUtcmlnaHQiLCAiUm90YXRlIGNsb2Nrd2lzZSIsIGZ1bmN0aW9uICh0KSB7CiAgICAgIGEodCwgTSk7CiAgICB9LCAhMSksIG8oKSwgaCgpXSwKICAgICAgICBGID0gdXkuc2tldGNoKHsKICAgICAgZG9tOiB3LAogICAgICBjb21wb25lbnRzOiBBLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0LmFzU3BlYygpOwogICAgICB9KSwKICAgICAgY29udGFpbmVyQmVoYXZpb3VyczogdGMoW2ZtKCJpbWFnZS10b29scy1mbGlwcm90YXRlLWJ1dHRvbnMtZXZlbnRzIiwgW0NyKFVTLmRpc2FibGUoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBkKEEsIHQpOwogICAgICB9KSwgQ3IoVVMuZW5hYmxlKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgbShBLCB0KTsKICAgICAgfSldKV0pCiAgICB9KSwKICAgICAgICBJID0gW3AoKSwgbygpLCBoKCldLAogICAgICAgIFIgPSB1eS5za2V0Y2goewogICAgICBkb206IHcsCiAgICAgIGNvbXBvbmVudHM6IEkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHQuYXNTcGVjKCk7CiAgICAgIH0pCiAgICB9KSwKICAgICAgICBWID0gbCgiQnJpZ2h0bmVzcyIsIEQwLCAtMTAwLCAwLCAxMDApLAogICAgICAgIFAgPSBsKCJDb250cmFzdCIsIEIwLCAtMTAwLCAwLCAxMDApLAogICAgICAgIEggPSBsKCJHYW1tYSIsIEUwLCAtMTAwLCAwLCAxMDApLAogICAgICAgIHogPSB5KCJSIiksCiAgICAgICAgTiA9IHkoIkciKSwKICAgICAgICBMID0geSgiQiIpLAogICAgICAgIFcgPSBbcCgpLCB6LCBOLCBMLCBoKCldLAogICAgICAgIFUgPSB1eS5za2V0Y2goewogICAgICBkb206IHcsCiAgICAgIGNvbXBvbmVudHM6IFcubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHQuYXNTcGVjKCk7CiAgICAgIH0pCiAgICB9KSwKICAgICAgICBqID0gdnQuc29tZShUMCksCiAgICAgICAgRyA9IHZ0LnNvbWUoXzApLAogICAgICAgIFggPSBbbigiY3JvcCIsICJDcm9wIiwgeChrLCB2dC5ub25lKCksIGZ1bmN0aW9uICh0KSB7CiAgICAgIGYuc2hvd0Nyb3AoKTsKICAgIH0pLCAhMSksIG4oInJlc2l6ZSIsICJSZXNpemUiLCB4KFQsIHZ0Lm5vbmUoKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgTy5nZXRPcHQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBuID0gZi5nZXRNZWFzdXJlbWVudHMoKSwKICAgICAgICAgICAgZSA9IG4ud2lkdGgsCiAgICAgICAgICAgIG8gPSBuLmhlaWdodDsKICAgICAgICBUZi5zZXRWYWx1ZSh0LCB7CiAgICAgICAgICB3aWR0aDogZSwKICAgICAgICAgIGhlaWdodDogbwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pLCAhMSksIG4oIm9yaWVudGF0aW9uIiwgIk9yaWVudGF0aW9uIiwgeChGLCB2dC5ub25lKCksIFMpLCAhMSksIG4oImJyaWdodG5lc3MiLCAiQnJpZ2h0bmVzcyIsIHgoViwgdnQubm9uZSgpLCBTKSwgITEpLCBuKCJzaGFycGVuIiwgIlNoYXJwZW4iLCB4KFIsIGosIFMpLCAhMSksIG4oImNvbnRyYXN0IiwgIkNvbnRyYXN0IiwgeChQLCB2dC5ub25lKCksIFMpLCAhMSksIG4oImNvbG9yLWxldmVscyIsICJDb2xvciBsZXZlbHMiLCB4KFUsIHZ0Lm5vbmUoKSwgUyksICExKSwgbigiZ2FtbWEiLCAiR2FtbWEiLCB4KEgsIHZ0Lm5vbmUoKSwgUyksICExKSwgbigiaW52ZXJ0IiwgIkludmVydCIsIHgoUiwgRywgUyksICExKV0sCiAgICAgICAgWSA9IHV5LnNrZXRjaCh7CiAgICAgIGRvbTogdywKICAgICAgY29tcG9uZW50czogWC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdC5hc1NwZWMoKTsKICAgICAgfSkKICAgIH0pLAogICAgICAgIHEgPSBQbSh1eS5za2V0Y2goewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiCiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IFtZXSwKICAgICAgY29udGFpbmVyQmVoYXZpb3VyczogdGMoW0ZnLmNvbmZpZyh7fSldKQogICAgfSkpOwogICAgcmV0dXJuIHsKICAgICAgbWVtQ29udGFpbmVyOiBxLAogICAgICBnZXRBcHBseUJ1dHRvbjogZnVuY3Rpb24gZ2V0QXBwbHlCdXR0b24odCkgewogICAgICAgIHJldHVybiBxLmdldE9wdCh0KS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gdC5jb21wb25lbnRzKClbMF07CiAgICAgICAgICByZXR1cm4gbi5jb21wb25lbnRzKClbbi5jb21wb25lbnRzKCkubGVuZ3RoIC0gMV07CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBudyh0KSB7CiAgICB2YXIgbiwgZTsKICAgIGlmICh0LmNoYW5nZWRUb3VjaGVzKSBmb3IgKG4gPSAic2NyZWVuWCBzY3JlZW5ZIHBhZ2VYIHBhZ2VZIGNsaWVudFggY2xpZW50WSIuc3BsaXQoIiAiKSwgZSA9IDA7IGUgPCBuLmxlbmd0aDsgZSsrKSB7CiAgICAgIHRbbltlXV0gPSB0LmNoYW5nZWRUb3VjaGVzWzBdW25bZV1dOwogICAgfQogIH0KCiAgKFJ5ID0gSXkgPSBJeSB8fCB7fSlbUnkuSGlnaGxpZ2h0Rmlyc3QgPSAwXSA9ICJIaWdobGlnaHRGaXJzdCIsIFJ5W1J5LkhpZ2hsaWdodE5vbmUgPSAxXSA9ICJIaWdobGlnaHROb25lIjsKCiAgZnVuY3Rpb24gZXcobywgdCkgewogICAgcmV0dXJuIHsKICAgICAgdWlkOiBvLnVpZCwKICAgICAgZG9tOiBvLmRvbSwKICAgICAgY29tcG9uZW50czogdCwKICAgICAgYmVoYXZpb3VyczogWnMoby5mb3JtQmVoYXZpb3VycywgW1RmLmNvbmZpZyh7CiAgICAgICAgc3RvcmU6IHsKICAgICAgICAgIG1vZGU6ICJtYW51YWwiLAogICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKHQpIHsKICAgICAgICAgICAgcmV0dXJuIGR0KGdsKHQsIG8pLCBmdW5jdGlvbiAodCwgbykgewogICAgICAgICAgICAgIHJldHVybiB0KCkuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgdmFyIG4gPSB1ZC5nZXRDdXJyZW50KHQpLAogICAgICAgICAgICAgICAgICAgIGUgPSBuZXcgRXJyb3IoIkNhbm5vdCBmaW5kIGEgY3VycmVudCBjb21wb25lbnQgdG8gZXh0cmFjdCB0aGUgdmFsdWUgZnJvbSBmb3IgZm9ybSBwYXJ0ICciICsgbyArICInOiAiICsgQXIodC5lbGVtZW50KSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbi5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlLmVycm9yKGUpOwogICAgICAgICAgICAgICAgfSwgUmUudmFsdWUpOwogICAgICAgICAgICAgIH0pLm1hcChUZi5nZXRWYWx1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZShlLCB0KSB7CiAgICAgICAgICAgIEoodCwgZnVuY3Rpb24gKG4sIHQpIHsKICAgICAgICAgICAgICBmbChlLCBvLCB0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICB1ZC5nZXRDdXJyZW50KHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgVGYuc2V0VmFsdWUodCwgbik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KV0pLAogICAgICBhcGlzOiB7CiAgICAgICAgZ2V0RmllbGQ6IGZ1bmN0aW9uIGdldEZpZWxkKHQsIG4pIHsKICAgICAgICAgIHJldHVybiBmbCh0LCBvLCBuKS5iaW5kKHVkLmdldEN1cnJlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIG93KCkgewogICAgcmV0dXJuIHVkLmNvbmZpZyh7CiAgICAgIGZpbmQ6IHZ0LnNvbWUKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gcncodCkgewogICAgcmV0dXJuIG4gPSBCciwgZSA9IE1yLCBpMCh0LCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gbih0LmVsZW1lbnQpOwogICAgfSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIGUodC5lbGVtZW50LCBuKTsKICAgIH0pOwogICAgdmFyIG4sIGU7CiAgfQoKICB2YXIgaXcsCiAgICAgIHV3LAogICAgICBhdywKICAgICAgY3csCiAgICAgIHN3ID0gZnVuY3Rpb24gc3cobiwgdCkgewogICAgcmV0dXJuIG4uZ2V0U3lzdGVtKCkuZ2V0QnlVaWQodC51aWQgKyAiLSIgKyBxeSgpKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gUmUudmFsdWUodCk7CiAgICAgIH07CiAgICB9KS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHQubGF6eVNpbmsuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBSZS5lcnJvcihuZXcgRXJyb3IoIk5vIGludGVybmFsIHNpbmsgaXMgc3BlY2lmaWVkLCBub3IgY291bGQgYW4gZXh0ZXJuYWwgc2luayBiZSBmb3VuZCIpKTsKICAgICAgICB9OwogICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdChuKTsKICAgICAgICB9OwogICAgICB9KTsKICAgIH0pOwogIH0sCiAgICAgIGx3ID0gcnQoW2ZvKCJkb20iKSwgZm8oImZldGNoIiksIEt1KCJvbk9wZW4iKSwgSnUoIm9uRXhlY3V0ZSIpLCBUbygiZ2V0SG90c3BvdCIsIHZ0LnNvbWUpLCBUbygiZ2V0QW5jaG9yT3ZlcnJpZGVzIiwgcnQoe30pKSwgTmMoKSwgJHMoImRyb3Bkb3duQmVoYXZpb3VycyIsIFt6ZywgWXksIE1nLCBWZ10pLCBmbygidG9nZ2xlQ2xhc3MiKSwgVG8oImV2ZW50T3JkZXIiLCB7fSksIHhvKCJsYXp5U2luayIpLCBUbygibWF0Y2hXaWR0aCIsICExKSwgVG8oInVzZU1pbldpZHRoIiwgITEpLCB4bygicm9sZSIpXS5jb25jYXQoZXgoKSkpLAogICAgICBmdyA9IHJ0KFtLZih7CiAgICBzY2hlbWE6IFtYdSgpXSwKICAgIG5hbWU6ICJtZW51IiwKICAgIGRlZmF1bHRzOiBmdW5jdGlvbiBkZWZhdWx0cyh0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgb25FeGVjdXRlOiB0Lm9uRXhlY3V0ZQogICAgICB9OwogICAgfQogIH0pLCBLeSgpXSksCiAgICAgIGR3ID0gU2woewogICAgbmFtZTogIkRyb3Bkb3duIiwKICAgIGNvbmZpZ0ZpZWxkczogbHcoKSwKICAgIHBhcnRGaWVsZHM6IGZ3KCksCiAgICBmYWN0b3J5OiBmdW5jdGlvbiBmYWN0b3J5KG4sIHQsIGUsIG8pIHsKICAgICAgZnVuY3Rpb24gcih0KSB7CiAgICAgICAgaGYuZ2V0U3RhdGUodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgb3AuaGlnaGxpZ2h0UHJpbWFyeSh0KTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaSh0LCBuKSB7CiAgICAgICAgcmV0dXJuIGJyKHQpLCB2dC5zb21lKCEwKTsKICAgICAgfQoKICAgICAgdmFyIHUsCiAgICAgICAgICBhID0gewogICAgICAgIGV4cGFuZDogZnVuY3Rpb24gZXhwYW5kKHQpIHsKICAgICAgICAgIHpnLmlzT24odCkgfHwgUXkobiwgaCwgdCwgbywgc3QsIEl5LkhpZ2hsaWdodE5vbmUpLmdldChzdCk7CiAgICAgICAgfSwKICAgICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKHQpIHsKICAgICAgICAgIHpnLmlzT24odCkgfHwgUXkobiwgaCwgdCwgbywgc3QsIEl5LkhpZ2hsaWdodEZpcnN0KS5nZXQoc3QpOwogICAgICAgIH0sCiAgICAgICAgaXNPcGVuOiB6Zy5pc09uLAogICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSh0KSB7CiAgICAgICAgICB6Zy5pc09uKHQpICYmIFF5KG4sIGgsIHQsIG8sIHN0LCBJeS5IaWdobGlnaHRGaXJzdCkuZ2V0KHN0KTsKICAgICAgICB9LAogICAgICAgIHJlcG9zaXRpb25NZW51czogZnVuY3Rpb24gcmVwb3NpdGlvbk1lbnVzKHQpIHsKICAgICAgICAgIHpnLmlzT24odCkgJiYgbngodCk7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gewogICAgICAgIHVpZDogbi51aWQsCiAgICAgICAgZG9tOiBuLmRvbSwKICAgICAgICBjb21wb25lbnRzOiB0LAogICAgICAgIGJlaGF2aW91cnM6IFpzKG4uZHJvcGRvd25CZWhhdmlvdXJzLCBbemcuY29uZmlnKHsKICAgICAgICAgIHRvZ2dsZUNsYXNzOiBuLnRvZ2dsZUNsYXNzLAogICAgICAgICAgYXJpYTogewogICAgICAgICAgICBtb2RlOiAiZXhwYW5kZWQiCiAgICAgICAgICB9CiAgICAgICAgfSksIFl5LmNvbmZpZyh7CiAgICAgICAgICBvdGhlcnM6IHsKICAgICAgICAgICAgc2FuZGJveDogZnVuY3Rpb24gc2FuZGJveCh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHR4KG4sIHQsIHsKICAgICAgICAgICAgICAgIG9uT3BlbjogZnVuY3Rpb24gb25PcGVuKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gemcub24odCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24gb25DbG9zZSgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHpnLm9mZih0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pLCBNZy5jb25maWcoewogICAgICAgICAgbW9kZTogInNwZWNpYWwiLAogICAgICAgICAgb25TcGFjZTogaSwKICAgICAgICAgIG9uRW50ZXI6IGksCiAgICAgICAgICBvbkRvd246IGZ1bmN0aW9uIG9uRG93bih0LCBuKSB7CiAgICAgICAgICAgIHJldHVybiBkdy5pc09wZW4odCkgPyByKFl5LmdldENvdXBsZWQodCwgInNhbmRib3giKSkgOiBkdy5vcGVuKHQpLCB2dC5zb21lKCEwKTsKICAgICAgICAgIH0sCiAgICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gb25Fc2NhcGUodCwgbikgewogICAgICAgICAgICByZXR1cm4gZHcuaXNPcGVuKHQpID8gKGR3LmNsb3NlKHQpLCB2dC5zb21lKCEwKSkgOiB2dC5ub25lKCk7CiAgICAgICAgICB9CiAgICAgICAgfSksIFZnLmNvbmZpZyh7fSldKSwKICAgICAgICBldmVudHM6IHhtKHZ0LnNvbWUoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIFF5KG4sIGgsIHQsIG8sIHIsIEl5LkhpZ2hsaWdodEZpcnN0KS5nZXQoc3QpOwogICAgICAgIH0pKSwKICAgICAgICBldmVudE9yZGVyOiBfbHQoX2x0KHt9LCBuLmV2ZW50T3JkZXIpLCAoKHUgPSB7fSlbRmkoKV0gPSBbImRpc2FibGluZyIsICJ0b2dnbGluZyIsICJhbGxveS5iYXNlLmJlaGF2aW91ciJdLCB1KSksCiAgICAgICAgYXBpczogYSwKICAgICAgICBkb21Nb2RpZmljYXRpb246IHsKICAgICAgICAgIGF0dHJpYnV0ZXM6IF9sdChfbHQoewogICAgICAgICAgICAiYXJpYS1oYXNwb3B1cCI6ICJ0cnVlIgogICAgICAgICAgfSwgbi5yb2xlLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHJvbGU6IHQKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pKSwgImJ1dHRvbiIgPT09IG4uZG9tLnRhZyA/IHsKICAgICAgICAgICAgdHlwZTogdHQobi5kb20sICJhdHRyaWJ1dGVzIikuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiB0dCh0LCAidHlwZSIpOwogICAgICAgICAgICB9KS5nZXRPcigiYnV0dG9uIikKICAgICAgICAgIH0gOiB7fSkKICAgICAgICB9CiAgICAgIH07CiAgICB9LAogICAgYXBpczogewogICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5vcGVuKG4pOwogICAgICB9LAogICAgICBleHBhbmQ6IGZ1bmN0aW9uIGV4cGFuZCh0LCBuKSB7CiAgICAgICAgcmV0dXJuIHQuZXhwYW5kKG4pOwogICAgICB9LAogICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UodCwgbikgewogICAgICAgIHJldHVybiB0LmNsb3NlKG4pOwogICAgICB9LAogICAgICBpc09wZW46IGZ1bmN0aW9uIGlzT3Blbih0LCBuKSB7CiAgICAgICAgcmV0dXJuIHQuaXNPcGVuKG4pOwogICAgICB9LAogICAgICByZXBvc2l0aW9uTWVudXM6IGZ1bmN0aW9uIHJlcG9zaXRpb25NZW51cyh0LCBuKSB7CiAgICAgICAgcmV0dXJuIHQucmVwb3NpdGlvbk1lbnVzKG4pOwogICAgICB9CiAgICB9CiAgfSksCiAgICAgIG13ID0geWEoewogICAgZmllbGRzOiBbXSwKICAgIG5hbWU6ICJ1bnNlbGVjdGluZyIsCiAgICBhY3RpdmU6IE9iamVjdC5mcmVlemUoewogICAgICBfX3Byb3RvX186IG51bGwsCiAgICAgIGV2ZW50czogZnVuY3Rpb24gZXZlbnRzKCkgewogICAgICAgIHJldHVybiBudShbd3IoVGkoKSwgXyldKTsKICAgICAgfSwKICAgICAgZXhoaWJpdDogZnVuY3Rpb24gZXhoaWJpdCgpIHsKICAgICAgICByZXR1cm4gTnIoewogICAgICAgICAgc3R5bGVzOiB7CiAgICAgICAgICAgICItd2Via2l0LXVzZXItc2VsZWN0IjogIm5vbmUiLAogICAgICAgICAgICAidXNlci1zZWxlY3QiOiAibm9uZSIsCiAgICAgICAgICAgICItbXMtdXNlci1zZWxlY3QiOiAibm9uZSIsCiAgICAgICAgICAgICItbW96LXVzZXItc2VsZWN0IjogIi1tb3otbm9uZSIKICAgICAgICAgIH0sCiAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgIHVuc2VsZWN0YWJsZTogIm9uIgogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9KQogIH0pLAogICAgICBndyA9IEZyKCJjb2xvci1pbnB1dC1jaGFuZ2UiKSwKICAgICAgcHcgPSBGcigiY29sb3Itc3dhdGNoLWNoYW5nZSIpLAogICAgICBodyA9IEZyKCJjb2xvci1waWNrZXItY2FuY2VsIiksCiAgICAgIHZ3ID0gSmYoewogICAgc2NoZW1hOiBbZm8oImRvbSIpXSwKICAgIG5hbWU6ICJsYWJlbCIKICB9KSwKICAgICAgYncgPSBveCgidG9wLWxlZnQiKSwKICAgICAgeXcgPSBveCgidG9wIiksCiAgICAgIHh3ID0gb3goInRvcC1yaWdodCIpLAogICAgICB3dyA9IG94KCJyaWdodCIpLAogICAgICBTdyA9IG94KCJib3R0b20tcmlnaHQiKSwKICAgICAgQ3cgPSBveCgiYm90dG9tIiksCiAgICAgIGt3ID0gb3goImJvdHRvbS1sZWZ0IiksCiAgICAgIE93ID0gW3Z3LCBveCgibGVmdCIpLCB3dywgeXcsIEN3LCBidywgeHcsIGt3LCBTdywgcWYoewogICAgbmFtZTogInRodW1iIiwKICAgIGRlZmF1bHRzOiBydCh7CiAgICAgIGRvbTogewogICAgICAgIHN0eWxlczogewogICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIKICAgICAgICB9CiAgICAgIH0KICAgIH0pLAogICAgb3ZlcnJpZGVzOiBmdW5jdGlvbiBvdmVycmlkZXModCkgewogICAgICByZXR1cm4gewogICAgICAgIGV2ZW50czogbnUoW19yKGNpKCksIHQsICJzcGVjdHJ1bSIpLCBfcihzaSgpLCB0LCAic3BlY3RydW0iKSwgX3IobGkoKSwgdCwgInNwZWN0cnVtIiksIF9yKGRpKCksIHQsICJzcGVjdHJ1bSIpLCBfcihtaSgpLCB0LCAic3BlY3RydW0iKSwgX3IocGkoKSwgdCwgInNwZWN0cnVtIildKQogICAgICB9OwogICAgfQogIH0pLCBxZih7CiAgICBzY2hlbWE6IFthcigibW91c2VJc0Rvd24iLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBWbyghMSk7CiAgICB9KV0sCiAgICBuYW1lOiAic3BlY3RydW0iLAogICAgb3ZlcnJpZGVzOiBmdW5jdGlvbiBvdmVycmlkZXMoZSkgewogICAgICBmdW5jdGlvbiBvKG4sIHQpIHsKICAgICAgICByZXR1cm4gci5nZXRWYWx1ZUZyb21FdmVudCh0KS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiByLnNldFZhbHVlRnJvbShuLCBlLCB0KTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIHIgPSBlLm1vZGVsLm1hbmFnZXI7CiAgICAgIHJldHVybiB7CiAgICAgICAgYmVoYXZpb3VyczogdGMoW01nLmNvbmZpZyh7CiAgICAgICAgICBtb2RlOiAic3BlY2lhbCIsCiAgICAgICAgICBvbkxlZnQ6IGZ1bmN0aW9uIG9uTGVmdCh0KSB7CiAgICAgICAgICAgIHJldHVybiByLm9uTGVmdCh0LCBlKTsKICAgICAgICAgIH0sCiAgICAgICAgICBvblJpZ2h0OiBmdW5jdGlvbiBvblJpZ2h0KHQpIHsKICAgICAgICAgICAgcmV0dXJuIHIub25SaWdodCh0LCBlKTsKICAgICAgICAgIH0sCiAgICAgICAgICBvblVwOiBmdW5jdGlvbiBvblVwKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHIub25VcCh0LCBlKTsKICAgICAgICAgIH0sCiAgICAgICAgICBvbkRvd246IGZ1bmN0aW9uIG9uRG93bih0KSB7CiAgICAgICAgICAgIHJldHVybiByLm9uRG93bih0LCBlKTsKICAgICAgICAgIH0KICAgICAgICB9KSwgVmcuY29uZmlnKHt9KV0pLAogICAgICAgIGV2ZW50czogbnUoW0NyKGNpKCksIG8pLCBDcihzaSgpLCBvKSwgQ3IoZGkoKSwgbyksIENyKG1pKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICBlLm1vdXNlSXNEb3duLmdldCgpICYmIG8odCwgbik7CiAgICAgICAgfSldKQogICAgICB9OwogICAgfQogIH0pXSwKICAgICAgX3cgPSBydCgic2xpZGVyLmNoYW5nZS52YWx1ZSIpLAogICAgICBUdyA9ICJsZWZ0IiwKICAgICAgRXcgPSBYeCgtMSksCiAgICAgIER3ID0gWHgoMSksCiAgICAgIEJ3ID0gdnQubm9uZSwKICAgICAgTXcgPSB2dC5ub25lLAogICAgICBBdyA9IHsKICAgICJ0b3AtbGVmdCI6IHZ0Lm5vbmUoKSwKICAgIHRvcDogdnQubm9uZSgpLAogICAgInRvcC1yaWdodCI6IHZ0Lm5vbmUoKSwKICAgIHJpZ2h0OiB2dC5zb21lKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIER4KHQsIHsKICAgICAgICB4OiBmeChuKQogICAgICB9KTsKICAgIH0pLAogICAgImJvdHRvbS1yaWdodCI6IHZ0Lm5vbmUoKSwKICAgIGJvdHRvbTogdnQubm9uZSgpLAogICAgImJvdHRvbS1sZWZ0IjogdnQubm9uZSgpLAogICAgbGVmdDogdnQuc29tZShmdW5jdGlvbiAodCwgbikgewogICAgICBEeCh0LCB7CiAgICAgICAgeDogYXgobikKICAgICAgfSk7CiAgICB9KQogIH0sCiAgICAgIEZ3ID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBzZXRWYWx1ZUZyb206IGZ1bmN0aW9uIHNldFZhbHVlRnJvbSh0LCBuLCBlKSB7CiAgICAgIHZhciBvID0gR3godCwgbiwgZSk7CiAgICAgIHJldHVybiBqeCh0LCB7CiAgICAgICAgeDogbwogICAgICB9KSwgbzsKICAgIH0sCiAgICBzZXRUb01pbjogZnVuY3Rpb24gc2V0VG9NaW4odCwgbikgewogICAgICBqeCh0LCB7CiAgICAgICAgeDogaXgobikKICAgICAgfSk7CiAgICB9LAogICAgc2V0VG9NYXg6IGZ1bmN0aW9uIHNldFRvTWF4KHQsIG4pIHsKICAgICAgangodCwgewogICAgICAgIHg6IHN4KG4pCiAgICAgIH0pOwogICAgfSwKICAgIGZpbmRWYWx1ZU9mT2Zmc2V0OiBHeCwKICAgIGdldFZhbHVlRnJvbUV2ZW50OiBmdW5jdGlvbiBnZXRWYWx1ZUZyb21FdmVudCh0KSB7CiAgICAgIHJldHVybiByeCh0KS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdC5sZWZ0OwogICAgICB9KTsKICAgIH0sCiAgICBmaW5kUG9zaXRpb25PZlZhbHVlOiBZeCwKICAgIHNldFBvc2l0aW9uRnJvbVZhbHVlOiBmdW5jdGlvbiBzZXRQb3NpdGlvbkZyb21WYWx1ZSh0LCBuLCBlLCBvKSB7CiAgICAgIHZhciByID0gVHgoZSksCiAgICAgICAgICBpID0gWXgodCwgby5nZXRTcGVjdHJ1bSh0KSwgci54LCBvLmdldExlZnRFZGdlKHQpLCBvLmdldFJpZ2h0RWRnZSh0KSwgZSksCiAgICAgICAgICB1ID0ga24obi5lbGVtZW50KSAvIDI7CiAgICAgIGZuKG4uZWxlbWVudCwgImxlZnQiLCBpIC0gdSArICJweCIpOwogICAgfSwKICAgIG9uTGVmdDogRXcsCiAgICBvblJpZ2h0OiBEdywKICAgIG9uVXA6IEJ3LAogICAgb25Eb3duOiBNdywKICAgIGVkZ2VBY3Rpb25zOiBBdwogIH0pLAogICAgICBJdyA9IHZ0Lm5vbmUsCiAgICAgIFJ3ID0gdnQubm9uZSwKICAgICAgVncgPSBKeCgtMSksCiAgICAgIFB3ID0gSngoMSksCiAgICAgIEh3ID0gewogICAgInRvcC1sZWZ0IjogdnQubm9uZSgpLAogICAgdG9wOiB2dC5zb21lKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIER4KHQsIHsKICAgICAgICB5OiBjeChuKQogICAgICB9KTsKICAgIH0pLAogICAgInRvcC1yaWdodCI6IHZ0Lm5vbmUoKSwKICAgIHJpZ2h0OiB2dC5ub25lKCksCiAgICAiYm90dG9tLXJpZ2h0IjogdnQubm9uZSgpLAogICAgYm90dG9tOiB2dC5zb21lKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIER4KHQsIHsKICAgICAgICB5OiBkeChuKQogICAgICB9KTsKICAgIH0pLAogICAgImJvdHRvbS1sZWZ0IjogdnQubm9uZSgpLAogICAgbGVmdDogdnQubm9uZSgpCiAgfSwKICAgICAgencgPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIHNldFZhbHVlRnJvbTogZnVuY3Rpb24gc2V0VmFsdWVGcm9tKHQsIG4sIGUpIHsKICAgICAgdmFyIG8gPSBLeCh0LCBuLCBlKTsKICAgICAgcmV0dXJuIHF4KHQsIHsKICAgICAgICB5OiBvCiAgICAgIH0pLCBvOwogICAgfSwKICAgIHNldFRvTWluOiBmdW5jdGlvbiBzZXRUb01pbih0LCBuKSB7CiAgICAgIHF4KHQsIHsKICAgICAgICB5OiB1eChuKQogICAgICB9KTsKICAgIH0sCiAgICBzZXRUb01heDogZnVuY3Rpb24gc2V0VG9NYXgodCwgbikgewogICAgICBxeCh0LCB7CiAgICAgICAgeTogbHgobikKICAgICAgfSk7CiAgICB9LAogICAgZmluZFZhbHVlT2ZPZmZzZXQ6IEt4LAogICAgZ2V0VmFsdWVGcm9tRXZlbnQ6IGZ1bmN0aW9uIGdldFZhbHVlRnJvbUV2ZW50KHQpIHsKICAgICAgcmV0dXJuIHJ4KHQpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0LnRvcDsKICAgICAgfSk7CiAgICB9LAogICAgZmluZFBvc2l0aW9uT2ZWYWx1ZTogJHgsCiAgICBzZXRQb3NpdGlvbkZyb21WYWx1ZTogZnVuY3Rpb24gc2V0UG9zaXRpb25Gcm9tVmFsdWUodCwgbiwgZSwgbykgewogICAgICB2YXIgciA9IFR4KGUpLAogICAgICAgICAgaSA9ICR4KHQsIG8uZ2V0U3BlY3RydW0odCksIHIueSwgby5nZXRUb3BFZGdlKHQpLCBvLmdldEJvdHRvbUVkZ2UodCksIGUpLAogICAgICAgICAgdSA9IHhuKG4uZWxlbWVudCkgLyAyOwogICAgICBmbihuLmVsZW1lbnQsICJ0b3AiLCBpIC0gdSArICJweCIpOwogICAgfSwKICAgIG9uTGVmdDogSXcsCiAgICBvblJpZ2h0OiBSdywKICAgIG9uVXA6IFZ3LAogICAgb25Eb3duOiBQdywKICAgIGVkZ2VBY3Rpb25zOiBIdwogIH0pLAogICAgICBOdyA9IHJ4LAogICAgICBMdyA9IHQwKC0xLCAhMSksCiAgICAgIFd3ID0gdDAoMSwgITEpLAogICAgICBVdyA9IHQwKC0xLCAhMCksCiAgICAgIGp3ID0gdDAoMSwgITApLAogICAgICBHdyA9IHsKICAgICJ0b3AtbGVmdCI6IHZ0LnNvbWUoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgRHgodCwgRXgoYXgobiksIGN4KG4pKSk7CiAgICB9KSwKICAgIHRvcDogdnQuc29tZShmdW5jdGlvbiAodCwgbikgewogICAgICBEeCh0LCBFeChoeChuKSwgY3gobikpKTsKICAgIH0pLAogICAgInRvcC1yaWdodCI6IHZ0LnNvbWUoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgRHgodCwgRXgoZngobiksIGN4KG4pKSk7CiAgICB9KSwKICAgIHJpZ2h0OiB2dC5zb21lKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIER4KHQsIEV4KGZ4KG4pLCB2eChuKSkpOwogICAgfSksCiAgICAiYm90dG9tLXJpZ2h0IjogdnQuc29tZShmdW5jdGlvbiAodCwgbikgewogICAgICBEeCh0LCBFeChmeChuKSwgZHgobikpKTsKICAgIH0pLAogICAgYm90dG9tOiB2dC5zb21lKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIER4KHQsIEV4KGh4KG4pLCBkeChuKSkpOwogICAgfSksCiAgICAiYm90dG9tLWxlZnQiOiB2dC5zb21lKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIER4KHQsIEV4KGF4KG4pLCBkeChuKSkpOwogICAgfSksCiAgICBsZWZ0OiB2dC5zb21lKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIER4KHQsIEV4KGF4KG4pLCB2eChuKSkpOwogICAgfSkKICB9LAogICAgICBYdyA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgc2V0VmFsdWVGcm9tOiBmdW5jdGlvbiBzZXRWYWx1ZUZyb20odCwgbiwgZSkgewogICAgICB2YXIgbyA9IFp4KEd4KHQsIG4sIGUubGVmdCksIEt4KHQsIG4sIGUudG9wKSk7CiAgICAgIHJldHVybiBReCh0LCBvKSwgbzsKICAgIH0sCiAgICBzZXRUb01pbjogZnVuY3Rpb24gc2V0VG9NaW4odCwgbikgewogICAgICBReCh0LCBaeChpeChuKSwgdXgobikpKTsKICAgIH0sCiAgICBzZXRUb01heDogZnVuY3Rpb24gc2V0VG9NYXgodCwgbikgewogICAgICBReCh0LCBaeChzeChuKSwgbHgobikpKTsKICAgIH0sCiAgICBnZXRWYWx1ZUZyb21FdmVudDogTncsCiAgICBzZXRQb3NpdGlvbkZyb21WYWx1ZTogZnVuY3Rpb24gc2V0UG9zaXRpb25Gcm9tVmFsdWUodCwgbiwgZSwgbykgewogICAgICB2YXIgciA9IFR4KGUpLAogICAgICAgICAgaSA9IFl4KHQsIG8uZ2V0U3BlY3RydW0odCksIHIueCwgby5nZXRMZWZ0RWRnZSh0KSwgby5nZXRSaWdodEVkZ2UodCksIGUpLAogICAgICAgICAgdSA9ICR4KHQsIG8uZ2V0U3BlY3RydW0odCksIHIueSwgby5nZXRUb3BFZGdlKHQpLCBvLmdldEJvdHRvbUVkZ2UodCksIGUpLAogICAgICAgICAgYSA9IGtuKG4uZWxlbWVudCkgLyAyLAogICAgICAgICAgYyA9IHhuKG4uZWxlbWVudCkgLyAyOwogICAgICBmbihuLmVsZW1lbnQsICJsZWZ0IiwgaSAtIGEgKyAicHgiKSwgZm4obi5lbGVtZW50LCAidG9wIiwgdSAtIGMgKyAicHgiKTsKICAgIH0sCiAgICBvbkxlZnQ6IEx3LAogICAgb25SaWdodDogV3csCiAgICBvblVwOiBVdywKICAgIG9uRG93bjogancsCiAgICBlZGdlQWN0aW9uczogR3cKICB9KSwKICAgICAgWXcgPSBTbCh7CiAgICBuYW1lOiAiU2xpZGVyIiwKICAgIGNvbmZpZ0ZpZWxkczogW1RvKCJzdGVwU2l6ZSIsIDEpLCBUbygib25DaGFuZ2UiLCBzdCksIFRvKCJvbkNob29zZSIsIHN0KSwgVG8oIm9uSW5pdCIsIHN0KSwgVG8oIm9uRHJhZ1N0YXJ0Iiwgc3QpLCBUbygib25EcmFnRW5kIiwgc3QpLCBUbygic25hcFRvR3JpZCIsICExKSwgVG8oInJvdW5kZWQiLCAhMCksIHhvKCJzbmFwU3RhcnQiKSwgbW8oIm1vZGVsIiwgc28oIm1vZGUiLCB7CiAgICAgIHg6IFtUbygibWluWCIsIDApLCBUbygibWF4WCIsIDEwMCksIGFyKCJ2YWx1ZSIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIFZvKHQubW9kZS5taW5YKTsKICAgICAgfSksIGZvKCJnZXRJbml0aWFsVmFsdWUiKSwgWnUoIm1hbmFnZXIiLCBGdyldLAogICAgICB5OiBbVG8oIm1pblkiLCAwKSwgVG8oIm1heFkiLCAxMDApLCBhcigidmFsdWUiLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBWbyh0Lm1vZGUubWluWSk7CiAgICAgIH0pLCBmbygiZ2V0SW5pdGlhbFZhbHVlIiksIFp1KCJtYW5hZ2VyIiwgencpXSwKICAgICAgeHk6IFtUbygibWluWCIsIDApLCBUbygibWF4WCIsIDEwMCksIFRvKCJtaW5ZIiwgMCksIFRvKCJtYXhZIiwgMTAwKSwgYXIoInZhbHVlIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gVm8oewogICAgICAgICAgeDogdC5tb2RlLm1pblgsCiAgICAgICAgICB5OiB0Lm1vZGUubWluWQogICAgICAgIH0pOwogICAgICB9KSwgZm8oImdldEluaXRpYWxWYWx1ZSIpLCBadSgibWFuYWdlciIsIFh3KV0KICAgIH0pKSwgJHMoInNsaWRlckJlaGF2aW91cnMiLCBbTWcsIFRmXSksIGFyKCJtb3VzZUlzRG93biIsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFZvKCExKTsKICAgIH0pXSwKICAgIHBhcnRGaWVsZHM6IE93LAogICAgZmFjdG9yeTogZnVuY3Rpb24gZmFjdG9yeShpLCB0LCBuLCBlKSB7CiAgICAgIGZ1bmN0aW9uIHUodCkgewogICAgICAgIHJldHVybiBkbCh0LCBpLCAidGh1bWIiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYSh0KSB7CiAgICAgICAgcmV0dXJuIGRsKHQsIGksICJzcGVjdHJ1bSIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgICByZXR1cm4gZmwodCwgaSwgImxlZnQtZWRnZSIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgICByZXR1cm4gZmwodCwgaSwgInJpZ2h0LWVkZ2UiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYyh0KSB7CiAgICAgICAgcmV0dXJuIGZsKHQsIGksICJ0b3AtZWRnZSIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzKHQpIHsKICAgICAgICByZXR1cm4gZmwodCwgaSwgImJvdHRvbS1lZGdlIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGwodCwgbikgewogICAgICAgIHYuc2V0UG9zaXRpb25Gcm9tVmFsdWUodCwgbiwgaSwgewogICAgICAgICAgZ2V0TGVmdEVkZ2U6IG8sCiAgICAgICAgICBnZXRSaWdodEVkZ2U6IHIsCiAgICAgICAgICBnZXRUb3BFZGdlOiBjLAogICAgICAgICAgZ2V0Qm90dG9tRWRnZTogcywKICAgICAgICAgIGdldFNwZWN0cnVtOiBhCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGYodCwgbikgewogICAgICAgIGgudmFsdWUuc2V0KG4pLCBsKHQsIHUodCkpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkKGUpIHsKICAgICAgICB2YXIgdCA9IGkubW91c2VJc0Rvd24uZ2V0KCk7CiAgICAgICAgaS5tb3VzZUlzRG93bi5zZXQoITEpLCB0ICYmIGZsKGUsIGksICJ0aHVtYiIpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gaC52YWx1ZS5nZXQoKTsKICAgICAgICAgIGkub25DaG9vc2UoZSwgdCwgbik7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG0odCwgbikgewogICAgICAgIG4uc3RvcCgpLCBpLm1vdXNlSXNEb3duLnNldCghMCksIGkub25EcmFnU3RhcnQodCwgdSh0KSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGcodCwgbikgewogICAgICAgIG4uc3RvcCgpLCBpLm9uRHJhZ0VuZCh0LCB1KHQpKSwgZCh0KTsKICAgICAgfQoKICAgICAgdmFyIHAsCiAgICAgICAgICBoID0gaS5tb2RlbCwKICAgICAgICAgIHYgPSBoLm1hbmFnZXI7CiAgICAgIHJldHVybiB7CiAgICAgICAgdWlkOiBpLnVpZCwKICAgICAgICBkb206IGkuZG9tLAogICAgICAgIGNvbXBvbmVudHM6IHQsCiAgICAgICAgYmVoYXZpb3VyczogWnMoaS5zbGlkZXJCZWhhdmlvdXJzLCBbTWcuY29uZmlnKHsKICAgICAgICAgIG1vZGU6ICJzcGVjaWFsIiwKICAgICAgICAgIGZvY3VzSW46IGZ1bmN0aW9uIGZvY3VzSW4odCkgewogICAgICAgICAgICByZXR1cm4gZmwodCwgaSwgInNwZWN0cnVtIikubWFwKE1nLmZvY3VzSW4pLm1hcChfKTsKICAgICAgICAgIH0KICAgICAgICB9KSwgVGYuY29uZmlnKHsKICAgICAgICAgIHN0b3JlOiB7CiAgICAgICAgICAgIG1vZGU6ICJtYW51YWwiLAogICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUodCkgewogICAgICAgICAgICAgIHJldHVybiBoLnZhbHVlLmdldCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSksIHJjLmNvbmZpZyh7CiAgICAgICAgICBjaGFubmVsczogKChwID0ge30pW3lmKCldID0gewogICAgICAgICAgICBvblJlY2VpdmU6IGQKICAgICAgICAgIH0sIHApCiAgICAgICAgfSldKSwKICAgICAgICBldmVudHM6IG51KFtDcihfdygpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgIWZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgIGYodCwgbik7CiAgICAgICAgICAgIHZhciBlID0gdSh0KTsKICAgICAgICAgICAgaS5vbkNoYW5nZSh0LCBlLCBuKSwgdnQuc29tZSghMCk7CiAgICAgICAgICB9KHQsIG4uZXZlbnQudmFsdWUpOwogICAgICAgIH0pLCBldShmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgdmFyIGUgPSBoLmdldEluaXRpYWxWYWx1ZSgpOwogICAgICAgICAgaC52YWx1ZS5zZXQoZSk7CiAgICAgICAgICB2YXIgbyA9IHUodCk7CiAgICAgICAgICBsKHQsIG8pOwogICAgICAgICAgdmFyIHIgPSBhKHQpOwogICAgICAgICAgaS5vbkluaXQodCwgbywgciwgaC52YWx1ZS5nZXQoKSk7CiAgICAgICAgfSksIENyKGNpKCksIG0pLCBDcihsaSgpLCBnKSwgQ3IoZGkoKSwgbSksIENyKHBpKCksIGcpXSksCiAgICAgICAgYXBpczogewogICAgICAgICAgcmVzZXRUb01pbjogZnVuY3Rpb24gcmVzZXRUb01pbih0KSB7CiAgICAgICAgICAgIHYuc2V0VG9NaW4odCwgaSk7CiAgICAgICAgICB9LAogICAgICAgICAgcmVzZXRUb01heDogZnVuY3Rpb24gcmVzZXRUb01heCh0KSB7CiAgICAgICAgICAgIHYuc2V0VG9NYXgodCwgaSk7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0VmFsdWU6IGYsCiAgICAgICAgICByZWZyZXNoOiBsCiAgICAgICAgfSwKICAgICAgICBkb21Nb2RpZmljYXRpb246IHsKICAgICAgICAgIHN0eWxlczogewogICAgICAgICAgICBwb3NpdGlvbjogInJlbGF0aXZlIgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0sCiAgICBhcGlzOiB7CiAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh0LCBuLCBlKSB7CiAgICAgICAgdC5zZXRWYWx1ZShuLCBlKTsKICAgICAgfSwKICAgICAgcmVzZXRUb01pbjogZnVuY3Rpb24gcmVzZXRUb01pbih0LCBuKSB7CiAgICAgICAgdC5yZXNldFRvTWluKG4pOwogICAgICB9LAogICAgICByZXNldFRvTWF4OiBmdW5jdGlvbiByZXNldFRvTWF4KHQsIG4pIHsKICAgICAgICB0LnJlc2V0VG9NYXgobik7CiAgICAgIH0sCiAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uIHJlZnJlc2godCwgbikgewogICAgICAgIHQucmVmcmVzaChuKTsKICAgICAgfQogICAgfQogIH0pLAogICAgICBxdyA9IEZyKCJyZ2ItaGV4LXVwZGF0ZSIpLAogICAgICBLdyA9IEZyKCJzbGlkZXItdXBkYXRlIiksCiAgICAgIEp3ID0gRnIoInBhbGV0dGUtdXBkYXRlIiksCiAgICAgICR3ID0gWyRzKCJmb3JtQmVoYXZpb3VycyIsIFtUZl0pXSwKICAgICAgUXcgPSB7CiAgICBnZXRGaWVsZDogSHIoZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgcmV0dXJuIHQuZ2V0RmllbGQobiwgZSk7CiAgICB9KSwKICAgIHNrZXRjaDogZnVuY3Rpb24gc2tldGNoKHQpIHsKICAgICAgdmFyIGUsCiAgICAgICAgICBuID0gewogICAgICAgIGZpZWxkOiBmdW5jdGlvbiBmaWVsZCh0LCBuKSB7CiAgICAgICAgICByZXR1cm4gZS5wdXNoKHQpLCB1bCgiZm9ybSIsIG4wKHQpLCBuKTsKICAgICAgICB9LAogICAgICAgIHJlY29yZDogcnQoZSA9IFtdKQogICAgICB9LAogICAgICAgICAgbyA9IHQobiksCiAgICAgICAgICByID0gTShuLnJlY29yZCgpLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBxZih7CiAgICAgICAgICBuYW1lOiB0LAogICAgICAgICAgcG5hbWU6IG4wKHQpCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICByZXR1cm4geGwoImZvcm0iLCAkdywgciwgZXcsIG8pOwogICAgfQogIH0sCiAgICAgIFp3ID0gRnIoInZhbGlkLWlucHV0IiksCiAgICAgIHRTID0gRnIoImludmFsaWQtaW5wdXQiKSwKICAgICAgblMgPSBGcigidmFsaWRhdGluZy1pbnB1dCIpLAogICAgICBlUyA9ICJjb2xvcmN1c3RvbS5yZ2IuIiwKICAgICAgb1MgPSBmdW5jdGlvbiBvUyh0KSB7CiAgICByZXR1cm4gdWQuY29uZmlnKHsKICAgICAgZmluZDogdC5nZXRPcHQKICAgIH0pOwogIH0sCiAgICAgIHJTID0gZnVuY3Rpb24gclModCkgewogICAgcmV0dXJuIHVkLmNvbmZpZyh7CiAgICAgIGZpbmQ6IGZ1bmN0aW9uIGZpbmQobikgewogICAgICAgIHJldHVybiBKdChuLmVsZW1lbnQsIHQpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBuLmdldFN5c3RlbSgpLmdldEJ5RG9tKHQpLnRvT3B0aW9uYWwoKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfSwKICAgICAgaVMgPSB7CiAgICAiY29sb3JjdXN0b20ucmdiLnJlZC5sYWJlbCI6ICJSIiwKICAgICJjb2xvcmN1c3RvbS5yZ2IucmVkLmRlc2NyaXB0aW9uIjogIlJlZCBjb21wb25lbnQiLAogICAgImNvbG9yY3VzdG9tLnJnYi5ncmVlbi5sYWJlbCI6ICJHIiwKICAgICJjb2xvcmN1c3RvbS5yZ2IuZ3JlZW4uZGVzY3JpcHRpb24iOiAiR3JlZW4gY29tcG9uZW50IiwKICAgICJjb2xvcmN1c3RvbS5yZ2IuYmx1ZS5sYWJlbCI6ICJCIiwKICAgICJjb2xvcmN1c3RvbS5yZ2IuYmx1ZS5kZXNjcmlwdGlvbiI6ICJCbHVlIGNvbXBvbmVudCIsCiAgICAiY29sb3JjdXN0b20ucmdiLmhleC5sYWJlbCI6ICIjIiwKICAgICJjb2xvcmN1c3RvbS5yZ2IuaGV4LmRlc2NyaXB0aW9uIjogIkhleCBjb2xvciBjb2RlIiwKICAgICJjb2xvcmN1c3RvbS5yZ2IucmFuZ2UiOiAiUmFuZ2UgMCB0byAyNTUiLAogICAgImNvbG9yY3VzdG9tLnNiLnNhdHVyYXRpb24iOiAiU2F0dXJhdGlvbiIsCiAgICAiY29sb3JjdXN0b20uc2IuYnJpZ2h0bmVzcyI6ICJCcmlnaHRuZXNzIiwKICAgICJjb2xvcmN1c3RvbS5zYi5waWNrZXIiOiAiU2F0dXJhdGlvbiBhbmQgQnJpZ2h0bmVzcyBQaWNrZXIiLAogICAgImNvbG9yY3VzdG9tLnNiLnBhbGV0dGUiOiAiU2F0dXJhdGlvbiBhbmQgQnJpZ2h0bmVzcyBQYWxldHRlIiwKICAgICJjb2xvcmN1c3RvbS5zYi5pbnN0cnVjdGlvbnMiOiAiVXNlIGFycm93IGtleXMgdG8gc2VsZWN0IHNhdHVyYXRpb24gYW5kIGJyaWdodG5lc3MsIG9uIHggYW5kIHkgYXhlcyIsCiAgICAiY29sb3JjdXN0b20uaHVlLmh1ZSI6ICJIdWUiLAogICAgImNvbG9yY3VzdG9tLmh1ZS5zbGlkZXIiOiAiSHVlIFNsaWRlciIsCiAgICAiY29sb3JjdXN0b20uaHVlLnBhbGV0dGUiOiAiSHVlIFBhbGV0dGUiLAogICAgImNvbG9yY3VzdG9tLmh1ZS5pbnN0cnVjdGlvbnMiOiAiVXNlIGFycm93IGtleXMgdG8gc2VsZWN0IGEgaHVlIiwKICAgICJhcmlhLmNvbG9yLnBpY2tlciI6ICJDb2xvciBQaWNrZXIiLAogICAgImFyaWEuaW5wdXQuaW52YWxpZCI6ICJJbnZhbGlkIGlucHV0IgogIH0sCiAgICAgIHVTID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoInRpbnltY2UuUmVzb3VyY2UiKSwKICAgICAgYVMgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgidGlueW1jZS51dGlsLlRvb2xzIiksCiAgICAgIGNTID0gSm8oW1RvKCJwcmVwcm9jZXNzIiwgaCksIFRvKCJwb3N0cHJvY2VzcyIsIGgpXSksCiAgICAgIHNTID0gZnVuY3Rpb24gc1MociwgdCkgewogICAgdmFyIGkgPSBjbygiUmVwcmVzZW50aW5nQ29uZmlncy5tZW1lbnRvIHByb2Nlc3NvcnMiLCBjUywgdCk7CiAgICByZXR1cm4gVGYuY29uZmlnKHsKICAgICAgc3RvcmU6IHsKICAgICAgICBtb2RlOiAibWFudWFsIiwKICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUodCkgewogICAgICAgICAgdmFyIG4gPSByLmdldCh0KSwKICAgICAgICAgICAgICBlID0gVGYuZ2V0VmFsdWUobik7CiAgICAgICAgICByZXR1cm4gaS5wb3N0cHJvY2VzcyhlKTsKICAgICAgICB9LAogICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh0LCBuKSB7CiAgICAgICAgICB2YXIgZSA9IGkucHJlcHJvY2VzcyhuKSwKICAgICAgICAgICAgICBvID0gci5nZXQodCk7CiAgICAgICAgICBUZi5zZXRWYWx1ZShvLCBlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0sCiAgICAgIGxTID0gaTAsCiAgICAgIGZTID0gZnVuY3Rpb24gZlModCkgewogICAgcmV0dXJuIFRmLmNvbmZpZyh7CiAgICAgIHN0b3JlOiB7CiAgICAgICAgbW9kZTogIm1lbW9yeSIsCiAgICAgICAgaW5pdGlhbFZhbHVlOiB0CiAgICAgIH0KICAgIH0pOwogIH0sCiAgICAgIGRTID0gRnIoImFsbG95LWZha2UtYmVmb3JlLXRhYnN0b3AiKSwKICAgICAgbVMgPSBGcigiYWxsb3ktZmFrZS1hZnRlci10YWJzdG9wIiksCiAgICAgIGdTID0gIShzZSgpLmJyb3dzZXIuaXNJRSgpIHx8IHNlKCkuYnJvd3Nlci5pc0VkZ2UoKSksCiAgICAgIHBTID0gZnVuY3Rpb24gcFModCkgewogICAgcmV0dXJuIHQuZ2V0Q29udGV4dCgiMmQiKTsKICB9LAogICAgICBoUyA9IGZ1bmN0aW9uIGhTKHQsIG4sIGUpIHsKICAgIHJldHVybiB0LndpZHRoID0gbiwgdC5oZWlnaHQgPSBlLCB0OwogIH0sCiAgICAgIHZTID0gZnVuY3Rpb24gdlModCkgewogICAgVVJMLnJldm9rZU9iamVjdFVSTCh0LnNyYyk7CiAgfSwKICAgICAgYlMgPSBbMCwgLjAxLCAuMDIsIC4wNCwgLjA1LCAuMDYsIC4wNywgLjA4LCAuMSwgLjExLCAuMTIsIC4xNCwgLjE1LCAuMTYsIC4xNywgLjE4LCAuMiwgLjIxLCAuMjIsIC4yNCwgLjI1LCAuMjcsIC4yOCwgLjMsIC4zMiwgLjM0LCAuMzYsIC4zOCwgLjQsIC40MiwgLjQ0LCAuNDYsIC40OCwgLjUsIC41MywgLjU2LCAuNTksIC42MiwgLjY1LCAuNjgsIC43MSwgLjc0LCAuNzcsIC44LCAuODMsIC44NiwgLjg5LCAuOTIsIC45NSwgLjk4LCAxLCAxLjA2LCAxLjEyLCAxLjE4LCAxLjI0LCAxLjMsIDEuMzYsIDEuNDIsIDEuNDgsIDEuNTQsIDEuNiwgMS42NiwgMS43MiwgMS43OCwgMS44NCwgMS45LCAxLjk2LCAyLCAyLjEyLCAyLjI1LCAyLjM3LCAyLjUsIDIuNjIsIDIuNzUsIDIuODcsIDMsIDMuMiwgMy40LCAzLjYsIDMuOCwgNCwgNC4zLCA0LjcsIDQuOSwgNSwgNS41LCA2LCA2LjUsIDYuOCwgNywgNy4zLCA3LjUsIDcuOCwgOCwgOC40LCA4LjcsIDksIDkuNCwgOS42LCA5LjgsIDEwXSwKICAgICAgeVMgPSBmdW5jdGlvbiB5Uyh0LCBuLCBUKSB7CiAgICB2YXIgZSA9IHBTKHQpLAogICAgICAgIG8gPSBmdW5jdGlvbiAodCkgewogICAgICBmb3IgKHZhciBuLCBlLCBvLCByLCBpID0gdC5kYXRhLCB1ID0gVFswXSwgYSA9IFRbMV0sIGMgPSBUWzJdLCBzID0gVFszXSwgbCA9IFRbNF0sIGYgPSBUWzVdLCBkID0gVFs2XSwgbSA9IFRbN10sIGcgPSBUWzhdLCBwID0gVFs5XSwgaCA9IFRbMTBdLCB2ID0gVFsxMV0sIGIgPSBUWzEyXSwgeSA9IFRbMTNdLCB4ID0gVFsxNF0sIHcgPSBUWzE1XSwgUyA9IFRbMTZdLCBDID0gVFsxN10sIGsgPSBUWzE4XSwgTyA9IFRbMTldLCBfID0gMDsgXyA8IGkubGVuZ3RoOyBfICs9IDQpIHsKICAgICAgICBuID0gaVtfXSwgZSA9IGlbXyArIDFdLCBvID0gaVtfICsgMl0sIHIgPSBpW18gKyAzXSwgaVtfXSA9IG4gKiB1ICsgZSAqIGEgKyBvICogYyArIHIgKiBzICsgbCwgaVtfICsgMV0gPSBuICogZiArIGUgKiBkICsgbyAqIG0gKyByICogZyArIHAsIGlbXyArIDJdID0gbiAqIGggKyBlICogdiArIG8gKiBiICsgciAqIHkgKyB4LCBpW18gKyAzXSA9IG4gKiB3ICsgZSAqIFMgKyBvICogQyArIHIgKiBrICsgTzsKICAgICAgfQoKICAgICAgcmV0dXJuIHQ7CiAgICB9KGUuZ2V0SW1hZ2VEYXRhKDAsIDAsIHQud2lkdGgsIHQuaGVpZ2h0KSk7CgogICAgcmV0dXJuIGUucHV0SW1hZ2VEYXRhKG8sIDAsIDApLCBiMCh0LCBuKTsKICB9LAogICAgICB4UyA9IChpdyA9IFstMSwgMCwgMCwgMCwgMjU1LCAwLCAtMSwgMCwgMCwgMjU1LCAwLCAwLCAtMSwgMCwgMjU1LCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAwLCAwLCAxXSwgZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiBDMCh0LCBpdyk7CiAgfSksCiAgICAgIHdTID0gazAoZnVuY3Rpb24gKHQsIG4pIHsKICAgIHJldHVybiBTMCh0LCBbMSwgMCwgMCwgMCwgbiA9IHgwKDI1NSAqIG4sIC0yNTUsIDI1NSksIDAsIDEsIDAsIDAsIG4sIDAsIDAsIDEsIDAsIG4sIDAsIDAsIDAsIDEsIDAsIDAsIDAsIDAsIDAsIDFdKTsKICB9KSwKICAgICAgU1MgPSBrMChmdW5jdGlvbiAodCwgbikgewogICAgdmFyIGU7CiAgICByZXR1cm4gbiA9IHgwKG4sIC0xLCAxKSwgUzAodCwgWyhlID0gKG4gKj0gMTAwKSA8IDAgPyAxMjcgKyBuIC8gMTAwICogMTI3IDogMTI3ICogKDAgPT0gKGUgPSBuICUgMSkgPyBiU1tuXSA6IGJTW01hdGguZmxvb3IobildICogKDEgLSBlKSArIGJTW01hdGguZmxvb3IobikgKyAxXSAqIGUpICsgMTI3KSAvIDEyNywgMCwgMCwgMCwgLjUgKiAoMTI3IC0gZSksIDAsIGUgLyAxMjcsIDAsIDAsIC41ICogKDEyNyAtIGUpLCAwLCAwLCBlIC8gMTI3LCAwLCAuNSAqICgxMjcgLSBlKSwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMCwgMV0pOwogIH0pLAogICAgICBDUyA9ICh1dyA9IFswLCAtMSwgMCwgLTEsIDUsIC0xLCAwLCAtMSwgMF0sIGZ1bmN0aW9uICh0KSB7CiAgICByZXR1cm4gYSA9IHV3LCAodSA9IHQpLnRvQ2FudmFzKCkudGhlbihmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gbiA9IHQsIGUgPSB1LmdldFR5cGUoKSwgbyA9IGEsIHIgPSBwUyhuKSwgaSA9IGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgICAgZm9yICh2YXIgbyA9IGZ1bmN0aW9uIG8odCwgbiwgZSkgewogICAgICAgICAgcmV0dXJuIGUgPCB0ID8gdCA9IGUgOiB0IDwgbiAmJiAodCA9IG4pLCB0OwogICAgICAgIH0sIHIgPSBNYXRoLnJvdW5kKE1hdGguc3FydChlLmxlbmd0aCkpLCBpID0gTWF0aC5mbG9vcihyIC8gMiksIHUgPSB0LmRhdGEsIGEgPSBuLmRhdGEsIGMgPSB0LndpZHRoLCBzID0gdC5oZWlnaHQsIGwgPSAwOyBsIDwgczsgbCsrKSB7CiAgICAgICAgICBmb3IgKHZhciBmID0gMDsgZiA8IGM7IGYrKykgewogICAgICAgICAgICBmb3IgKHZhciBkID0gMCwgbSA9IDAsIGcgPSAwLCBwID0gMDsgcCA8IHI7IHArKykgewogICAgICAgICAgICAgIGZvciAodmFyIGggPSAwOyBoIDwgcjsgaCsrKSB7CiAgICAgICAgICAgICAgICB2YXIgdiA9IG8oZiArIGggLSBpLCAwLCBjIC0gMSksCiAgICAgICAgICAgICAgICAgICAgYiA9IDQgKiAobyhsICsgcCAtIGksIDAsIHMgLSAxKSAqIGMgKyB2KSwKICAgICAgICAgICAgICAgICAgICB5ID0gZVtwICogciArIGhdOwogICAgICAgICAgICAgICAgZCArPSB1W2JdICogeSwgbSArPSB1WzEgKyBiXSAqIHksIGcgKz0gdVsyICsgYl0gKiB5OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHggPSA0ICogKGwgKiBjICsgZik7CiAgICAgICAgICAgIGFbeF0gPSBvKGQsIDAsIDI1NSksIGFbMSArIHhdID0gbyhtLCAwLCAyNTUpLCBhWzIgKyB4XSA9IG8oZywgMCwgMjU1KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBuOwogICAgICB9KHIuZ2V0SW1hZ2VEYXRhKDAsIDAsIG4ud2lkdGgsIG4uaGVpZ2h0KSwgci5nZXRJbWFnZURhdGEoMCwgMCwgbi53aWR0aCwgbi5oZWlnaHQpLCBvKSwgci5wdXRJbWFnZURhdGEoaSwgMCwgMCksIGIwKG4sIGUpOwogICAgICB2YXIgbiwgZSwgbywgciwgaTsKICAgIH0pOwogICAgdmFyIHUsIGE7CiAgfSksCiAgICAgIGtTID0gKGF3ID0gZnVuY3Rpb24gYXcodCwgbikgewogICAgcmV0dXJuIDI1NSAqIE1hdGgucG93KHQgLyAyNTUsIDEgLSBuKTsKICB9LCBmdW5jdGlvbiAobiwgZSkgewogICAgcmV0dXJuIG4udG9DYW52YXMoKS50aGVuKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAodCwgbiwgZSkgewogICAgICAgIGZvciAodmFyIG8gPSBwUyh0KSwgciA9IG5ldyBBcnJheSgyNTYpLCBpID0gMDsgaSA8IHIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHJbaV0gPSBhdyhpLCBlKTsKICAgICAgICB9CgogICAgICAgIHZhciB1ID0gZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIGZvciAodmFyIGUgPSB0LmRhdGEsIG8gPSAwOyBvIDwgZS5sZW5ndGg7IG8gKz0gNCkgewogICAgICAgICAgICBlW29dID0gbltlW29dXSwgZVtvICsgMV0gPSBuW2VbbyArIDFdXSwgZVtvICsgMl0gPSBuW2VbbyArIDJdXTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gdDsKICAgICAgICB9KG8uZ2V0SW1hZ2VEYXRhKDAsIDAsIHQud2lkdGgsIHQuaGVpZ2h0KSwgcik7CgogICAgICAgIHJldHVybiBvLnB1dEltYWdlRGF0YSh1LCAwLCAwKSwgYjAodCwgbik7CiAgICAgIH0odCwgbi5nZXRUeXBlKCksIGUpOwogICAgfSk7CiAgfSksCiAgICAgIE9TID0gZnVuY3Rpb24gT1ModCwgbiwgZSkgewogICAgdmFyIG8gPSBnMCh0KSwKICAgICAgICByID0gcDAodCksCiAgICAgICAgaSA9IG4gLyBvLAogICAgICAgIHUgPSBlIC8gciwKICAgICAgICBhID0gITE7CiAgICAoaSA8IC41IHx8IDIgPCBpKSAmJiAoaSA9IGkgPCAuNSA/IC41IDogMiwgYSA9ICEwKSwgKHUgPCAuNSB8fCAyIDwgdSkgJiYgKHUgPSB1IDwgLjUgPyAuNSA6IDIsIGEgPSAhMCk7CgogICAgdmFyIGMgPSBfUyh0LCBpLCB1KTsKCiAgICByZXR1cm4gYSA/IGMudGhlbihmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gT1ModCwgbiwgZSk7CiAgICB9KSA6IGM7CiAgfSwKICAgICAgX1MgPSBmdW5jdGlvbiBfUyh1LCBhLCBjKSB7CiAgICByZXR1cm4gbmV3IFZ5KGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuID0gZzAodSksCiAgICAgICAgICBlID0gcDAodSksCiAgICAgICAgICBvID0gTWF0aC5mbG9vcihuICogYSksCiAgICAgICAgICByID0gTWF0aC5mbG9vcihlICogYyksCiAgICAgICAgICBpID0gZDAobywgcik7CiAgICAgIHBTKGkpLmRyYXdJbWFnZSh1LCAwLCAwLCBuLCBlLCAwLCAwLCBvLCByKSwgdChpKTsKICAgIH0pOwogIH0sCiAgICAgIFRTID0gZnVuY3Rpb24gVFModCwgbiwgZSkgewogICAgdmFyIG8gPSAoZSA8IDAgPyAzNjAgKyBlIDogZSkgKiBNYXRoLlBJIC8gMTgwLAogICAgICAgIHIgPSB0LndpZHRoLAogICAgICAgIGkgPSB0LmhlaWdodCwKICAgICAgICB1ID0gTWF0aC5zaW4obyksCiAgICAgICAgYSA9IE1hdGguY29zKG8pLAogICAgICAgIGMgPSBPMChNYXRoLmFicyhyICogYSkgKyBNYXRoLmFicyhpICogdSkpLAogICAgICAgIHMgPSBPMChNYXRoLmFicyhyICogdSkgKyBNYXRoLmFicyhpICogYSkpLAogICAgICAgIGwgPSBkMChjLCBzKSwKICAgICAgICBmID0gcFMobCk7CiAgICByZXR1cm4gZi50cmFuc2xhdGUoYyAvIDIsIHMgLyAyKSwgZi5yb3RhdGUobyksIGYuZHJhd0ltYWdlKHQsIC1yIC8gMiwgLWkgLyAyKSwgYjAobCwgbik7CiAgfSwKICAgICAgRVMgPSBmdW5jdGlvbiBFUyh0LCBuLCBlKSB7CiAgICB2YXIgbyA9IGQwKHQud2lkdGgsIHQuaGVpZ2h0KSwKICAgICAgICByID0gcFMobyk7CiAgICByZXR1cm4gInYiID09PSBlID8gKHIuc2NhbGUoMSwgLTEpLCByLmRyYXdJbWFnZSh0LCAwLCAtby5oZWlnaHQpKSA6IChyLnNjYWxlKC0xLCAxKSwgci5kcmF3SW1hZ2UodCwgLW8ud2lkdGgsIDApKSwgYjAobywgbik7CiAgfSwKICAgICAgRFMgPSBmdW5jdGlvbiBEUyh0LCBuLCBlLCBvLCByLCBpKSB7CiAgICB2YXIgdSA9IGQwKHIsIGkpOwogICAgcmV0dXJuIHBTKHUpLmRyYXdJbWFnZSh0LCAtZSwgLW8pLCBiMCh1LCBuKTsKICB9LAogICAgICBCUyA9IEZyKCJ0b29sYmFyLmJ1dHRvbi5leGVjdXRlIiksCiAgICAgIE1TID0gKChjdyA9IHt9KVtGaSgpXSA9IFsiZGlzYWJsaW5nIiwgImFsbG95LmJhc2UuYmVoYXZpb3VyIiwgInRvZ2dsaW5nIiwgInRvb2xiYXItYnV0dG9uLWV2ZW50cyJdLCBjdyksCiAgICAgIEFTID0gRnIoInVwZGF0ZS1tZW51LXRleHQiKSwKICAgICAgRlMgPSBGcigidXBkYXRlLW1lbnUtaWNvbiIpLAogICAgICBJUyA9IHsKICAgIHR5cGU6ICJzZXBhcmF0b3IiCiAgfSwKICAgICAgUlMgPSBmdW5jdGlvbiBSUyh0LCBsKSB7CiAgICB2YXIgbiwgZSwgbzsKICAgIHJldHVybiBJKChuID0geSh0KSA/IHQuc3BsaXQoIiAiKSA6IHQsIGUgPSBsLCAwIDwgKG8gPSBSKG4sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiB5KG4pID8gIiIgPT09IG4gPyB0IDogInwiID09PSBuID8gMCA8IHQubGVuZ3RoICYmICFIMCh0W3QubGVuZ3RoIC0gMV0pID8gdC5jb25jYXQoW0lTXSkgOiB0IDogVHQoZSwgbi50b0xvd2VyQ2FzZSgpKSA/IHQuY29uY2F0KFtlW24udG9Mb3dlckNhc2UoKV1dKSA6IHQgOiB0LmNvbmNhdChbbl0pOwogICAgfSwgW10pKS5sZW5ndGggJiYgSDAob1tvLmxlbmd0aCAtIDFdKSAmJiBvLnBvcCgpLCBvKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgdmFyIGUsCiAgICAgICAgICBvLAogICAgICAgICAgciwKICAgICAgICAgIGksCiAgICAgICAgICB1LAogICAgICAgICAgYSwKICAgICAgICAgIGMgPSBmdW5jdGlvbiAodCkgewogICAgICAgIGlmIChIMCh0KSkgcmV0dXJuIHQ7CiAgICAgICAgdmFyIG4gPSB0dCh0LCAidmFsdWUiKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBGcigiZ2VuZXJhdGVkLW1lbnUtaXRlbSIpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBYbyh7CiAgICAgICAgICB2YWx1ZTogbgogICAgICAgIH0sIHQpOwogICAgICB9KG4pLAogICAgICAgICAgcyA9IChvID0gbCwgVHQoZSA9IGMsICJnZXRTdWJtZW51SXRlbXMiKSA/IChpID0gbywgdSA9IChyID0gZSkuZ2V0U3VibWVudUl0ZW1zKCksIGEgPSBSUyh1LCBpKSwgewogICAgICAgIGl0ZW06IHIsCiAgICAgICAgbWVudXM6IFhvKGEubWVudXMsIGNyKHIudmFsdWUsIGEuaXRlbXMpKSwKICAgICAgICBleHBhbnNpb25zOiBYbyhhLmV4cGFuc2lvbnMsIGNyKHIudmFsdWUsIHIudmFsdWUpKQogICAgICB9KSA6IHsKICAgICAgICBpdGVtOiBlLAogICAgICAgIG1lbnVzOiB7fSwKICAgICAgICBleHBhbnNpb25zOiB7fQogICAgICB9KTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgbWVudXM6IFhvKHQubWVudXMsIHMubWVudXMpLAogICAgICAgIGl0ZW1zOiBbcy5pdGVtXS5jb25jYXQodC5pdGVtcyksCiAgICAgICAgZXhwYW5zaW9uczogWG8odC5leHBhbnNpb25zLCBzLmV4cGFuc2lvbnMpCiAgICAgIH07CiAgICB9LCB7CiAgICAgIG1lbnVzOiB7fSwKICAgICAgZXhwYW5zaW9uczoge30sCiAgICAgIGl0ZW1zOiBbXQogICAgfSk7CiAgfSwKICAgICAgVlMgPSBydChbVG8oImZpZWxkMU5hbWUiLCAiZmllbGQxIiksIFRvKCJmaWVsZDJOYW1lIiwgImZpZWxkMiIpLCAkdSgib25Mb2NrZWRDaGFuZ2UiKSwgWXUoWyJsb2NrQ2xhc3MiXSksIFRvKCJsb2NrZWQiLCAhMSksIEVmKCJjb3VwbGVkRmllbGRCZWhhdmlvdXJzIiwgW3VkLCBUZl0pXSksCiAgICAgIFBTID0gcnQoW0swKCJmaWVsZDEiLCAiZmllbGQyIiksIEswKCJmaWVsZDIiLCAiZmllbGQxIiksIHFmKHsKICAgIGZhY3Rvcnk6IHNwLAogICAgc2NoZW1hOiBbZm8oImRvbSIpXSwKICAgIG5hbWU6ICJsb2NrIiwKICAgIG92ZXJyaWRlczogZnVuY3Rpb24gb3ZlcnJpZGVzKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBidXR0b25CZWhhdmlvdXJzOiB0YyhbemcuY29uZmlnKHsKICAgICAgICAgIHNlbGVjdGVkOiB0LmxvY2tlZCwKICAgICAgICAgIHRvZ2dsZUNsYXNzOiB0Lm1hcmtlcnMubG9ja0NsYXNzLAogICAgICAgICAgYXJpYTogewogICAgICAgICAgICBtb2RlOiAicHJlc3NlZCIKICAgICAgICAgIH0KICAgICAgICB9KV0pCiAgICAgIH07CiAgICB9CiAgfSldKSwKICAgICAgSFMgPSBTbCh7CiAgICBuYW1lOiAiRm9ybUNvdXBsZWRJbnB1dHMiLAogICAgY29uZmlnRmllbGRzOiBWUygpLAogICAgcGFydEZpZWxkczogUFMoKSwKICAgIGZhY3Rvcnk6IGZ1bmN0aW9uIGZhY3RvcnkobywgdCwgbiwgZSkgewogICAgICByZXR1cm4gewogICAgICAgIHVpZDogby51aWQsCiAgICAgICAgZG9tOiBvLmRvbSwKICAgICAgICBjb21wb25lbnRzOiB0LAogICAgICAgIGJlaGF2aW91cnM6IERmKG8uY291cGxlZEZpZWxkQmVoYXZpb3VycywgW3VkLmNvbmZpZyh7CiAgICAgICAgICBmaW5kOiB2dC5zb21lCiAgICAgICAgfSksIFRmLmNvbmZpZyh7CiAgICAgICAgICBzdG9yZTogewogICAgICAgICAgICBtb2RlOiAibWFudWFsIiwKICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKHQpIHsKICAgICAgICAgICAgICB2YXIgbiA9IGhsKHQsIG8sIFsiZmllbGQxIiwgImZpZWxkMiJdKSwKICAgICAgICAgICAgICAgICAgZSA9IHt9OwogICAgICAgICAgICAgIHJldHVybiBlW28uZmllbGQxTmFtZV0gPSBUZi5nZXRWYWx1ZShuLmZpZWxkMSgpKSwgZVtvLmZpZWxkMk5hbWVdID0gVGYuZ2V0VmFsdWUobi5maWVsZDIoKSksIGU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh0LCBuKSB7CiAgICAgICAgICAgICAgdmFyIGUgPSBobCh0LCBvLCBbImZpZWxkMSIsICJmaWVsZDIiXSk7CiAgICAgICAgICAgICAgbnQobiwgby5maWVsZDFOYW1lKSAmJiBUZi5zZXRWYWx1ZShlLmZpZWxkMSgpLCBuW28uZmllbGQxTmFtZV0pLCBudChuLCBvLmZpZWxkMk5hbWUpICYmIFRmLnNldFZhbHVlKGUuZmllbGQyKCksIG5bby5maWVsZDJOYW1lXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KV0pLAogICAgICAgIGFwaXM6IHsKICAgICAgICAgIGdldEZpZWxkMTogZnVuY3Rpb24gZ2V0RmllbGQxKHQpIHsKICAgICAgICAgICAgcmV0dXJuIGZsKHQsIG8sICJmaWVsZDEiKTsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXRGaWVsZDI6IGZ1bmN0aW9uIGdldEZpZWxkMih0KSB7CiAgICAgICAgICAgIHJldHVybiBmbCh0LCBvLCAiZmllbGQyIik7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0TG9jazogZnVuY3Rpb24gZ2V0TG9jayh0KSB7CiAgICAgICAgICAgIHJldHVybiBmbCh0LCBvLCAibG9jayIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0sCiAgICBhcGlzOiB7CiAgICAgIGdldEZpZWxkMTogZnVuY3Rpb24gZ2V0RmllbGQxKHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5nZXRGaWVsZDEobik7CiAgICAgIH0sCiAgICAgIGdldEZpZWxkMjogZnVuY3Rpb24gZ2V0RmllbGQyKHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5nZXRGaWVsZDIobik7CiAgICAgIH0sCiAgICAgIGdldExvY2s6IGZ1bmN0aW9uIGdldExvY2sodCwgbikgewogICAgICAgIHJldHVybiB0LmdldExvY2sobik7CiAgICAgIH0KICAgIH0KICB9KSwKICAgICAgelMgPSB7CiAgICB1bmRvOiBydChGcigidW5kbyIpKSwKICAgIHJlZG86IHJ0KEZyKCJyZWRvIikpLAogICAgem9vbTogcnQoRnIoInpvb20iKSksCiAgICBiYWNrOiBydChGcigiYmFjayIpKSwKICAgIGFwcGx5OiBydChGcigiYXBwbHkiKSksCiAgICBzd2FwOiBydChGcigic3dhcCIpKSwKICAgIHRyYW5zZm9ybTogcnQoRnIoInRyYW5zZm9ybSIpKSwKICAgIHRlbXBUcmFuc2Zvcm06IHJ0KEZyKCJ0ZW1wLXRyYW5zZm9ybSIpKSwKICAgIHRyYW5zZm9ybUFwcGx5OiBydChGcigidHJhbnNmb3JtLWFwcGx5IikpCiAgfSwKICAgICAgTlMgPSBydCgic2F2ZS1zdGF0ZSIpLAogICAgICBMUyA9IHJ0KCJkaXNhYmxlIiksCiAgICAgIFdTID0gcnQoImVuYWJsZSIpLAogICAgICBVUyA9IHsKICAgIGZvcm1BY3Rpb25FdmVudDogYnksCiAgICBzYXZlU3RhdGU6IE5TLAogICAgZGlzYWJsZTogTFMsCiAgICBlbmFibGU6IFdTCiAgfSwKICAgICAgalMgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgidGlueW1jZS5nZW9tLlJlY3QiKSwKICAgICAgR1MgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgidGlueW1jZS5kb20uRG9tUXVlcnkiKSwKICAgICAgWFMgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgidGlueW1jZS51dGlsLk9ic2VydmFibGUiKSwKICAgICAgWVMgPSB0aW55bWNlLnV0aWwuVG9vbHMucmVzb2x2ZSgidGlueW1jZS51dGlsLlZLIik7CgogIGZ1bmN0aW9uIHFTKHQsIGQpIHsKICAgIGZ1bmN0aW9uIG0odCkgewogICAgICBpZiAobncodCksIHQuYnV0dG9uICE9PSBwKSByZXR1cm4geCh0KTsKICAgICAgdC5kZWx0YVggPSB0LnNjcmVlblggLSBoLCB0LmRlbHRhWSA9IHQuc2NyZWVuWSAtIHYsIHQucHJldmVudERlZmF1bHQoKSwgZC5kcmFnKHQpOwogICAgfQoKICAgIHZhciBnLAogICAgICAgIHAsCiAgICAgICAgaCwKICAgICAgICB2LAogICAgICAgIGIgPSBkLmRvY3VtZW50IHx8IGRvY3VtZW50LAogICAgICAgIHkgPSBiLmdldEVsZW1lbnRCeUlkKGQuaGFuZGxlIHx8IHQpLAogICAgICAgIHggPSBmdW5jdGlvbiB4KHQpIHsKICAgICAgbncodCksIEdTKGIpLm9mZigibW91c2Vtb3ZlIHRvdWNobW92ZSIsIG0pLm9mZigibW91c2V1cCB0b3VjaGVuZCIsIHgpLCBnLnJlbW92ZSgpLCBkLnN0b3AgJiYgZC5zdG9wKHQpOwogICAgfTsKCiAgICByZXR1cm4gR1MoeSkub24oIm1vdXNlZG93biB0b3VjaHN0YXJ0IiwgZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBlLAogICAgICAgICAgbywKICAgICAgICAgIHIsCiAgICAgICAgICBpLAogICAgICAgICAgdSwKICAgICAgICAgIGEsCiAgICAgICAgICBjLAogICAgICAgICAgcywKICAgICAgICAgIGwgPSAobiA9IE1hdGgubWF4LCBlID0gYi5kb2N1bWVudEVsZW1lbnQsIG8gPSBiLmJvZHksIHIgPSBuKGUuc2Nyb2xsV2lkdGgsIG8uc2Nyb2xsV2lkdGgpLCBpID0gbihlLmNsaWVudFdpZHRoLCBvLmNsaWVudFdpZHRoKSwgdSA9IG4oZS5vZmZzZXRXaWR0aCwgby5vZmZzZXRXaWR0aCksIGEgPSBuKGUuc2Nyb2xsSGVpZ2h0LCBvLnNjcm9sbEhlaWdodCksIGMgPSBuKGUuY2xpZW50SGVpZ2h0LCBvLmNsaWVudEhlaWdodCksIHsKICAgICAgICB3aWR0aDogciA8IHUgPyBpIDogciwKICAgICAgICBoZWlnaHQ6IGEgPCBuKGUub2Zmc2V0SGVpZ2h0LCBvLm9mZnNldEhlaWdodCkgPyBjIDogYQogICAgICB9KTsKICAgICAgbncodCksIHQucHJldmVudERlZmF1bHQoKSwgcCA9IHQuYnV0dG9uOwogICAgICB2YXIgZiA9IHk7CiAgICAgIGggPSB0LnNjcmVlblgsIHYgPSB0LnNjcmVlblksIHMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSA/IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGYsIG51bGwpLmdldFByb3BlcnR5VmFsdWUoImN1cnNvciIpIDogZi5ydW50aW1lU3R5bGUuY3Vyc29yLCBnID0gR1MoIjxkaXY+PC9kaXY+IikuY3NzKHsKICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICB0b3A6IDAsCiAgICAgICAgbGVmdDogMCwKICAgICAgICB3aWR0aDogbC53aWR0aCwKICAgICAgICBoZWlnaHQ6IGwuaGVpZ2h0LAogICAgICAgIHpJbmRleDogMjE0NzQ4MzY0NywKICAgICAgICBvcGFjaXR5OiAxZS00LAogICAgICAgIGN1cnNvcjogcwogICAgICB9KS5hcHBlbmRUbyhiLmJvZHkpLCBHUyhiKS5vbigibW91c2Vtb3ZlIHRvdWNobW92ZSIsIG0pLm9uKCJtb3VzZXVwIHRvdWNoZW5kIiwgeCksIGQuc3RhcnQodCk7CiAgICB9KSwgewogICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgIEdTKHkpLm9mZigpOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gS1ModCwgbiwgZSwgbywgcikgewogICAgcmV0dXJuIGowKHsKICAgICAgbmFtZTogdCwKICAgICAgaWNvbjogdnQuc29tZShuKSwKICAgICAgZGlzYWJsZWQ6IGUsCiAgICAgIHRvb2x0aXA6IHZ0LnNvbWUodCksCiAgICAgIHByaW1hcnk6ICExLAogICAgICBib3JkZXJsZXNzOiAhMQogICAgfSwgbywgcik7CiAgfQoKICBmdW5jdGlvbiBKUyh0LCBuKSB7CiAgICBuID8gZGQuZW5hYmxlKHQpIDogZGQuZGlzYWJsZSh0KTsKICB9CgogIHZhciAkUyA9IDAsCiAgICAgIFFTID0gZnVuY3Rpb24gUVMocywgZSwgbCwgbywgcikgewogICAgZnVuY3Rpb24gZih0LCBuKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgeDogbi54IC0gdC54LAogICAgICAgIHk6IG4ueSAtIHQueSwKICAgICAgICB3OiBuLncsCiAgICAgICAgaDogbi5oCiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gdSh0LCBuLCBlLCBvKSB7CiAgICAgIHZhciByLAogICAgICAgICAgaSA9IG4ueCwKICAgICAgICAgIHUgPSBuLnksCiAgICAgICAgICBhID0gbi53LAogICAgICAgICAgYyA9IG4uaDsKICAgICAgaSArPSBlICogdC5kZWx0YVgsIHUgKz0gbyAqIHQuZGVsdGFZLCBhICs9IGUgKiB0LmRlbHRhVywgYyArPSBvICogdC5kZWx0YUgsIHMgPSBqUy5jbGFtcCh7CiAgICAgICAgeDogaSwKICAgICAgICB5OiB1LAogICAgICAgIHc6IGEgPSBhIDwgMjAgPyAyMCA6IGEsCiAgICAgICAgaDogYyA9IGMgPCAyMCA/IDIwIDogYwogICAgICB9LCBsLCAibW92ZSIgPT09IHQubmFtZSksIHIgPSBmKGwsIHMpLCBwLmZpcmUoInVwZGF0ZVJlY3QiLCB7CiAgICAgICAgcmVjdDogcgogICAgICB9KSwgZyhyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpKHQpIHsKICAgICAgbihzID0gdCk7CiAgICB9CgogICAgZnVuY3Rpb24gbihuKSB7CiAgICAgIGZ1bmN0aW9uIHQodCwgbikgewogICAgICAgIG4uaCA8IDAgJiYgKG4uaCA9IDApLCBuLncgPCAwICYmIChuLncgPSAwKSwgR1MoIiMiICsgYyArICItIiArIHQsIG8pLmNzcyh7CiAgICAgICAgICBsZWZ0OiBuLngsCiAgICAgICAgICB0b3A6IG4ueSwKICAgICAgICAgIHdpZHRoOiBuLncsCiAgICAgICAgICBoZWlnaHQ6IG4uaAogICAgICAgIH0pOwogICAgICB9CgogICAgICBhUy5lYWNoKGQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgR1MoIiMiICsgYyArICItIiArIHQubmFtZSwgbykuY3NzKHsKICAgICAgICAgIGxlZnQ6IG4udyAqIHQueE11bCArIG4ueCwKICAgICAgICAgIHRvcDogbi5oICogdC55TXVsICsgbi55CiAgICAgICAgfSk7CiAgICAgIH0pLCB0KCJ0b3AiLCB7CiAgICAgICAgeDogZS54LAogICAgICAgIHk6IGUueSwKICAgICAgICB3OiBlLncsCiAgICAgICAgaDogbi55IC0gZS55CiAgICAgIH0pLCB0KCJyaWdodCIsIHsKICAgICAgICB4OiBuLnggKyBuLncsCiAgICAgICAgeTogbi55LAogICAgICAgIHc6IGUudyAtIG4ueCAtIG4udyArIGUueCwKICAgICAgICBoOiBuLmgKICAgICAgfSksIHQoImJvdHRvbSIsIHsKICAgICAgICB4OiBlLngsCiAgICAgICAgeTogbi55ICsgbi5oLAogICAgICAgIHc6IGUudywKICAgICAgICBoOiBlLmggLSBuLnkgLSBuLmggKyBlLnkKICAgICAgfSksIHQoImxlZnQiLCB7CiAgICAgICAgeDogZS54LAogICAgICAgIHk6IG4ueSwKICAgICAgICB3OiBuLnggLSBlLngsCiAgICAgICAgaDogbi5oCiAgICAgIH0pLCB0KCJtb3ZlIiwgbik7CiAgICB9CgogICAgdmFyIHQsCiAgICAgICAgYSA9ICJ0b3gtIiwKICAgICAgICBjID0gInRveC1jcmlkLSIgKyAkUysrLAogICAgICAgIGQgPSBbewogICAgICBuYW1lOiAibW92ZSIsCiAgICAgIHhNdWw6IDAsCiAgICAgIHlNdWw6IDAsCiAgICAgIGRlbHRhWDogMSwKICAgICAgZGVsdGFZOiAxLAogICAgICBkZWx0YVc6IDAsCiAgICAgIGRlbHRhSDogMCwKICAgICAgbGFiZWw6ICJDcm9wIE1hc2siCiAgICB9LCB7CiAgICAgIG5hbWU6ICJudyIsCiAgICAgIHhNdWw6IDAsCiAgICAgIHlNdWw6IDAsCiAgICAgIGRlbHRhWDogMSwKICAgICAgZGVsdGFZOiAxLAogICAgICBkZWx0YVc6IC0xLAogICAgICBkZWx0YUg6IC0xLAogICAgICBsYWJlbDogIlRvcCBMZWZ0IENyb3AgSGFuZGxlIgogICAgfSwgewogICAgICBuYW1lOiAibmUiLAogICAgICB4TXVsOiAxLAogICAgICB5TXVsOiAwLAogICAgICBkZWx0YVg6IDAsCiAgICAgIGRlbHRhWTogMSwKICAgICAgZGVsdGFXOiAxLAogICAgICBkZWx0YUg6IC0xLAogICAgICBsYWJlbDogIlRvcCBSaWdodCBDcm9wIEhhbmRsZSIKICAgIH0sIHsKICAgICAgbmFtZTogInN3IiwKICAgICAgeE11bDogMCwKICAgICAgeU11bDogMSwKICAgICAgZGVsdGFYOiAxLAogICAgICBkZWx0YVk6IDAsCiAgICAgIGRlbHRhVzogLTEsCiAgICAgIGRlbHRhSDogMSwKICAgICAgbGFiZWw6ICJCb3R0b20gTGVmdCBDcm9wIEhhbmRsZSIKICAgIH0sIHsKICAgICAgbmFtZTogInNlIiwKICAgICAgeE11bDogMSwKICAgICAgeU11bDogMSwKICAgICAgZGVsdGFYOiAwLAogICAgICBkZWx0YVk6IDAsCiAgICAgIGRlbHRhVzogMSwKICAgICAgZGVsdGFIOiAxLAogICAgICBsYWJlbDogIkJvdHRvbSBSaWdodCBDcm9wIEhhbmRsZSIKICAgIH1dLAogICAgICAgIG0gPSBbInRvcCIsICJyaWdodCIsICJib3R0b20iLCAibGVmdCJdLAogICAgICAgIGcgPSBmdW5jdGlvbiBnKHQpIHsKICAgICAgdmFyIG47CiAgICAgIGkoKG4gPSBsLCB7CiAgICAgICAgeDogdC54ICsgbi54LAogICAgICAgIHk6IHQueSArIG4ueSwKICAgICAgICB3OiB0LncsCiAgICAgICAgaDogdC5oCiAgICAgIH0pKTsKICAgIH07CgogICAgR1MoJzxkaXYgaWQ9IicgKyBjICsgJyIgY2xhc3M9IicgKyBhICsgJ2Nyb3ByZWN0LWNvbnRhaW5lciIgcm9sZT0iZ3JpZCIgYXJpYS1kcm9wZWZmZWN0PSJleGVjdXRlIj4nKS5hcHBlbmRUbyhvKSwgYVMuZWFjaChtLCBmdW5jdGlvbiAodCkgewogICAgICBHUygiIyIgKyBjLCBvKS5hcHBlbmQoJzxkaXYgaWQ9IicgKyBjICsgIi0iICsgdCArICciY2xhc3M9IicgKyBhICsgJ2Nyb3ByZWN0LWJsb2NrIiBzdHlsZT0iZGlzcGxheTogbm9uZSIgZGF0YS1tY2UtYm9ndXM9ImFsbCI+Jyk7CiAgICB9KSwgYVMuZWFjaChkLCBmdW5jdGlvbiAodCkgewogICAgICBHUygiIyIgKyBjLCBvKS5hcHBlbmQoJzxkaXYgaWQ9IicgKyBjICsgIi0iICsgdC5uYW1lICsgJyIgY2xhc3M9IicgKyBhICsgImNyb3ByZWN0LWhhbmRsZSAiICsgYSArICJjcm9wcmVjdC1oYW5kbGUtIiArIHQubmFtZSArICcic3R5bGU9ImRpc3BsYXk6IG5vbmUiIGRhdGEtbWNlLWJvZ3VzPSJhbGwiIHJvbGU9ImdyaWRjZWxsIiB0YWJpbmRleD0iLTEiIGFyaWEtbGFiZWw9IicgKyB0LmxhYmVsICsgJyIgYXJpYS1ncmFiYmVkPSJmYWxzZSIgdGl0bGU9IicgKyB0LmxhYmVsICsgJyI+Jyk7CiAgICB9KSwgdCA9IGFTLm1hcChkLCBmdW5jdGlvbiAobikgewogICAgICB2YXIgZTsKICAgICAgcmV0dXJuIHFTKGMsIHsKICAgICAgICBkb2N1bWVudDogby5vd25lckRvY3VtZW50LAogICAgICAgIGhhbmRsZTogYyArICItIiArIG4ubmFtZSwKICAgICAgICBzdGFydDogZnVuY3Rpb24gc3RhcnQoKSB7CiAgICAgICAgICBlID0gczsKICAgICAgICB9LAogICAgICAgIGRyYWc6IGZ1bmN0aW9uIGRyYWcodCkgewogICAgICAgICAgdShuLCBlLCB0LmRlbHRhWCwgdC5kZWx0YVkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KSwgbihzKSwgR1Mobykub24oImZvY3VzaW4gZm9jdXNvdXQiLCBmdW5jdGlvbiAodCkgewogICAgICBHUyh0LnRhcmdldCkuYXR0cigiYXJpYS1ncmFiYmVkIiwgImZvY3VzIiA9PT0gdC50eXBlID8gInRydWUiIDogImZhbHNlIik7CiAgICB9KSwgR1Mobykub24oImtleWRvd24iLCBmdW5jdGlvbiAobikgewogICAgICB2YXIgaTsKCiAgICAgIGZ1bmN0aW9uIHQodCwgbiwgZSwgbywgcikgewogICAgICAgIHQuc3RvcFByb3BhZ2F0aW9uKCksIHQucHJldmVudERlZmF1bHQoKSwgdShpLCBlLCBvLCByKTsKICAgICAgfQoKICAgICAgc3dpdGNoIChhUy5lYWNoKGQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaWYgKG4udGFyZ2V0LmlkID09PSBjICsgIi0iICsgdC5uYW1lKSByZXR1cm4gaSA9IHQsICExOwogICAgICB9KSwgbi5rZXlDb2RlKSB7CiAgICAgICAgY2FzZSBZUy5MRUZUOgogICAgICAgICAgdChuLCAwLCBzLCAtMTAsIDApOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgWVMuUklHSFQ6CiAgICAgICAgICB0KG4sIDAsIHMsIDEwLCAwKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIFlTLlVQOgogICAgICAgICAgdChuLCAwLCBzLCAwLCAtMTApOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgWVMuRE9XTjoKICAgICAgICAgIHQobiwgMCwgcywgMCwgMTApOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgWVMuRU5URVI6CiAgICAgICAgY2FzZSBZUy5TUEFDRUJBUjoKICAgICAgICAgIG4ucHJldmVudERlZmF1bHQoKSwgcigpOwogICAgICB9CiAgICB9KTsKICAgIHZhciBwID0gYVMuZXh0ZW5kKHsKICAgICAgdG9nZ2xlVmlzaWJpbGl0eTogZnVuY3Rpb24gdG9nZ2xlVmlzaWJpbGl0eSh0KSB7CiAgICAgICAgdmFyIG4gPSBhUy5tYXAoZCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAiIyIgKyBjICsgIi0iICsgdC5uYW1lOwogICAgICAgIH0pLmNvbmNhdChhUy5tYXAobSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAiIyIgKyBjICsgIi0iICsgdDsKICAgICAgICB9KSkuam9pbigiLCIpOwogICAgICAgIHQgPyBHUyhuLCBvKS5zaG93KCkgOiBHUyhuLCBvKS5oaWRlKCk7CiAgICAgIH0sCiAgICAgIHNldENsYW1wUmVjdDogZnVuY3Rpb24gc2V0Q2xhbXBSZWN0KHQpIHsKICAgICAgICBsID0gdCwgbihzKTsKICAgICAgfSwKICAgICAgc2V0UmVjdDogaSwKICAgICAgZ2V0SW5uZXJSZWN0OiBmdW5jdGlvbiBnZXRJbm5lclJlY3QoKSB7CiAgICAgICAgcmV0dXJuIGYobCwgcyk7CiAgICAgIH0sCiAgICAgIHNldElubmVyUmVjdDogZywKICAgICAgc2V0Vmlld1BvcnRSZWN0OiBmdW5jdGlvbiBzZXRWaWV3UG9ydFJlY3QodCkgewogICAgICAgIGUgPSB0LCBuKHMpOwogICAgICB9LAogICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgIGFTLmVhY2godCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHQuZGVzdHJveSgpOwogICAgICAgIH0pLCB0ID0gW107CiAgICAgIH0KICAgIH0sIFhTKTsKICAgIHJldHVybiBwOwogIH07CgogIGZ1bmN0aW9uIFpTKHQpIHsKICAgIHZhciBlLAogICAgICAgIG8sCiAgICAgICAgbiwKICAgICAgICByLAogICAgICAgIGkgPSBWbyh0KSwKICAgICAgICB1ID0gZGMoKSwKICAgICAgICBhID0gKG8gPSAtMSwgewogICAgICBkYXRhOiBlID0gW10sCiAgICAgIGFkZDogZnVuY3Rpb24gYWRkKHQpIHsKICAgICAgICB2YXIgbiA9IGUuc3BsaWNlKCsrbyk7CiAgICAgICAgcmV0dXJuIGUucHVzaCh0KSwgewogICAgICAgICAgc3RhdGU6IHQsCiAgICAgICAgICByZW1vdmVkOiBuCiAgICAgICAgfTsKICAgICAgfSwKICAgICAgdW5kbzogZnVuY3Rpb24gdW5kbygpIHsKICAgICAgICBpZiAobigpKSByZXR1cm4gZVstLW9dOwogICAgICB9LAogICAgICByZWRvOiBmdW5jdGlvbiByZWRvKCkgewogICAgICAgIGlmIChyKCkpIHJldHVybiBlWysrb107CiAgICAgIH0sCiAgICAgIGNhblVuZG86IG4gPSBmdW5jdGlvbiBuKCkgewogICAgICAgIHJldHVybiAwIDwgbzsKICAgICAgfSwKICAgICAgY2FuUmVkbzogciA9IGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgcmV0dXJuIC0xICE9PSBvICYmIG8gPCBlLmxlbmd0aCAtIDE7CiAgICAgIH0KICAgIH0pOwoKICAgIGZ1bmN0aW9uIGModCkgewogICAgICBpLnNldCh0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzKHQpIHsKICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh0LnVybCk7CiAgICB9CgogICAgZnVuY3Rpb24gbCh0KSB7CiAgICAgIHZhciBuID0gZih0KTsKICAgICAgYyhuKTsKICAgICAgdmFyIGUgPSBhLmFkZChuKS5yZW1vdmVkOwogICAgICByZXR1cm4gYVMuZWFjaChlLCBzKSwgbi51cmw7CiAgICB9CgogICAgYS5hZGQodCk7CgogICAgZnVuY3Rpb24gZih0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYmxvYjogdCwKICAgICAgICB1cmw6IFVSTC5jcmVhdGVPYmplY3RVUkwodCkKICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBkKCkgewogICAgICB1Lm9uKHMpLCB1LmNsZWFyKCk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgZ2V0QmxvYlN0YXRlOiBmdW5jdGlvbiBnZXRCbG9iU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIGkuZ2V0KCk7CiAgICAgIH0sCiAgICAgIHNldEJsb2JTdGF0ZTogYywKICAgICAgYWRkQmxvYlN0YXRlOiBsLAogICAgICBnZXRUZW1wU3RhdGU6IGZ1bmN0aW9uIGdldFRlbXBTdGF0ZSgpIHsKICAgICAgICByZXR1cm4gdS5nZXQoKS5nZXRPclRodW5rKGkuZ2V0KTsKICAgICAgfSwKICAgICAgdXBkYXRlVGVtcFN0YXRlOiBmdW5jdGlvbiB1cGRhdGVUZW1wU3RhdGUodCkgewogICAgICAgIHZhciBuID0gZih0KTsKICAgICAgICByZXR1cm4gZCgpLCB1LnNldChuKSwgbi51cmw7CiAgICAgIH0sCiAgICAgIGFkZFRlbXBTdGF0ZTogZnVuY3Rpb24gYWRkVGVtcFN0YXRlKHQpIHsKICAgICAgICB2YXIgbiA9IGYodCk7CiAgICAgICAgcmV0dXJuIHUuc2V0KG4pLCBuLnVybDsKICAgICAgfSwKICAgICAgYXBwbHlUZW1wU3RhdGU6IGZ1bmN0aW9uIGFwcGx5VGVtcFN0YXRlKG4pIHsKICAgICAgICByZXR1cm4gdS5nZXQoKS5mb2xkKHN0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgbCh0LmJsb2IpLCBuKCk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGRlc3Ryb3lUZW1wU3RhdGU6IGQsCiAgICAgIHVuZG86IGZ1bmN0aW9uIHVuZG8oKSB7CiAgICAgICAgdmFyIHQgPSBhLnVuZG8oKTsKICAgICAgICByZXR1cm4gYyh0KSwgdC51cmw7CiAgICAgIH0sCiAgICAgIHJlZG86IGZ1bmN0aW9uIHJlZG8oKSB7CiAgICAgICAgdmFyIHQgPSBhLnJlZG8oKTsKICAgICAgICByZXR1cm4gYyh0KSwgdC51cmw7CiAgICAgIH0sCiAgICAgIGdldEhpc3RvcnlTdGF0ZXM6IGZ1bmN0aW9uIGdldEhpc3RvcnlTdGF0ZXMoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHVuZG9FbmFibGVkOiBhLmNhblVuZG8oKSwKICAgICAgICAgIHJlZG9FbmFibGVkOiBhLmNhblJlZG8oKQogICAgICAgIH07CiAgICAgIH0KICAgIH07CiAgfQoKICBmdW5jdGlvbiB0Qyh0LCBuKSB7CiAgICBmdW5jdGlvbiBpKHQpIHsKICAgICAgdmFyIG4gPSBiLmdldEhpc3RvcnlTdGF0ZXMoKTsKICAgICAgUy51cGRhdGVCdXR0b25VbmRvU3RhdGVzKHQsIG4udW5kb0VuYWJsZWQsIG4ucmVkb0VuYWJsZWQpLCB2cih0LCBVUy5mb3JtQWN0aW9uRXZlbnQsIHsKICAgICAgICBuYW1lOiBVUy5zYXZlU3RhdGUoKSwKICAgICAgICB2YWx1ZTogbi51bmRvRW5hYmxlZAogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiB1KHQpIHsKICAgICAgcmV0dXJuIHQudG9CbG9iKCk7CiAgICB9CgogICAgZnVuY3Rpb24gYSh0KSB7CiAgICAgIHZyKHQsIFVTLmZvcm1BY3Rpb25FdmVudCwgewogICAgICAgIG5hbWU6IFVTLmRpc2FibGUoKSwKICAgICAgICB2YWx1ZToge30KICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gYyhuLCB0LCBlLCBvLCByKSB7CiAgICAgIGEobiksIHkwKHQpLnRoZW4oZSkudGhlbih1KS50aGVuKG8pLnRoZW4oZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4geChuLCB0KTsKICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgaShuKSwgcigpLCB5KG4pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAodCkgewogICAgICAgIGNvbnNvbGUubG9nKHQpLCBuLmdldFN5c3RlbSgpLmlzQ29ubmVjdGVkKCkgJiYgeShuKTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gcih0LCBuLCBlKSB7CiAgICAgIGModCwgYi5nZXRCbG9iU3RhdGUoKS5ibG9iLCBuLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBiLnVwZGF0ZVRlbXBTdGF0ZSh0KTsKICAgICAgfSwgZSk7CiAgICB9CgogICAgZnVuY3Rpb24gcyh0KSB7CiAgICAgIHZhciBuID0gYi5nZXRCbG9iU3RhdGUoKS51cmw7CiAgICAgIHJldHVybiBiLmRlc3Ryb3lUZW1wU3RhdGUoKSwgaSh0KSwgbjsKICAgIH0KCiAgICB2YXIgZSwKICAgICAgICBvLAogICAgICAgIGwsCiAgICAgICAgZiwKICAgICAgICBkLAogICAgICAgIG0sCiAgICAgICAgZywKICAgICAgICBwLAogICAgICAgIGgsCiAgICAgICAgdiwKICAgICAgICBiID0gWlModC5jdXJyZW50U3RhdGUpLAogICAgICAgIHkgPSBmdW5jdGlvbiB5KHQpIHsKICAgICAgQy5nZXRBcHBseUJ1dHRvbih0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgZGQuZW5hYmxlKHQpOwogICAgICB9KSwgdnIodCwgVVMuZm9ybUFjdGlvbkV2ZW50LCB7CiAgICAgICAgbmFtZTogVVMuZW5hYmxlKCksCiAgICAgICAgdmFsdWU6IHt9CiAgICAgIH0pOwogICAgfSwKICAgICAgICB4ID0gZnVuY3Rpb24geCh0LCBuKSB7CiAgICAgIHJldHVybiBhKHQpLCB3LnVwZGF0ZVNyYyh0LCBuKTsKICAgIH0sCiAgICAgICAgdyA9IChmID0gdC5jdXJyZW50U3RhdGUudXJsLCBkID0gUG0oewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LWltYWdlLXRvb2xzX19pbWFnZS1iZyJdLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHJvbGU6ICJwcmVzZW50YXRpb24iCiAgICAgICAgfQogICAgICB9CiAgICB9KSwgbSA9IFZvKDEpLCBnID0gZGMoKSwgcCA9IFZvKHsKICAgICAgeDogMCwKICAgICAgeTogMCwKICAgICAgdzogMSwKICAgICAgaDogMQogICAgfSksIGggPSBWbyh7CiAgICAgIHg6IDAsCiAgICAgIHk6IDAsCiAgICAgIHc6IDEsCiAgICAgIGg6IDEKICAgIH0pLCB7CiAgICAgIG1lbUNvbnRhaW5lcjogdiA9IFBtKHV5LnNrZXRjaCh7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtaW1hZ2UtdG9vbHNfX2ltYWdlIl0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IFtkLmFzU3BlYygpLCB7CiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAiaW1nIiwKICAgICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICAgIHNyYzogZgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgewogICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgIHRhZzogImRpdiIKICAgICAgICAgIH0sCiAgICAgICAgICBiZWhhdmlvdXJzOiB0YyhbZm0oImltYWdlLXBhbmVsLWNyb3AtZXZlbnRzIiwgW2V1KGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHYuZ2V0T3B0KHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICB2YXIgbiA9IHQuZWxlbWVudC5kb20sCiAgICAgICAgICAgICAgICAgIGUgPSBRUyh7CiAgICAgICAgICAgICAgICB4OiAxMCwKICAgICAgICAgICAgICAgIHk6IDEwLAogICAgICAgICAgICAgICAgdzogMTAwLAogICAgICAgICAgICAgICAgaDogMTAwCiAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgICAgICB3OiAyMDAsCiAgICAgICAgICAgICAgICBoOiAyMDAKICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICB4OiAwLAogICAgICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgICAgIHc6IDIwMCwKICAgICAgICAgICAgICAgIGg6IDIwMAogICAgICAgICAgICAgIH0sIG4sIHN0KTsKICAgICAgICAgICAgICBlLnRvZ2dsZVZpc2liaWxpdHkoITEpLCBlLm9uKCJ1cGRhdGVSZWN0IiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHZhciBuID0gdC5yZWN0LAogICAgICAgICAgICAgICAgICAgIGUgPSBtLmdldCgpLAogICAgICAgICAgICAgICAgICAgIG8gPSB7CiAgICAgICAgICAgICAgICAgIHg6IE1hdGgucm91bmQobi54IC8gZSksCiAgICAgICAgICAgICAgICAgIHk6IE1hdGgucm91bmQobi55IC8gZSksCiAgICAgICAgICAgICAgICAgIHc6IE1hdGgucm91bmQobi53IC8gZSksCiAgICAgICAgICAgICAgICAgIGg6IE1hdGgucm91bmQobi5oIC8gZSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBwLnNldChvKTsKICAgICAgICAgICAgICB9KSwgZy5zZXQoZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSldKV0pCiAgICAgICAgfV0sCiAgICAgICAgY29udGFpbmVyQmVoYXZpb3VyczogdGMoW0ZnLmNvbmZpZyh7fSksIGZtKCJpbWFnZS1wYW5lbC1ldmVudHMiLCBbZXUoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIE8odCwgZik7CiAgICAgICAgfSldKV0pCiAgICAgIH0pKSwKICAgICAgdXBkYXRlU3JjOiBPLAogICAgICB6b29tOiBmdW5jdGlvbiB6b29tKHQsIG4pIHsKICAgICAgICB2YXIgZSA9IG0uZ2V0KCksCiAgICAgICAgICAgIG8gPSAwIDwgbiA/IE1hdGgubWluKDIsIGUgKyAuMSkgOiBNYXRoLm1heCguMSwgZSAtIC4xKTsKICAgICAgICBtLnNldChvKSwgdi5nZXRPcHQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIG4gPSB0LmNvbXBvbmVudHMoKVsxXS5lbGVtZW50OwogICAgICAgICAgayh0LCBuKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgc2hvd0Nyb3A6IGZ1bmN0aW9uIHNob3dDcm9wKCkgewogICAgICAgIGcub24oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHQudG9nZ2xlVmlzaWJpbGl0eSghMCk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGhpZGVDcm9wOiBmdW5jdGlvbiBoaWRlQ3JvcCgpIHsKICAgICAgICBnLm9uKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB0LnRvZ2dsZVZpc2liaWxpdHkoITEpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBnZXRSZWN0OiBmdW5jdGlvbiBnZXRSZWN0KCkgewogICAgICAgIHJldHVybiBwLmdldCgpOwogICAgICB9LAogICAgICBnZXRNZWFzdXJlbWVudHM6IGZ1bmN0aW9uIGdldE1lYXN1cmVtZW50cygpIHsKICAgICAgICB2YXIgdCA9IGguZ2V0KCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHdpZHRoOiB0LncsCiAgICAgICAgICBoZWlnaHQ6IHQuaAogICAgICAgIH07CiAgICAgIH0KICAgIH0pLAogICAgICAgIFMgPSAobyA9IFBtKEtTKCJVbmRvIiwgInVuZG8iLCAhMCwgZnVuY3Rpb24gKHQpIHsKICAgICAgdnIodCwgelMudW5kbygpLCB7CiAgICAgICAgZGlyZWN0aW9uOiAxCiAgICAgIH0pOwogICAgfSwgZSA9IG4pKSwgbCA9IFBtKEtTKCJSZWRvIiwgInJlZG8iLCAhMCwgZnVuY3Rpb24gKHQpIHsKICAgICAgdnIodCwgelMucmVkbygpLCB7CiAgICAgICAgZGlyZWN0aW9uOiAxCiAgICAgIH0pOwogICAgfSwgZSkpLCB7CiAgICAgIGNvbnRhaW5lcjogdXkuc2tldGNoKHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1pbWFnZS10b29sc19fdG9vbGJhciIsICJ0b3gtaW1hZ2UtdG9vbHNfX3NpZGViYXIiXQogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogW28uYXNTcGVjKCksIGwuYXNTcGVjKCksIEtTKCJab29tIGluIiwgInpvb20taW4iLCAhMSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZyKHQsIHpTLnpvb20oKSwgewogICAgICAgICAgICBkaXJlY3Rpb246IDEKICAgICAgICAgIH0pOwogICAgICAgIH0sIGUpLCBLUygiWm9vbSBvdXQiLCAiem9vbS1vdXQiLCAhMSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZyKHQsIHpTLnpvb20oKSwgewogICAgICAgICAgICBkaXJlY3Rpb246IC0xCiAgICAgICAgICB9KTsKICAgICAgICB9LCBlKV0KICAgICAgfSksCiAgICAgIHVwZGF0ZUJ1dHRvblVuZG9TdGF0ZXM6IGZ1bmN0aW9uIHVwZGF0ZUJ1dHRvblVuZG9TdGF0ZXModCwgbiwgZSkgewogICAgICAgIG8uZ2V0T3B0KHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIEpTKHQsIG4pOwogICAgICAgIH0pLCBsLmdldE9wdCh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBKUyh0LCBlKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSksCiAgICAgICAgQyA9IHR3KHcsIG4pOwoKICAgIGZ1bmN0aW9uIGsodCwgcykgewogICAgICB2LmdldE9wdCh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIGUgPSBtLmdldCgpLAogICAgICAgICAgICBvID0ga24odC5lbGVtZW50KSwKICAgICAgICAgICAgciA9IHhuKHQuZWxlbWVudCksCiAgICAgICAgICAgIGkgPSBzLmRvbS5uYXR1cmFsV2lkdGggKiBlLAogICAgICAgICAgICB1ID0gcy5kb20ubmF0dXJhbEhlaWdodCAqIGUsCiAgICAgICAgICAgIGEgPSBNYXRoLm1heCgwLCBvIC8gMiAtIGkgLyAyKSwKICAgICAgICAgICAgYyA9IE1hdGgubWF4KDAsIHIgLyAyIC0gdSAvIDIpLAogICAgICAgICAgICBuID0gewogICAgICAgICAgbGVmdDogYS50b1N0cmluZygpICsgInB4IiwKICAgICAgICAgIHRvcDogYy50b1N0cmluZygpICsgInB4IiwKICAgICAgICAgIHdpZHRoOiBpLnRvU3RyaW5nKCkgKyAicHgiLAogICAgICAgICAgaGVpZ2h0OiB1LnRvU3RyaW5nKCkgKyAicHgiLAogICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIKICAgICAgICB9OwogICAgICAgIGRuKHMsIG4pLCBkLmdldE9wdCh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBkbih0LmVsZW1lbnQsIG4pOwogICAgICAgIH0pLCBnLm9uKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgbiA9IHAuZ2V0KCk7CiAgICAgICAgICB0LnNldFJlY3QoewogICAgICAgICAgICB4OiBuLnggKiBlICsgYSwKICAgICAgICAgICAgeTogbi55ICogZSArIGMsCiAgICAgICAgICAgIHc6IG4udyAqIGUsCiAgICAgICAgICAgIGg6IG4uaCAqIGUKICAgICAgICAgIH0pLCB0LnNldENsYW1wUmVjdCh7CiAgICAgICAgICAgIHg6IGEsCiAgICAgICAgICAgIHk6IGMsCiAgICAgICAgICAgIHc6IGksCiAgICAgICAgICAgIGg6IHUKICAgICAgICAgIH0pLCB0LnNldFZpZXdQb3J0UmVjdCh7CiAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgIHc6IG8sCiAgICAgICAgICAgIGg6IHIKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBPKHQsIG4pIHsKICAgICAgdmFyIGUsCiAgICAgICAgICBpID0gQXQuZnJvbVRhZygiaW1nIik7CiAgICAgIHJldHVybiBvbihpLCAic3JjIiwgbiksIGUgPSBpLmRvbSwgbmV3IEJwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSBmdW5jdGlvbiBuKCkgewogICAgICAgICAgZS5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkIiwgbiksIHQoZSk7CiAgICAgICAgfTsKCiAgICAgICAgZS5jb21wbGV0ZSA/IHQoZSkgOiBlLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCBuKTsKICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgdC5nZXRTeXN0ZW0oKS5pc0Nvbm5lY3RlZCgpICYmIHYuZ2V0T3B0KHQpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIG4gPSBrdSh7CiAgICAgICAgICAgIGVsZW1lbnQ6IGkKICAgICAgICAgIH0pOwogICAgICAgICAgRmcucmVwbGFjZUF0KHQsIDEsIHZ0LnNvbWUobikpOwogICAgICAgICAgdmFyIGUgPSBoLmdldCgpLAogICAgICAgICAgICAgIG8gPSB7CiAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgIHc6IGkuZG9tLm5hdHVyYWxXaWR0aCwKICAgICAgICAgICAgaDogaS5kb20ubmF0dXJhbEhlaWdodAogICAgICAgICAgfTsKICAgICAgICAgIGguc2V0KG8pOwogICAgICAgICAgdmFyIHUsCiAgICAgICAgICAgICAgciA9IGpTLmluZmxhdGUobywgLTIwLCAtMjApOwogICAgICAgICAgcC5zZXQociksIGUudyA9PT0gby53ICYmIGUuaCA9PT0gby5oIHx8ICh1ID0gaSwgdi5nZXRPcHQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICB2YXIgbiA9IGtuKHQuZWxlbWVudCksCiAgICAgICAgICAgICAgICBlID0geG4odC5lbGVtZW50KSwKICAgICAgICAgICAgICAgIG8gPSB1LmRvbS5uYXR1cmFsV2lkdGgsCiAgICAgICAgICAgICAgICByID0gdS5kb20ubmF0dXJhbEhlaWdodCwKICAgICAgICAgICAgICAgIGkgPSBNYXRoLm1pbihuIC8gbywgZSAvIHIpOwogICAgICAgICAgICAxIDw9IGkgPyBtLnNldCgxKSA6IG0uc2V0KGkpOwogICAgICAgICAgfSkpLCBrKHQsIGkpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHJvbGU6ICJwcmVzZW50YXRpb24iCiAgICAgICAgfQogICAgICB9LAogICAgICBjb21wb25lbnRzOiBbQy5tZW1Db250YWluZXIuYXNTcGVjKCksIHcubWVtQ29udGFpbmVyLmFzU3BlYygpLCBTLmNvbnRhaW5lcl0sCiAgICAgIGJlaGF2aW91cnM6IHRjKFtUZi5jb25maWcoewogICAgICAgIHN0b3JlOiB7CiAgICAgICAgICBtb2RlOiAibWFudWFsIiwKICAgICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGIuZ2V0QmxvYlN0YXRlKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KSwgZm0oImltYWdlLXRvb2xzLWV2ZW50cyIsIFtDcih6Uy51bmRvKCksIGZ1bmN0aW9uIChuLCB0KSB7CiAgICAgICAgdmFyIGUgPSBiLnVuZG8oKTsKICAgICAgICB4KG4sIGUpLnRoZW4oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHkobiksIGkobik7CiAgICAgICAgfSk7CiAgICAgIH0pLCBDcih6Uy5yZWRvKCksIGZ1bmN0aW9uIChuLCB0KSB7CiAgICAgICAgdmFyIGUgPSBiLnJlZG8oKTsKICAgICAgICB4KG4sIGUpLnRoZW4oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHkobiksIGkobik7CiAgICAgICAgfSk7CiAgICAgIH0pLCBDcih6Uy56b29tKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgdmFyIGUgPSBuLmV2ZW50LmRpcmVjdGlvbjsKICAgICAgICB3Lnpvb20odCwgZSk7CiAgICAgIH0pLCBDcih6Uy5iYWNrKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIG8gPSBzKGUgPSB0KTsKICAgICAgICB4KGUsIG8pLnRoZW4oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHkoZSk7CiAgICAgICAgfSksICgwLCBuLmV2ZW50LnN3YXApKCksIHcuaGlkZUNyb3AoKTsKICAgICAgfSksIENyKHpTLmFwcGx5KCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgYi5hcHBseVRlbXBTdGF0ZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBzKHQpLCAoMCwgbi5ldmVudC5zd2FwKSgpOwogICAgICAgIH0pOwogICAgICB9KSwgQ3IoelMudHJhbnNmb3JtKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgcmV0dXJuIHIodCwgbi5ldmVudC50cmFuc2Zvcm0sIHN0KTsKICAgICAgfSksIENyKHpTLnRlbXBUcmFuc2Zvcm0oKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICB2YXIgZSA9IG4uZXZlbnQudHJhbnNmb3JtOwogICAgICAgIGModCwgYi5nZXRUZW1wU3RhdGUoKS5ibG9iLCBlLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGIuYWRkVGVtcFN0YXRlKHQpOwogICAgICAgIH0sIHN0KTsKICAgICAgfSksIENyKHpTLnRyYW5zZm9ybUFwcGx5KCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgdmFyIGUgPSB0LAogICAgICAgICAgICBvID0gbi5ldmVudC50cmFuc2Zvcm0sCiAgICAgICAgICAgIHIgPSBuLmV2ZW50LnN3YXAsCiAgICAgICAgICAgIGkgPSBiLmdldEJsb2JTdGF0ZSgpLmJsb2I7CiAgICAgICAgYyhlLCBpLCBvLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIG4gPSBiLmFkZEJsb2JTdGF0ZSh0KTsKICAgICAgICAgIHJldHVybiBzKGUpLCBuOwogICAgICAgIH0sIHIpOwogICAgICB9KSwgQ3IoelMuc3dhcCgpLCBmdW5jdGlvbiAobiwgdCkgewogICAgICAgIFMudXBkYXRlQnV0dG9uVW5kb1N0YXRlcyhuLCAhMSwgITEpOwogICAgICAgIHZhciBlID0gdC5ldmVudC50cmFuc2Zvcm0sCiAgICAgICAgICAgIG8gPSB0LmV2ZW50LnN3YXA7CiAgICAgICAgZS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG8oKTsKICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcihuLCB0LCBvKTsKICAgICAgICB9KTsKICAgICAgfSldKSwgb3coKV0pCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gbkModCkgewogICAgcmV0dXJuICFUdCh0LCAiaXRlbXMiKTsKICB9CgogIGZ1bmN0aW9uIGVDKHQsIG4pIHsKICAgIGZ1bmN0aW9uIGUodCkgewogICAgICByZXR1cm4gewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAidGQiLAogICAgICAgICAgaW5uZXJIdG1sOiBuLnRyYW5zbGF0ZSh0KQogICAgICAgIH0KICAgICAgfTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJ0YWJsZSIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtZGlhbG9nX190YWJsZSJdCiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IFt7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJ0aGVhZCIKICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IFt7CiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAidHIiCiAgICAgICAgICB9LAogICAgICAgICAgY29tcG9uZW50czogTSh0LmhlYWRlciwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICAgIHRhZzogInRoIiwKICAgICAgICAgICAgICAgIGlubmVySHRtbDogbi50cmFuc2xhdGUodCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KQogICAgICAgIH1dCiAgICAgIH0sIHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogInRib2R5IgogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogTSh0LmNlbGxzLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgICAgdGFnOiAidHIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbXBvbmVudHM6IE0odCwgZSkKICAgICAgICAgIH07CiAgICAgICAgfSkKICAgICAgfV0sCiAgICAgIGJlaGF2aW91cnM6IHRjKFtmeS5jb25maWcoe30pLCBWZy5jb25maWcoe30pXSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBvQyhlLCBuKSB7CiAgICB2YXIgdCA9IGUubGFiZWwubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBaYih0LCBuKTsKICAgIH0pLAogICAgICAgIG8gPSBbZGQuY29uZmlnKHsKICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uIGRpc2FibGVkKCkgewogICAgICAgIHJldHVybiBlLmRpc2FibGVkIHx8IG4uaXNEaXNhYmxlZCgpOwogICAgICB9CiAgICB9KSwgbXYoKSwgTWcuY29uZmlnKHsKICAgICAgbW9kZTogImV4ZWN1dGlvbiIsCiAgICAgIHVzZUVudGVyOiAhMCAhPT0gZS5tdWx0aWxpbmUsCiAgICAgIHVzZUNvbnRyb2xFbnRlcjogITAgPT09IGUubXVsdGlsaW5lLAogICAgICBleGVjdXRlOiBmdW5jdGlvbiBleGVjdXRlKHQpIHsKICAgICAgICByZXR1cm4gaHIodCwgeXkpLCB2dC5zb21lKCEwKTsKICAgICAgfQogICAgfSksIGZtKCJ0ZXh0ZmllbGQtY2hhbmdlIiwgW0NyKHdpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHZyKHQsIHB5LCB7CiAgICAgICAgbmFtZTogZS5uYW1lCiAgICAgIH0pOwogICAgfSksIENyKE1pKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHZyKHQsIHB5LCB7CiAgICAgICAgbmFtZTogZS5uYW1lCiAgICAgIH0pOwogICAgfSldKSwgZnkuY29uZmlnKHt9KV0sCiAgICAgICAgciA9IGUudmFsaWRhdGlvbi5tYXAoZnVuY3Rpb24gKG8pIHsKICAgICAgcmV0dXJuIEd5LmNvbmZpZyh7CiAgICAgICAgZ2V0Um9vdDogZnVuY3Rpb24gZ2V0Um9vdCh0KSB7CiAgICAgICAgICByZXR1cm4gWXQodC5lbGVtZW50KTsKICAgICAgICB9LAogICAgICAgIGludmFsaWRDbGFzczogInRveC1pbnZhbGlkIiwKICAgICAgICB2YWxpZGF0b3I6IHsKICAgICAgICAgIHZhbGlkYXRlOiBmdW5jdGlvbiB2YWxpZGF0ZSh0KSB7CiAgICAgICAgICAgIHZhciBuID0gVGYuZ2V0VmFsdWUodCksCiAgICAgICAgICAgICAgICBlID0gby52YWxpZGF0b3Iobik7CiAgICAgICAgICAgIHJldHVybiBMeSghMCA9PT0gZSA/IFJlLnZhbHVlKG4pIDogUmUuZXJyb3IoZSkpOwogICAgICAgICAgfSwKICAgICAgICAgIHZhbGlkYXRlT25Mb2FkOiBvLnZhbGlkYXRlT25Mb2FkCiAgICAgICAgfQogICAgICB9KTsKICAgIH0pLnRvQXJyYXkoKSwKICAgICAgICBpID0gZS5wbGFjZWhvbGRlci5mb2xkKHJ0KHt9KSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBwbGFjZWhvbGRlcjogbi50cmFuc2xhdGUodCkKICAgICAgfTsKICAgIH0pLAogICAgICAgIHUgPSBlLmlucHV0TW9kZS5mb2xkKHJ0KHt9KSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBpbnB1dG1vZGU6IHQKICAgICAgfTsKICAgIH0pLAogICAgICAgIGEgPSBfbHQoX2x0KHt9LCBpKSwgdSk7CgogICAgcmV0dXJuIFFiKHQsIHN5LnBhcnRzLmZpZWxkKHsKICAgICAgdGFnOiAhMCA9PT0gZS5tdWx0aWxpbmUgPyAidGV4dGFyZWEiIDogImlucHV0IiwKICAgICAgaW5wdXRBdHRyaWJ1dGVzOiBhLAogICAgICBpbnB1dENsYXNzZXM6IFtlLmNsYXNzbmFtZV0sCiAgICAgIGlucHV0QmVoYXZpb3VyczogdGMoZnQoW28sIHJdKSksCiAgICAgIHNlbGVjdE9uRm9jdXM6ICExLAogICAgICBmYWN0b3J5OiBPeQogICAgfSksIChlLmZsZXggPyBbInRveC1mb3JtX19ncm91cC0tc3RyZXRjaGVkIl0gOiBbXSkuY29uY2F0KGUubWF4aW1pemVkID8gWyJ0b3gtZm9ybS1ncm91cC0tbWF4aW1pemUiXSA6IFtdKSwgW2RkLmNvbmZpZyh7CiAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiBkaXNhYmxlZCgpIHsKICAgICAgICByZXR1cm4gZS5kaXNhYmxlZCB8fCBuLmlzRGlzYWJsZWQoKTsKICAgICAgfSwKICAgICAgb25EaXNhYmxlZDogZnVuY3Rpb24gb25EaXNhYmxlZCh0KSB7CiAgICAgICAgc3kuZ2V0RmllbGQodCkuZWFjaChkZC5kaXNhYmxlKTsKICAgICAgfSwKICAgICAgb25FbmFibGVkOiBmdW5jdGlvbiBvbkVuYWJsZWQodCkgewogICAgICAgIHN5LmdldEZpZWxkKHQpLmVhY2goZGQuZW5hYmxlKTsKICAgICAgfQogICAgfSksIG12KCldKTsKICB9CgogIGZ1bmN0aW9uIHJDKHQpIHsKICAgIHZhciBuID0gVm8obnVsbCk7CiAgICByZXR1cm4geHUoewogICAgICByZWFkU3RhdGU6IGZ1bmN0aW9uIHJlYWRTdGF0ZSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdGltZXI6IG51bGwgIT09IG4uZ2V0KCkgPyAic2V0IiA6ICJ1bnNldCIKICAgICAgICB9OwogICAgICB9LAogICAgICBzZXRUaW1lcjogZnVuY3Rpb24gc2V0VGltZXIodCkgewogICAgICAgIG4uc2V0KHQpOwogICAgICB9LAogICAgICBjYW5jZWw6IGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgICB2YXIgdCA9IG4uZ2V0KCk7CiAgICAgICAgbnVsbCAhPT0gdCAmJiB0LmNhbmNlbCgpOwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGlDKHQsIG4sIGUpIHsKICAgIHZhciBvID0gVGYuZ2V0VmFsdWUoZSk7CiAgICBUZi5zZXRWYWx1ZShuLCBvKSwgdTEobik7CiAgfQoKICBmdW5jdGlvbiB1Qyh0LCBuKSB7CiAgICB2YXIgZSA9IHQuZWxlbWVudCwKICAgICAgICBvID0gJHIoZSksCiAgICAgICAgciA9IGUuZG9tOwogICAgIm51bWJlciIgIT09IHJuKGUsICJ0eXBlIikgJiYgbihyLCBvKTsKICB9CgogIGZ1bmN0aW9uIGFDKHQpIHsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6ICJtZW51aXRlbSIsCiAgICAgIHZhbHVlOiB0LnVybCwKICAgICAgdGV4dDogdC50aXRsZSwKICAgICAgbWV0YTogewogICAgICAgIGF0dGFjaDogdC5hdHRhY2gKICAgICAgfSwKICAgICAgb25BY3Rpb246IHN0CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gY0ModCwgbikgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogIm1lbnVpdGVtIiwKICAgICAgdmFsdWU6IG4sCiAgICAgIHRleHQ6IHQsCiAgICAgIG1ldGE6IHsKICAgICAgICBhdHRhY2g6IHZvaWQgMAogICAgICB9LAogICAgICBvbkFjdGlvbjogc3QKICAgIH07CiAgfQoKICBmdW5jdGlvbiBzQyh0LCBuKSB7CiAgICByZXR1cm4gZSA9IHQsIE0oRihuLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdC50eXBlID09PSBlOwogICAgfSksIGFDKTsKICAgIHZhciBlOwogIH0KCiAgZnVuY3Rpb24gbEModCwgbikgewogICAgdmFyIGUgPSB0LnRvTG93ZXJDYXNlKCk7CiAgICByZXR1cm4gRihuLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdXQoKHZvaWQgMCAhPT0gdC5tZXRhICYmIHZvaWQgMCAhPT0gdC5tZXRhLnRleHQgPyB0Lm1ldGEgOiB0KS50ZXh0LnRvTG93ZXJDYXNlKCksIGUpIHx8IHV0KHQudmFsdWUudG9Mb3dlckNhc2UoKSwgZSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGZDKHUsIGEsIGMpIHsKICAgIGZ1bmN0aW9uIHIodCkgewogICAgICB2YXIgbiA9IFRmLmdldFZhbHVlKHQpOwogICAgICBjLmFkZFRvSGlzdG9yeShuLnZhbHVlLCB1LmZpbGV0eXBlKTsKICAgIH0KCiAgICB2YXIgdCwKICAgICAgICBuLAogICAgICAgIGUsCiAgICAgICAgbywKICAgICAgICBpID0gYS5zaGFyZWQucHJvdmlkZXJzLAogICAgICAgIHMgPSBzeS5wYXJ0cy5maWVsZCh7CiAgICAgIGZhY3Rvcnk6IGwxLAogICAgICBkaXNtaXNzT25CbHVyOiAhMCwKICAgICAgaW5wdXRDbGFzc2VzOiBbInRveC10ZXh0ZmllbGQiXSwKICAgICAgc2FuZGJveENsYXNzZXM6IFsidG94LWRpYWxvZ19fcG9wdXBzIl0sCiAgICAgIGlucHV0QXR0cmlidXRlczogewogICAgICAgICJhcmlhLWVycm9ybWVzc2FnZSI6IGcxLAogICAgICAgIHR5cGU6ICJ1cmwiCiAgICAgIH0sCiAgICAgIG1pbkNoYXJzOiAwLAogICAgICByZXNwb25zZVRpbWU6IDAsCiAgICAgIGZldGNoOiBmdW5jdGlvbiBmZXRjaCh0KSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIG8sCiAgICAgICAgICAgIG4sCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIGkgPSB6MCgoZSA9IHUuZmlsZXR5cGUsIG8gPSBjLCBuID0gVGYuZ2V0VmFsdWUodCksIHIgPSB2b2lkIDAgIT09IG4ubWV0YS50ZXh0ID8gbi5tZXRhLnRleHQgOiBuLnZhbHVlLCBvLmdldExpbmtJbmZvcm1hdGlvbigpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgbiA9IGxDKHIsIE0oby5nZXRIaXN0b3J5KGUpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gY0ModCwgdCk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICByZXR1cm4gImZpbGUiID09PSBlID8gUihbbiwgbEMociwgc0MoImhlYWRlciIsIHQudGFyZ2V0cykpLCBsQyhyLCBmdChbdnQuZnJvbSh0LmFuY2hvclRvcCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiBjQygiPHRvcD4iLCB0KTsKICAgICAgICAgIH0pLnRvQXJyYXkoKSwgc0MoImFuY2hvciIsIHQudGFyZ2V0cyksIHZ0LmZyb20odC5hbmNob3JCb3R0b20pLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gY0MoIjxib3R0b20+IiwgdCk7CiAgICAgICAgICB9KS50b0FycmF5KCldKSldLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICByZXR1cm4gMCA9PT0gdC5sZW5ndGggfHwgMCA9PT0gbi5sZW5ndGggPyB0LmNvbmNhdChuKSA6IHQuY29uY2F0KG0xLCBuKTsKICAgICAgICAgIH0sIFtdKSA6IG47CiAgICAgICAgfSkpLCB4aC5CVUJCTEVfVE9fU0FOREJPWCwgYSwgITEpOwogICAgICAgIHJldHVybiBMeShpKTsKICAgICAgfSwKICAgICAgZ2V0SG90c3BvdDogZnVuY3Rpb24gZ2V0SG90c3BvdCh0KSB7CiAgICAgICAgcmV0dXJuIHAuZ2V0T3B0KHQpOwogICAgICB9LAogICAgICBvblNldFZhbHVlOiBmdW5jdGlvbiBvblNldFZhbHVlKHQsIG4pIHsKICAgICAgICB0Lmhhc0NvbmZpZ3VyZWQoR3kpICYmIEd5LnJ1bih0KS5nZXQoc3QpOwogICAgICB9LAogICAgICB0eXBlYWhlYWRCZWhhdmlvdXJzOiB0YyhmdChbYy5nZXRWYWxpZGF0aW9uSGFuZGxlcigpLm1hcChmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiBHeS5jb25maWcoewogICAgICAgICAgZ2V0Um9vdDogZnVuY3Rpb24gZ2V0Um9vdCh0KSB7CiAgICAgICAgICAgIHJldHVybiBZdCh0LmVsZW1lbnQpOwogICAgICAgICAgfSwKICAgICAgICAgIGludmFsaWRDbGFzczogInRveC1jb250cm9sLXdyYXAtLXN0YXR1cy1pbnZhbGlkIiwKICAgICAgICAgIG5vdGlmeTogewogICAgICAgICAgICBvbkludmFsaWQ6IGZ1bmN0aW9uIG9uSW52YWxpZCh0LCBuKSB7CiAgICAgICAgICAgICAgZi5nZXRPcHQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgb24odC5lbGVtZW50LCAidGl0bGUiLCBpLnRyYW5zbGF0ZShuKSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB2YWxpZGF0b3I6IHsKICAgICAgICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uIHZhbGlkYXRlKHQpIHsKICAgICAgICAgICAgICB2YXIgbiA9IFRmLmdldFZhbHVlKHQpOwogICAgICAgICAgICAgIHJldHVybiBkMShmdW5jdGlvbiAobykgewogICAgICAgICAgICAgICAgZSh7CiAgICAgICAgICAgICAgICAgIHR5cGU6IHUuZmlsZXR5cGUsCiAgICAgICAgICAgICAgICAgIHVybDogbi52YWx1ZQogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgdmFyIG4sIGU7CiAgICAgICAgICAgICAgICAgICJpbnZhbGlkIiA9PT0gdC5zdGF0dXMgPyAobiA9IFJlLmVycm9yKHQubWVzc2FnZSksIG8obikpIDogKGUgPSBSZS52YWx1ZSh0Lm1lc3NhZ2UpLCBvKGUpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICB2YWxpZGF0ZU9uTG9hZDogITEKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSkudG9BcnJheSgpLCBbZGQuY29uZmlnKHsKICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24gZGlzYWJsZWQoKSB7CiAgICAgICAgICByZXR1cm4gdS5kaXNhYmxlZCB8fCBpLmlzRGlzYWJsZWQoKTsKICAgICAgICB9CiAgICAgIH0pLCBmeS5jb25maWcoe30pLCBmbSgidXJsaW5wdXQtZXZlbnRzIiwgZnQoWyJmaWxlIiA9PT0gdS5maWxldHlwZSA/IFtDcih3aSgpLCBmdW5jdGlvbiAodCkgewogICAgICAgIHZyKHQsIHB5LCB7CiAgICAgICAgICBuYW1lOiB1Lm5hbWUKICAgICAgICB9KTsKICAgICAgfSldIDogW10sIFtDcihTaSgpLCBmdW5jdGlvbiAodCkgewogICAgICAgIHZyKHQsIHB5LCB7CiAgICAgICAgICBuYW1lOiB1Lm5hbWUKICAgICAgICB9KSwgcih0KTsKICAgICAgfSksIENyKE1pKCksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdnIodCwgcHksIHsKICAgICAgICAgIG5hbWU6IHUubmFtZQogICAgICAgIH0pLCByKHQpOwogICAgICB9KV1dKSldXSkpLAogICAgICBldmVudE9yZGVyOiAoKHQgPSB7fSlbd2koKV0gPSBbInN0cmVhbWluZyIsICJ1cmxpbnB1dC1ldmVudHMiLCAiaW52YWxpZGF0aW5nIl0sIHQpLAogICAgICBtb2RlbDogewogICAgICAgIGdldERpc3BsYXlUZXh0OiBmdW5jdGlvbiBnZXREaXNwbGF5VGV4dCh0KSB7CiAgICAgICAgICByZXR1cm4gdC52YWx1ZTsKICAgICAgICB9LAogICAgICAgIHNlbGVjdHNPdmVyOiAhMSwKICAgICAgICBwb3B1bGF0ZUZyb21Ccm93c2U6ICExCiAgICAgIH0sCiAgICAgIG1hcmtlcnM6IHsKICAgICAgICBvcGVuQ2xhc3M6ICJ0b3gtdGV4dGZpZWxkLS1wb3B1cC1vcGVuIgogICAgICB9LAogICAgICBsYXp5U2luazogYS5zaGFyZWQuZ2V0U2luaywKICAgICAgcGFydHM6IHsKICAgICAgICBtZW51OiAkcCgwLCAwLCAibm9ybWFsIikKICAgICAgfSwKICAgICAgb25FeGVjdXRlOiBmdW5jdGlvbiBvbkV4ZWN1dGUodCwgbiwgZSkgewogICAgICAgIHZyKG4sIHl5LCB7fSk7CiAgICAgIH0sCiAgICAgIG9uSXRlbUV4ZWN1dGU6IGZ1bmN0aW9uIG9uSXRlbUV4ZWN1dGUodCwgbiwgZSwgbykgewogICAgICAgIHIodCksIHZyKHQsIHB5LCB7CiAgICAgICAgICBuYW1lOiB1Lm5hbWUKICAgICAgICB9KTsKICAgICAgfQogICAgfSksCiAgICAgICAgbCA9IHUubGFiZWwubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBaYih0LCBpKTsKICAgIH0pLAogICAgICAgIGYgPSBQbSgobiA9ICJpbnZhbGlkIiwgZSA9IHZ0LnNvbWUoZzEpLCBqbSgid2FybmluZyIsIHsKICAgICAgdGFnOiAiZGl2IiwKICAgICAgY2xhc3NlczogWyJ0b3gtaWNvbiIsICJ0b3gtY29udHJvbC13cmFwX19zdGF0dXMtaWNvbi0iICsgbl0sCiAgICAgIGF0dHJpYnV0ZXM6IF9sdCh7CiAgICAgICAgdGl0bGU6IGkudHJhbnNsYXRlKG8gPSB2b2lkIDAgPT09IG8gPyBuIDogbyksCiAgICAgICAgImFyaWEtbGl2ZSI6ICJwb2xpdGUiCiAgICAgIH0sIGUuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHt9OwogICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpZDogdAogICAgICAgIH07CiAgICAgIH0pKQogICAgfSwgaS5pY29ucykpKSwKICAgICAgICBkID0gUG0oewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LWNvbnRyb2wtd3JhcF9fc3RhdHVzLWljb24td3JhcCJdCiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IFtmLmFzU3BlYygpXQogICAgfSksCiAgICAgICAgbSA9IGMuZ2V0VXJsUGlja2VyKHUuZmlsZXR5cGUpLAogICAgICAgIGcgPSBGcigiYnJvd3Nlci51cmwuZXZlbnQiKSwKICAgICAgICBwID0gUG0oewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LWNvbnRyb2wtd3JhcCJdCiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IFtzLCBkLmFzU3BlYygpXSwKICAgICAgYmVoYXZpb3VyczogdGMoW2RkLmNvbmZpZyh7CiAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uIGRpc2FibGVkKCkgewogICAgICAgICAgcmV0dXJuIHUuZGlzYWJsZWQgfHwgaS5pc0Rpc2FibGVkKCk7CiAgICAgICAgfQogICAgICB9KV0pCiAgICB9KSwKICAgICAgICBoID0gUG0oWDAoewogICAgICBuYW1lOiB1Lm5hbWUsCiAgICAgIGljb246IHZ0LnNvbWUoImJyb3dzZSIpLAogICAgICB0ZXh0OiB1LmxhYmVsLmdldE9yKCIiKSwKICAgICAgZGlzYWJsZWQ6IHUuZGlzYWJsZWQsCiAgICAgIHByaW1hcnk6ICExLAogICAgICBib3JkZXJsZXNzOiAhMAogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIGhyKHQsIGcpOwogICAgfSwgaSwgW10sIFsidG94LWJyb3dzZS11cmwiXSkpOwogICAgcmV0dXJuIHN5LnNrZXRjaCh7CiAgICAgIGRvbTogZ3koW10pLAogICAgICBjb21wb25lbnRzOiBsLnRvQXJyYXkoKS5jb25jYXQoW3sKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1mb3JtX19jb250cm9scy1oLXN0YWNrIl0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IGZ0KFtbcC5hc1NwZWMoKV0sIG0ubWFwKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBoLmFzU3BlYygpOwogICAgICAgIH0pLnRvQXJyYXkoKV0pCiAgICAgIH1dKSwKICAgICAgZmllbGRCZWhhdmlvdXJzOiB0YyhbZGQuY29uZmlnKHsKICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24gZGlzYWJsZWQoKSB7CiAgICAgICAgICByZXR1cm4gdS5kaXNhYmxlZCB8fCBpLmlzRGlzYWJsZWQoKTsKICAgICAgICB9LAogICAgICAgIG9uRGlzYWJsZWQ6IGZ1bmN0aW9uIG9uRGlzYWJsZWQodCkgewogICAgICAgICAgc3kuZ2V0RmllbGQodCkuZWFjaChkZC5kaXNhYmxlKSwgaC5nZXRPcHQodCkuZWFjaChkZC5kaXNhYmxlKTsKICAgICAgICB9LAogICAgICAgIG9uRW5hYmxlZDogZnVuY3Rpb24gb25FbmFibGVkKHQpIHsKICAgICAgICAgIHN5LmdldEZpZWxkKHQpLmVhY2goZGQuZW5hYmxlKSwgaC5nZXRPcHQodCkuZWFjaChkZC5lbmFibGUpOwogICAgICAgIH0KICAgICAgfSksIG12KCksIGZtKCJ1cmwtaW5wdXQtZXZlbnRzIiwgW0NyKGcsIGZ1bmN0aW9uIChvKSB7CiAgICAgICAgdWQuZ2V0Q3VycmVudChvKS5lYWNoKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICB2YXIgdCA9IFRmLmdldFZhbHVlKG4pLAogICAgICAgICAgICAgIGUgPSBfbHQoewogICAgICAgICAgICBmaWVsZG5hbWU6IHUubmFtZQogICAgICAgICAgfSwgdCk7CgogICAgICAgICAgbS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHQoZSkuZ2V0KGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgVGYuc2V0VmFsdWUobiwgdCksIHZyKG8sIHB5LCB7CiAgICAgICAgICAgICAgICBuYW1lOiB1Lm5hbWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSldKV0pCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGRDKHIpIHsKICAgIHJldHVybiBmdW5jdGlvbiAobiwgZSwgbykgewogICAgICByZXR1cm4gdHQoZSwgIm5hbWUiKS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gcihlLCBvKTsKICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gbi5maWVsZCh0LCByKGUsIG8pKTsKICAgICAgfSk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gbUMobiwgdCwgZSkgewogICAgdmFyIG8gPSBYbyhlLCB7CiAgICAgIHNoYXJlZDogewogICAgICAgIGludGVycHJldGVyOiBmdW5jdGlvbiBpbnRlcnByZXRlcih0KSB7CiAgICAgICAgICByZXR1cm4gdjEobiwgdCwgbyk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIHJldHVybiB2MShuLCB0LCBvKTsKICB9CgogIGZ1bmN0aW9uIGdDKHQsIG4sIGUpIHsKICAgIGZ1bmN0aW9uIG8oKSB7CiAgICAgIHJldHVybiBBdC5mcm9tRG9tKHQuZ2V0Q29udGVudEFyZWFDb250YWluZXIoKSk7CiAgICB9CgogICAgZnVuY3Rpb24gcigpIHsKICAgICAgcmV0dXJuIHAgfHwgIWUoKTsKICAgIH0KCiAgICB2YXIgaSwKICAgICAgICB1LAogICAgICAgIGEsCiAgICAgICAgYywKICAgICAgICBzLAogICAgICAgIGwsCiAgICAgICAgZiwKICAgICAgICBkLAogICAgICAgIG0sCiAgICAgICAgZywKICAgICAgICBwID0gYXYodCk7CiAgICByZXR1cm4gewogICAgICBpbmxpbmVEaWFsb2c6IChmID0gbywgZCA9IG4sIG0gPSByLCBnID0gewogICAgICAgIG1heEhlaWdodEZ1bmN0aW9uOiBJYygpCiAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbSgpID8gewogICAgICAgICAgdHlwZTogIm5vZGUiLAogICAgICAgICAgcm9vdDogdG4oZigpKSwKICAgICAgICAgIG5vZGU6IHZ0LmZyb20oZigpKSwKICAgICAgICAgIGJ1YmJsZTogeGMoMTIsIDEyLCBiMSksCiAgICAgICAgICBsYXlvdXRzOiB7CiAgICAgICAgICAgIG9uUnRsOiBmdW5jdGlvbiBvblJ0bCgpIHsKICAgICAgICAgICAgICByZXR1cm4gW0JtXTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25MdHI6IGZ1bmN0aW9uIG9uTHRyKCkgewogICAgICAgICAgICAgIHJldHVybiBbRG1dOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgb3ZlcnJpZGVzOiBnCiAgICAgICAgfSA6IHsKICAgICAgICAgIHR5cGU6ICJob3RzcG90IiwKICAgICAgICAgIGhvdHNwb3Q6IGQoKSwKICAgICAgICAgIGJ1YmJsZTogeGMoLTEyLCAxMiwgYjEpLAogICAgICAgICAgbGF5b3V0czogewogICAgICAgICAgICBvblJ0bDogZnVuY3Rpb24gb25SdGwoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFtHYV07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uTHRyOiBmdW5jdGlvbiBvbkx0cigpIHsKICAgICAgICAgICAgICByZXR1cm4gW1hhXTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIG92ZXJyaWRlczogZwogICAgICAgIH07CiAgICAgIH0pLAogICAgICBiYW5uZXI6IChjID0gbywgcyA9IG4sIGwgPSByLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGwoKSA/IHsKICAgICAgICAgIHR5cGU6ICJub2RlIiwKICAgICAgICAgIHJvb3Q6IHRuKGMoKSksCiAgICAgICAgICBub2RlOiB2dC5mcm9tKGMoKSksCiAgICAgICAgICBsYXlvdXRzOiB7CiAgICAgICAgICAgIG9uUnRsOiBmdW5jdGlvbiBvblJ0bCgpIHsKICAgICAgICAgICAgICByZXR1cm4gW3VwXTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25MdHI6IGZ1bmN0aW9uIG9uTHRyKCkgewogICAgICAgICAgICAgIHJldHVybiBbdXBdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSA6IHsKICAgICAgICAgIHR5cGU6ICJob3RzcG90IiwKICAgICAgICAgIGhvdHNwb3Q6IHMoKSwKICAgICAgICAgIGxheW91dHM6IHsKICAgICAgICAgICAgb25SdGw6IGZ1bmN0aW9uIG9uUnRsKCkgewogICAgICAgICAgICAgIHJldHVybiBbSmFdOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvbkx0cjogZnVuY3Rpb24gb25MdHIoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFtKYV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9KSwKICAgICAgY3Vyc29yOiAodSA9IHQsIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogInNlbGVjdGlvbiIsCiAgICAgICAgICByb290OiBhKCksCiAgICAgICAgICBnZXRTZWxlY3Rpb246IGZ1bmN0aW9uIGdldFNlbGVjdGlvbigpIHsKICAgICAgICAgICAgdmFyIHQgPSB1LnNlbGVjdGlvbi5nZXRSbmcoKTsKICAgICAgICAgICAgcmV0dXJuIHZ0LnNvbWUoZnMucmFuZ2UoQXQuZnJvbURvbSh0LnN0YXJ0Q29udGFpbmVyKSwgdC5zdGFydE9mZnNldCwgQXQuZnJvbURvbSh0LmVuZENvbnRhaW5lciksIHQuZW5kT2Zmc2V0KSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSksCiAgICAgIG5vZGU6IChpID0gYSA9IGZ1bmN0aW9uIGEoKSB7CiAgICAgICAgcmV0dXJuIEF0LmZyb21Eb20odC5nZXRCb2R5KCkpOwogICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiAibm9kZSIsCiAgICAgICAgICByb290OiBpKCksCiAgICAgICAgICBub2RlOiB0CiAgICAgICAgfTsKICAgICAgfSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBwQyhpKSB7CiAgICByZXR1cm4gdnQuZnJvbShpLmdldFBhcmFtKCJzdHlsZV9mb3JtYXRzIikpLmZpbHRlcihjKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBlLAogICAgICAgICAgbyA9IChuID0gaSwgZSA9IHgxKHQpLCBuLmZvcm1hdHRlciA/IHIoZS5jdXN0b21Gb3JtYXRzKSA6IG4ub24oImluaXQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcihlLmN1c3RvbUZvcm1hdHMpOwogICAgICB9KSwgZS5mb3JtYXRzKTsKCiAgICAgIGZ1bmN0aW9uIHIodCkgewogICAgICAgIFN0KHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBuLmZvcm1hdHRlci5oYXModC5uYW1lKSB8fCBuLmZvcm1hdHRlci5yZWdpc3Rlcih0Lm5hbWUsIHQuZm9ybWF0KTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGkuZ2V0UGFyYW0oInN0eWxlX2Zvcm1hdHNfbWVyZ2UiLCAhMSwgImJvb2xlYW4iKSA/IHkxLmNvbmNhdChvKSA6IG87CiAgICB9KS5nZXRPcih5MSk7CiAgfQoKICBmdW5jdGlvbiBoQyh0LCBuLCBlKSB7CiAgICB2YXIgbyA9IHsKICAgICAgdHlwZTogImZvcm1hdHRlciIsCiAgICAgIGlzU2VsZWN0ZWQ6IG4odC5mb3JtYXQpLAogICAgICBnZXRTdHlsZVByZXZpZXc6IGUodC5mb3JtYXQpCiAgICB9OwogICAgcmV0dXJuIFhvKHQsIG8pOwogIH0KCiAgZnVuY3Rpb24gdkMoYywgdCwgcywgbCkgewogICAgdmFyIGYgPSBmdW5jdGlvbiBmKHQpIHsKICAgICAgcmV0dXJuIE0odCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbiwKICAgICAgICAgICAgZSwKICAgICAgICAgICAgbywKICAgICAgICAgICAgciwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgdSA9IGt0KHQpOwoKICAgICAgICBpZiAobnQodCwgIml0ZW1zIikpIHsKICAgICAgICAgIHZhciBhID0gZih0Lml0ZW1zKTsKICAgICAgICAgIHJldHVybiBYbyhYbyh0LCB7CiAgICAgICAgICAgIHR5cGU6ICJzdWJtZW51IgogICAgICAgICAgfSksIHsKICAgICAgICAgICAgZ2V0U3R5bGVJdGVtczogcnQoYSkKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG50KHQsICJmb3JtYXQiKSA/IGhDKHQsIHMsIGwpIDogMSA9PT0gdS5sZW5ndGggJiYgd3QodSwgInRpdGxlIikgPyBYbyh0LCB7CiAgICAgICAgICB0eXBlOiAic2VwYXJhdG9yIgogICAgICAgIH0pIDogKHIgPSB7CiAgICAgICAgICB0eXBlOiAiZm9ybWF0dGVyIiwKICAgICAgICAgIGZvcm1hdDogbyA9ICJjdXN0b20tIiArIChlID0geSgobiA9IHQpLm5hbWUpID8gbi5uYW1lIDogRnIobi50aXRsZSkpLAogICAgICAgICAgaXNTZWxlY3RlZDogcyhvKSwKICAgICAgICAgIGdldFN0eWxlUHJldmlldzogbChvKQogICAgICAgIH0sIGkgPSBYbyhuLCByKSwgYy5mb3JtYXR0ZXIucmVnaXN0ZXIoZSwgaSksIGkpOwogICAgICB9KTsKICAgIH07CgogICAgcmV0dXJuIGYodCk7CiAgfQoKICBmdW5jdGlvbiBiQyhlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgaWYgKGQobiA9IHQpICYmIDEgPT09IG4ubm9kZVR5cGUpIHsKICAgICAgICBpZiAodC5jb250ZW50RWRpdGFibGUgPT09IGUpIHJldHVybiAhMDsKICAgICAgICBpZiAodC5nZXRBdHRyaWJ1dGUoImRhdGEtbWNlLWNvbnRlbnRlZGl0YWJsZSIpID09PSBlKSByZXR1cm4gITA7CiAgICAgIH0KCiAgICAgIHZhciBuOwogICAgICByZXR1cm4gITE7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24geUModCwgbiwgZSwgbywgcikgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogdCwKICAgICAgdGl0bGU6IG4sCiAgICAgIHVybDogZSwKICAgICAgbGV2ZWw6IG8sCiAgICAgIGF0dGFjaDogcgogICAgfTsKICB9CgogIGZ1bmN0aW9uIHhDKHQpIHsKICAgIHJldHVybiB0LmlubmVyVGV4dCB8fCB0LnRleHRDb250ZW50OwogIH0KCiAgZnVuY3Rpb24gd0ModCkgewogICAgcmV0dXJuIHQgJiYgIkEiID09PSB0Lm5vZGVOYW1lICYmIHZvaWQgMCAhPT0gKHQuaWQgfHwgdC5uYW1lKSAmJiBZayh0KTsKICB9CgogIGZ1bmN0aW9uIFNDKHQpIHsKICAgIHJldHVybiB0ICYmIC9eKEhbMS02XSkkLy50ZXN0KHQubm9kZU5hbWUpOwogIH0KCiAgZnVuY3Rpb24gQ0ModCkgewogICAgcmV0dXJuIFNDKHQpICYmIFlrKHQpOwogIH0KCiAgZnVuY3Rpb24ga0ModCkgewogICAgdmFyIG4sCiAgICAgICAgZSA9IHQuaWQgfHwgRnIoImgiKTsKICAgIHJldHVybiB5QygiaGVhZGVyIiwgeEModCksICIjIiArIGUsIFNDKG4gPSB0KSA/IHBhcnNlSW50KG4ubm9kZU5hbWUuc3Vic3RyKDEpLCAxMCkgOiAwLCBmdW5jdGlvbiAoKSB7CiAgICAgIHQuaWQgPSBlOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBPQyh0KSB7CiAgICB2YXIgbiA9IHQuaWQgfHwgdC5uYW1lOwogICAgcmV0dXJuIHlDKCJhbmNob3IiLCB4Qyh0KSB8fCAiIyIgKyBuLCAiIyIgKyBuLCAwLCBzdCk7CiAgfQoKICBmdW5jdGlvbiBfQyh0KSB7CiAgICByZXR1cm4gMCA8IHcxKHQudGl0bGUpLmxlbmd0aDsKICB9CgogIGZ1bmN0aW9uIFRDKHQpIHsKICAgIHJldHVybiB5KHQpICYmIC9eaHR0cHM/Ly50ZXN0KHQpOwogIH0KCiAgZnVuY3Rpb24gRUModCkgewogICAgcmV0dXJuIHgodCkgJiYgUSh0LCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gIShjKG4gPSB0KSAmJiBuLmxlbmd0aCA8PSA1ICYmIE4obiwgVEMpKTsKICAgICAgdmFyIG47CiAgICB9KS5pc05vbmUoKTsKICB9CgogIGZ1bmN0aW9uIERDKCkgewogICAgdmFyIHQsCiAgICAgICAgbiA9IGxiLmdldEl0ZW0oTzEpOwogICAgaWYgKG51bGwgPT09IG4pIHJldHVybiB7fTsKCiAgICB0cnkgewogICAgICB0ID0gSlNPTi5wYXJzZShuKTsKICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgaWYgKHQgaW5zdGFuY2VvZiBTeW50YXhFcnJvcikgcmV0dXJuIGNvbnNvbGUubG9nKCJMb2NhbCBzdG9yYWdlICIgKyBPMSArICIgd2FzIG5vdCB2YWxpZCBKU09OIiwgdCksIHt9OwogICAgICB0aHJvdyB0OwogICAgfQoKICAgIHJldHVybiBFQyh0KSA/IHQgOiAoY29uc29sZS5sb2coIkxvY2FsIHN0b3JhZ2UgIiArIE8xICsgIiB3YXMgbm90IHZhbGlkIGZvcm1hdCIsIHQpLCB7fSk7CiAgfQoKICBmdW5jdGlvbiBCQyh0KSB7CiAgICByZXR1cm4gdHQoREMoKSwgdCkuZ2V0T3IoW10pOwogIH0KCiAgZnVuY3Rpb24gTUMobiwgdCkgewogICAgdmFyIGUsIG87CiAgICBUQyhuKSAmJiAobyA9IEYodHQoZSA9IERDKCksIHQpLmdldE9yKFtdKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQgIT09IG47CiAgICB9KSwgZVt0XSA9IFtuXS5jb25jYXQobykuc2xpY2UoMCwgNSksIGZ1bmN0aW9uICh0KSB7CiAgICAgIGlmICghRUModCkpIHRocm93IG5ldyBFcnJvcigiQmFkIGZvcm1hdCBmb3IgaGlzdG9yeTpcbiIgKyBKU09OLnN0cmluZ2lmeSh0KSk7CiAgICAgIGxiLnNldEl0ZW0oTzEsIEpTT04uc3RyaW5naWZ5KHQpKTsKICAgIH0oZSkpOwogIH0KCiAgZnVuY3Rpb24gQUModCkgewogICAgcmV0dXJuICEhdDsKICB9CgogIGZ1bmN0aW9uIEZDKHQpIHsKICAgIHJldHVybiBkdChhUy5tYWtlTWFwKHQsIC9bLCBdLyksIEFDKTsKICB9CgogIGZ1bmN0aW9uIElDKHQpIHsKICAgIHJldHVybiB2dC5mcm9tKHQuZ2V0UGFyYW0oImZpbGVfcGlja2VyX2NhbGxiYWNrIikpLmZpbHRlcihtKTsKICB9CgogIGZ1bmN0aW9uIFJDKHQpIHsKICAgIHJldHVybiB2dC5mcm9tKHQpLmZpbHRlcih5KS5nZXRPclVuZGVmaW5lZCgpOwogIH0KCiAgZnVuY3Rpb24gVkMobCkgewogICAgcmV0dXJuIHsKICAgICAgZ2V0SGlzdG9yeTogQkMsCiAgICAgIGFkZFRvSGlzdG9yeTogTUMsCiAgICAgIGdldExpbmtJbmZvcm1hdGlvbjogZnVuY3Rpb24gZ2V0TGlua0luZm9ybWF0aW9uKCkgewogICAgICAgIHJldHVybiAhMSA9PT0gKHQgPSBsKS5nZXRQYXJhbSgidHlwZWFoZWFkX3VybHMiKSA/IHZ0Lm5vbmUoKSA6IHZ0LnNvbWUoewogICAgICAgICAgdGFyZ2V0czogazEodC5nZXRCb2R5KCkpLAogICAgICAgICAgYW5jaG9yVG9wOiBSQyh0LmdldFBhcmFtKCJhbmNob3JfdG9wIiwgIiN0b3AiKSksCiAgICAgICAgICBhbmNob3JCb3R0b206IFJDKHQuZ2V0UGFyYW0oImFuY2hvcl9ib3R0b20iLCAiI2JvdHRvbSIpKQogICAgICAgIH0pOwogICAgICAgIHZhciB0OwogICAgICB9LAogICAgICBnZXRWYWxpZGF0aW9uSGFuZGxlcjogZnVuY3Rpb24gZ2V0VmFsaWRhdGlvbkhhbmRsZXIoKSB7CiAgICAgICAgcmV0dXJuIHZ0LmZyb20odm9pZCAwID09PSAobiA9ICh0ID0gbCkuZ2V0UGFyYW0oImZpbGVfcGlja2VyX3ZhbGlkYXRvcl9oYW5kbGVyIiwgdm9pZCAwLCAiZnVuY3Rpb24iKSkgPyB0LmdldFBhcmFtKCJmaWxlcGlja2VyX3ZhbGlkYXRvcl9oYW5kbGVyIiwgdm9pZCAwLCAiZnVuY3Rpb24iKSA6IG4pOwogICAgICAgIHZhciB0LCBuOwogICAgICB9LAogICAgICBnZXRVcmxQaWNrZXI6IGZ1bmN0aW9uIGdldFVybFBpY2tlcih0KSB7CiAgICAgICAgcmV0dXJuIG4gPSBjID0gbCwgZSA9IHMgPSB0LCByID0gdnQuc29tZSgobyA9IG4pLmdldFBhcmFtKCJmaWxlX3BpY2tlcl90eXBlcyIpKS5maWx0ZXIoQUMpLCBpID0gdnQuc29tZShvLmdldFBhcmFtKCJmaWxlX2Jyb3dzZXJfY2FsbGJhY2tfdHlwZXMiKSkuZmlsdGVyKEFDKSwgdSA9IHIub3IoaSkubWFwKEZDKSwgYSA9IElDKG8pLmZvbGQoTywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB1LmZvbGQoXywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIDAgPCBrdCh0KS5sZW5ndGggJiYgdDsKICAgICAgICAgIH0pOwogICAgICAgIH0pLCAodyhhKSA/IGEgPyBJQyhuKSA6IHZ0Lm5vbmUoKSA6IGFbZV0gPyBJQyhuKSA6IHZ0Lm5vbmUoKSkubWFwKGZ1bmN0aW9uIChvKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgcmV0dXJuIE55KGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSBfbHQoewogICAgICAgICAgICAgICAgZmlsZXR5cGU6IHMsCiAgICAgICAgICAgICAgICBmaWVsZG5hbWU6IG4uZmllbGRuYW1lCiAgICAgICAgICAgICAgfSwgdnQuZnJvbShuLm1ldGEpLmdldE9yKHt9KSk7CgogICAgICAgICAgICAgIG8uY2FsbChjLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICAgICAgaWYgKCF5KHQpKSB0aHJvdyBuZXcgRXJyb3IoIkV4cGVjdGVkIHZhbHVlIHRvIGJlIHN0cmluZyIpOwogICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gbiAmJiAheChuKSkgdGhyb3cgbmV3IEVycm9yKCJFeHBlY3RlZCBtZXRhIHRvIGJlIGEgb2JqZWN0Iik7CiAgICAgICAgICAgICAgICBlKHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHQsCiAgICAgICAgICAgICAgICAgIG1ldGE6IG4KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0sIG4udmFsdWUsIHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgICAgdmFyIG4sIGUsIG8sIHIsIGksIHUsIGEsIGMsIHM7CiAgICAgIH0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBQQyh0LCBuLCBlKSB7CiAgICB2YXIgbywKICAgICAgICByLAogICAgICAgIGksCiAgICAgICAgdSwKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICAgcywKICAgICAgICBfbDIsCiAgICAgICAgZiwKICAgICAgICBkLAogICAgICAgIG0sCiAgICAgICAgZywKICAgICAgICBwLAogICAgICAgIGggPSBWbyghMSksCiAgICAgICAgdiA9IHsKICAgICAgaXNQb3NpdGlvbmVkQXRUb3A6IGZ1bmN0aW9uIGlzUG9zaXRpb25lZEF0VG9wKCkgewogICAgICAgIHJldHVybiAidG9wIiA9PT0gby5nZXQoKTsKICAgICAgfSwKICAgICAgZ2V0RG9ja2luZ01vZGU6IChvID0gVm8oaXYobikgPyAiYm90dG9tIiA6ICJ0b3AiKSkuZ2V0LAogICAgICBzZXREb2NraW5nTW9kZTogby5zZXQKICAgIH0sCiAgICAgICAgYiA9IHsKICAgICAgc2hhcmVkOiB7CiAgICAgICAgcHJvdmlkZXJzOiB7CiAgICAgICAgICBpY29uczogZnVuY3Rpb24gaWNvbnMoKSB7CiAgICAgICAgICAgIHJldHVybiBuLnVpLnJlZ2lzdHJ5LmdldEFsbCgpLmljb25zOwogICAgICAgICAgfSwKICAgICAgICAgIG1lbnVJdGVtczogZnVuY3Rpb24gbWVudUl0ZW1zKCkgewogICAgICAgICAgICByZXR1cm4gbi51aS5yZWdpc3RyeS5nZXRBbGwoKS5tZW51SXRlbXM7CiAgICAgICAgICB9LAogICAgICAgICAgdHJhbnNsYXRlOiBscC50cmFuc2xhdGUsCiAgICAgICAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbiBpc0Rpc2FibGVkKCkgewogICAgICAgICAgICByZXR1cm4gbi5tb2RlLmlzUmVhZE9ubHkoKSB8fCBuLnVpLmlzRGlzYWJsZWQoKTsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXRTZXR0aW5nOiBuLmdldFBhcmFtLmJpbmQobikKICAgICAgICB9LAogICAgICAgIGludGVycHJldGVyOiBmdW5jdGlvbiBpbnRlcnByZXRlcih0KSB7CiAgICAgICAgICByZXR1cm4gdjEoaDEsIHQsIGIpOwogICAgICAgIH0sCiAgICAgICAgYW5jaG9yczogZ0MobiwgZSwgdi5pc1Bvc2l0aW9uZWRBdFRvcCksCiAgICAgICAgaGVhZGVyOiB2LAogICAgICAgIGdldFNpbms6IGZ1bmN0aW9uIGdldFNpbmsoKSB7CiAgICAgICAgICByZXR1cm4gUmUudmFsdWUodCk7CiAgICAgICAgfQogICAgICB9LAogICAgICB1cmxpbnB1dDogVkMobiksCiAgICAgIHN0eWxlc2VsZWN0OiAoZiA9IFZvKFtdKSwgZCA9IFZvKFtdKSwgbSA9IFZvKFtdKSwgZyA9IFZvKFtdKSwgcCA9IFZvKCEoX2wyID0gZnVuY3Rpb24gbCh0KSB7CiAgICAgICAgdmFyIG4gPSB0Lml0ZW1zOwogICAgICAgIHJldHVybiB2b2lkIDAgIT09IG4gJiYgMCA8IG4ubGVuZ3RoID8geihuLCBfbDIpIDogW3QuZm9ybWF0XTsKICAgICAgfSkpLCAocyA9IG4pLm9uKCJQcmVJbml0IiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbiA9IHBDKHMpLAogICAgICAgICAgICBlID0gdkMocywgbiwgeSwgeCk7CiAgICAgICAgZi5zZXQoZSksIGQuc2V0KHooZSwgX2wyKSk7CiAgICAgIH0pLCBzLm9uKCJhZGRTdHlsZU1vZGlmaWNhdGlvbnMiLCBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBuID0gdkMocywgdC5pdGVtcywgeSwgeCk7CiAgICAgICAgbS5zZXQobiksIHAuc2V0KHQucmVwbGFjZSksIGcuc2V0KHoobiwgX2wyKSk7CiAgICAgIH0pLCB7CiAgICAgICAgZ2V0RGF0YTogZnVuY3Rpb24gZ2V0RGF0YSgpIHsKICAgICAgICAgIHZhciB0ID0gcC5nZXQoKSA/IFtdIDogZi5nZXQoKSwKICAgICAgICAgICAgICBuID0gbS5nZXQoKTsKICAgICAgICAgIHJldHVybiB0LmNvbmNhdChuKTsKICAgICAgICB9LAogICAgICAgIGdldEZsYXR0ZW5lZEtleXM6IGZ1bmN0aW9uIGdldEZsYXR0ZW5lZEtleXMoKSB7CiAgICAgICAgICB2YXIgdCA9IHAuZ2V0KCkgPyBbXSA6IGQuZ2V0KCksCiAgICAgICAgICAgICAgbiA9IGcuZ2V0KCk7CiAgICAgICAgICByZXR1cm4gdC5jb25jYXQobik7CiAgICAgICAgfQogICAgICB9KSwKICAgICAgY29sb3JpbnB1dDogewogICAgICAgIGNvbG9yUGlja2VyOiBmdW5jdGlvbiBjb2xvclBpY2tlcih0LCBuKSB7CiAgICAgICAgICBCYihjKSh0LCBuKTsKICAgICAgICB9LAogICAgICAgIGhhc0N1c3RvbUNvbG9yczogZnVuY3Rpb24gaGFzQ3VzdG9tQ29sb3JzKCkgewogICAgICAgICAgcmV0dXJuIGRiKGEpOwogICAgICAgIH0sCiAgICAgICAgZ2V0Q29sb3JzOiBmdW5jdGlvbiBnZXRDb2xvcnMoKSB7CiAgICAgICAgICByZXR1cm4gbWIodSk7CiAgICAgICAgfSwKICAgICAgICBnZXRDb2xvckNvbHM6IChpID0gdSA9IGEgPSBjID0gbiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHBiKGkpOwogICAgICAgIH0pCiAgICAgIH0sCiAgICAgIGRpYWxvZzogewogICAgICAgIGlzRHJhZ2dhYmxlTW9kYWw6IChyID0gbiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHIuZ2V0UGFyYW0oImRyYWdnYWJsZV9tb2RhbCIsICExLCAiYm9vbGVhbiIpOwogICAgICAgIH0pCiAgICAgIH0sCiAgICAgIGlzQ29udGV4dE1lbnVPcGVuOiBmdW5jdGlvbiBpc0NvbnRleHRNZW51T3BlbigpIHsKICAgICAgICByZXR1cm4gaC5nZXQoKTsKICAgICAgfSwKICAgICAgc2V0Q29udGV4dE1lbnVTdGF0ZTogZnVuY3Rpb24gc2V0Q29udGV4dE1lbnVTdGF0ZSh0KSB7CiAgICAgICAgcmV0dXJuIGguc2V0KHQpOwogICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIHkodCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBzLmZvcm1hdHRlci5tYXRjaCh0KTsKICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiB4KG4pIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IHMuZm9ybWF0dGVyLmdldChuKTsKICAgICAgICByZXR1cm4gdm9pZCAwICE9PSB0ID8gdnQuc29tZSh7CiAgICAgICAgICB0YWc6IDAgPCB0Lmxlbmd0aCAmJiAodFswXS5pbmxpbmUgfHwgdFswXS5ibG9jaykgfHwgImRpdiIsCiAgICAgICAgICBzdHlsZXM6IHMuZG9tLnBhcnNlU3R5bGUocy5mb3JtYXR0ZXIuZ2V0Q3NzVGV4dChuKSkKICAgICAgICB9KSA6IHZ0Lm5vbmUoKTsKICAgICAgfTsKICAgIH0KCiAgICByZXR1cm4gYjsKICB9CgogIGZ1bmN0aW9uIEhDKHQpIHsKICAgIHJldHVybiAobXQocG4odCwgInBvc2l0aW9uIiksICJmaXhlZCIpID8gdnQubm9uZSgpIDogcXQodCkpLm9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICB2YXIgZSA9IEF0LmZyb21UYWcoInNwYW4iKTsKICAgICAgcmV0dXJuIFl0KHQpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICBfZSh0LCBlKTsKCiAgICAgICAgdmFyIG4gPSBxdChlKTsKICAgICAgICByZXR1cm4gVGUoZSksIG47CiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB6Qyh0KSB7CiAgICByZXR1cm4gSEModCkubWFwKENuKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFNlKDAsIDApOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBOQyh0LCBuKSB7CiAgICB2YXIgZSA9IHQuZWxlbWVudDsKICAgIFhyKGUsIG4udHJhbnNpdGlvbkNsYXNzKSwgWXIoZSwgbi5mYWRlT3V0Q2xhc3MpLCBYcihlLCBuLmZhZGVJbkNsYXNzKSwgbi5vblNob3codCk7CiAgfQoKICBmdW5jdGlvbiBMQyh0LCBuKSB7CiAgICB2YXIgZSA9IHQuZWxlbWVudDsKICAgIFhyKGUsIG4udHJhbnNpdGlvbkNsYXNzKSwgWXIoZSwgbi5mYWRlSW5DbGFzcyksIFhyKGUsIG4uZmFkZU91dENsYXNzKSwgbi5vbkhpZGUodCk7CiAgfQoKICBmdW5jdGlvbiBXQyh0LCBuLCBlKSB7CiAgICByZXR1cm4gTih0LCBmdW5jdGlvbiAodCkgewogICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICBjYXNlICJib3R0b20iOgogICAgICAgICAgcmV0dXJuIG4uYm90dG9tIDw9IGUuYm90dG9tOwoKICAgICAgICBjYXNlICJ0b3AiOgogICAgICAgICAgcmV0dXJuIG4ueSA+PSBlLnk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gVUMobiwgdCkgewogICAgcmV0dXJuIHQuZ2V0SW5pdGlhbFBvcygpLm1hcChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gQmUodC5ib3VuZHMueCwgdC5ib3VuZHMueSwga24obiksIHhuKG4pKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gakMoZSwgbywgcikgewogICAgcmV0dXJuIHIuZ2V0SW5pdGlhbFBvcygpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgc3dpdGNoIChyLmNsZWFySW5pdGlhbFBvcygpLCB0LnBvc2l0aW9uKSB7CiAgICAgICAgY2FzZSAic3RhdGljIjoKICAgICAgICAgIHJldHVybiB2dC5zb21lKFYxLnN0YXRpYygpKTsKCiAgICAgICAgY2FzZSAiYWJzb2x1dGUiOgogICAgICAgICAgdmFyIG4gPSBIQyhlKS5tYXAoTWUpLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gTWUodmUoKSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiB2dC5zb21lKFYxLmFic29sdXRlKFRhKCJhYnNvbHV0ZSIsIHR0KHQuc3R5bGUsICJsZWZ0IikubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiBvLnggLSBuLng7CiAgICAgICAgICB9KSwgdHQodC5zdHlsZSwgInRvcCIpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gby55IC0gbi55OwogICAgICAgICAgfSksIHR0KHQuc3R5bGUsICJyaWdodCIpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gbi5yaWdodCAtIG8ucmlnaHQ7CiAgICAgICAgICB9KSwgdHQodC5zdHlsZSwgImJvdHRvbSIpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gbi5ib3R0b20gLSBvLmJvdHRvbTsKICAgICAgICAgIH0pKSkpOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIHZ0Lm5vbmUoKTsKICAgICAgfQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBHQyh0LCBuLCBlKSB7CiAgICB2YXIgbywKICAgICAgICByLAogICAgICAgIGksCiAgICAgICAgdSA9IHQuZWxlbWVudDsKICAgIHJldHVybiBtdChwbih1LCAicG9zaXRpb24iKSwgImZpeGVkIikgPyAociA9IG4sIFVDKG8gPSB1LCBpID0gZSkuZmlsdGVyKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBXQyhpLmdldE1vZGVzKCksIHQsIHIpOwogICAgfSkuYmluZChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gakMobywgdCwgaSk7CiAgICB9KSkgOiBmdW5jdGlvbiAodCwgbiwgZSkgewogICAgICB2YXIgciwKICAgICAgICAgIG8sCiAgICAgICAgICBpID0gTWUodCk7CiAgICAgIGlmIChXQyhlLmdldE1vZGVzKCksIGksIG4pKSByZXR1cm4gdnQubm9uZSgpOwogICAgICByID0gdCwgbyA9IGksIGUuc2V0SW5pdGlhbFBvcyh7CiAgICAgICAgc3R5bGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0ID0ge30sCiAgICAgICAgICAgICAgbiA9IHIuZG9tOwogICAgICAgICAgaWYgKGN0KG4pKSBmb3IgKHZhciBlID0gMDsgZSA8IG4uc3R5bGUubGVuZ3RoOyBlKyspIHsKICAgICAgICAgICAgdmFyIG8gPSBuLnN0eWxlLml0ZW0oZSk7CiAgICAgICAgICAgIHRbb10gPSBuLnN0eWxlW29dOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgfSgpLAogICAgICAgIHBvc2l0aW9uOiBnbihyLCAicG9zaXRpb24iKSB8fCAic3RhdGljIiwKICAgICAgICBib3VuZHM6IG8KICAgICAgfSk7CiAgICAgIHZhciB1ID0gQWUoKSwKICAgICAgICAgIGEgPSBpLnggLSB1LngsCiAgICAgICAgICBjID0gbi55IC0gdS55LAogICAgICAgICAgcyA9IHUuYm90dG9tIC0gbi5ib3R0b20sCiAgICAgICAgICBsID0gaS55IDw9IG4ueTsKICAgICAgcmV0dXJuIHZ0LnNvbWUoVjEuZml4ZWQoVGEoImZpeGVkIiwgdnQuc29tZShhKSwgbCA/IHZ0LnNvbWUoYykgOiB2dC5ub25lKCksIHZ0Lm5vbmUoKSwgbCA/IHZ0Lm5vbmUoKSA6IHZ0LnNvbWUocykpKSk7CiAgICB9KHUsIG4sIGUpOwogIH0KCiAgZnVuY3Rpb24gWEMobiwgdCwgZSkgewogICAgZS5zZXREb2NrZWQoITEpLCBTdChbImxlZnQiLCAicmlnaHQiLCAidG9wIiwgImJvdHRvbSIsICJwb3NpdGlvbiJdLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdm4obi5lbGVtZW50LCB0KTsKICAgIH0pLCB0Lm9uVW5kb2NrZWQobik7CiAgfQoKICBmdW5jdGlvbiBZQyh0LCBuLCBlLCBvKSB7CiAgICB2YXIgciA9ICJmaXhlZCIgPT09IG8ucG9zaXRpb247CiAgICBlLnNldERvY2tlZChyKSwgRWEodC5lbGVtZW50LCBvKSwgKHIgPyBuLm9uRG9ja2VkIDogbi5vblVuZG9ja2VkKSh0KTsKICB9CgogIGZ1bmN0aW9uIHFDKG8sIHQsIHIsIGksIHUpIHsKICAgIHZvaWQgMCA9PT0gdSAmJiAodSA9ICExKSwgdC5jb250ZXh0dWFsLmVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgZS5sYXp5Q29udGV4dChvKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSB0LnkgPCBpLmJvdHRvbSAmJiB0LmJvdHRvbSA+IGkueTsKICAgICAgICBuICE9PSByLmlzVmlzaWJsZSgpICYmIChyLnNldFZpc2libGUobiksIHUgJiYgIW4gPyAoS3Ioby5lbGVtZW50LCBbZS5mYWRlT3V0Q2xhc3NdKSwgZS5vbkhpZGUobykpIDogKG4gPyBOQyA6IExDKShvLCBlKSk7CiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBLQyh0LCBuLCBlKSB7CiAgICB2YXIgbywgciwgaSwgdSwgYSwgYzsKICAgIGUuaXNEb2NrZWQoKSAmJiAociA9IG4sIGkgPSBlLCBjID0gKG8gPSB0KS5lbGVtZW50LCBpLnNldERvY2tlZCghMSksIFVDKGEgPSBvLmVsZW1lbnQsIHUgPSBpKS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBqQyhhLCB0LCB1KTsKICAgIH0pLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgdC5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gWEMobywgciwgaSk7CiAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIFlDKG8sIHIsIGksIHQpOwogICAgICB9LCBzdCk7CiAgICB9KSwgaS5zZXRWaXNpYmxlKCEwKSwgci5jb250ZXh0dWFsLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgSnIoYywgW3QuZmFkZUluQ2xhc3MsIHQuZmFkZU91dENsYXNzLCB0LnRyYW5zaXRpb25DbGFzc10pLCB0Lm9uU2hvdyhvKTsKICAgIH0pLCBQMShvLCByLCBpKSk7CiAgfQoKICBmdW5jdGlvbiBKQyh0LCBuKSB7CiAgICByZXR1cm4gd3QoTjEuZ2V0TW9kZXModCksIG4pOwogIH0KCiAgZnVuY3Rpb24gJEMocikgewogICAgdmFyIGkgPSByLmVsZW1lbnQ7CiAgICBZdChpKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgZSwKICAgICAgICAgIG8gPSAicGFkZGluZy0iICsgTjEuZ2V0TW9kZXMocilbMF07CiAgICAgIE4xLmlzRG9ja2VkKHIpID8gKG4gPSBrbih0KSwgZm4oaSwgIndpZHRoIiwgbiArICJweCIpLCBmbih0LCBvLCB3bihlID0gaSkgKyAocGFyc2VJbnQoZ24oZSwgIm1hcmdpbi10b3AiKSwgMTApIHx8IDApICsgKHBhcnNlSW50KGduKGUsICJtYXJnaW4tYm90dG9tIiksIDEwKSB8fCAwKSArICJweCIpKSA6ICh2bihpLCAid2lkdGgiKSwgdm4odCwgbykpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBRQyh0LCBuKSB7CiAgICBuID8gKFlyKHQsIFcxLmZhZGVPdXRDbGFzcyksIEtyKHQsIFtXMS50cmFuc2l0aW9uQ2xhc3MsIFcxLmZhZGVJbkNsYXNzXSkpIDogKFlyKHQsIFcxLmZhZGVJbkNsYXNzKSwgS3IodCwgW1cxLmZhZGVPdXRDbGFzcywgVzEudHJhbnNpdGlvbkNsYXNzXSkpOwogIH0KCiAgZnVuY3Rpb24gWkModCwgbikgewogICAgdmFyIGUgPSBBdC5mcm9tRG9tKHQuZ2V0Q29udGFpbmVyKCkpOwogICAgbiA/IChYcihlLCBVMSksIFlyKGUsIGoxKSkgOiAoWHIoZSwgajEpLCBZcihlLCBVMSkpOwogIH0KCiAgZnVuY3Rpb24gdGsodSwgdCkgewogICAgZnVuY3Rpb24gbyhuKSB7CiAgICAgIHIoKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIG4odC5lbGVtZW50KTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIHUuaW5saW5lIHx8ICRDKHQpLCBaQyh1LCBOMS5pc0RvY2tlZCh0KSksIHQuZ2V0U3lzdGVtKCkuYnJvYWRjYXN0T24oW2JmKCldLCB7fSksIHIoKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHQuZ2V0U3lzdGVtKCkuYnJvYWRjYXN0T24oW2JmKCldLCB7fSk7CiAgICAgIH0pOwogICAgfQoKICAgIHZhciBlLAogICAgICAgIGkgPSBkYygpLAogICAgICAgIHIgPSB0LmdldFNpbmssCiAgICAgICAgYSA9IHUuaW5saW5lID8gW10gOiBbcmMuY29uZmlnKHsKICAgICAgY2hhbm5lbHM6ICgoZSA9IHt9KVtMMSgpXSA9IHsKICAgICAgICBvblJlY2VpdmU6ICRDCiAgICAgIH0sIGUpCiAgICB9KV07CiAgICByZXR1cm4gSChbVmcuY29uZmlnKHt9KSwgTjEuY29uZmlnKHsKICAgICAgY29udGV4dHVhbDogX2x0KHsKICAgICAgICBsYXp5Q29udGV4dDogZnVuY3Rpb24gbGF6eUNvbnRleHQodCkgewogICAgICAgICAgdmFyIG4gPSB3bih0LmVsZW1lbnQpLAogICAgICAgICAgICAgIGUgPSB1LmlubGluZSA/IHUuZ2V0Q29udGVudEFyZWFDb250YWluZXIoKSA6IHUuZ2V0Q29udGFpbmVyKCksCiAgICAgICAgICAgICAgbyA9IE1lKEF0LmZyb21Eb20oZSkpLAogICAgICAgICAgICAgIHIgPSBvLmhlaWdodCAtIG4sCiAgICAgICAgICAgICAgaSA9IG8ueSArIChKQyh0LCAidG9wIikgPyAwIDogbik7CiAgICAgICAgICByZXR1cm4gdnQuc29tZShCZShvLngsIGksIG8ud2lkdGgsIHIpKTsKICAgICAgICB9LAogICAgICAgIG9uU2hvdzogZnVuY3Rpb24gb25TaG93KCkgewogICAgICAgICAgbyhmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gUUModCwgITApOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBvblNob3duOiBmdW5jdGlvbiBvblNob3duKHIpIHsKICAgICAgICAgIG8oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIEpyKHQsIFtXMS50cmFuc2l0aW9uQ2xhc3MsIFcxLmZhZGVJbkNsYXNzXSk7CiAgICAgICAgICB9KSwgaS5nZXQoKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgICAgZSA9IHIuZWxlbWVudCwKICAgICAgICAgICAgICAgIG8gPSBVdChuID0gdCk7CiAgICAgICAgICAgIGthKG8pLmZpbHRlcihmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiAhTHQobiwgdCk7CiAgICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiBMdCh0LCBBdC5mcm9tRG9tKG8uZG9tLmJvZHkpKSB8fCBXdChlLCB0KTsKICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFNhKG4pOwogICAgICAgICAgICB9KSwgaS5jbGVhcigpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBvbkhpZGU6IGZ1bmN0aW9uIG9uSGlkZSh0KSB7CiAgICAgICAgICB2YXIgbiA9IHQuZWxlbWVudCwKICAgICAgICAgICAgICBlID0gcjsKICAgICAgICAgIE9hKG4pLm9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZSgpLnRvT3B0aW9uYWwoKS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIE9hKHQuZWxlbWVudCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkuZm9sZChpLmNsZWFyLCBpLnNldCksIG8oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIFFDKHQsICExKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25IaWRkZW46IGZ1bmN0aW9uIG9uSGlkZGVuKCkgewogICAgICAgICAgbyhmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gSnIodCwgW1cxLnRyYW5zaXRpb25DbGFzc10pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCBXMSksCiAgICAgIGxhenlWaWV3cG9ydDogZnVuY3Rpb24gbGF6eVZpZXdwb3J0KHQpIHsKICAgICAgICB2YXIgbiA9IEFlKCksCiAgICAgICAgICAgIGUgPSB1LmdldFBhcmFtKCJ0b29sYmFyX3N0aWNreV9vZmZzZXQiLCAwLCAibnVtYmVyIiksCiAgICAgICAgICAgIG8gPSBuLnkgKyAoSkModCwgInRvcCIpID8gZSA6IDApLAogICAgICAgICAgICByID0gbi5oZWlnaHQgLSAoSkModCwgImJvdHRvbSIpID8gZSA6IDApOwogICAgICAgIHJldHVybiBCZShuLngsIG8sIG4ud2lkdGgsIHIpOwogICAgICB9LAogICAgICBtb2RlczogW3QuaGVhZGVyLmdldERvY2tpbmdNb2RlKCldLAogICAgICBvbkRvY2tlZDogbiwKICAgICAgb25VbmRvY2tlZDogbgogICAgfSldLCBhLCAhMCk7CiAgfQoKICBmdW5jdGlvbiBuayh0KSB7CiAgICByZXR1cm4gdW8oIm1lbnVidXR0b24iLCBxMSwgdCk7CiAgfQoKICBmdW5jdGlvbiBlayhuLCB0KSB7CiAgICByZXR1cm4gdC5nZXRBbmltYXRpb25Sb290LmZvbGQoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbi5lbGVtZW50OwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQobik7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIG9rKHQpIHsKICAgIHJldHVybiB0LmRpbWVuc2lvbi5wcm9wZXJ0eTsKICB9CgogIGZ1bmN0aW9uIHJrKHQsIG4pIHsKICAgIHJldHVybiB0LmRpbWVuc2lvbi5nZXREaW1lbnNpb24obik7CiAgfQoKICBmdW5jdGlvbiBpayh0LCBuKSB7CiAgICBKcihlayh0LCBuKSwgW24uc2hyaW5raW5nQ2xhc3MsIG4uZ3Jvd2luZ0NsYXNzXSk7CiAgfQoKICBmdW5jdGlvbiB1ayh0LCBuKSB7CiAgICBZcih0LmVsZW1lbnQsIG4ub3BlbkNsYXNzKSwgWHIodC5lbGVtZW50LCBuLmNsb3NlZENsYXNzKSwgZm4odC5lbGVtZW50LCBvayhuKSwgIjBweCIpLCBibih0LmVsZW1lbnQpOwogIH0KCiAgZnVuY3Rpb24gYWsodCwgbikgewogICAgWXIodC5lbGVtZW50LCBuLmNsb3NlZENsYXNzKSwgWHIodC5lbGVtZW50LCBuLm9wZW5DbGFzcyksIHZuKHQuZWxlbWVudCwgb2sobikpOwogIH0KCiAgZnVuY3Rpb24gY2sodCwgbiwgZSwgbykgewogICAgZS5zZXRDb2xsYXBzZWQoKSwgZm4odC5lbGVtZW50LCBvayhuKSwgcmsobiwgdC5lbGVtZW50KSksIGJuKHQuZWxlbWVudCksIGlrKHQsIG4pLCB1ayh0LCBuKSwgbi5vblN0YXJ0U2hyaW5rKHQpLCBuLm9uU2hydW5rKHQpOwogIH0KCiAgZnVuY3Rpb24gc2sodCwgbiwgZSkgewogICAgdmFyIG8gPSByayhuLCB0LmVsZW1lbnQpOwogICAgKCIwcHgiID09PSBvID8gY2sgOiBmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgICB2YXIgciA9IG8uZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHJrKG4sIHQuZWxlbWVudCk7CiAgICAgIH0pOwogICAgICBlLnNldENvbGxhcHNlZCgpLCBmbih0LmVsZW1lbnQsIG9rKG4pLCByKSwgYm4odC5lbGVtZW50KTsKICAgICAgdmFyIGkgPSBlayh0LCBuKTsKICAgICAgWXIoaSwgbi5ncm93aW5nQ2xhc3MpLCBYcihpLCBuLnNocmlua2luZ0NsYXNzKSwgdWsodCwgbiksIG4ub25TdGFydFNocmluayh0KTsKICAgIH0pKHQsIG4sIGUsIHZ0LnNvbWUobykpOwogIH0KCiAgZnVuY3Rpb24gbGsodCwgbiwgZSkgewogICAgdmFyIG8gPSBlayh0LCBuKSwKICAgICAgICByID0gcXIobywgbi5zaHJpbmtpbmdDbGFzcyksCiAgICAgICAgaSA9IHJrKG4sIHQuZWxlbWVudCk7CiAgICBhayh0LCBuKTsKICAgIHZhciB1ID0gcmsobiwgdC5lbGVtZW50KTsKICAgIChyID8gZnVuY3Rpb24gKCkgewogICAgICBmbih0LmVsZW1lbnQsIG9rKG4pLCBpKSwgYm4odC5lbGVtZW50KTsKICAgIH0gOiBmdW5jdGlvbiAoKSB7CiAgICAgIHVrKHQsIG4pOwogICAgfSkoKSwgWXIobywgbi5zaHJpbmtpbmdDbGFzcyksIFhyKG8sIG4uZ3Jvd2luZ0NsYXNzKSwgYWsodCwgbiksIGZuKHQuZWxlbWVudCwgb2sobiksIHUpLCBlLnNldEV4cGFuZGVkKCksIG4ub25TdGFydEdyb3codCk7CiAgfQoKICBmdW5jdGlvbiBmayh0LCBuLCBlKSB7CiAgICByZXR1cm4gITAgPT09IHFyKGVrKHQsIG4pLCBuLmdyb3dpbmdDbGFzcyk7CiAgfQoKICBmdW5jdGlvbiBkayh0LCBuLCBlKSB7CiAgICByZXR1cm4gITAgPT09IHFyKGVrKHQsIG4pLCBuLnNocmlua2luZ0NsYXNzKTsKICB9CgogIGZ1bmN0aW9uIG1rKHQpIHsKICAgIHJldHVybiAiPGFsbG95LmZpZWxkLiIgKyB0ICsgIj4iOwogIH0KCiAgZnVuY3Rpb24gZ2sodCkgewogICAgcmV0dXJuIHsKICAgICAgZWxlbWVudDogZnVuY3Rpb24gZWxlbWVudCgpIHsKICAgICAgICByZXR1cm4gdC5lbGVtZW50LmRvbTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIHBrKHQsIGUpIHsKICAgIHVkLmdldEN1cnJlbnQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gRmcuc2V0KHQsIFsobiA9IGUsIG9PLnNrZXRjaChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgY2xhc3NlczogWyJ0b3gtc2lkZWJhcl9fcGFuZS1jb250YWluZXIiXQogICAgICAgICAgfSwKICAgICAgICAgIGNvbXBvbmVudHM6IChlID0gdCwgciA9IE0oa3QobyA9IG4pLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICB2YXIgbiA9IG9bdF0sCiAgICAgICAgICAgICAgICBlID0gYW8odW8oInNpZGViYXIiLCByTywgbikpOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG5hbWU6IHQsCiAgICAgICAgICAgICAgZ2V0QXBpOiBnaywKICAgICAgICAgICAgICBvblNldHVwOiBlLm9uU2V0dXAsCiAgICAgICAgICAgICAgb25TaG93OiBlLm9uU2hvdywKICAgICAgICAgICAgICBvbkhpZGU6IGUub25IaWRlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KSwgTShyLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICB2YXIgbiA9IFZvKHN0KTsKICAgICAgICAgICAgcmV0dXJuIGUuc2xvdCh0Lm5hbWUsIHsKICAgICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgICAgICBjbGFzc2VzOiBbInRveC1zaWRlYmFyX19wYW5lIl0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJlaGF2aW91cnM6IFloKFtwdih0LCBuKSwgaHYodCwgbiksIENyKEtpKCksIGZ1bmN0aW9uIChuLCB0KSB7CiAgICAgICAgICAgICAgICB2YXIgZSA9IHQuZXZlbnQ7CiAgICAgICAgICAgICAgICBWKHIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0Lm5hbWUgPT09IGUubmFtZTsKICAgICAgICAgICAgICAgIH0pLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgKGUudmlzaWJsZSA/IHQub25TaG93IDogdC5vbkhpZGUpKHQuZ2V0QXBpKG4pKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pXSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSksCiAgICAgICAgICBzbG90QmVoYXZpb3VyczogWWgoW2V1KGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiBvTy5oaWRlQWxsU2xvdHModCk7CiAgICAgICAgICB9KV0pCiAgICAgICAgfTsKICAgICAgICB2YXIgZSwgbywgcjsKICAgICAgfSkpXSk7CiAgICAgIHZhciBuOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBoayh0KSB7CiAgICByZXR1cm4gdWQuZ2V0Q3VycmVudCh0KS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBaMS5pc0dyb3dpbmcodCkgfHwgWjEuaGFzR3Jvd24odCkgPyB1ZC5nZXRDdXJyZW50KHQpLmJpbmQoZnVuY3Rpb24gKG4pIHsKICAgICAgICByZXR1cm4gVihvTy5nZXRTbG90TmFtZXMobiksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gb08uaXNTaG93aW5nKG4sIHQpOwogICAgICAgIH0pOwogICAgICB9KSA6IHZ0Lm5vbmUoKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gdmsodCkgewogICAgdmFyIG4gPSBBdC5mcm9tSHRtbCh0KSwKICAgICAgICBlID0gS3QobiksCiAgICAgICAgbyA9IFIodm9pZCAwICE9PSBuLmRvbS5hdHRyaWJ1dGVzID8gbi5kb20uYXR0cmlidXRlcyA6IFtdLCBmdW5jdGlvbiAodCwgbikgewogICAgICB2YXIgZTsKICAgICAgcmV0dXJuICJjbGFzcyIgPT09IG4ubmFtZSA/IHQgOiBfbHQoX2x0KHt9LCB0KSwgKChlID0ge30pW24ubmFtZV0gPSBuLnZhbHVlLCBlKSk7CiAgICB9LCB7fSksCiAgICAgICAgciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKG4uZG9tLmNsYXNzTGlzdCwgMCksCiAgICAgICAgaSA9IDAgPT09IGUubGVuZ3RoID8ge30gOiB7CiAgICAgIGlubmVySHRtbDogQnIobikKICAgIH07CiAgICByZXR1cm4gX2x0KHsKICAgICAgdGFnOiBGdChuKSwKICAgICAgY2xhc3NlczogciwKICAgICAgYXR0cmlidXRlczogbwogICAgfSwgaSk7CiAgfQoKICBmdW5jdGlvbiBiayh0KSB7CiAgICByZXR1cm4gdWQuZ2V0Q3VycmVudCh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBTYSh0LmVsZW1lbnQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB5ayhmLCBkLCBtKSB7CiAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgdmFyIG47CiAgICAgICFnLmdldCgpIHx8ICJmb2N1c2luIiA9PT0gKG4gPSB0KS50eXBlICYmIChuLmNvbXBvc2VkID8gWShuLmNvbXBvc2VkUGF0aCgpKSA6IHZ0LmZyb20obi50YXJnZXQpKS5tYXAoQXQuZnJvbURvbSkuZmlsdGVyKEduKS5leGlzdHMoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gcXIodCwgIm1jZS1wYXN0ZWJpbiIpOwogICAgICB9KSB8fCAodC5wcmV2ZW50RGVmYXVsdCgpLCBiayhkKCkpLCBmLmVkaXRvck1hbmFnZXIuc2V0QWN0aXZlKGYpKTsKICAgIH0KCiAgICB2YXIgZyA9IFZvKCExKSwKICAgICAgICBlID0gZGMoKTsKCiAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgdmFyIG4sIGUsIG8sIHIsIGksIHUsIGEsIGMsIHMsIGw7CiAgICAgIHQgIT09IGcuZ2V0KCkgJiYgKGcuc2V0KHQpLCBuID0gZiwgZSA9IGQoKSwgbyA9IHQsIHIgPSBtLnByb3ZpZGVycywgYyA9IGUuZWxlbWVudCwgcyA9IG8sIGwgPSAiZGF0YS1tY2UtIiArIChpID0gInRhYmluZGV4IiksIHZ0LmZyb20obi5pZnJhbWVFbGVtZW50KS5tYXAoQXQuZnJvbURvbSkuZWFjaChmdW5jdGlvbiAobikgewogICAgICAgIHMgPyAodW4obiwgaSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIG9uKG4sIGwsIHQpOwogICAgICAgIH0pLCBvbihuLCBpLCAtMSkpIDogKGNuKG4sIGkpLCB1bihuLCBsKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBvbihuLCBpLCB0KSwgY24obiwgbCk7CiAgICAgICAgfSkpOwogICAgICB9KSwgbyA/IChjTy5ibG9jayhlLCAoYSA9IHIsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGRvbTogewogICAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgICAgImFyaWEtbGFiZWwiOiBhLnRyYW5zbGF0ZSgiTG9hZGluZy4uLiIpLAogICAgICAgICAgICAgIHRhYmluZGV4OiAiMCIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhc3NlczogWyJ0b3gtdGhyb2JiZXJfX2J1c3ktc3Bpbm5lciJdCiAgICAgICAgICB9LAogICAgICAgICAgY29tcG9uZW50czogW3sKICAgICAgICAgICAgZG9tOiB2aygnPGRpdiBjbGFzcz0idG94LXNwaW5uZXIiPjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjwvZGl2PicpCiAgICAgICAgICB9XQogICAgICAgIH07CiAgICAgIH0pKSwgdm4oYywgImRpc3BsYXkiKSwgY24oYywgImFyaWEtaGlkZGVuIiksIG4uaGFzRm9jdXMoKSAmJiBiayhlKSkgOiAodSA9IHVkLmdldEN1cnJlbnQoZSkuZXhpc3RzKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIENhKHQuZWxlbWVudCk7CiAgICAgIH0pLCBjTy51bmJsb2NrKGUpLCBmbihjLCAiZGlzcGxheSIsICJub25lIiksIG9uKGMsICJhcmlhLWhpZGRlbiIsICJ0cnVlIiksIHUgJiYgbi5mb2N1cygpKSwgZi5maXJlKCJBZnRlclByb2dyZXNzU3RhdGUiLCB7CiAgICAgICAgc3RhdGU6IHQKICAgICAgfSkpOwogICAgfQoKICAgIGYuaW5saW5lIHx8IGYub24oIlByZUluaXQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGYuZG9tLmJpbmQoZi5nZXRXaW4oKSwgImZvY3VzaW4iLCBuKSwgZi5vbigiQmVmb3JlRXhlY0NvbW1hbmQiLCBmdW5jdGlvbiAodCkgewogICAgICAgICJtY2Vmb2N1cyIgPT09IHQuY29tbWFuZC50b0xvd2VyQ2FzZSgpICYmICEwICE9PSB0LnZhbHVlICYmIG4odCk7CiAgICAgIH0pOwogICAgfSksIGYub24oIlByb2dyZXNzU3RhdGUiLCBmdW5jdGlvbiAodCkgewogICAgICB2YXIgbjsKICAgICAgZS5vbihjcC5jbGVhclRpbWVvdXQpLCB1KHQudGltZSkgPyAobiA9IGNwLnNldEVkaXRvclRpbWVvdXQoZiwgZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBvKHQuc3RhdGUpOwogICAgICB9LCB0LnRpbWUpLCBlLnNldChuKSkgOiAobyh0LnN0YXRlKSwgZS5jbGVhcigpKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24geGsodCwgbiwgZSkgewogICAgcmV0dXJuIHsKICAgICAgd2l0aGluOiB0LAogICAgICBleHRyYTogbiwKICAgICAgd2l0aGluV2lkdGg6IGUKICAgIH07CiAgfQoKICBmdW5jdGlvbiB3ayh0LCBuLCBvKSB7CiAgICB2YXIgZSwKICAgICAgICByID0gKGUgPSBmdW5jdGlvbiBlKHQsIG4pIHsKICAgICAgdmFyIGUgPSBvKHQpOwogICAgICByZXR1cm4gdnQuc29tZSh7CiAgICAgICAgZWxlbWVudDogdCwKICAgICAgICBzdGFydDogbiwKICAgICAgICBmaW5pc2g6IG4gKyBlLAogICAgICAgIHdpZHRoOiBlCiAgICAgIH0pOwogICAgfSwgUih0LCBmdW5jdGlvbiAobiwgdCkgewogICAgICByZXR1cm4gZSh0LCBuLmxlbikuZm9sZChydChuKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgbGVuOiB0LmZpbmlzaCwKICAgICAgICAgIGxpc3Q6IG4ubGlzdC5jb25jYXQoW3RdKQogICAgICAgIH07CiAgICAgIH0pOwogICAgfSwgewogICAgICBsZW46IDAsCiAgICAgIGxpc3Q6IFtdCiAgICB9KS5saXN0KSwKICAgICAgICBpID0gRihyLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdC5maW5pc2ggPD0gbjsKICAgIH0pLAogICAgICAgIHUgPSBJKGksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiB0ICsgbi53aWR0aDsKICAgIH0sIDApOwogICAgcmV0dXJuIHsKICAgICAgd2l0aGluOiBpLAogICAgICBleHRyYTogci5zbGljZShpLmxlbmd0aCksCiAgICAgIHdpdGhpbldpZHRoOiB1CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gU2sodCkgewogICAgcmV0dXJuIE0odCwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQuZWxlbWVudDsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gQ2sodCwgbikgewogICAgdmFyIGUgPSBNKG4sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBUdSh0KTsKICAgIH0pOwogICAgRjEuc2V0R3JvdXBzKHQsIGUpOwogIH0KCiAgZnVuY3Rpb24ga2sodCwgbiwgZSkgewogICAgdmFyIG8sCiAgICAgICAgciwKICAgICAgICBpLAogICAgICAgIHUsCiAgICAgICAgYSwKICAgICAgICBjLAogICAgICAgIHMsCiAgICAgICAgbCwKICAgICAgICBmLAogICAgICAgIGQsCiAgICAgICAgbSwKICAgICAgICBnLAogICAgICAgIHAsCiAgICAgICAgaCwKICAgICAgICB2LAogICAgICAgIGIsCiAgICAgICAgeSwKICAgICAgICB4LAogICAgICAgIHcsCiAgICAgICAgUywKICAgICAgICBDID0gbi5idWlsdEdyb3Vwcy5nZXQoKTsKICAgIDAgIT09IEMubGVuZ3RoICYmIChvID0gZGwodCwgbiwgInByaW1hcnkiKSwgciA9IFl5LmdldENvdXBsZWQodCwgIm92ZXJmbG93R3JvdXAiKSwgZm4oby5lbGVtZW50LCAidmlzaWJpbGl0eSIsICJoaWRkZW4iKSwgdSA9IEsoaSA9IEMuY29uY2F0KFtyXSksIGZ1bmN0aW9uIChuKSB7CiAgICAgIHJldHVybiBPYShuLmVsZW1lbnQpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gbi5nZXRTeXN0ZW0oKS5nZXRCeURvbSh0KS50b09wdGlvbmFsKCk7CiAgICAgIH0pOwogICAgfSksIGUoW10pLCBDayhvLCBpKSwgYSA9IGtuKG8uZWxlbWVudCksIDAgPT09IChzID0gYSwgbCA9IG4uYnVpbHRHcm91cHMuZ2V0KCksIGQgPSByLCB5ID0gKDAgPT09IChtID0gd2sobCwgcywgZiA9IGZ1bmN0aW9uIGYodCkgewogICAgICByZXR1cm4ga24odC5lbGVtZW50KTsKICAgIH0pKS5leHRyYS5sZW5ndGggPyB2dC5zb21lKG0pIDogdnQubm9uZSgpKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHdrKGwsIHMgLSBmKGQpLCBmKTsKICAgIH0pLCB4ID0geS53aXRoaW4sIHcgPSB5LmV4dHJhLCBTID0geS53aXRoaW5XaWR0aCwgKGMgPSAxID09PSB3Lmxlbmd0aCAmJiB3WzBdLndpZHRoIDw9IGYoZCkgPyAoYiA9IFMsIHhrKFNrKHguY29uY2F0KHcpKSwgW10sIGIpKSA6IDEgPD0gdy5sZW5ndGggPyAocCA9IHcsIGggPSBkLCB2ID0gUywgeGsoU2soeCkuY29uY2F0KFtoXSksIFNrKHApLCB2KSkgOiAoZyA9IFMsIHhrKFNrKHgpLCBbXSwgZykpKS5leHRyYS5sZW5ndGgpID8gKEZnLnJlbW92ZShvLCByKSwgZShbXSkpIDogKENrKG8sIGMud2l0aGluKSwgZShjLmV4dHJhKSksIHZuKG8uZWxlbWVudCwgInZpc2liaWxpdHkiKSwgYm4oby5lbGVtZW50KSwgdS5lYWNoKFZnLmZvY3VzKSk7CiAgfQoKICBmdW5jdGlvbiBPayh0LCBuKSB7CiAgICB2YXIgZSA9IFl5LmdldENvdXBsZWQodCwgInRvb2xiYXJTYW5kYm94Iik7CiAgICBoZi5pc09wZW4oZSkgPyBoZi5jbG9zZShlKSA6IGhmLm9wZW4oZSwgbi50b29sYmFyKCkpOwogIH0KCiAgZnVuY3Rpb24gX2sodCwgbiwgZSwgbykgewogICAgdmFyIHIgPSBlLmdldEJvdW5kcy5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQoKTsKICAgIH0pLAogICAgICAgIGkgPSBlLmxhenlTaW5rKHQpLmdldE9yRGllKCk7CiAgICBzZi5wb3NpdGlvbldpdGhpbkJvdW5kcyhpLCBuLCB7CiAgICAgIGFuY2hvcjogewogICAgICAgIHR5cGU6ICJob3RzcG90IiwKICAgICAgICBob3RzcG90OiB0LAogICAgICAgIGxheW91dHM6IG8sCiAgICAgICAgb3ZlcnJpZGVzOiB7CiAgICAgICAgICBtYXhXaWR0aEZ1bmN0aW9uOiBkTygpCiAgICAgICAgfQogICAgICB9CiAgICB9LCByKTsKICB9CgogIGZ1bmN0aW9uIFRrKHQsIG4sIGUsIG8sIHIpIHsKICAgIEYxLnNldEdyb3VwcyhuLCByKSwgX2sodCwgbiwgZSwgbyksIHpnLm9uKHQpOwogIH0KCiAgZnVuY3Rpb24gRWsodCkgewogICAgcmV0dXJuIE0odCwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIFR1KHQpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBEayh0LCBlLCBvKSB7CiAgICBrayh0LCBvLCBmdW5jdGlvbiAobikgewogICAgICBvLm92ZXJmbG93R3JvdXBzLnNldChuKSwgZS5nZXRPcHQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIHBPLnNldEdyb3Vwcyh0LCBFayhuKSk7CiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBCayhuLCBlKSB7CiAgICBmbChuLCBlLCAib3ZlcmZsb3ctYnV0dG9uIikuYmluZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBmbChuLCBlLCAib3ZlcmZsb3ciKTsKICAgIH0pLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgS2sobiwgZSksIFoxLnRvZ2dsZUdyb3codCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIE1rKHQpIHsKICAgIHZhciBuID0gdC50aXRsZS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHt9OwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB0aXRsZTogdAogICAgICAgIH0KICAgICAgfTsKICAgIH0pOwogICAgcmV0dXJuIHsKICAgICAgZG9tOiBfbHQoewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtdG9vbGJhcl9fZ3JvdXAiXQogICAgICB9LCBuKSwKICAgICAgY29tcG9uZW50czogW2JPLnBhcnRzLml0ZW1zKHt9KV0sCiAgICAgIGl0ZW1zOiB0Lml0ZW1zLAogICAgICBtYXJrZXJzOiB7CiAgICAgICAgaXRlbVNlbGVjdG9yOiAiKjpub3QoLnRveC1zcGxpdC1idXR0b24pID4gLnRveC10YnRuOm5vdChbZGlzYWJsZWRdKSwgLnRveC1zcGxpdC1idXR0b246bm90KFtkaXNhYmxlZF0pLCAudG94LXRvb2xiYXItbmF2LWpzOm5vdChbZGlzYWJsZWRdKSIKICAgICAgfSwKICAgICAgdGdyb3VwQmVoYXZpb3VyczogdGMoW2Z5LmNvbmZpZyh7fSksIFZnLmNvbmZpZyh7fSldKQogICAgfTsKICB9CgogIGZ1bmN0aW9uIEFrKHQpIHsKICAgIHJldHVybiBiTy5za2V0Y2goTWsodCkpOwogIH0KCiAgZnVuY3Rpb24gRmsoZSwgdCkgewogICAgdmFyIG4gPSBldShmdW5jdGlvbiAodCkgewogICAgICB2YXIgbiA9IE0oZS5pbml0R3JvdXBzLCBBayk7CiAgICAgIEYxLnNldEdyb3Vwcyh0LCBuKTsKICAgIH0pOwogICAgcmV0dXJuIHRjKFtKdihlLnByb3ZpZGVycy5pc0Rpc2FibGVkKSwgbXYoKSwgTWcuY29uZmlnKHsKICAgICAgbW9kZTogdCwKICAgICAgb25Fc2NhcGU6IGUub25Fc2NhcGUsCiAgICAgIHNlbGVjdG9yOiAiLnRveC10b29sYmFyX19ncm91cCIKICAgIH0pLCBmbSgidG9vbGJhci1ldmVudHMiLCBbbl0pXSk7CiAgfQoKICBmdW5jdGlvbiBJayh0KSB7CiAgICB2YXIgbiA9IHQuY3ljbGljS2V5aW5nID8gImN5Y2xpYyIgOiAiYWN5Y2xpYyI7CiAgICByZXR1cm4gewogICAgICB1aWQ6IHQudWlkLAogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LXRvb2xiYXItb3ZlcmxvcmQiXQogICAgICB9LAogICAgICBwYXJ0czogewogICAgICAgICJvdmVyZmxvdy1ncm91cCI6IE1rKHsKICAgICAgICAgIHRpdGxlOiB2dC5ub25lKCksCiAgICAgICAgICBpdGVtczogW10KICAgICAgICB9KSwKICAgICAgICAib3ZlcmZsb3ctYnV0dG9uIjogVTAoewogICAgICAgICAgbmFtZTogIm1vcmUiLAogICAgICAgICAgaWNvbjogdnQuc29tZSgibW9yZS1kcmF3ZXIiKSwKICAgICAgICAgIGRpc2FibGVkOiAhMSwKICAgICAgICAgIHRvb2x0aXA6IHZ0LnNvbWUoIk1vcmUuLi4iKSwKICAgICAgICAgIHByaW1hcnk6ICExLAogICAgICAgICAgYm9yZGVybGVzczogITEKICAgICAgICB9LCB2dC5ub25lKCksIHQucHJvdmlkZXJzKQogICAgICB9LAogICAgICBzcGxpdFRvb2xiYXJCZWhhdmlvdXJzOiBGayh0LCBuKQogICAgfTsKICB9CgogIGZ1bmN0aW9uIFJrKHQpIHsKICAgIHZhciBuID0gdC5jeWNsaWNLZXlpbmcgPyAiY3ljbGljIiA6ICJhY3ljbGljIjsKICAgIHJldHVybiBGMS5za2V0Y2goewogICAgICB1aWQ6IHQudWlkLAogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LXRvb2xiYXIiXS5jb25jYXQodC50eXBlID09PSBoaC5zY3JvbGxpbmcgPyBbInRveC10b29sYmFyLS1zY3JvbGxpbmciXSA6IFtdKQogICAgICB9LAogICAgICBjb21wb25lbnRzOiBbRjEucGFydHMuZ3JvdXBzKHt9KV0sCiAgICAgIHRvb2xiYXJCZWhhdmlvdXJzOiBGayh0LCBuKQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBWayh0KSB7CiAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIHQgPyB0LnNwbGl0KCIgIikgOiB0OwogIH0KCiAgZnVuY3Rpb24gUGsoaSwgdSkgewogICAgdmFyIGEgPSBfbHQoX2x0KHt9LCBNTyksIHUubWVudXMpLAogICAgICAgIGUgPSAwIDwga3QodS5tZW51cykubGVuZ3RoLAogICAgICAgIHQgPSBGKHZvaWQgMCA9PT0gdS5tZW51YmFyIHx8ICEwID09PSB1Lm1lbnViYXIgPyBWaygiZmlsZSBlZGl0IHZpZXcgaW5zZXJ0IGZvcm1hdCB0b29scyB0YWJsZSBoZWxwIikgOiBWayghMSA9PT0gdS5tZW51YmFyID8gIiIgOiB1Lm1lbnViYXIpLCBmdW5jdGlvbiAodCkgewogICAgICB2YXIgbiA9IFR0KE1PLCB0KTsKICAgICAgcmV0dXJuIGUgPyBuIHx8IHR0KHUubWVudXMsIHQpLmV4aXN0cyhmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBUdCh0LCAiaXRlbXMiKTsKICAgICAgfSkgOiBuOwogICAgfSk7CgogICAgcmV0dXJuIEYoTSh0LCBmdW5jdGlvbiAodCkgewogICAgICB2YXIgbiA9IGFbdF0sCiAgICAgICAgICBlID0gewogICAgICAgIHRpdGxlOiBuLnRpdGxlLAogICAgICAgIGl0ZW1zOiBWayhuLml0ZW1zKQogICAgICB9LAogICAgICAgICAgbyA9IHUsCiAgICAgICAgICByID0gaS5nZXRQYXJhbSgicmVtb3ZlZF9tZW51aXRlbXMiLCAiIikuc3BsaXQoL1sgLF0vKTsKICAgICAgcmV0dXJuIHsKICAgICAgICB0ZXh0OiBlLnRpdGxlLAogICAgICAgIGdldEl0ZW1zOiBmdW5jdGlvbiBnZXRJdGVtcygpIHsKICAgICAgICAgIHJldHVybiB6KGUuaXRlbXMsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHZhciBuID0gdC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICByZXR1cm4gMCA9PT0gbi50cmltKCkubGVuZ3RoIHx8IFQociwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gdCA9PT0gbjsKICAgICAgICAgICAgfSkgPyBbXSA6ICJzZXBhcmF0b3IiID09PSBuIHx8ICJ8IiA9PT0gbiA/IFt7CiAgICAgICAgICAgICAgdHlwZTogInNlcGFyYXRvciIKICAgICAgICAgICAgfV0gOiBvLm1lbnVJdGVtc1tuXSA/IFtvLm1lbnVJdGVtc1tuXV0gOiBbXTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKICAgIH0pLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gMCA8IHQuZ2V0SXRlbXMoKS5sZW5ndGggJiYgVCh0LmdldEl0ZW1zKCksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuICJzZXBhcmF0b3IiICE9PSB0LnR5cGU7CiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBIayh0KSB7CiAgICBmdW5jdGlvbiBuKCkgewogICAgICB0Ll9za2luTG9hZGVkID0gITAsIHQuZmlyZSgiU2tpbkxvYWRlZCIpOwogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHQuaW5pdGlhbGl6ZWQgPyBuKCkgOiB0Lm9uKCJpbml0Iiwgbik7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gemsoZSwgbywgcikgewogICAgcmV0dXJuIG5ldyBCcChmdW5jdGlvbiAodCwgbikgewogICAgICByLmxvYWQobywgdCwgbiksIGUub24oInJlbW92ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gci51bmxvYWQobyk7CiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBOayh0LCBuKSB7CiAgICB2YXIgZSwKICAgICAgICBvLAogICAgICAgIHIsCiAgICAgICAgaSwKICAgICAgICB1LAogICAgICAgIGEsCiAgICAgICAgYywKICAgICAgICBzLAogICAgICAgIGwsCiAgICAgICAgZiA9IChyID0gKGUgPSBuKS5nZXRQYXJhbSgic2tpbiIpLCBpID0gZS5nZXRQYXJhbSgic2tpbl91cmwiKSwgITEgIT09IHIgJiYgKG8gPSByIHx8ICJveGlkZSIsIGkgPSBpID8gZS5kb2N1bWVudEJhc2VVUkkudG9BYnNvbHV0ZShpKSA6IG52LmJhc2VVUkwgKyAiL3NraW5zL3VpLyIgKyBvKSwgaSk7CiAgICBmICYmIG4uY29udGVudENTUy5wdXNoKGYgKyAodCA/ICIvY29udGVudC5pbmxpbmUiIDogIi9jb250ZW50IikgKyAiLm1pbi5jc3MiKSwgITEgPT09IG4uZ2V0UGFyYW0oInNraW4iKSA9PSAwICYmIHkoZikgPyBCcC5hbGwoW3prKG4sIGYgKyAiL3NraW4ubWluLmNzcyIsIG4udWkuc3R5bGVTaGVldExvYWRlciksIChjID0gbiwgcyA9IGYsIGwgPSBBdC5mcm9tRG9tKGMuZ2V0RWxlbWVudCgpKSwgZ2UobCkuaXNTb21lKCkgPyB6ayhjLCBzICsgIi9za2luLnNoYWRvd2RvbS5taW4uY3NzIiwgdHYuRE9NLnN0eWxlU2hlZXRMb2FkZXIpIDogQnAucmVzb2x2ZSgpKV0pLnRoZW4oSGsobiksICh1ID0gbiwgYSA9ICJTa2luIGNvdWxkIG5vdCBiZSBsb2FkZWQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB1LmZpcmUoIlNraW5Mb2FkRXJyb3IiLCB7CiAgICAgICAgbWVzc2FnZTogYQogICAgICB9KTsKICAgIH0pKSA6IEhrKG4pKCk7CiAgfQoKICBmdW5jdGlvbiBMayhvLCByKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKG4pIHsKICAgICAgZnVuY3Rpb24gdCgpIHsKICAgICAgICBuLnNldEFjdGl2ZShvLmZvcm1hdHRlci5tYXRjaChyKSk7CiAgICAgICAgdmFyIHQgPSBvLmZvcm1hdHRlci5mb3JtYXRDaGFuZ2VkKHIsIG4uc2V0QWN0aXZlKTsKICAgICAgICBlLnNldCh0KTsKICAgICAgfQoKICAgICAgdmFyIGUgPSBmYygpOwogICAgICByZXR1cm4gby5pbml0aWFsaXplZCA/IHQoKSA6IG8ub25jZSgiaW5pdCIsIHQpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgby5vZmYoImluaXQiLCB0KSwgZS5jbGVhcigpOwogICAgICB9OwogICAgfTsKICB9CgogIGZ1bmN0aW9uIFdrKG8sIHIsIGkpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICBmdW5jdGlvbiBuKCkgewogICAgICAgIHJldHVybiBpKHQpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBlKCkgewogICAgICAgIGkodCksIG8ub24ociwgbik7CiAgICAgIH0KCiAgICAgIHJldHVybiBvLmluaXRpYWxpemVkID8gZSgpIDogby5vbmNlKCJpbml0IiwgZSksIGZ1bmN0aW9uICgpIHsKICAgICAgICBvLm9mZigiaW5pdCIsIGUpLCBvLm9mZihyLCBuKTsKICAgICAgfTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBVayhuKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICBuLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG4uZm9jdXMoKSwgbi5leGVjQ29tbWFuZCgibWNlVG9nZ2xlRm9ybWF0IiwgITEsIHQuZm9ybWF0KTsKICAgICAgICB9KTsKICAgICAgfTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBqayh0LCBuKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdC5leGVjQ29tbWFuZChuKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBHayh0LCBuLCBlKSB7CiAgICB2YXIgdSwKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICAgbyA9IGUuZGF0YXNldCwKICAgICAgICByID0gImJhc2ljIiA9PT0gby50eXBlID8gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTShvLmRhdGEsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIGhDKHQsIGUuaXNTZWxlY3RlZEZvciwgZS5nZXRQcmV2aWV3Rm9yKTsKICAgICAgfSk7CiAgICB9IDogby5nZXREYXRhOwogICAgcmV0dXJuIHsKICAgICAgaXRlbXM6ICh1ID0gbiwgYSA9IGUsIGMgPSBmdW5jdGlvbiBjKHQsIG4sIGUpIHsKICAgICAgICB2YXIgbyA9ICJmb3JtYXR0ZXIiID09PSB0LnR5cGUgJiYgYS5pc0ludmFsaWQodCk7CiAgICAgICAgcmV0dXJuIDAgPT09IG4gPyBvID8gW10gOiBpKHQsIG4sICExLCBlKS50b0FycmF5KCkgOiBpKHQsIG4sIG8sIGUpLnRvQXJyYXkoKTsKICAgICAgfSwgewogICAgICAgIHZhbGlkYXRlSXRlbXM6IHMsCiAgICAgICAgZ2V0RmV0Y2g6IGZ1bmN0aW9uIGdldEZldGNoKGUsIG8pIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICBuKHowKHMobygpKSwgeGguQ0xPU0VfT05fRVhFQ1VURSwgZSwgITEpKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9KSwKICAgICAgZ2V0U3R5bGVJdGVtczogcgogICAgfTsKCiAgICBmdW5jdGlvbiBpKHQsIG4sIGUsIG8pIHsKICAgICAgdmFyIHIgPSB1LnNoYXJlZC5wcm92aWRlcnMudHJhbnNsYXRlKHQudGl0bGUpOwogICAgICBpZiAoInNlcGFyYXRvciIgPT09IHQudHlwZSkgcmV0dXJuIHZ0LnNvbWUoewogICAgICAgIHR5cGU6ICJzZXBhcmF0b3IiLAogICAgICAgIHRleHQ6IHIKICAgICAgfSk7CiAgICAgIGlmICgic3VibWVudSIgIT09IHQudHlwZSkgcmV0dXJuIHZ0LnNvbWUoX2x0KHsKICAgICAgICB0eXBlOiAidG9nZ2xlbWVudWl0ZW0iLAogICAgICAgIHRleHQ6IHIsCiAgICAgICAgaWNvbjogdC5pY29uLAogICAgICAgIGFjdGl2ZTogdC5pc1NlbGVjdGVkKG8pLAogICAgICAgIGRpc2FibGVkOiBlLAogICAgICAgIG9uQWN0aW9uOiBhLm9uQWN0aW9uKHQpCiAgICAgIH0sIHQuZ2V0U3R5bGVQcmV2aWV3KCkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHt9OwogICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBtZXRhOiB7CiAgICAgICAgICAgIHN0eWxlOiB0CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSkpKTsKICAgICAgdmFyIGkgPSB6KHQuZ2V0U3R5bGVJdGVtcygpLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBjKHQsIG4sIG8pOwogICAgICB9KTsKICAgICAgcmV0dXJuIDAgPT09IG4gJiYgaS5sZW5ndGggPD0gMCA/IHZ0Lm5vbmUoKSA6IHZ0LnNvbWUoewogICAgICAgIHR5cGU6ICJuZXN0ZWRtZW51aXRlbSIsCiAgICAgICAgdGV4dDogciwKICAgICAgICBkaXNhYmxlZDogaS5sZW5ndGggPD0gMCwKICAgICAgICBnZXRTdWJtZW51SXRlbXM6IGZ1bmN0aW9uIGdldFN1Ym1lbnVJdGVtcygpIHsKICAgICAgICAgIHJldHVybiB6KHQuZ2V0U3R5bGVJdGVtcygpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gYyh0LCBuLCBvKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gcyh0KSB7CiAgICAgIHZhciBuID0gYS5nZXRDdXJyZW50VmFsdWUoKSwKICAgICAgICAgIGUgPSBhLnNob3VsZEhpZGUgPyAwIDogMTsKICAgICAgcmV0dXJuIHoodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gYyh0LCBlLCBuKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBYayh0LCBuLCBlKSB7CiAgICB2YXIgbyA9IEdrKDAsIG4sIGUpLAogICAgICAgIHIgPSBvLml0ZW1zLAogICAgICAgIGkgPSBvLmdldFN0eWxlSXRlbXMsCiAgICAgICAgdSA9IFdrKHQsICJOb2RlQ2hhbmdlIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSB0LmdldENvbXBvbmVudCgpOwogICAgICBlLnVwZGF0ZVRleHQobik7CiAgICB9KTsKICAgIHJldHVybiBQMCh7CiAgICAgIHRleHQ6IGUuaWNvbi5pc1NvbWUoKSA/IHZ0Lm5vbmUoKSA6IGUudGV4dCwKICAgICAgaWNvbjogZS5pY29uLAogICAgICB0b29sdGlwOiB2dC5mcm9tKGUudG9vbHRpcCksCiAgICAgIHJvbGU6IHZ0Lm5vbmUoKSwKICAgICAgZmV0Y2g6IHIuZ2V0RmV0Y2gobiwgaSksCiAgICAgIG9uU2V0dXA6IHUsCiAgICAgIGdldEFwaTogZnVuY3Rpb24gZ2V0QXBpKHQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZ2V0Q29tcG9uZW50OiBydCh0KQogICAgICAgIH07CiAgICAgIH0sCiAgICAgIGNvbHVtbnM6IDEsCiAgICAgIHByZXNldHM6ICJub3JtYWwiLAogICAgICBjbGFzc2VzOiBlLmljb24uaXNTb21lKCkgPyBbXSA6IFsiYmVzcG9rZSJdLAogICAgICBkcm9wZG93bkJlaGF2aW91cnM6IFtdCiAgICB9LCAidG94LXRidG4iLCBuLnNoYXJlZCk7CiAgfQoKICBmdW5jdGlvbiBZayh0KSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgZm9yICg7IHQgPSB0LnBhcmVudE5vZGU7KSB7CiAgICAgICAgdmFyIG4gPSB0LmNvbnRlbnRFZGl0YWJsZTsKICAgICAgICBpZiAobiAmJiAiaW5oZXJpdCIgIT09IG4pIHJldHVybiBTMSh0KTsKICAgICAgfQoKICAgICAgcmV0dXJuICExOwogICAgfSh0KSAmJiAhQzEodCk7CiAgfQoKICBmdW5jdGlvbiBxayhyLCB0KSB7CiAgICBmdW5jdGlvbiBuKHQpIHsKICAgICAgcmV0dXJuIHBsKHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGUoZSwgbykgewogICAgICByZXR1cm4gZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICByZXR1cm4gZmwodCwgciwgbikubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gZSh0LCBuKTsKICAgICAgICB9KS5nZXRPcihvKTsKICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBvKHQsIG4pIHsKICAgICAgcmV0dXJuICJ0cnVlIiAhPT0gcm4odC5lbGVtZW50LCAiYXJpYS1oaWRkZW4iKTsKICAgIH0KCiAgICB2YXIgaSwKICAgICAgICB1ID0gZShvLCAhMSksCiAgICAgICAgYSA9IGUoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgdmFyIGU7CiAgICAgIG8odCkgJiYgKGZuKGUgPSB0LmVsZW1lbnQsICJkaXNwbGF5IiwgIm5vbmUiKSwgb24oZSwgImFyaWEtaGlkZGVuIiwgInRydWUiKSwgdnIodCwgS2koKSwgewogICAgICAgIG5hbWU6IG4sCiAgICAgICAgdmlzaWJsZTogITEKICAgICAgfSkpOwogICAgfSksCiAgICAgICAgYyA9IChpID0gYSwgZnVuY3Rpb24gKG4sIHQpIHsKICAgICAgU3QodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gaShuLCB0KTsKICAgICAgfSk7CiAgICB9KSwKICAgICAgICBzID0gZShmdW5jdGlvbiAodCwgbikgewogICAgICB2YXIgZTsKICAgICAgbyh0KSB8fCAodm4oZSA9IHQuZWxlbWVudCwgImRpc3BsYXkiKSwgY24oZSwgImFyaWEtaGlkZGVuIiksIHZyKHQsIEtpKCksIHsKICAgICAgICBuYW1lOiBuLAogICAgICAgIHZpc2libGU6ICEwCiAgICAgIH0pKTsKICAgIH0pOwogICAgcmV0dXJuIHsKICAgICAgdWlkOiByLnVpZCwKICAgICAgZG9tOiByLmRvbSwKICAgICAgY29tcG9uZW50czogdCwKICAgICAgYmVoYXZpb3VyczogUXMoci5zbG90QmVoYXZpb3VycyksCiAgICAgIGFwaXM6IHsKICAgICAgICBnZXRTbG90TmFtZXM6IG4sCiAgICAgICAgZ2V0U2xvdDogZnVuY3Rpb24gZ2V0U2xvdCh0LCBuKSB7CiAgICAgICAgICByZXR1cm4gZmwodCwgciwgbik7CiAgICAgICAgfSwKICAgICAgICBpc1Nob3dpbmc6IHUsCiAgICAgICAgaGlkZVNsb3Q6IGEsCiAgICAgICAgaGlkZUFsbFNsb3RzOiBmdW5jdGlvbiBoaWRlQWxsU2xvdHModCkgewogICAgICAgICAgcmV0dXJuIGModCwgbigpKTsKICAgICAgICB9LAogICAgICAgIHNob3dTbG90OiBzCiAgICAgIH0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBLayh0LCBuKSB7CiAgICBmbCh0LCBuLCAib3ZlcmZsb3ciKS5lYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgIGtrKHQsIG4sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSBNKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gVHUodCk7CiAgICAgICAgfSk7CiAgICAgICAgRjEuc2V0R3JvdXBzKGUsIG4pOwogICAgICB9KSwgZmwodCwgbiwgIm92ZXJmbG93LWJ1dHRvbiIpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICBaMS5oYXNHcm93bihlKSAmJiB6Zy5vbih0KTsKICAgICAgfSksIFoxLnJlZnJlc2goZSk7CiAgICB9KTsKICB9CgogIHZhciBKaywKICAgICAgJGssCiAgICAgIFFrLAogICAgICBaayA9ICJkYXRhLXZhbHVlIiwKICAgICAgdDEgPSBmdW5jdGlvbiB0MShuLCBlLCB0LCBvKSB7CiAgICByZXR1cm4gTSh0LCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gbkModCkgPyB7CiAgICAgICAgdHlwZTogInRvZ2dsZW1lbnVpdGVtIiwKICAgICAgICB0ZXh0OiB0LnRleHQsCiAgICAgICAgdmFsdWU6IHQudmFsdWUsCiAgICAgICAgYWN0aXZlOiB0LnZhbHVlID09PSBvLAogICAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiBvbkFjdGlvbigpIHsKICAgICAgICAgIFRmLnNldFZhbHVlKG4sIHQudmFsdWUpLCB2cihuLCBweSwgewogICAgICAgICAgICBuYW1lOiBlCiAgICAgICAgICB9KSwgVmcuZm9jdXMobik7CiAgICAgICAgfQogICAgICB9IDogewogICAgICAgIHR5cGU6ICJuZXN0ZWRtZW51aXRlbSIsCiAgICAgICAgdGV4dDogdC50ZXh0LAogICAgICAgIGdldFN1Ym1lbnVJdGVtczogZnVuY3Rpb24gZ2V0U3VibWVudUl0ZW1zKCkgewogICAgICAgICAgcmV0dXJuIHQxKG4sIGUsIHQuaXRlbXMsIG8pOwogICAgICAgIH0KICAgICAgfTsKICAgIH0pOwogIH0sCiAgICAgIG4xID0gZnVuY3Rpb24gbjEodCwgbikgewogICAgcmV0dXJuIEsodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIG5DKHQpID8gb3QodC52YWx1ZSA9PT0gbiwgdCkgOiBuMSh0Lml0ZW1zLCBuKTsKICAgIH0pOwogIH0sCiAgICAgIGUxID0gd2woewogICAgbmFtZTogIkh0bWxTZWxlY3QiLAogICAgY29uZmlnRmllbGRzOiBbZm8oIm9wdGlvbnMiKSwgJHMoInNlbGVjdEJlaGF2aW91cnMiLCBbVmcsIFRmXSksIFRvKCJzZWxlY3RDbGFzc2VzIiwgW10pLCBUbygic2VsZWN0QXR0cmlidXRlcyIsIHt9KSwgeG8oImRhdGEiKV0sCiAgICBmYWN0b3J5OiBmdW5jdGlvbiBmYWN0b3J5KGUsIHQpIHsKICAgICAgdmFyIG4gPSBNKGUub3B0aW9ucywgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgIHRhZzogIm9wdGlvbiIsCiAgICAgICAgICAgIHZhbHVlOiB0LnZhbHVlLAogICAgICAgICAgICBpbm5lckh0bWw6IHQudGV4dAogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0pLAogICAgICAgICAgbyA9IGUuZGF0YS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gY3IoImluaXRpYWxWYWx1ZSIsIHQpOwogICAgICB9KS5nZXRPcih7fSk7CiAgICAgIHJldHVybiB7CiAgICAgICAgdWlkOiBlLnVpZCwKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogInNlbGVjdCIsCiAgICAgICAgICBjbGFzc2VzOiBlLnNlbGVjdENsYXNzZXMsCiAgICAgICAgICBhdHRyaWJ1dGVzOiBlLnNlbGVjdEF0dHJpYnV0ZXMKICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IG4sCiAgICAgICAgYmVoYXZpb3VyczogWnMoZS5zZWxlY3RCZWhhdmlvdXJzLCBbVmcuY29uZmlnKHt9KSwgVGYuY29uZmlnKHsKICAgICAgICAgIHN0b3JlOiBfbHQoewogICAgICAgICAgICBtb2RlOiAibWFudWFsIiwKICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gJHIodC5lbGVtZW50KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKHQsIG4pIHsKICAgICAgICAgICAgICBWKGUub3B0aW9ucywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0LnZhbHVlID09PSBuOwogICAgICAgICAgICAgIH0pLmlzU29tZSgpICYmIFFyKHQuZWxlbWVudCwgbik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIG8pCiAgICAgICAgfSldKQogICAgICB9OwogICAgfQogIH0pLAogICAgICBvMSA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgZXZlbnRzOiBmdW5jdGlvbiBldmVudHModCwgbikgewogICAgICB2YXIgZSA9IHQuc3RyZWFtLnN0cmVhbXMuc2V0dXAodCwgbik7CiAgICAgIHJldHVybiBudShbQ3IodC5ldmVudCwgZSksIG91KGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbi5jYW5jZWwoKTsKICAgICAgfSldLmNvbmNhdCh0LmNhbmNlbEV2ZW50Lm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBbQ3IodCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIG4uY2FuY2VsKCk7CiAgICAgICAgfSldOwogICAgICB9KS5nZXRPcihbXSkpKTsKICAgIH0KICB9KSwKICAgICAgcjEgPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIHRocm90dGxlOiByQywKICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQodCkgewogICAgICByZXR1cm4gdC5zdHJlYW0uc3RyZWFtcy5zdGF0ZSh0KTsKICAgIH0KICB9KSwKICAgICAgaTEgPSB5YSh7CiAgICBmaWVsZHM6IFttbygic3RyZWFtIiwgc28oIm1vZGUiLCB7CiAgICAgIHRocm90dGxlOiBbZm8oImRlbGF5IiksIFRvKCJzdG9wRXZlbnQiLCAhMCksIFp1KCJzdHJlYW1zIiwgewogICAgICAgIHNldHVwOiBmdW5jdGlvbiBzZXR1cCh0LCBuKSB7CiAgICAgICAgICB2YXIgZSA9IHQuc3RyZWFtLAogICAgICAgICAgICAgIG8gPSBwcCh0Lm9uU3RyZWFtLCBlLmRlbGF5KTsKICAgICAgICAgIHJldHVybiBuLnNldFRpbWVyKG8pLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICBvLnRocm90dGxlKHQsIG4pLCBlLnN0b3BFdmVudCAmJiBuLnN0b3AoKTsKICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBzdGF0ZTogckMKICAgICAgfSldCiAgICB9KSksIFRvKCJldmVudCIsICJpbnB1dCIpLCB4bygiY2FuY2VsRXZlbnQiKSwgJHUoIm9uU3RyZWFtIildLAogICAgbmFtZTogInN0cmVhbWluZyIsCiAgICBhY3RpdmU6IG8xLAogICAgc3RhdGU6IHIxCiAgfSksCiAgICAgIHUxID0gZnVuY3Rpb24gdTEodCkgewogICAgdUModCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIHQuc2V0U2VsZWN0aW9uUmFuZ2Uobi5sZW5ndGgsIG4ubGVuZ3RoKTsKICAgIH0pOwogIH0sCiAgICAgIGExID0gcnQoImFsbG95LnR5cGVhaGVhZC5pdGVtZXhlY3V0ZSIpLAogICAgICBjMSA9IHJ0KFt4bygibGF6eVNpbmsiKSwgZm8oImZldGNoIiksIFRvKCJtaW5DaGFycyIsIDUpLCBUbygicmVzcG9uc2VUaW1lIiwgMWUzKSwgS3UoIm9uT3BlbiIpLCBUbygiZ2V0SG90c3BvdCIsIHZ0LnNvbWUpLCBUbygiZ2V0QW5jaG9yT3ZlcnJpZGVzIiwgcnQoe30pKSwgVG8oImxheW91dHMiLCB2dC5ub25lKCkpLCBUbygiZXZlbnRPcmRlciIsIHt9KSwgUm8oIm1vZGVsIiwge30sIFtUbygiZ2V0RGlzcGxheVRleHQiLCBmdW5jdGlvbiAodCkgewogICAgcmV0dXJuIHZvaWQgMCAhPT0gdC5tZXRhICYmIHZvaWQgMCAhPT0gdC5tZXRhLnRleHQgPyB0Lm1ldGEudGV4dCA6IHQudmFsdWU7CiAgfSksIFRvKCJzZWxlY3RzT3ZlciIsICEwKSwgVG8oInBvcHVsYXRlRnJvbUJyb3dzZSIsICEwKV0pLCBLdSgib25TZXRWYWx1ZSIpLCBKdSgib25FeGVjdXRlIiksIEt1KCJvbkl0ZW1FeGVjdXRlIiksIFRvKCJpbnB1dENsYXNzZXMiLCBbXSksIFRvKCJpbnB1dEF0dHJpYnV0ZXMiLCB7fSksIFRvKCJpbnB1dFN0eWxlcyIsIHt9KSwgVG8oIm1hdGNoV2lkdGgiLCAhMCksIFRvKCJ1c2VNaW5XaWR0aCIsICExKSwgVG8oImRpc21pc3NPbkJsdXIiLCAhMCksIFl1KFsib3BlbkNsYXNzIl0pLCB4bygiaW5pdGlhbERhdGEiKSwgJHMoInR5cGVhaGVhZEJlaGF2aW91cnMiLCBbVmcsIFRmLCBpMSwgTWcsIHpnLCBZeV0pLCBhcigicHJldmlld2luZyIsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBWbyghMCk7CiAgfSldLmNvbmNhdChreSgpKS5jb25jYXQoZXgoKSkpLAogICAgICBzMSA9IHJ0KFtLZih7CiAgICBzY2hlbWE6IFtYdSgpXSwKICAgIG5hbWU6ICJtZW51IiwKICAgIG92ZXJyaWRlczogZnVuY3Rpb24gb3ZlcnJpZGVzKG8pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBmYWtlRm9jdXM6ICEwLAogICAgICAgIG9uSGlnaGxpZ2h0OiBmdW5jdGlvbiBvbkhpZ2hsaWdodChuLCBlKSB7CiAgICAgICAgICBvLnByZXZpZXdpbmcuZ2V0KCkgPyBuLmdldFN5c3RlbSgpLmdldEJ5VWlkKG8udWlkKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICFmdW5jdGlvbiAodCwgbiwgbykgewogICAgICAgICAgICAgIGlmICh0LnNlbGVjdHNPdmVyKSB7CiAgICAgICAgICAgICAgICB2YXIgZSA9IFRmLmdldFZhbHVlKG4pLAogICAgICAgICAgICAgICAgICAgIHIgPSB0LmdldERpc3BsYXlUZXh0KGUpLAogICAgICAgICAgICAgICAgICAgIGkgPSBUZi5nZXRWYWx1ZShvKTsKICAgICAgICAgICAgICAgIHJldHVybiAwID09PSB0LmdldERpc3BsYXlUZXh0KGkpLmluZGV4T2YocikgPyB2dC5zb21lKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgdmFyIGU7CiAgICAgICAgICAgICAgICAgIGlDKDAsIG4sIG8pLCBlID0gci5sZW5ndGgsIHVDKG4sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuc2V0U2VsZWN0aW9uUmFuZ2UoZSwgbi5sZW5ndGgpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pIDogdnQubm9uZSgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHZ0Lm5vbmUoKTsKICAgICAgICAgICAgfShvLm1vZGVsLCB0LCBlKS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gZ2QuZGVoaWdobGlnaHQobiwgZSk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSA6IG4uZ2V0U3lzdGVtKCkuZ2V0QnlVaWQoby51aWQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgby5tb2RlbC5wb3B1bGF0ZUZyb21Ccm93c2UgJiYgaUMoby5tb2RlbCwgdCwgZSk7CiAgICAgICAgICB9KSwgby5wcmV2aWV3aW5nLnNldCghMSk7CiAgICAgICAgfSwKICAgICAgICBvbkV4ZWN1dGU6IGZ1bmN0aW9uIG9uRXhlY3V0ZSh0LCBuKSB7CiAgICAgICAgICByZXR1cm4gdC5nZXRTeXN0ZW0oKS5nZXRCeVVpZChvLnVpZCkudG9PcHRpb25hbCgpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdnIodCwgYTEoKSwgewogICAgICAgICAgICAgIGl0ZW06IG4KICAgICAgICAgICAgfSksICEwOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBvbkhvdmVyOiBmdW5jdGlvbiBvbkhvdmVyKHQsIG4pIHsKICAgICAgICAgIG8ucHJldmlld2luZy5zZXQoITEpLCB0LmdldFN5c3RlbSgpLmdldEJ5VWlkKG8udWlkKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIG8ubW9kZWwucG9wdWxhdGVGcm9tQnJvd3NlICYmIGlDKG8ubW9kZWwsIHQsIG4pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0pXSksCiAgICAgIGwxID0gU2woewogICAgbmFtZTogIlR5cGVhaGVhZCIsCiAgICBjb25maWdGaWVsZHM6IGMxKCksCiAgICBwYXJ0RmllbGRzOiBzMSgpLAogICAgZmFjdG9yeTogZnVuY3Rpb24gZmFjdG9yeShyLCB0LCBuLCBpKSB7CiAgICAgIGZ1bmN0aW9uIGUodCwgbiwgZSkgewogICAgICAgIHIucHJldmlld2luZy5zZXQoITEpOwogICAgICAgIHZhciBvID0gWXkuZ2V0Q291cGxlZCh0LCAic2FuZGJveCIpOwogICAgICAgIGhmLmlzT3BlbihvKSA/IHVkLmdldEN1cnJlbnQobykuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgZ2QuZ2V0SGlnaGxpZ2h0ZWQodCkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGUodCk7CiAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHhyKG8sIHQuZWxlbWVudCwgImtleWRvd24iLCBuKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pIDogJHkociwgdSh0KSwgdCwgbywgaSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHVkLmdldEN1cnJlbnQodCkuZWFjaChlKTsKICAgICAgICB9LCBJeS5IaWdobGlnaHRGaXJzdCkuZ2V0KHN0KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gdShlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdmFyIG4gPSB6KFoodC5tZW51cyksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIEYodC5pdGVtcywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAiaXRlbSIgPT09IHQudHlwZTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBUZi5nZXRTdGF0ZShlKS51cGRhdGUoTShuLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiB0LmRhdGE7CiAgICAgICAgICAgIH0pKSwgdDsKICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHZhciBvID0gdHkociksCiAgICAgICAgICBhID0gW1ZnLmNvbmZpZyh7fSksIFRmLmNvbmZpZyh7CiAgICAgICAgb25TZXRWYWx1ZTogci5vblNldFZhbHVlLAogICAgICAgIHN0b3JlOiBfbHQoewogICAgICAgICAgbW9kZTogImRhdGFzZXQiLAogICAgICAgICAgZ2V0RGF0YUtleTogZnVuY3Rpb24gZ2V0RGF0YUtleSh0KSB7CiAgICAgICAgICAgIHJldHVybiAkcih0LmVsZW1lbnQpOwogICAgICAgICAgfSwKICAgICAgICAgIGdldEZhbGxiYWNrRW50cnk6IGZ1bmN0aW9uIGdldEZhbGxiYWNrRW50cnkodCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHZhbHVlOiB0LAogICAgICAgICAgICAgIG1ldGE6IHt9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9LAogICAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKHQsIG4pIHsKICAgICAgICAgICAgUXIodC5lbGVtZW50LCByLm1vZGVsLmdldERpc3BsYXlUZXh0KG4pKTsKICAgICAgICAgIH0KICAgICAgICB9LCByLmluaXRpYWxEYXRhLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGNyKCJpbml0aWFsVmFsdWUiLCB0KTsKICAgICAgICB9KS5nZXRPcih7fSkpCiAgICAgIH0pLCBpMS5jb25maWcoewogICAgICAgIHN0cmVhbTogewogICAgICAgICAgbW9kZTogInRocm90dGxlIiwKICAgICAgICAgIGRlbGF5OiByLnJlc3BvbnNlVGltZSwKICAgICAgICAgIHN0b3BFdmVudDogITEKICAgICAgICB9LAogICAgICAgIG9uU3RyZWFtOiBmdW5jdGlvbiBvblN0cmVhbSh0LCBuKSB7CiAgICAgICAgICB2YXIgZSwKICAgICAgICAgICAgICBvID0gWXkuZ2V0Q291cGxlZCh0LCAic2FuZGJveCIpOwogICAgICAgICAgVmcuaXNGb2N1c2VkKHQpICYmICRyKHQuZWxlbWVudCkubGVuZ3RoID49IHIubWluQ2hhcnMgJiYgKGUgPSB1ZC5nZXRDdXJyZW50KG8pLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIGdkLmdldEhpZ2hsaWdodGVkKHQpLm1hcChUZi5nZXRWYWx1ZSk7CiAgICAgICAgICB9KSwgci5wcmV2aWV3aW5nLnNldCghMCksICR5KHIsIHUodCksIHQsIG8sIGksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHVkLmdldEN1cnJlbnQobykuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIGUuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByLm1vZGVsLnNlbGVjdHNPdmVyICYmIGdkLmhpZ2hsaWdodEZpcnN0KHQpOwogICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgICBnZC5oaWdobGlnaHRCeSh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gVGYuZ2V0VmFsdWUodCkudmFsdWUgPT09IG4udmFsdWU7CiAgICAgICAgICAgICAgICB9KSwgZ2QuZ2V0SGlnaGxpZ2h0ZWQodCkub3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBnZC5oaWdobGlnaHRGaXJzdCh0KSwgdnQubm9uZSgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwgSXkuSGlnaGxpZ2h0Rmlyc3QpLmdldChzdCkpOwogICAgICAgIH0sCiAgICAgICAgY2FuY2VsRXZlbnQ6IEhpKCkKICAgICAgfSksIE1nLmNvbmZpZyh7CiAgICAgICAgbW9kZTogInNwZWNpYWwiLAogICAgICAgIG9uRG93bjogZnVuY3Rpb24gb25Eb3duKHQsIG4pIHsKICAgICAgICAgIHJldHVybiBlKHQsIG4sIGdkLmhpZ2hsaWdodEZpcnN0KSwgdnQuc29tZSghMCk7CiAgICAgICAgfSwKICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gb25Fc2NhcGUodCkgewogICAgICAgICAgdmFyIG4gPSBZeS5nZXRDb3VwbGVkKHQsICJzYW5kYm94Iik7CiAgICAgICAgICByZXR1cm4gaGYuaXNPcGVuKG4pID8gKGhmLmNsb3NlKG4pLCB2dC5zb21lKCEwKSkgOiB2dC5ub25lKCk7CiAgICAgICAgfSwKICAgICAgICBvblVwOiBmdW5jdGlvbiBvblVwKHQsIG4pIHsKICAgICAgICAgIHJldHVybiBlKHQsIG4sIGdkLmhpZ2hsaWdodExhc3QpLCB2dC5zb21lKCEwKTsKICAgICAgICB9LAogICAgICAgIG9uRW50ZXI6IGZ1bmN0aW9uIG9uRW50ZXIobikgewogICAgICAgICAgdmFyIHQgPSBZeS5nZXRDb3VwbGVkKG4sICJzYW5kYm94IiksCiAgICAgICAgICAgICAgZSA9IGhmLmlzT3Blbih0KTsKICAgICAgICAgIGlmIChlICYmICFyLnByZXZpZXdpbmcuZ2V0KCkpIHJldHVybiB1ZC5nZXRDdXJyZW50KHQpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIGdkLmdldEhpZ2hsaWdodGVkKHQpOwogICAgICAgICAgfSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB2cihuLCBhMSgpLCB7CiAgICAgICAgICAgICAgaXRlbTogdAogICAgICAgICAgICB9KSwgITA7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvID0gVGYuZ2V0VmFsdWUobik7CiAgICAgICAgICByZXR1cm4gaHIobiwgSGkoKSksIHIub25FeGVjdXRlKHQsIG4sIG8pLCBlICYmIGhmLmNsb3NlKHQpLCB2dC5zb21lKCEwKTsKICAgICAgICB9CiAgICAgIH0pLCB6Zy5jb25maWcoewogICAgICAgIHRvZ2dsZUNsYXNzOiByLm1hcmtlcnMub3BlbkNsYXNzLAogICAgICAgIGFyaWE6IHsKICAgICAgICAgIG1vZGU6ICJleHBhbmRlZCIKICAgICAgICB9CiAgICAgIH0pLCBZeS5jb25maWcoewogICAgICAgIG90aGVyczogewogICAgICAgICAgc2FuZGJveDogZnVuY3Rpb24gc2FuZGJveCh0KSB7CiAgICAgICAgICAgIHJldHVybiB0eChyLCB0LCB7CiAgICAgICAgICAgICAgb25PcGVuOiBmdW5jdGlvbiBvbk9wZW4oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gemcub24odCk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbiBvbkNsb3NlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHpnLm9mZih0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSksIGZtKCJ0eXBlYWhlYWRldmVudHMiLCBbaXUoZnVuY3Rpb24gKHQpIHsKICAgICAgICBReShyLCB1KHQpLCB0LCBpLCBzdCwgSXkuSGlnaGxpZ2h0Rmlyc3QpLmdldChzdCk7CiAgICAgIH0pLCBDcihhMSgpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIHZhciBlID0gWXkuZ2V0Q291cGxlZCh0LCAic2FuZGJveCIpOwogICAgICAgIGlDKHIubW9kZWwsIHQsIG4uZXZlbnQuaXRlbSksIGhyKHQsIEhpKCkpLCByLm9uSXRlbUV4ZWN1dGUodCwgZSwgbi5ldmVudC5pdGVtLCBUZi5nZXRWYWx1ZSh0KSksIGhmLmNsb3NlKGUpLCB1MSh0KTsKICAgICAgfSldLmNvbmNhdChyLmRpc21pc3NPbkJsdXIgPyBbQ3IoQmkoKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbiA9IFl5LmdldENvdXBsZWQodCwgInNhbmRib3giKTsKICAgICAgICBPYShuLmVsZW1lbnQpLmlzTm9uZSgpICYmIGhmLmNsb3NlKG4pOwogICAgICB9KV0gOiBbXSkpXTsKICAgICAgcmV0dXJuIHsKICAgICAgICB1aWQ6IHIudWlkLAogICAgICAgIGRvbTogbnkoWG8ociwgewogICAgICAgICAgaW5wdXRBdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgIHJvbGU6ICJjb21ib2JveCIsCiAgICAgICAgICAgICJhcmlhLWF1dG9jb21wbGV0ZSI6ICJsaXN0IiwKICAgICAgICAgICAgImFyaWEtaGFzcG9wdXAiOiAidHJ1ZSIKICAgICAgICAgIH0KICAgICAgICB9KSksCiAgICAgICAgYmVoYXZpb3VyczogX2x0KF9sdCh7fSwgbyksIFpzKHIudHlwZWFoZWFkQmVoYXZpb3VycywgYSkpLAogICAgICAgIGV2ZW50T3JkZXI6IHIuZXZlbnRPcmRlcgogICAgICB9OwogICAgfQogIH0pLAogICAgICBmMSA9IGZ1bmN0aW9uIGYxKGkpIHsKICAgIHJldHVybiBfbHQoX2x0KHt9LCBpKSwgewogICAgICB0b0NhY2hlZDogZnVuY3Rpb24gdG9DYWNoZWQoKSB7CiAgICAgICAgcmV0dXJuIGYxKGkudG9DYWNoZWQoKSk7CiAgICAgIH0sCiAgICAgIGJpbmRGdXR1cmU6IGZ1bmN0aW9uIGJpbmRGdXR1cmUobikgewogICAgICAgIHJldHVybiBmMShpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LmZvbGQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIEx5KFJlLmVycm9yKHQpKTsKICAgICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiBuKHQpOwogICAgICAgICAgfSk7CiAgICAgICAgfSkpOwogICAgICB9LAogICAgICBiaW5kUmVzdWx0OiBmdW5jdGlvbiBiaW5kUmVzdWx0KG4pIHsKICAgICAgICByZXR1cm4gZjEoaS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LmJpbmQobik7CiAgICAgICAgfSkpOwogICAgICB9LAogICAgICBtYXBSZXN1bHQ6IGZ1bmN0aW9uIG1hcFJlc3VsdChuKSB7CiAgICAgICAgcmV0dXJuIGYxKGkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC5tYXAobik7CiAgICAgICAgfSkpOwogICAgICB9LAogICAgICBtYXBFcnJvcjogZnVuY3Rpb24gbWFwRXJyb3IobikgewogICAgICAgIHJldHVybiBmMShpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHQubWFwRXJyb3Iobik7CiAgICAgICAgfSkpOwogICAgICB9LAogICAgICBmb2xkUmVzdWx0OiBmdW5jdGlvbiBmb2xkUmVzdWx0KG4sIGUpIHsKICAgICAgICByZXR1cm4gaS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LmZvbGQobiwgZSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHdpdGhUaW1lb3V0OiBmdW5jdGlvbiB3aXRoVGltZW91dCh0LCByKSB7CiAgICAgICAgcmV0dXJuIGYxKE55KGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICB2YXIgZSA9ICExLAogICAgICAgICAgICAgIG8gPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZSA9ICEwLCBuKFJlLmVycm9yKHIoKSkpOwogICAgICAgICAgfSwgdCk7CiAgICAgICAgICBpLmdldChmdW5jdGlvbiAodCkgewogICAgICAgICAgICBlIHx8IChjbGVhclRpbWVvdXQobyksIG4odCkpOwogICAgICAgICAgfSk7CiAgICAgICAgfSkpOwogICAgICB9CiAgICB9KTsKICB9LAogICAgICBkMSA9IGZ1bmN0aW9uIGQxKHQpIHsKICAgIHJldHVybiBmMShOeSh0KSk7CiAgfSwKICAgICAgbTEgPSB7CiAgICB0eXBlOiAic2VwYXJhdG9yIgogIH0sCiAgICAgIGcxID0gRnIoImFyaWEtaW52YWxpZCIpLAogICAgICBwMSA9IHsKICAgIGJhcjogZEMoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIGUgPSBuLnNoYXJlZCwgewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LWJhciIsICJ0b3gtZm9ybV9fY29udHJvbHMtaC1zdGFjayJdCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiBNKHQuaXRlbXMsIGUuaW50ZXJwcmV0ZXIpCiAgICAgIH07CiAgICAgIHZhciBlOwogICAgfSksCiAgICBjb2xsZWN0aW9uOiBkQyhmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gdSA9IHQsIGEgPSBuLnNoYXJlZC5wcm92aWRlcnMsIGMgPSB1LmxhYmVsLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBaYih0LCBhKTsKICAgICAgfSksIHMgPSBlKGZ1bmN0aW9uICh0LCBuLCBlLCBvKSB7CiAgICAgICAgbi5zdG9wKCksIGEuaXNEaXNhYmxlZCgpIHx8IHZyKHQsIGJ5LCB7CiAgICAgICAgICBuYW1lOiB1Lm5hbWUsCiAgICAgICAgICB2YWx1ZTogbwogICAgICAgIH0pOwogICAgICB9KSwgbCA9IFtDcihoaSgpLCBlKGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgICAgU2EoZSk7CiAgICAgIH0pKSwgQ3IoQ2koKSwgcyksIENyKFJpKCksIHMpLCBDcih2aSgpLCBlKGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgICAgRnUodC5lbGVtZW50LCAiLiIgKyBEaCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgWXIodCwgRGgpOwogICAgICAgIH0pLCBYcihlLCBEaCk7CiAgICAgIH0pKSwgQ3IoYmkoKSwgZShmdW5jdGlvbiAodCkgewogICAgICAgIEZ1KHQuZWxlbWVudCwgIi4iICsgRGgpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIFlyKHQsIERoKTsKICAgICAgICB9KTsKICAgICAgfSkpLCBpdShlKGZ1bmN0aW9uICh0LCBuLCBlLCBvKSB7CiAgICAgICAgdnIodCwgYnksIHsKICAgICAgICAgIG5hbWU6IHUubmFtZSwKICAgICAgICAgIHZhbHVlOiBvCiAgICAgICAgfSk7CiAgICAgIH0pKV0sIFFiKGMsIHN5LnBhcnRzLmZpZWxkKHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1jb2xsZWN0aW9uIl0uY29uY2F0KDEgIT09IHUuY29sdW1ucyA/IFsidG94LWNvbGxlY3Rpb24tLWdyaWQiXSA6IFsidG94LWNvbGxlY3Rpb24tLWxpc3QiXSkKICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IFtdLAogICAgICAgIGZhY3Rvcnk6IHsKICAgICAgICAgIHNrZXRjaDogaAogICAgICAgIH0sCiAgICAgICAgYmVoYXZpb3VyczogdGMoW2RkLmNvbmZpZyh7CiAgICAgICAgICBkaXNhYmxlZDogYS5pc0Rpc2FibGVkLAogICAgICAgICAgb25EaXNhYmxlZDogZnVuY3Rpb24gb25EaXNhYmxlZCh0KSB7CiAgICAgICAgICAgIG8odCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBYcih0LCAidG94LWNvbGxlY3Rpb25fX2l0ZW0tLXN0YXRlLWRpc2FibGVkIiksIG9uKHQsICJhcmlhLWRpc2FibGVkIiwgITApOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBvbkVuYWJsZWQ6IGZ1bmN0aW9uIG9uRW5hYmxlZCh0KSB7CiAgICAgICAgICAgIG8odCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBZcih0LCAidG94LWNvbGxlY3Rpb25fX2l0ZW0tLXN0YXRlLWRpc2FibGVkIiksIGNuKHQsICJhcmlhLWRpc2FibGVkIik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pLCBtdigpLCBGZy5jb25maWcoe30pLCBUZi5jb25maWcoewogICAgICAgICAgc3RvcmU6IHsKICAgICAgICAgICAgbW9kZTogIm1lbW9yeSIsCiAgICAgICAgICAgIGluaXRpYWxWYWx1ZTogW10KICAgICAgICAgIH0sCiAgICAgICAgICBvblNldFZhbHVlOiBmdW5jdGlvbiBvblNldFZhbHVlKG8sIHQpIHsKICAgICAgICAgICAgdmFyIG4gPSBvLAogICAgICAgICAgICAgICAgZSA9IE0odCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICB2YXIgbiA9IGxwLnRyYW5zbGF0ZSh0LnRleHQpLAogICAgICAgICAgICAgICAgICBlID0gMSA9PT0gdS5jb2x1bW5zID8gJzxkaXYgY2xhc3M9InRveC1jb2xsZWN0aW9uX19pdGVtLWxhYmVsIj4nICsgbiArICI8L2Rpdj4iIDogIiIsCiAgICAgICAgICAgICAgICAgIG8gPSAnPGRpdiBjbGFzcz0idG94LWNvbGxlY3Rpb25fX2l0ZW0taWNvbiI+JyArIHQuaWNvbiArICI8L2Rpdj4iLAogICAgICAgICAgICAgICAgICByID0gewogICAgICAgICAgICAgICAgXzogIiAiLAogICAgICAgICAgICAgICAgIiAtICI6ICIgIiwKICAgICAgICAgICAgICAgICItIjogIiAiCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgaSA9IG4ucmVwbGFjZSgvXF98IFwtIHxcLS9nLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJbdF07CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSJ0b3gtY29sbGVjdGlvbl9faXRlbScgKyAoYS5pc0Rpc2FibGVkKCkgPyAiIHRveC1jb2xsZWN0aW9uX19pdGVtLS1zdGF0ZS1kaXNhYmxlZCIgOiAiIikgKyAnIiB0YWJpbmRleD0iLTEiIGRhdGEtY29sbGVjdGlvbi1pdGVtLXZhbHVlPSInICsgZHkuZW5jb2RlQWxsUmF3KHQudmFsdWUpICsgJyIgdGl0bGU9IicgKyBpICsgJyIgYXJpYS1sYWJlbD0iJyArIGkgKyAnIj4nICsgbyArIGUgKyAiPC9kaXY+IjsKICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICByID0gTSgiYXV0byIgIT09IHUuY29sdW1ucyAmJiAxIDwgdS5jb2x1bW5zID8gQihlLCB1LmNvbHVtbnMpIDogW2VdLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0idG94LWNvbGxlY3Rpb25fX2dyb3VwIj4nICsgdC5qb2luKCIiKSArICI8L2Rpdj4iOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgTXIobi5lbGVtZW50LCByLmpvaW4oIiIpKSwgImF1dG8iID09PSB1LmNvbHVtbnMgJiYgaWgobywgNSwgInRveC1jb2xsZWN0aW9uX19pdGVtIikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHZhciBuID0gdC5udW1Sb3dzLAogICAgICAgICAgICAgICAgICBlID0gdC5udW1Db2x1bW5zOwogICAgICAgICAgICAgIE1nLnNldEdyaWRTaXplKG8sIG4sIGUpOwogICAgICAgICAgICB9KSwgaHIobywgQ3kpOwogICAgICAgICAgfQogICAgICAgIH0pLCBmeS5jb25maWcoe30pLCBNZy5jb25maWcoMSA9PT0gKGkgPSB1LmNvbHVtbnMpID8gewogICAgICAgICAgbW9kZTogIm1lbnUiLAogICAgICAgICAgbW92ZU9uVGFiOiAhMSwKICAgICAgICAgIHNlbGVjdG9yOiAiLnRveC1jb2xsZWN0aW9uX19pdGVtIgogICAgICAgIH0gOiAiYXV0byIgPT09IGkgPyB7CiAgICAgICAgICBtb2RlOiAiZmxhdGdyaWQiLAogICAgICAgICAgc2VsZWN0b3I6ICIudG94LWNvbGxlY3Rpb25fX2l0ZW0iLAogICAgICAgICAgaW5pdFNpemU6IHsKICAgICAgICAgICAgbnVtQ29sdW1uczogMSwKICAgICAgICAgICAgbnVtUm93czogMQogICAgICAgICAgfQogICAgICAgIH0gOiB7CiAgICAgICAgICBtb2RlOiAibWF0cml4IiwKICAgICAgICAgIHNlbGVjdG9yczogewogICAgICAgICAgICByb3c6ICIudG94LWNvbGxlY3Rpb25fX2dyb3VwIiwKICAgICAgICAgICAgY2VsbDogIi4iICsgU2gKICAgICAgICAgIH0KICAgICAgICB9KSwgZm0oImNvbGxlY3Rpb24tZXZlbnRzIiwgbCldKSwKICAgICAgICBldmVudE9yZGVyOiAoKHIgPSB7fSlbRmkoKV0gPSBbImRpc2FibGluZyIsICJhbGxveS5iYXNlLmJlaGF2aW91ciIsICJjb2xsZWN0aW9uLWV2ZW50cyJdLCByKQogICAgICB9KSwgWyJ0b3gtZm9ybV9fZ3JvdXAtLWNvbGxlY3Rpb24iXSwgW10pOwoKICAgICAgZnVuY3Rpb24gZShvKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChuLCBlKSB7CiAgICAgICAgICBJdShlLmV2ZW50LnRhcmdldCwgIltkYXRhLWNvbGxlY3Rpb24taXRlbS12YWx1ZV0iKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIG8obiwgZSwgdCwgcm4odCwgImRhdGEtY29sbGVjdGlvbi1pdGVtLXZhbHVlIikpOwogICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbyh0LCBuKSB7CiAgICAgICAgcmV0dXJuIE0ocHModC5lbGVtZW50LCAiLnRveC1jb2xsZWN0aW9uX19pdGVtIiksIG4pOwogICAgICB9CgogICAgICB2YXIgdSwgYSwgciwgaSwgYywgcywgbDsKICAgIH0pLAogICAgYWxlcnRiYW5uZXI6IGRDKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiBvID0gbi5zaGFyZWQucHJvdmlkZXJzLCB1eS5za2V0Y2goewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgcm9sZTogImFsZXJ0IgogICAgICAgICAgfSwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LW5vdGlmaWNhdGlvbiIsICJ0b3gtbm90aWZpY2F0aW9uLS1pbiIsICJ0b3gtbm90aWZpY2F0aW9uLS0iICsgKGUgPSB0KS5sZXZlbF0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IFt7CiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgY2xhc3NlczogWyJ0b3gtbm90aWZpY2F0aW9uX19pY29uIl0KICAgICAgICAgIH0sCiAgICAgICAgICBjb21wb25lbnRzOiBbc3Auc2tldGNoKHsKICAgICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgICAgdGFnOiAiYnV0dG9uIiwKICAgICAgICAgICAgICBjbGFzc2VzOiBbInRveC1idXR0b24iLCAidG94LWJ1dHRvbi0tbmFrZWQiLCAidG94LWJ1dHRvbi0taWNvbiJdLAogICAgICAgICAgICAgIGlubmVySHRtbDogTG0oZS5pY29uLCBvLmljb25zKSwKICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgICAgICB0aXRsZTogby50cmFuc2xhdGUoZS5pY29uVG9vbHRpcCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFjdGlvbjogZnVuY3Rpb24gYWN0aW9uKHQpIHsKICAgICAgICAgICAgICB2cih0LCBieSwgewogICAgICAgICAgICAgICAgbmFtZTogImFsZXJ0LWJhbm5lciIsCiAgICAgICAgICAgICAgICB2YWx1ZTogZS51cmwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYnV0dG9uQmVoYXZpb3VyczogdGMoW1dtKCldKQogICAgICAgICAgfSldCiAgICAgICAgfSwgewogICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgIGNsYXNzZXM6IFsidG94LW5vdGlmaWNhdGlvbl9fYm9keSJdLAogICAgICAgICAgICBpbm5lckh0bWw6IG8udHJhbnNsYXRlKGUudGV4dCkKICAgICAgICAgIH0KICAgICAgICB9XQogICAgICB9KTsKICAgICAgdmFyIGUsIG87CiAgICB9KSwKICAgIGlucHV0OiBkQyhmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gbyA9IG4uc2hhcmVkLnByb3ZpZGVycywgb0MoewogICAgICAgIG5hbWU6IChlID0gdCkubmFtZSwKICAgICAgICBtdWx0aWxpbmU6ICExLAogICAgICAgIGxhYmVsOiBlLmxhYmVsLAogICAgICAgIGlucHV0TW9kZTogZS5pbnB1dE1vZGUsCiAgICAgICAgcGxhY2Vob2xkZXI6IGUucGxhY2Vob2xkZXIsCiAgICAgICAgZmxleDogITEsCiAgICAgICAgZGlzYWJsZWQ6IGUuZGlzYWJsZWQsCiAgICAgICAgY2xhc3NuYW1lOiAidG94LXRleHRmaWVsZCIsCiAgICAgICAgdmFsaWRhdGlvbjogdnQubm9uZSgpLAogICAgICAgIG1heGltaXplZDogZS5tYXhpbWl6ZWQKICAgICAgfSwgbyk7CiAgICAgIHZhciBlLCBvOwogICAgfSksCiAgICB0ZXh0YXJlYTogZEMoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIG8gPSBuLnNoYXJlZC5wcm92aWRlcnMsIG9DKHsKICAgICAgICBuYW1lOiAoZSA9IHQpLm5hbWUsCiAgICAgICAgbXVsdGlsaW5lOiAhMCwKICAgICAgICBsYWJlbDogZS5sYWJlbCwKICAgICAgICBpbnB1dE1vZGU6IHZ0Lm5vbmUoKSwKICAgICAgICBwbGFjZWhvbGRlcjogZS5wbGFjZWhvbGRlciwKICAgICAgICBmbGV4OiAhMCwKICAgICAgICBkaXNhYmxlZDogZS5kaXNhYmxlZCwKICAgICAgICBjbGFzc25hbWU6ICJ0b3gtdGV4dGFyZWEiLAogICAgICAgIHZhbGlkYXRpb246IHZ0Lm5vbmUoKSwKICAgICAgICBtYXhpbWl6ZWQ6IGUubWF4aW1pemVkCiAgICAgIH0sIG8pOwogICAgICB2YXIgZSwgbzsKICAgIH0pLAogICAgbGFiZWw6IGRDKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiByID0gewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAibGFiZWwiLAogICAgICAgICAgaW5uZXJIdG1sOiAobyA9IG4uc2hhcmVkKS5wcm92aWRlcnMudHJhbnNsYXRlKChlID0gdCkubGFiZWwpLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtbGFiZWwiXQogICAgICAgIH0KICAgICAgfSwgaSA9IE0oZS5pdGVtcywgby5pbnRlcnByZXRlciksIHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1mb3JtX19ncm91cCJdCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiBbcl0uY29uY2F0KGkpLAogICAgICAgIGJlaGF2aW91cnM6IHRjKFtvdygpLCBGZy5jb25maWcoe30pLCBydyh2dC5ub25lKCkpLCBNZy5jb25maWcoewogICAgICAgICAgbW9kZTogImFjeWNsaWMiCiAgICAgICAgfSldKQogICAgICB9OwogICAgICB2YXIgZSwgbywgciwgaTsKICAgIH0pLAogICAgaWZyYW1lOiAoSmsgPSBmdW5jdGlvbiBKayh0LCBuKSB7CiAgICAgIHJldHVybiBlID0gdCwgbyA9IG4uc2hhcmVkLnByb3ZpZGVycywgdSA9IGdTICYmIGUuc2FuZGJveGVkLCBhID0gX2x0KF9sdCh7fSwgZS5sYWJlbC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdGl0bGU6IHQKICAgICAgICB9OwogICAgICB9KS5nZXRPcih7fSkpLCB1ID8gewogICAgICAgIHNhbmRib3g6ICJhbGxvdy1zY3JpcHRzIGFsbG93LXNhbWUtb3JpZ2luIgogICAgICB9IDoge30pLCByID0gdSwgaSA9IFZvKCIiKSwgYyA9IHsKICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUodCkgewogICAgICAgICAgcmV0dXJuIGkuZ2V0KCk7CiAgICAgICAgfSwKICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUodCwgbikgewogICAgICAgICAgdmFyIGU7CiAgICAgICAgICByID8gb24odC5lbGVtZW50LCAic3JjZG9jIiwgbikgOiAob24odC5lbGVtZW50LCAic3JjIiwgImphdmFzY3JpcHQ6JyciKSwgKGUgPSB0LmVsZW1lbnQuZG9tLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQpLm9wZW4oKSwgZS53cml0ZShuKSwgZS5jbG9zZSgpKSwgaS5zZXQobik7CiAgICAgICAgfQogICAgICB9LCBRYihlLmxhYmVsLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBaYih0LCBvKTsKICAgICAgfSksIHN5LnBhcnRzLmZpZWxkKHsKICAgICAgICBmYWN0b3J5OiB7CiAgICAgICAgICBza2V0Y2g6IGZ1bmN0aW9uIHNrZXRjaCh0KSB7CiAgICAgICAgICAgIHJldHVybiBjMCh7CiAgICAgICAgICAgICAgdWlkOiB0LnVpZCwKICAgICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICAgIHRhZzogImlmcmFtZSIsCiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiBhCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBiZWhhdmlvdXJzOiB0YyhbZnkuY29uZmlnKHt9KSwgVmcuY29uZmlnKHt9KSwgbFModnQubm9uZSgpLCBjLmdldFZhbHVlLCBjLnNldFZhbHVlKV0pCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSksIFsidG94LWZvcm1fX2dyb3VwLS1zdHJldGNoZWQiXSwgW10pOwogICAgICB2YXIgZSwgbywgciwgaSwgdSwgYSwgYzsKICAgIH0sIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgIHZhciBvID0gWG8obiwgewogICAgICAgIHNvdXJjZTogImR5bmFtaWMiCiAgICAgIH0pOwogICAgICByZXR1cm4gZEMoSmspKHQsIG8sIGUpOwogICAgfSksCiAgICBidXR0b246IGRDKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiBlID0gdCwgbyA9IG4uc2hhcmVkLnByb3ZpZGVycywgciA9IFkwKGUubmFtZSwgImN1c3RvbSIpLCBRYih2dC5ub25lKCksIHN5LnBhcnRzLmZpZWxkKF9sdCh7CiAgICAgICAgZmFjdG9yeTogc3AKICAgICAgfSwgRzAoZSwgdnQuc29tZShyKSwgbywgW2ZTKCIiKSwgb3coKV0pKSksIFtdLCBbXSk7CiAgICAgIHZhciBlLCBvLCByOwogICAgfSksCiAgICBjaGVja2JveDogZEMoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIHIgPSB0LCBpID0gbi5zaGFyZWQucHJvdmlkZXJzLCB1ID0gVGYuY29uZmlnKHsKICAgICAgICBzdG9yZTogewogICAgICAgICAgbW9kZTogIm1hbnVhbCIsCiAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUodCkgewogICAgICAgICAgICByZXR1cm4gdC5lbGVtZW50LmRvbS5jaGVja2VkOwogICAgICAgICAgfSwKICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh0LCBuKSB7CiAgICAgICAgICAgIHQuZWxlbWVudC5kb20uY2hlY2tlZCA9IG47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KSwgYSA9IHN5LnBhcnRzLmZpZWxkKHsKICAgICAgICBmYWN0b3J5OiB7CiAgICAgICAgICBza2V0Y2g6IGgKICAgICAgICB9LAogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiaW5wdXQiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtY2hlY2tib3hfX2lucHV0Il0sCiAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgIHR5cGU6ICJjaGVja2JveCIKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGJlaGF2aW91cnM6IHRjKFtvdygpLCBkZC5jb25maWcoewogICAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uIGRpc2FibGVkKCkgewogICAgICAgICAgICByZXR1cm4gci5kaXNhYmxlZCB8fCBpLmlzRGlzYWJsZWQoKTsKICAgICAgICAgIH0KICAgICAgICB9KSwgZnkuY29uZmlnKHt9KSwgVmcuY29uZmlnKHt9KSwgdSwgTWcuY29uZmlnKHsKICAgICAgICAgIG1vZGU6ICJzcGVjaWFsIiwKICAgICAgICAgIG9uRW50ZXI6IGUsCiAgICAgICAgICBvblNwYWNlOiBlLAogICAgICAgICAgc3RvcFNwYWNlS2V5dXA6ICEwCiAgICAgICAgfSksIGZtKCJjaGVja2JveC1ldmVudHMiLCBbQ3IoU2koKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIHZyKHQsIHB5LCB7CiAgICAgICAgICAgIG5hbWU6IHIubmFtZQogICAgICAgICAgfSk7CiAgICAgICAgfSldKV0pCiAgICAgIH0pLCBjID0gc3kucGFydHMubGFiZWwoewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAic3BhbiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1jaGVja2JveF9fbGFiZWwiXSwKICAgICAgICAgIGlubmVySHRtbDogaS50cmFuc2xhdGUoci5sYWJlbCkKICAgICAgICB9LAogICAgICAgIGJlaGF2aW91cnM6IHRjKFttdy5jb25maWcoe30pXSkKICAgICAgfSksIHMgPSBQbSh7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtY2hlY2tib3hfX2ljb25zIl0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IFtvKCJjaGVja2VkIiksIG8oInVuY2hlY2tlZCIpXQogICAgICB9KSwgc3kuc2tldGNoKHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImxhYmVsIiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LWNoZWNrYm94Il0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IFthLCBzLmFzU3BlYygpLCBjXSwKICAgICAgICBmaWVsZEJlaGF2aW91cnM6IHRjKFtkZC5jb25maWcoewogICAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uIGRpc2FibGVkKCkgewogICAgICAgICAgICByZXR1cm4gci5kaXNhYmxlZCB8fCBpLmlzRGlzYWJsZWQoKTsKICAgICAgICAgIH0sCiAgICAgICAgICBkaXNhYmxlQ2xhc3M6ICJ0b3gtY2hlY2tib3gtLWRpc2FibGVkIiwKICAgICAgICAgIG9uRGlzYWJsZWQ6IGZ1bmN0aW9uIG9uRGlzYWJsZWQodCkgewogICAgICAgICAgICBzeS5nZXRGaWVsZCh0KS5lYWNoKGRkLmRpc2FibGUpOwogICAgICAgICAgfSwKICAgICAgICAgIG9uRW5hYmxlZDogZnVuY3Rpb24gb25FbmFibGVkKHQpIHsKICAgICAgICAgICAgc3kuZ2V0RmllbGQodCkuZWFjaChkZC5lbmFibGUpOwogICAgICAgICAgfQogICAgICAgIH0pLCBtdigpXSkKICAgICAgfSk7CgogICAgICBmdW5jdGlvbiBlKHQpIHsKICAgICAgICByZXR1cm4gdC5lbGVtZW50LmRvbS5jbGljaygpLCB2dC5zb21lKCEwKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbyh0KSB7CiAgICAgICAgcmV0dXJuIGptKCJjaGVja2VkIiA9PT0gdCA/ICJzZWxlY3RlZCIgOiAidW5zZWxlY3RlZCIsIHsKICAgICAgICAgIHRhZzogInNwYW4iLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtaWNvbiIsICJ0b3gtY2hlY2tib3gtaWNvbl9fIiArIHRdCiAgICAgICAgfSwgaS5pY29ucyk7CiAgICAgIH0KCiAgICAgIHZhciByLCBpLCB1LCBhLCBjLCBzOwogICAgfSksCiAgICBjb2xvcmlucHV0OiBkQyhmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gZSA9IHQsIHIgPSBuLnNoYXJlZCwgaSA9IG4uY29sb3JpbnB1dCwgYyA9IHN5LnBhcnRzLmZpZWxkKHsKICAgICAgICBmYWN0b3J5OiBPeSwKICAgICAgICBpbnB1dENsYXNzZXM6IFsidG94LXRleHRmaWVsZCJdLAogICAgICAgIG9uU2V0VmFsdWU6IGZ1bmN0aW9uIG9uU2V0VmFsdWUodCkgewogICAgICAgICAgcmV0dXJuIEd5LnJ1bih0KS5nZXQoc3QpOwogICAgICAgIH0sCiAgICAgICAgaW5wdXRCZWhhdmlvdXJzOiB0YyhbZGQuY29uZmlnKHsKICAgICAgICAgIGRpc2FibGVkOiByLnByb3ZpZGVycy5pc0Rpc2FibGVkCiAgICAgICAgfSksIG12KCksIGZ5LmNvbmZpZyh7fSksIEd5LmNvbmZpZyh7CiAgICAgICAgICBpbnZhbGlkQ2xhc3M6ICJ0b3gtdGV4dGJveC1maWVsZC1pbnZhbGlkIiwKICAgICAgICAgIGdldFJvb3Q6IGZ1bmN0aW9uIGdldFJvb3QodCkgewogICAgICAgICAgICByZXR1cm4gWXQodC5lbGVtZW50KTsKICAgICAgICAgIH0sCiAgICAgICAgICBub3RpZnk6IHsKICAgICAgICAgICAgb25WYWxpZDogZnVuY3Rpb24gb25WYWxpZCh0KSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBUZi5nZXRWYWx1ZSh0KTsKICAgICAgICAgICAgICB2cih0LCBndywgewogICAgICAgICAgICAgICAgY29sb3I6IG4KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHZhbGlkYXRvcjogewogICAgICAgICAgICB2YWxpZGF0ZU9uTG9hZDogITEsCiAgICAgICAgICAgIHZhbGlkYXRlOiBmdW5jdGlvbiB2YWxpZGF0ZSh0KSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBUZi5nZXRWYWx1ZSh0KTsKICAgICAgICAgICAgICBpZiAoMCA9PT0gbi5sZW5ndGgpIHJldHVybiBMeShSZS52YWx1ZSghMCkpOwogICAgICAgICAgICAgIHZhciBlID0gQXQuZnJvbVRhZygic3BhbiIpOwogICAgICAgICAgICAgIGZuKGUsICJiYWNrZ3JvdW5kLWNvbG9yIiwgbik7CiAgICAgICAgICAgICAgdmFyIG8gPSBwbihlLCAiYmFja2dyb3VuZC1jb2xvciIpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFJlLmVycm9yKCJibGFoIik7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBSZS52YWx1ZShuKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gTHkobyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KV0pLAogICAgICAgIHNlbGVjdE9uRm9jdXM6ICExCiAgICAgIH0pLCBzID0gZS5sYWJlbC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gWmIodCwgci5wcm92aWRlcnMpOwogICAgICB9KSwgbCA9IFBtKCh1ID0gewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAic3BhbiIsCiAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgICJhcmlhLWxhYmVsIjogci5wcm92aWRlcnMudHJhbnNsYXRlKCJDb2xvciBzd2F0Y2giKQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbGF5b3V0czogewogICAgICAgICAgb25SdGw6IGZ1bmN0aW9uIG9uUnRsKCkgewogICAgICAgICAgICByZXR1cm4gW1hhLCBHYSwgSmFdOwogICAgICAgICAgfSwKICAgICAgICAgIG9uTHRyOiBmdW5jdGlvbiBvbkx0cigpIHsKICAgICAgICAgICAgcmV0dXJuIFtHYSwgWGEsIEphXTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IFtdLAogICAgICAgIGZldGNoOiB5YihpLmdldENvbG9ycygpLCBpLmhhc0N1c3RvbUNvbG9ycygpKSwKICAgICAgICBjb2x1bW5zOiBpLmdldENvbG9yQ29scygpLAogICAgICAgIHByZXNldHM6ICJjb2xvciIsCiAgICAgICAgb25JdGVtQWN0aW9uOiBmdW5jdGlvbiBvbkl0ZW1BY3Rpb24odCwgZSkgewogICAgICAgICAgbC5nZXRPcHQodCkuZWFjaChmdW5jdGlvbiAobikgewogICAgICAgICAgICAiY3VzdG9tIiA9PT0gZSA/IGkuY29sb3JQaWNrZXIoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICB0LmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGhyKG4sIGh3KTsKICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgbyhuLCB0KSwgZ2IodCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sICIjZmZmZmZmIikgOiBvKG4sICJyZW1vdmUiID09PSBlID8gIiIgOiBlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgZHcuc2tldGNoKHsKICAgICAgICBkb206IHUuZG9tLAogICAgICAgIGNvbXBvbmVudHM6IHUuY29tcG9uZW50cywKICAgICAgICB0b2dnbGVDbGFzczogIm1jZS1hY3RpdmUiLAogICAgICAgIGRyb3Bkb3duQmVoYXZpb3VyczogdGMoW0t2KChhID0gcikucHJvdmlkZXJzLmlzRGlzYWJsZWQpLCBtdigpLCBtdy5jb25maWcoe30pLCBmeS5jb25maWcoe30pXSksCiAgICAgICAgbGF5b3V0czogdS5sYXlvdXRzLAogICAgICAgIHNhbmRib3hDbGFzc2VzOiBbInRveC1kaWFsb2dfX3BvcHVwcyJdLAogICAgICAgIGxhenlTaW5rOiBhLmdldFNpbmssCiAgICAgICAgZmV0Y2g6IGZ1bmN0aW9uIGZldGNoKG4pIHsKICAgICAgICAgIHJldHVybiBOeShmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdS5mZXRjaCh0KTsKICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdnQuZnJvbShXYihYbyhDYihGcigibWVudS12YWx1ZSIpLCB0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHUub25JdGVtQWN0aW9uKG4sIHQpOwogICAgICAgICAgICB9LCB1LmNvbHVtbnMsIHUucHJlc2V0cywgeGguQ0xPU0VfT05fRVhFQ1VURSwgTywgYS5wcm92aWRlcnMpLCB7CiAgICAgICAgICAgICAgbW92ZW1lbnQ6IGtiKHUuY29sdW1ucywgdS5wcmVzZXRzKQogICAgICAgICAgICB9KSkpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBwYXJ0czogewogICAgICAgICAgbWVudTogJHAoMCwgMCwgdS5wcmVzZXRzKQogICAgICAgIH0KICAgICAgfSkpKSwgc3kuc2tldGNoKHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1mb3JtX19ncm91cCJdCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiBzLnRvQXJyYXkoKS5jb25jYXQoW3sKICAgICAgICAgIGRvbTogewogICAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgICBjbGFzc2VzOiBbInRveC1jb2xvci1pbnB1dCJdCiAgICAgICAgICB9LAogICAgICAgICAgY29tcG9uZW50czogW2MsIGwuYXNTcGVjKCldCiAgICAgICAgfV0pLAogICAgICAgIGZpZWxkQmVoYXZpb3VyczogdGMoW2ZtKCJmb3JtLWZpZWxkLWV2ZW50cyIsIFtDcihndywgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIGwuZ2V0T3B0KHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgZm4odC5lbGVtZW50LCAiYmFja2dyb3VuZC1jb2xvciIsIG4uZXZlbnQuY29sb3IpOwogICAgICAgICAgfSksIHZyKHQsIHB5LCB7CiAgICAgICAgICAgIG5hbWU6IGUubmFtZQogICAgICAgICAgfSk7CiAgICAgICAgfSksIENyKHB3LCBmdW5jdGlvbiAobiwgZSkgewogICAgICAgICAgc3kuZ2V0RmllbGQobikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICBUZi5zZXRWYWx1ZSh0LCBlLmV2ZW50LnZhbHVlKSwgdWQuZ2V0Q3VycmVudChuKS5lYWNoKFZnLmZvY3VzKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pLCBDcihodywgZnVuY3Rpb24gKG4sIHQpIHsKICAgICAgICAgIHN5LmdldEZpZWxkKG4pLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdWQuZ2V0Q3VycmVudChuKS5lYWNoKFZnLmZvY3VzKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pXSldKQogICAgICB9KTsKCiAgICAgIGZ1bmN0aW9uIG8odCwgbikgewogICAgICAgIHZyKHQsIHB3LCB7CiAgICAgICAgICB2YWx1ZTogbgogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgZSwgciwgaSwgdSwgYSwgYywgcywgbDsKICAgIH0pLAogICAgY29sb3JwaWNrZXI6IGRDKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciByID0gUG0obzAocjAsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuICJ0b3gtIiArIHQ7CiAgICAgIH0pLnNrZXRjaCh7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtY29sb3ItcGlja2VyLWNvbnRhaW5lciJdLAogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICByb2xlOiAicHJlc2VudGF0aW9uIgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgb25WYWxpZEhleDogZnVuY3Rpb24gb25WYWxpZEhleCh0KSB7CiAgICAgICAgICB2cih0LCBieSwgewogICAgICAgICAgICBuYW1lOiAiaGV4LXZhbGlkIiwKICAgICAgICAgICAgdmFsdWU6ICEwCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG9uSW52YWxpZEhleDogZnVuY3Rpb24gb25JbnZhbGlkSGV4KHQpIHsKICAgICAgICAgIHZyKHQsIGJ5LCB7CiAgICAgICAgICAgIG5hbWU6ICJoZXgtdmFsaWQiLAogICAgICAgICAgICB2YWx1ZTogITEKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkpOwogICAgICByZXR1cm4gewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IgogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogW3IuYXNTcGVjKCldLAogICAgICAgIGJlaGF2aW91cnM6IHRjKFtUZi5jb25maWcoewogICAgICAgICAgc3RvcmU6IHsKICAgICAgICAgICAgbW9kZTogIm1hbnVhbCIsCiAgICAgICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSh0KSB7CiAgICAgICAgICAgICAgdmFyIG4gPSByLmdldCh0KTsKICAgICAgICAgICAgICByZXR1cm4gdWQuZ2V0Q3VycmVudChuKS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gVGYuZ2V0VmFsdWUodCkuaGV4OwogICAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgcmV0dXJuICIjIiArIHQ7CiAgICAgICAgICAgICAgfSkuZ2V0T3IoIiIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUodCwgbikgewogICAgICAgICAgICAgIHZhciBlID0gL14jKFthLWZBLUYwLTldezN9KD86W2EtZkEtRjAtOV17M30pPykvLmV4ZWMobiksCiAgICAgICAgICAgICAgICAgIG8gPSByLmdldCh0KTsKICAgICAgICAgICAgICB1ZC5nZXRDdXJyZW50KG8pLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkNhbiBub3QgZmluZCBmb3JtIik7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIFRmLnNldFZhbHVlKHQsIHsKICAgICAgICAgICAgICAgICAgaGV4OiB2dC5mcm9tKGVbMV0pLmdldE9yKCIiKQogICAgICAgICAgICAgICAgfSksIFF3LmdldEZpZWxkKHQsICJoZXgiKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgIGhyKHQsIHdpKCkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSwgb3coKV0pCiAgICAgIH07CiAgICB9KSwKICAgIGRyb3B6b25lOiBkQyhmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gdTAodCwgbi5zaGFyZWQucHJvdmlkZXJzKTsKICAgIH0pLAogICAgZ3JpZDogZEMoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIGUgPSBuLnNoYXJlZCwgewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LWZvcm1fX2dyaWQiLCAidG94LWZvcm1fX2dyaWQtLSIgKyB0LmNvbHVtbnMgKyAiY29sIl0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IE0odC5pdGVtcywgZS5pbnRlcnByZXRlcikKICAgICAgfTsKICAgICAgdmFyIGU7CiAgICB9KSwKICAgIGxpc3Rib3g6IGRDKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiBlID0gdCwgciA9IChvID0gbikuc2hhcmVkLnByb3ZpZGVycywgaSA9IFkoZS5pdGVtcykuZmlsdGVyKG5DKSwgdSA9IGUubGFiZWwubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIFpiKHQsIHIpOwogICAgICB9KSwgYSA9IHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1saXN0Ym94ZmllbGQiXQogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogW3N5LnBhcnRzLmZpZWxkKHsKICAgICAgICAgIGRvbToge30sCiAgICAgICAgICBmYWN0b3J5OiB7CiAgICAgICAgICAgIHNrZXRjaDogZnVuY3Rpb24gc2tldGNoKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gUDAoewogICAgICAgICAgICAgICAgdWlkOiB0LnVpZCwKICAgICAgICAgICAgICAgIHRleHQ6IGkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0LnRleHQ7CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGljb246IHZ0Lm5vbmUoKSwKICAgICAgICAgICAgICAgIHRvb2x0aXA6IGUubGFiZWwsCiAgICAgICAgICAgICAgICByb2xlOiB2dC5ub25lKCksCiAgICAgICAgICAgICAgICBmZXRjaDogZnVuY3Rpb24gZmV0Y2godCwgbikgewogICAgICAgICAgICAgICAgICBuKHowKHQxKHQsIGUubmFtZSwgZS5pdGVtcywgVGYuZ2V0VmFsdWUodCkpLCB4aC5DTE9TRV9PTl9FWEVDVVRFLCBvLCAhMSkpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9uU2V0dXA6IHJ0KHN0KSwKICAgICAgICAgICAgICAgIGdldEFwaTogcnQoe30pLAogICAgICAgICAgICAgICAgY29sdW1uczogMSwKICAgICAgICAgICAgICAgIHByZXNldHM6ICJub3JtYWwiLAogICAgICAgICAgICAgICAgY2xhc3NlczogW10sCiAgICAgICAgICAgICAgICBkcm9wZG93bkJlaGF2aW91cnM6IFtmeS5jb25maWcoe30pLCBUZi5jb25maWcoewogICAgICAgICAgICAgICAgICBzdG9yZTogewogICAgICAgICAgICAgICAgICAgIG1vZGU6ICJtYW51YWwiLAogICAgICAgICAgICAgICAgICAgIGluaXRpYWxWYWx1ZTogaS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LnZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0pLmdldE9yKCIiKSwKICAgICAgICAgICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUodCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJuKHQuZWxlbWVudCwgWmspOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKG4sIHQpIHsKICAgICAgICAgICAgICAgICAgICAgIG4xKGUuaXRlbXMsIHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb24obi5lbGVtZW50LCBaaywgdC52YWx1ZSksIHZyKG4sIEFTLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdC50ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KV0KICAgICAgICAgICAgICB9LCAidG94LWxpc3Rib3giLCBvLnNoYXJlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KV0KICAgICAgfSwgc3kuc2tldGNoKHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1mb3JtX19ncm91cCJdCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiBmdChbdS50b0FycmF5KCksIFthXV0pLAogICAgICAgIGZpZWxkQmVoYXZpb3VyczogdGMoW2RkLmNvbmZpZyh7CiAgICAgICAgICBkaXNhYmxlZDogcnQoZS5kaXNhYmxlZCksCiAgICAgICAgICBvbkRpc2FibGVkOiBmdW5jdGlvbiBvbkRpc2FibGVkKHQpIHsKICAgICAgICAgICAgc3kuZ2V0RmllbGQodCkuZWFjaChkZC5kaXNhYmxlKTsKICAgICAgICAgIH0sCiAgICAgICAgICBvbkVuYWJsZWQ6IGZ1bmN0aW9uIG9uRW5hYmxlZCh0KSB7CiAgICAgICAgICAgIHN5LmdldEZpZWxkKHQpLmVhY2goZGQuZW5hYmxlKTsKICAgICAgICAgIH0KICAgICAgICB9KV0pCiAgICAgIH0pOwogICAgICB2YXIgZSwgbywgciwgaSwgdSwgYTsKICAgIH0pLAogICAgc2VsZWN0Ym94OiBkQyhmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gZSA9IHQsIG8gPSBuLnNoYXJlZC5wcm92aWRlcnMsIHIgPSBNKGUuaXRlbXMsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRleHQ6IG8udHJhbnNsYXRlKHQudGV4dCksCiAgICAgICAgICB2YWx1ZTogdC52YWx1ZQogICAgICAgIH07CiAgICAgIH0pLCBpID0gZS5sYWJlbC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gWmIodCwgbyk7CiAgICAgIH0pLCB1ID0gewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LXNlbGVjdGZpZWxkIl0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IGZ0KFtbc3kucGFydHMuZmllbGQoewogICAgICAgICAgZG9tOiB7fSwKICAgICAgICAgIHNlbGVjdEF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgc2l6ZTogZS5zaXplCiAgICAgICAgICB9LAogICAgICAgICAgb3B0aW9uczogciwKICAgICAgICAgIGZhY3Rvcnk6IGUxLAogICAgICAgICAgc2VsZWN0QmVoYXZpb3VyczogdGMoW2RkLmNvbmZpZyh7CiAgICAgICAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiBkaXNhYmxlZCgpIHsKICAgICAgICAgICAgICByZXR1cm4gZS5kaXNhYmxlZCB8fCBvLmlzRGlzYWJsZWQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSksIGZ5LmNvbmZpZyh7fSksIGZtKCJzZWxlY3Rib3gtY2hhbmdlIiwgW0NyKFNpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgIHZyKHQsIHB5LCB7CiAgICAgICAgICAgICAgbmFtZTogZS5uYW1lCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSldKV0pCiAgICAgICAgfSldLCAoMSA8IGUuc2l6ZSA/IHZ0Lm5vbmUoKSA6IHZ0LnNvbWUoam0oImNoZXZyb24tZG93biIsIHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1zZWxlY3RmaWVsZF9faWNvbi1qcyJdCiAgICAgICAgfSwgby5pY29ucykpKS50b0FycmF5KCldKQogICAgICB9LCBzeS5za2V0Y2goewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LWZvcm1fX2dyb3VwIl0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IGZ0KFtpLnRvQXJyYXkoKSwgW3VdXSksCiAgICAgICAgZmllbGRCZWhhdmlvdXJzOiB0YyhbZGQuY29uZmlnKHsKICAgICAgICAgIGRpc2FibGVkOiBmdW5jdGlvbiBkaXNhYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIGUuZGlzYWJsZWQgfHwgby5pc0Rpc2FibGVkKCk7CiAgICAgICAgICB9LAogICAgICAgICAgb25EaXNhYmxlZDogZnVuY3Rpb24gb25EaXNhYmxlZCh0KSB7CiAgICAgICAgICAgIHN5LmdldEZpZWxkKHQpLmVhY2goZGQuZGlzYWJsZSk7CiAgICAgICAgICB9LAogICAgICAgICAgb25FbmFibGVkOiBmdW5jdGlvbiBvbkVuYWJsZWQodCkgewogICAgICAgICAgICBzeS5nZXRGaWVsZCh0KS5lYWNoKGRkLmVuYWJsZSk7CiAgICAgICAgICB9CiAgICAgICAgfSksIG12KCldKQogICAgICB9KTsKICAgICAgdmFyIGUsIG8sIHIsIGksIHU7CiAgICB9KSwKICAgIHNpemVpbnB1dDogZEMoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIFowKHQsIG4uc2hhcmVkLnByb3ZpZGVycyk7CiAgICB9KSwKICAgIHVybGlucHV0OiBkQyhmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gZkModCwgbiwgbi51cmxpbnB1dCk7CiAgICB9KSwKICAgIGN1c3RvbWVkaXRvcjogZEMoZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIG8gPSBkYygpLAogICAgICAgICAgbiA9IFBtKHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogZS50YWcKICAgICAgICB9CiAgICAgIH0pLAogICAgICAgICAgciA9IGRjKCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtY3VzdG9tLWVkaXRvciJdCiAgICAgICAgfSwKICAgICAgICBiZWhhdmlvdXJzOiB0YyhbZm0oImN1c3RvbS1lZGl0b3ItZXZlbnRzIiwgW2V1KGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBuLmdldE9wdCh0KS5lYWNoKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIChUdChlLCAiaW5pdCIpID8gZS5pbml0KG4uZWxlbWVudC5kb20pIDogdVMubG9hZChlLnNjcmlwdElkLCBlLnNjcmlwdFVybCkudGhlbihmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiB0KG4uZWxlbWVudC5kb20sIGUuc2V0dGluZ3MpOwogICAgICAgICAgICB9KSkudGhlbihmdW5jdGlvbiAobikgewogICAgICAgICAgICAgIHIub24oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIG4uc2V0VmFsdWUodCk7CiAgICAgICAgICAgICAgfSksIHIuY2xlYXIoKSwgby5zZXQobik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSldKSwgVGYuY29uZmlnKHsKICAgICAgICAgIHN0b3JlOiB7CiAgICAgICAgICAgIG1vZGU6ICJtYW51YWwiLAogICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG8uZ2V0KCkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gci5nZXQoKS5nZXRPcigiIik7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0LmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh0LCBuKSB7CiAgICAgICAgICAgICAgby5nZXQoKS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHIuc2V0KG4pOwogICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdC5zZXRWYWx1ZShuKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pLCBvdygpXSksCiAgICAgICAgY29tcG9uZW50czogW24uYXNTcGVjKCldCiAgICAgIH07CiAgICB9KSwKICAgIGh0bWxwYW5lbDogZEMoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuICJwcmVzZW50YXRpb24iID09PSB0LnByZXNldHMgPyB1eS5za2V0Y2goewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LWZvcm1fX2dyb3VwIl0sCiAgICAgICAgICBpbm5lckh0bWw6IHQuaHRtbAogICAgICAgIH0KICAgICAgfSkgOiB1eS5za2V0Y2goewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LWZvcm1fX2dyb3VwIl0sCiAgICAgICAgICBpbm5lckh0bWw6IHQuaHRtbCwKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgcm9sZTogImRvY3VtZW50IgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY29udGFpbmVyQmVoYXZpb3VyczogdGMoW2Z5LmNvbmZpZyh7fSksIFZnLmNvbmZpZyh7fSldKQogICAgICB9KTsKICAgIH0pLAogICAgaW1hZ2V0b29sczogZEMoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIHRDKHQsIG4uc2hhcmVkLnByb3ZpZGVycyk7CiAgICB9KSwKICAgIHRhYmxlOiBkQyhmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gZUModCwgbi5zaGFyZWQucHJvdmlkZXJzKTsKICAgIH0pLAogICAgcGFuZWw6IGRDKGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogdC5jbGFzc2VzCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiBNKHQuaXRlbXMsIG4uc2hhcmVkLmludGVycHJldGVyKQogICAgICB9OwogICAgfSkKICB9LAogICAgICBoMSA9IHsKICAgIGZpZWxkOiBmdW5jdGlvbiBmaWVsZCh0LCBuKSB7CiAgICAgIHJldHVybiBuOwogICAgfQogIH0sCiAgICAgIHYxID0gZnVuY3Rpb24gdjEobiwgZSwgbykgewogICAgcmV0dXJuIHR0KHAxLCBlLnR5cGUpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gY29uc29sZS5lcnJvcignVW5rbm93biBmYWN0b3J5IHR5cGUgIicgKyBlLnR5cGUgKyAnIiwgZGVmYXVsdGluZyB0byBjb250YWluZXI6ICcsIGUpLCBlOwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQobiwgZSwgbyk7CiAgICB9KTsKICB9LAogICAgICBiMSA9IHsKICAgIHZhbGlnbkNlbnRyZTogW10sCiAgICBhbGlnbkNlbnRyZTogW10sCiAgICBhbGlnbkxlZnQ6IFtdLAogICAgYWxpZ25SaWdodDogW10sCiAgICByaWdodDogW10sCiAgICBsZWZ0OiBbXSwKICAgIGJvdHRvbTogW10sCiAgICB0b3A6IFtdCiAgfSwKICAgICAgeTEgPSBbewogICAgdGl0bGU6ICJIZWFkaW5ncyIsCiAgICBpdGVtczogW3sKICAgICAgdGl0bGU6ICJIZWFkaW5nIDEiLAogICAgICBmb3JtYXQ6ICJoMSIKICAgIH0sIHsKICAgICAgdGl0bGU6ICJIZWFkaW5nIDIiLAogICAgICBmb3JtYXQ6ICJoMiIKICAgIH0sIHsKICAgICAgdGl0bGU6ICJIZWFkaW5nIDMiLAogICAgICBmb3JtYXQ6ICJoMyIKICAgIH0sIHsKICAgICAgdGl0bGU6ICJIZWFkaW5nIDQiLAogICAgICBmb3JtYXQ6ICJoNCIKICAgIH0sIHsKICAgICAgdGl0bGU6ICJIZWFkaW5nIDUiLAogICAgICBmb3JtYXQ6ICJoNSIKICAgIH0sIHsKICAgICAgdGl0bGU6ICJIZWFkaW5nIDYiLAogICAgICBmb3JtYXQ6ICJoNiIKICAgIH1dCiAgfSwgewogICAgdGl0bGU6ICJJbmxpbmUiLAogICAgaXRlbXM6IFt7CiAgICAgIHRpdGxlOiAiQm9sZCIsCiAgICAgIGZvcm1hdDogImJvbGQiCiAgICB9LCB7CiAgICAgIHRpdGxlOiAiSXRhbGljIiwKICAgICAgZm9ybWF0OiAiaXRhbGljIgogICAgfSwgewogICAgICB0aXRsZTogIlVuZGVybGluZSIsCiAgICAgIGZvcm1hdDogInVuZGVybGluZSIKICAgIH0sIHsKICAgICAgdGl0bGU6ICJTdHJpa2V0aHJvdWdoIiwKICAgICAgZm9ybWF0OiAic3RyaWtldGhyb3VnaCIKICAgIH0sIHsKICAgICAgdGl0bGU6ICJTdXBlcnNjcmlwdCIsCiAgICAgIGZvcm1hdDogInN1cGVyc2NyaXB0IgogICAgfSwgewogICAgICB0aXRsZTogIlN1YnNjcmlwdCIsCiAgICAgIGZvcm1hdDogInN1YnNjcmlwdCIKICAgIH0sIHsKICAgICAgdGl0bGU6ICJDb2RlIiwKICAgICAgZm9ybWF0OiAiY29kZSIKICAgIH1dCiAgfSwgewogICAgdGl0bGU6ICJCbG9ja3MiLAogICAgaXRlbXM6IFt7CiAgICAgIHRpdGxlOiAiUGFyYWdyYXBoIiwKICAgICAgZm9ybWF0OiAicCIKICAgIH0sIHsKICAgICAgdGl0bGU6ICJCbG9ja3F1b3RlIiwKICAgICAgZm9ybWF0OiAiYmxvY2txdW90ZSIKICAgIH0sIHsKICAgICAgdGl0bGU6ICJEaXYiLAogICAgICBmb3JtYXQ6ICJkaXYiCiAgICB9LCB7CiAgICAgIHRpdGxlOiAiUHJlIiwKICAgICAgZm9ybWF0OiAicHJlIgogICAgfV0KICB9LCB7CiAgICB0aXRsZTogIkFsaWduIiwKICAgIGl0ZW1zOiBbewogICAgICB0aXRsZTogIkxlZnQiLAogICAgICBmb3JtYXQ6ICJhbGlnbmxlZnQiCiAgICB9LCB7CiAgICAgIHRpdGxlOiAiQ2VudGVyIiwKICAgICAgZm9ybWF0OiAiYWxpZ25jZW50ZXIiCiAgICB9LCB7CiAgICAgIHRpdGxlOiAiUmlnaHQiLAogICAgICBmb3JtYXQ6ICJhbGlnbnJpZ2h0IgogICAgfSwgewogICAgICB0aXRsZTogIkp1c3RpZnkiLAogICAgICBmb3JtYXQ6ICJhbGlnbmp1c3RpZnkiCiAgICB9XQogIH1dLAogICAgICB4MSA9IGZ1bmN0aW9uIHgxKHQpIHsKICAgIHJldHVybiBSKHQsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIGlmIChUdChuLCAiaXRlbXMiKSkgewogICAgICAgIHZhciBlID0geDEobi5pdGVtcyk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGN1c3RvbUZvcm1hdHM6IHQuY3VzdG9tRm9ybWF0cy5jb25jYXQoZS5jdXN0b21Gb3JtYXRzKSwKICAgICAgICAgIGZvcm1hdHM6IHQuZm9ybWF0cy5jb25jYXQoW3sKICAgICAgICAgICAgdGl0bGU6IG4udGl0bGUsCiAgICAgICAgICAgIGl0ZW1zOiBlLmZvcm1hdHMKICAgICAgICAgIH1dKQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGlmIChUdChuLCAiaW5saW5lIikgfHwgVHQobiwgImJsb2NrIikgfHwgVHQobiwgInNlbGVjdG9yIikpIHsKICAgICAgICB2YXIgbyA9ICJjdXN0b20tIiArICh5KG4ubmFtZSkgPyBuLm5hbWUgOiBuLnRpdGxlLnRvTG93ZXJDYXNlKCkpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBjdXN0b21Gb3JtYXRzOiB0LmN1c3RvbUZvcm1hdHMuY29uY2F0KFt7CiAgICAgICAgICAgIG5hbWU6IG8sCiAgICAgICAgICAgIGZvcm1hdDogbgogICAgICAgICAgfV0pLAogICAgICAgICAgZm9ybWF0czogdC5mb3JtYXRzLmNvbmNhdChbewogICAgICAgICAgICB0aXRsZTogbi50aXRsZSwKICAgICAgICAgICAgZm9ybWF0OiBvLAogICAgICAgICAgICBpY29uOiBuLmljb24KICAgICAgICAgIH1dKQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHJldHVybiBfbHQoX2x0KHt9LCB0KSwgewogICAgICAgIGZvcm1hdHM6IHQuZm9ybWF0cy5jb25jYXQobikKICAgICAgfSk7CiAgICB9LCB7CiAgICAgIGN1c3RvbUZvcm1hdHM6IFtdLAogICAgICBmb3JtYXRzOiBbXQogICAgfSk7CiAgfSwKICAgICAgdzEgPSBhUy50cmltLAogICAgICBTMSA9IGJDKCJ0cnVlIiksCiAgICAgIEMxID0gYkMoImZhbHNlIiksCiAgICAgIGsxID0gZnVuY3Rpb24gazEodCkgewogICAgdmFyIG4gPSBNKHBzKEF0LmZyb21Eb20odCksICJoMSxoMixoMyxoNCxoNSxoNixhOm5vdChbaHJlZl0pIiksIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0LmRvbTsKICAgIH0pOwogICAgcmV0dXJuIEYoTShGKG4sIENDKSwga0MpLmNvbmNhdChNKEYobiwgd0MpLCBPQykpLCBfQyk7CiAgfSwKICAgICAgTzEgPSAidGlueW1jZS11cmwtaGlzdG9yeSIsCiAgICAgIF8xID0gbmQsCiAgICAgIFQxID0gWmYsCiAgICAgIEUxID0gcnQoW1RvKCJzaGVsbCIsICExKSwgZm8oIm1ha2VJdGVtIiksIFRvKCJzZXR1cEl0ZW0iLCBzdCksIEVmKCJsaXN0QmVoYXZpb3VycyIsIFtGZ10pXSksCiAgICAgIEQxID0gcnQoW0pmKHsKICAgIG5hbWU6ICJpdGVtcyIsCiAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIG92ZXJyaWRlcygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBiZWhhdmlvdXJzOiB0YyhbRmcuY29uZmlnKHt9KV0pCiAgICAgIH07CiAgICB9CiAgfSldKSwKICAgICAgQjEgPSBTbCh7CiAgICBuYW1lOiBydCgiQ3VzdG9tTGlzdCIpKCksCiAgICBjb25maWdGaWVsZHM6IEUxKCksCiAgICBwYXJ0RmllbGRzOiBEMSgpLAogICAgZmFjdG9yeTogZnVuY3Rpb24gZmFjdG9yeShzLCB0LCBuLCBlKSB7CiAgICAgIHZhciBvID0gcy5zaGVsbCA/IHsKICAgICAgICBiZWhhdmlvdXJzOiBbRmcuY29uZmlnKHt9KV0sCiAgICAgICAgY29tcG9uZW50czogW10KICAgICAgfSA6IHsKICAgICAgICBiZWhhdmlvdXJzOiBbXSwKICAgICAgICBjb21wb25lbnRzOiB0CiAgICAgIH07CiAgICAgIHJldHVybiB7CiAgICAgICAgdWlkOiBzLnVpZCwKICAgICAgICBkb206IHMuZG9tLAogICAgICAgIGNvbXBvbmVudHM6IG8uY29tcG9uZW50cywKICAgICAgICBiZWhhdmlvdXJzOiBacyhzLmxpc3RCZWhhdmlvdXJzLCBvLmJlaGF2aW91cnMpLAogICAgICAgIGFwaXM6IHsKICAgICAgICAgIHNldEl0ZW1zOiBmdW5jdGlvbiBzZXRJdGVtcyhhLCBjKSB7CiAgICAgICAgICAgIHZhciB0OwogICAgICAgICAgICB0ID0gYSwgKHMuc2hlbGwgPyB2dC5zb21lKHQpIDogZmwodCwgcywgIml0ZW1zIikpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHRocm93IGNvbnNvbGUuZXJyb3IoIkN1c3RvbSBMaXN0IHdhcyBkZWZpbmVkIHRvIG5vdCBiZSBhIHNoZWxsLCBidXQgbm8gaXRlbSBjb250YWluZXIgd2FzIHNwZWNpZmllZCBpbiBjb21wb25lbnRzIiksIG5ldyBFcnJvcigiQ3VzdG9tIExpc3Qgd2FzIGRlZmluZWQgdG8gbm90IGJlIGEgc2hlbGwsIGJ1dCBubyBpdGVtIGNvbnRhaW5lciB3YXMgc3BlY2lmaWVkIGluIGNvbXBvbmVudHMiKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICB2YXIgdCA9IEZnLmNvbnRlbnRzKG4pLAogICAgICAgICAgICAgICAgICBlID0gYy5sZW5ndGgsCiAgICAgICAgICAgICAgICAgIG8gPSBlIC0gdC5sZW5ndGgsCiAgICAgICAgICAgICAgICAgIHIgPSAwIDwgbyA/IEQobywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHMubWFrZUl0ZW0oKTsKICAgICAgICAgICAgICB9KSA6IFtdLAogICAgICAgICAgICAgICAgICBpID0gdC5zbGljZShlKTsKICAgICAgICAgICAgICBTdChpLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEZnLnJlbW92ZShuLCB0KTsKICAgICAgICAgICAgICB9KSwgU3QociwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBGZy5hcHBlbmQobiwgdCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdmFyIHUgPSBGZy5jb250ZW50cyhuKTsKICAgICAgICAgICAgICBTdCh1LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICAgICAgcy5zZXR1cEl0ZW0oYSwgdCwgY1tuXSwgbik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0sCiAgICBhcGlzOiB7CiAgICAgIHNldEl0ZW1zOiBmdW5jdGlvbiBzZXRJdGVtcyh0LCBuLCBlKSB7CiAgICAgICAgdC5zZXRJdGVtcyhuLCBlKTsKICAgICAgfQogICAgfQogIH0pLAogICAgICBNMSA9IHJ0KFtmbygiZG9tIiksIFRvKCJzaGVsbCIsICEwKSwgJHMoInRvb2xiYXJCZWhhdmlvdXJzIiwgW0ZnXSldKSwKICAgICAgQTEgPSBydChbSmYoewogICAgbmFtZTogImdyb3VwcyIsCiAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIG92ZXJyaWRlcygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBiZWhhdmlvdXJzOiB0YyhbRmcuY29uZmlnKHt9KV0pCiAgICAgIH07CiAgICB9CiAgfSldKSwKICAgICAgRjEgPSBTbCh7CiAgICBuYW1lOiAiVG9vbGJhciIsCiAgICBjb25maWdGaWVsZHM6IE0xKCksCiAgICBwYXJ0RmllbGRzOiBBMSgpLAogICAgZmFjdG9yeTogZnVuY3Rpb24gZmFjdG9yeShvLCB0LCBuLCBlKSB7CiAgICAgIHZhciByID0gby5zaGVsbCA/IHsKICAgICAgICBiZWhhdmlvdXJzOiBbRmcuY29uZmlnKHt9KV0sCiAgICAgICAgY29tcG9uZW50czogW10KICAgICAgfSA6IHsKICAgICAgICBiZWhhdmlvdXJzOiBbXSwKICAgICAgICBjb21wb25lbnRzOiB0CiAgICAgIH07CiAgICAgIHJldHVybiB7CiAgICAgICAgdWlkOiBvLnVpZCwKICAgICAgICBkb206IG8uZG9tLAogICAgICAgIGNvbXBvbmVudHM6IHIuY29tcG9uZW50cywKICAgICAgICBiZWhhdmlvdXJzOiBacyhvLnRvb2xiYXJCZWhhdmlvdXJzLCByLmJlaGF2aW91cnMpLAogICAgICAgIGFwaXM6IHsKICAgICAgICAgIHNldEdyb3VwczogZnVuY3Rpb24gc2V0R3JvdXBzKHQsIG4pIHsKICAgICAgICAgICAgdmFyIGU7CiAgICAgICAgICAgIGUgPSB0LCAoby5zaGVsbCA/IHZ0LnNvbWUoZSkgOiBmbChlLCBvLCAiZ3JvdXBzIikpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHRocm93IGNvbnNvbGUuZXJyb3IoIlRvb2xiYXIgd2FzIGRlZmluZWQgdG8gbm90IGJlIGEgc2hlbGwsIGJ1dCBubyBncm91cHMgY29udGFpbmVyIHdhcyBzcGVjaWZpZWQgaW4gY29tcG9uZW50cyIpLCBuZXcgRXJyb3IoIlRvb2xiYXIgd2FzIGRlZmluZWQgdG8gbm90IGJlIGEgc2hlbGwsIGJ1dCBubyBncm91cHMgY29udGFpbmVyIHdhcyBzcGVjaWZpZWQgaW4gY29tcG9uZW50cyIpOwogICAgICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIEZnLnNldCh0LCBuKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBkb21Nb2RpZmljYXRpb246IHsKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgcm9sZTogImdyb3VwIgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0sCiAgICBhcGlzOiB7CiAgICAgIHNldEdyb3VwczogZnVuY3Rpb24gc2V0R3JvdXBzKHQsIG4sIGUpIHsKICAgICAgICB0LnNldEdyb3VwcyhuLCBlKTsKICAgICAgfQogICAgfQogIH0pLAogICAgICBJMSA9IHJ0KFtdKSwKICAgICAgUjEgPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIHNldHVwOiBzdCwKICAgIGlzRG9ja2VkOiBPLAogICAgZ2V0QmVoYXZpb3VyczogSTEKICB9KSwKICAgICAgVjEgPSBQbyhbewogICAgc3RhdGljOiBbXQogIH0sIHsKICAgIGFic29sdXRlOiBbInBvc2l0aW9uQ3NzIl0KICB9LCB7CiAgICBmaXhlZDogWyJwb3NpdGlvbkNzcyJdCiAgfV0pLAogICAgICBQMSA9IGZ1bmN0aW9uIFAxKHQsIG4sIGUpIHsKICAgIHZhciBvLCByLCBpLCB1OwogICAgdC5nZXRTeXN0ZW0oKS5pc0Nvbm5lY3RlZCgpICYmIChpID0gZSwgdSA9IChyID0gbikubGF6eVZpZXdwb3J0KG8gPSB0KSwgaS5pc0RvY2tlZCgpICYmIHFDKG8sIHIsIGksIHUpLCBHQyhvLCB1LCBpKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgIHQuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIFhDKG8sIHIsIGkpOwogICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBZQyhvLCByLCBpLCB0KTsKICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICBxQyhvLCByLCBpLCB1LCAhMCksIFlDKG8sIHIsIGksIHQpOwogICAgICB9KTsKICAgIH0pKTsKICB9LAogICAgICBIMSA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgcmVmcmVzaDogUDEsCiAgICByZXNldDogS0MsCiAgICBpc0RvY2tlZDogZnVuY3Rpb24gaXNEb2NrZWQodCwgbiwgZSkgewogICAgICByZXR1cm4gZS5pc0RvY2tlZCgpOwogICAgfSwKICAgIGdldE1vZGVzOiBmdW5jdGlvbiBnZXRNb2Rlcyh0LCBuLCBlKSB7CiAgICAgIHJldHVybiBlLmdldE1vZGVzKCk7CiAgICB9LAogICAgc2V0TW9kZXM6IGZ1bmN0aW9uIHNldE1vZGVzKHQsIG4sIGUsIG8pIHsKICAgICAgcmV0dXJuIGUuc2V0TW9kZXMobyk7CiAgICB9CiAgfSksCiAgICAgIHoxID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBldmVudHM6IGZ1bmN0aW9uIGV2ZW50cyhvLCByKSB7CiAgICAgIHJldHVybiBudShbRHIoT2koKSwgZnVuY3Rpb24gKG4sIGUpIHsKICAgICAgICBvLmNvbnRleHR1YWwuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgcXIobi5lbGVtZW50LCB0LnRyYW5zaXRpb25DbGFzcykgJiYgKEpyKG4uZWxlbWVudCwgW3QudHJhbnNpdGlvbkNsYXNzLCB0LmZhZGVJbkNsYXNzXSksIChyLmlzVmlzaWJsZSgpID8gdC5vblNob3duIDogdC5vbkhpZGRlbikobikpLCBlLnN0b3AoKTsKICAgICAgICB9KTsKICAgICAgfSksIENyKFdpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgUDEodCwgbywgcik7CiAgICAgIH0pLCBDcihVaSgpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIEtDKHQsIG8sIHIpOwogICAgICB9KV0pOwogICAgfQogIH0pLAogICAgICBOMSA9IHlhKHsKICAgIGZpZWxkczogW19vKCJjb250ZXh0dWFsIiwgW2dvKCJmYWRlSW5DbGFzcyIpLCBnbygiZmFkZU91dENsYXNzIiksIGdvKCJ0cmFuc2l0aW9uQ2xhc3MiKSwgaG8oImxhenlDb250ZXh0IiksIEt1KCJvblNob3ciKSwgS3UoIm9uU2hvd24iKSwgS3UoIm9uSGlkZSIpLCBLdSgib25IaWRkZW4iKV0pLCBGbygibGF6eVZpZXdwb3J0IiwgQWUpLCBJbygibW9kZXMiLCBbInRvcCIsICJib3R0b20iXSwgdHIpLCBLdSgib25Eb2NrZWQiKSwgS3UoIm9uVW5kb2NrZWQiKV0sCiAgICBuYW1lOiAiZG9ja2luZyIsCiAgICBhY3RpdmU6IHoxLAogICAgYXBpczogSDEsCiAgICBzdGF0ZTogT2JqZWN0LmZyZWV6ZSh7CiAgICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdCh0KSB7CiAgICAgICAgdmFyIG4gPSBWbyghMSksCiAgICAgICAgICAgIGUgPSBWbyghMCksCiAgICAgICAgICAgIG8gPSBkYygpLAogICAgICAgICAgICByID0gVm8odC5tb2Rlcyk7CiAgICAgICAgcmV0dXJuIHh1KHsKICAgICAgICAgIGlzRG9ja2VkOiBuLmdldCwKICAgICAgICAgIHNldERvY2tlZDogbi5zZXQsCiAgICAgICAgICBnZXRJbml0aWFsUG9zOiBvLmdldCwKICAgICAgICAgIHNldEluaXRpYWxQb3M6IG8uc2V0LAogICAgICAgICAgY2xlYXJJbml0aWFsUG9zOiBvLmNsZWFyLAogICAgICAgICAgaXNWaXNpYmxlOiBlLmdldCwKICAgICAgICAgIHNldFZpc2libGU6IGUuc2V0LAogICAgICAgICAgZ2V0TW9kZXM6IHIuZ2V0LAogICAgICAgICAgc2V0TW9kZXM6IHIuc2V0LAogICAgICAgICAgcmVhZFN0YXRlOiBmdW5jdGlvbiByZWFkU3RhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiAiZG9ja2VkOiAgIiArIG4uZ2V0KCkgKyAiLCB2aXNpYmxlOiAiICsgZS5nZXQoKSArICIsIG1vZGVzOiAiICsgci5nZXQoKS5qb2luKCIsIik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pCiAgfSksCiAgICAgIEwxID0gcnQoRnIoInRvb2xiYXItaGVpZ2h0LWNoYW5nZSIpKSwKICAgICAgVzEgPSB7CiAgICBmYWRlSW5DbGFzczogInRveC1lZGl0b3ItZG9jay1mYWRlaW4iLAogICAgZmFkZU91dENsYXNzOiAidG94LWVkaXRvci1kb2NrLWZhZGVvdXQiLAogICAgdHJhbnNpdGlvbkNsYXNzOiAidG94LWVkaXRvci1kb2NrLXRyYW5zaXRpb24iCiAgfSwKICAgICAgVTEgPSAidG94LXRpbnltY2UtLXRvb2xiYXItc3RpY2t5LW9uIiwKICAgICAgajEgPSAidG94LXRpbnltY2UtLXRvb2xiYXItc3RpY2t5LW9mZiIsCiAgICAgIEcxID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBzZXR1cDogZnVuY3Rpb24gc2V0dXAodCwgbiwgZSkgewogICAgICB0LmlubGluZSB8fCAobi5oZWFkZXIuaXNQb3NpdGlvbmVkQXRUb3AoKSB8fCB0Lm9uKCJSZXNpemVFZGl0b3IiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgZSgpLmVhY2goTjEucmVzZXQpOwogICAgICB9KSwgdC5vbigiUmVzaXplV2luZG93IFJlc2l6ZUVkaXRvciIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBlKCkuZWFjaCgkQyk7CiAgICAgIH0pLCB0Lm9uKCJTa2luTG9hZGVkIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGUoKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBOMS5pc0RvY2tlZCh0KSA/IE4xLnJlc2V0KHQpIDogTjEucmVmcmVzaCh0KTsKICAgICAgICB9KTsKICAgICAgfSksIHQub24oIkZ1bGxzY3JlZW5TdGF0ZUNoYW5nZWQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgZSgpLmVhY2goTjEucmVzZXQpOwogICAgICB9KSksIHQub24oIkFmdGVyU2Nyb2xsSW50b1ZpZXciLCBmdW5jdGlvbiAoYikgewogICAgICAgIGUoKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBOMS5yZWZyZXNoKHQpOwogICAgICAgICAgdmFyIG4sCiAgICAgICAgICAgICAgZSwKICAgICAgICAgICAgICBvLAogICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICB1LAogICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgYywKICAgICAgICAgICAgICBzLAogICAgICAgICAgICAgIGwsCiAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICBkLAogICAgICAgICAgICAgIG0sCiAgICAgICAgICAgICAgZywKICAgICAgICAgICAgICBwLAogICAgICAgICAgICAgIGgsCiAgICAgICAgICAgICAgdiA9IHQuZWxlbWVudDsKICAgICAgICAgIFJkKHYpICYmIChuID0gYiwgciA9IChvID0gVXQoZSA9IHYpKS5kb20uZGVmYXVsdFZpZXcuaW5uZXJIZWlnaHQsIGkgPSBJbihvKSwgYSA9IHpuKHUgPSBBdC5mcm9tRG9tKG4uZWxtKSksIGMgPSB4bih1KSwgbCA9IChzID0gYS55KSArIGMsIGYgPSBDbihlKSwgZCA9IHhuKGUpLCBnID0gKG0gPSBmLnRvcCkgKyBkLCBwID0gTWF0aC5hYnMobSAtIGkudG9wKSA8IDIsIGggPSBNYXRoLmFicyhnIC0gKGkudG9wICsgcikpIDwgMiwgcCAmJiBzIDwgZyA/IFJuKGkubGVmdCwgcyAtIGQsIG8pIDogaCAmJiBtIDwgbCAmJiBSbihpLmxlZnQsIHMgLSByICsgYyArIGQsIG8pKTsKICAgICAgICB9KTsKICAgICAgfSksIHQub24oIlBvc3RSZW5kZXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgWkModCwgITEpOwogICAgICB9KTsKICAgIH0sCiAgICBpc0RvY2tlZDogZnVuY3Rpb24gaXNEb2NrZWQodCkgewogICAgICByZXR1cm4gdCgpLm1hcChOMS5pc0RvY2tlZCkuZ2V0T3IoITEpOwogICAgfSwKICAgIGdldEJlaGF2aW91cnM6IHRrCiAgfSksCiAgICAgIFgxID0gSm8oW2dvKCJ0eXBlIiksIG1vKCJpdGVtcyIsIG5vKFskbyhbZ28oIm5hbWUiKSwgeW8oIml0ZW1zIiwgdHIpXSksIHRyXSkpXS5jb25jYXQoVnApKSwKICAgICAgWTEgPSBbQ28oInRleHQiKSwgQ28oInRvb2x0aXAiKSwgQ28oImljb24iKSwgaG8oImZldGNoIiksIEZvKCJvblNldHVwIiwgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHN0OwogIH0pXSwKICAgICAgcTEgPSBKbyhIKFtnbygidHlwZSIpXSwgWTEsICEwKSksCiAgICAgIEsxID0gSm8oW2dvKCJ0eXBlIiksIENvKCJ0b29sdGlwIiksIENvKCJpY29uIiksIENvKCJ0ZXh0IiksIGtvKCJzZWxlY3QiKSwgaG8oImZldGNoIiksIEZvKCJvblNldHVwIiwgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHN0OwogIH0pLCBNbygicHJlc2V0cyIsICJub3JtYWwiLCBbIm5vcm1hbCIsICJjb2xvciIsICJsaXN0cHJldmlldyJdKSwgVG8oImNvbHVtbnMiLCAxKSwgaG8oIm9uQWN0aW9uIiksIGhvKCJvbkl0ZW1BY3Rpb24iKV0pLAogICAgICBKMSA9IHdsKHsKICAgIGZhY3Rvcnk6IGZ1bmN0aW9uIGZhY3RvcnkobiwgbykgewogICAgICB2YXIgdCA9IHsKICAgICAgICBmb2N1czogTWcuZm9jdXNJbiwKICAgICAgICBzZXRNZW51czogZnVuY3Rpb24gc2V0TWVudXModCwgbikgewogICAgICAgICAgdmFyIGUgPSBNKG4sIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHJldHVybiBMMChuayh7CiAgICAgICAgICAgICAgdHlwZTogIm1lbnVidXR0b24iLAogICAgICAgICAgICAgIHRleHQ6IG4udGV4dCwKICAgICAgICAgICAgICBmZXRjaDogZnVuY3Rpb24gZmV0Y2godCkgewogICAgICAgICAgICAgICAgdChuLmdldEl0ZW1zKCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkubWFwRXJyb3IoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gaXIodCk7CiAgICAgICAgICAgIH0pLmdldE9yRGllKCksICJ0b3gtbWJ0biIsIG8uYmFja3N0YWdlLCB2dC5zb21lKCJtZW51aXRlbSIpKTsKICAgICAgICAgIH0pOwogICAgICAgICAgRmcuc2V0KHQsIGUpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIHsKICAgICAgICB1aWQ6IG4udWlkLAogICAgICAgIGRvbTogbi5kb20sCiAgICAgICAgY29tcG9uZW50czogW10sCiAgICAgICAgYmVoYXZpb3VyczogdGMoW0ZnLmNvbmZpZyh7fSksIGZtKCJtZW51YmFyLWV2ZW50cyIsIFtldShmdW5jdGlvbiAodCkgewogICAgICAgICAgbi5vblNldHVwKHQpOwogICAgICAgIH0pLCBDcihoaSgpLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgRnUoZS5lbGVtZW50LCAiLnRveC1tYnRuLS1hY3RpdmUiKS5lYWNoKGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIEl1KHQuZXZlbnQudGFyZ2V0LCAiLnRveC1tYnRuIikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIEx0KG4sIHQpIHx8IGUuZ2V0U3lzdGVtKCkuZ2V0QnlEb20obikuZWFjaChmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgZS5nZXRTeXN0ZW0oKS5nZXRCeURvbSh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgIGR3LmV4cGFuZCh0KSwgZHcuY2xvc2UobiksIFZnLmZvY3VzKHQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSksIENyKHFpKCksIGZ1bmN0aW9uIChlLCB0KSB7CiAgICAgICAgICB0LmV2ZW50LnByZXZGb2N1cy5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiBlLmdldFN5c3RlbSgpLmdldEJ5RG9tKHQpLnRvT3B0aW9uYWwoKTsKICAgICAgICAgIH0pLmVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgdC5ldmVudC5uZXdGb2N1cy5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuZ2V0U3lzdGVtKCkuZ2V0QnlEb20odCkudG9PcHRpb25hbCgpOwogICAgICAgICAgICB9KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgZHcuaXNPcGVuKG4pICYmIChkdy5leHBhbmQodCksIGR3LmNsb3NlKG4pKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KV0pLCBNZy5jb25maWcoewogICAgICAgICAgbW9kZTogImZsb3ciLAogICAgICAgICAgc2VsZWN0b3I6ICIudG94LW1idG4iLAogICAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uIG9uRXNjYXBlKHQpIHsKICAgICAgICAgICAgcmV0dXJuIG4ub25Fc2NhcGUodCksIHZ0LnNvbWUoITApOwogICAgICAgICAgfQogICAgICAgIH0pLCBmeS5jb25maWcoe30pXSksCiAgICAgICAgYXBpczogdCwKICAgICAgICBkb21Nb2RpZmljYXRpb246IHsKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgcm9sZTogIm1lbnViYXIiCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgfSwKICAgIG5hbWU6ICJzaWx2ZXIuTWVudWJhciIsCiAgICBjb25maWdGaWVsZHM6IFtmbygiZG9tIiksIGZvKCJ1aWQiKSwgZm8oIm9uRXNjYXBlIiksIGZvKCJiYWNrc3RhZ2UiKSwgVG8oIm9uU2V0dXAiLCBzdCldLAogICAgYXBpczogewogICAgICBmb2N1czogZnVuY3Rpb24gZm9jdXModCwgbikgewogICAgICAgIHQuZm9jdXMobik7CiAgICAgIH0sCiAgICAgIHNldE1lbnVzOiBmdW5jdGlvbiBzZXRNZW51cyh0LCBuLCBlKSB7CiAgICAgICAgdC5zZXRNZW51cyhuLCBlKTsKICAgICAgfQogICAgfQogIH0pLAogICAgICAkMSA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgcmVmcmVzaDogZnVuY3Rpb24gcmVmcmVzaCh0LCBuLCBlKSB7CiAgICAgIHZhciBvOwogICAgICBlLmlzRXhwYW5kZWQoKSAmJiAodm4odC5lbGVtZW50LCBvayhuKSksIG8gPSByayhuLCB0LmVsZW1lbnQpLCBmbih0LmVsZW1lbnQsIG9rKG4pLCBvKSk7CiAgICB9LAogICAgZ3JvdzogZnVuY3Rpb24gZ3Jvdyh0LCBuLCBlKSB7CiAgICAgIGUuaXNFeHBhbmRlZCgpIHx8IGxrKHQsIG4sIGUpOwogICAgfSwKICAgIHNocmluazogZnVuY3Rpb24gc2hyaW5rKHQsIG4sIGUpIHsKICAgICAgZS5pc0V4cGFuZGVkKCkgJiYgc2sodCwgbiwgZSk7CiAgICB9LAogICAgaW1tZWRpYXRlU2hyaW5rOiBmdW5jdGlvbiBpbW1lZGlhdGVTaHJpbmsodCwgbiwgZSkgewogICAgICBlLmlzRXhwYW5kZWQoKSAmJiBjayh0LCBuLCBlKTsKICAgIH0sCiAgICBoYXNHcm93bjogZnVuY3Rpb24gaGFzR3Jvd24odCwgbiwgZSkgewogICAgICByZXR1cm4gZS5pc0V4cGFuZGVkKCk7CiAgICB9LAogICAgaGFzU2hydW5rOiBmdW5jdGlvbiBoYXNTaHJ1bmsodCwgbiwgZSkgewogICAgICByZXR1cm4gZS5pc0NvbGxhcHNlZCgpOwogICAgfSwKICAgIGlzR3Jvd2luZzogZmssCiAgICBpc1Nocmlua2luZzogZGssCiAgICBpc1RyYW5zaXRpb25pbmc6IGZ1bmN0aW9uIGlzVHJhbnNpdGlvbmluZyh0LCBuLCBlKSB7CiAgICAgIHJldHVybiBmayh0LCBuKSB8fCBkayh0LCBuKTsKICAgIH0sCiAgICB0b2dnbGVHcm93OiBmdW5jdGlvbiB0b2dnbGVHcm93KHQsIG4sIGUpIHsKICAgICAgKGUuaXNFeHBhbmRlZCgpID8gc2sgOiBsaykodCwgbiwgZSk7CiAgICB9LAogICAgZGlzYWJsZVRyYW5zaXRpb25zOiBpawogIH0pLAogICAgICBRMSA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgZXhoaWJpdDogZnVuY3Rpb24gZXhoaWJpdCh0LCBuLCBlKSB7CiAgICAgIHJldHVybiBOcihuLmV4cGFuZGVkID8gewogICAgICAgIGNsYXNzZXM6IFtuLm9wZW5DbGFzc10sCiAgICAgICAgc3R5bGVzOiB7fQogICAgICB9IDogewogICAgICAgIGNsYXNzZXM6IFtuLmNsb3NlZENsYXNzXSwKICAgICAgICBzdHlsZXM6IGNyKG4uZGltZW5zaW9uLnByb3BlcnR5LCAiMHB4IikKICAgICAgfSk7CiAgICB9LAogICAgZXZlbnRzOiBmdW5jdGlvbiBldmVudHMoZSwgbykgewogICAgICByZXR1cm4gbnUoW0RyKE9pKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgbi5ldmVudC5yYXcucHJvcGVydHlOYW1lID09PSBlLmRpbWVuc2lvbi5wcm9wZXJ0eSAmJiAoaWsodCwgZSksIG8uaXNFeHBhbmRlZCgpICYmIHZuKHQuZWxlbWVudCwgZS5kaW1lbnNpb24ucHJvcGVydHkpLCAoby5pc0V4cGFuZGVkKCkgPyBlLm9uR3Jvd24gOiBlLm9uU2hydW5rKSh0KSk7CiAgICAgIH0pXSk7CiAgICB9CiAgfSksCiAgICAgIFoxID0geWEoewogICAgZmllbGRzOiBbZm8oImNsb3NlZENsYXNzIiksIGZvKCJvcGVuQ2xhc3MiKSwgZm8oInNocmlua2luZ0NsYXNzIiksIGZvKCJncm93aW5nQ2xhc3MiKSwgeG8oImdldEFuaW1hdGlvblJvb3QiKSwgS3UoIm9uU2hydW5rIiksIEt1KCJvblN0YXJ0U2hyaW5rIiksIEt1KCJvbkdyb3duIiksIEt1KCJvblN0YXJ0R3JvdyIpLCBUbygiZXhwYW5kZWQiLCAhMSksIG1vKCJkaW1lbnNpb24iLCBzbygicHJvcGVydHkiLCB7CiAgICAgIHdpZHRoOiBbWnUoInByb3BlcnR5IiwgIndpZHRoIiksIFp1KCJnZXREaW1lbnNpb24iLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBrbih0KSArICJweCI7CiAgICAgIH0pXSwKICAgICAgaGVpZ2h0OiBbWnUoInByb3BlcnR5IiwgImhlaWdodCIpLCBadSgiZ2V0RGltZW5zaW9uIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4geG4odCkgKyAicHgiOwogICAgICB9KV0KICAgIH0pKV0sCiAgICBuYW1lOiAic2xpZGluZyIsCiAgICBhY3RpdmU6IFExLAogICAgYXBpczogJDEsCiAgICBzdGF0ZTogT2JqZWN0LmZyZWV6ZSh7CiAgICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdCh0KSB7CiAgICAgICAgdmFyIG4gPSBWbyh0LmV4cGFuZGVkKTsKICAgICAgICByZXR1cm4geHUoewogICAgICAgICAgaXNFeHBhbmRlZDogZnVuY3Rpb24gaXNFeHBhbmRlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEwID09PSBuLmdldCgpOwogICAgICAgICAgfSwKICAgICAgICAgIGlzQ29sbGFwc2VkOiBmdW5jdGlvbiBpc0NvbGxhcHNlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICExID09PSBuLmdldCgpOwogICAgICAgICAgfSwKICAgICAgICAgIHNldENvbGxhcHNlZDogUyhuLnNldCwgITEpLAogICAgICAgICAgc2V0RXhwYW5kZWQ6IFMobi5zZXQsICEwKSwKICAgICAgICAgIHJlYWRTdGF0ZTogZnVuY3Rpb24gcmVhZFN0YXRlKCkgewogICAgICAgICAgICByZXR1cm4gImV4cGFuZGVkOiAiICsgbi5nZXQoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSkKICB9KSwKICAgICAgdE8gPSAiY29udGFpbmVyIiwKICAgICAgbk8gPSBbJHMoInNsb3RCZWhhdmlvdXJzIiwgW10pXSwKICAgICAgZU8gPSBkdCh7CiAgICBnZXRTbG90TmFtZXM6IGZ1bmN0aW9uIGdldFNsb3ROYW1lcyh0LCBuKSB7CiAgICAgIHJldHVybiB0LmdldFNsb3ROYW1lcyhuKTsKICAgIH0sCiAgICBnZXRTbG90OiBmdW5jdGlvbiBnZXRTbG90KHQsIG4sIGUpIHsKICAgICAgcmV0dXJuIHQuZ2V0U2xvdChuLCBlKTsKICAgIH0sCiAgICBpc1Nob3dpbmc6IGZ1bmN0aW9uIGlzU2hvd2luZyh0LCBuLCBlKSB7CiAgICAgIHJldHVybiB0LmlzU2hvd2luZyhuLCBlKTsKICAgIH0sCiAgICBoaWRlU2xvdDogZnVuY3Rpb24gaGlkZVNsb3QodCwgbiwgZSkgewogICAgICByZXR1cm4gdC5oaWRlU2xvdChuLCBlKTsKICAgIH0sCiAgICBoaWRlQWxsU2xvdHM6IGZ1bmN0aW9uIGhpZGVBbGxTbG90cyh0LCBuKSB7CiAgICAgIHJldHVybiB0LmhpZGVBbGxTbG90cyhuKTsKICAgIH0sCiAgICBzaG93U2xvdDogZnVuY3Rpb24gc2hvd1Nsb3QodCwgbiwgZSkgewogICAgICByZXR1cm4gdC5zaG93U2xvdChuLCBlKTsKICAgIH0KICB9LCBIciksCiAgICAgIG9PID0gX2x0KF9sdCh7fSwgZU8pLCB7CiAgICBza2V0Y2g6IGZ1bmN0aW9uIHNrZXRjaCh0KSB7CiAgICAgIHZhciBlLAogICAgICAgICAgbiA9IHsKICAgICAgICBzbG90OiBmdW5jdGlvbiBzbG90KHQsIG4pIHsKICAgICAgICAgIHJldHVybiBlLnB1c2godCksIHVsKHRPLCBtayh0KSwgbik7CiAgICAgICAgfSwKICAgICAgICByZWNvcmQ6IHJ0KGUgPSBbXSkKICAgICAgfSwKICAgICAgICAgIG8gPSB0KG4pLAogICAgICAgICAgciA9IE0obi5yZWNvcmQoKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gcWYoewogICAgICAgICAgbmFtZTogdCwKICAgICAgICAgIHBuYW1lOiBtayh0KQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgcmV0dXJuIHhsKHRPLCBuTywgciwgcWssIG8pOwogICAgfQogIH0pLAogICAgICByTyA9IEpvKFtDbygiaWNvbiIpLCBDbygidG9vbHRpcCIpLCBGbygib25TaG93Iiwgc3QpLCBGbygib25IaWRlIiwgc3QpLCBGbygib25TZXR1cCIsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBzdDsKICB9KV0pLAogICAgICBpTyA9IEZyKCJGaXhTaXplRXZlbnQiKSwKICAgICAgdU8gPSBGcigiQXV0b1NpemVFdmVudCIpLAogICAgICBhTyA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgYmxvY2s6IGZ1bmN0aW9uIGJsb2NrKHQsIG4sIGUsIG8pIHsKICAgICAgb24odC5lbGVtZW50LCAiYXJpYS1idXN5IiwgITApOwogICAgICB2YXIgciA9IG4uZ2V0Um9vdCh0KS5nZXRPcih0KSwKICAgICAgICAgIGkgPSB0YyhbTWcuY29uZmlnKHsKICAgICAgICBtb2RlOiAic3BlY2lhbCIsCiAgICAgICAgb25UYWI6IGZ1bmN0aW9uIG9uVGFiKCkgewogICAgICAgICAgcmV0dXJuIHZ0LnNvbWUoITApOwogICAgICAgIH0sCiAgICAgICAgb25TaGlmdFRhYjogZnVuY3Rpb24gb25TaGlmdFRhYigpIHsKICAgICAgICAgIHJldHVybiB2dC5zb21lKCEwKTsKICAgICAgICB9CiAgICAgIH0pLCBWZy5jb25maWcoe30pXSksCiAgICAgICAgICB1ID0gbyhyLCBpKSwKICAgICAgICAgIGEgPSByLmdldFN5c3RlbSgpLmJ1aWxkKHUpOwogICAgICBGZy5hcHBlbmQociwgVHUoYSkpLCBhLmhhc0NvbmZpZ3VyZWQoTWcpICYmIG4uZm9jdXMgJiYgTWcuZm9jdXNJbihhKSwgZS5pc0Jsb2NrZWQoKSB8fCBuLm9uQmxvY2sodCksIGUuYmxvY2tXaXRoKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gRmcucmVtb3ZlKHIsIGEpOwogICAgICB9KTsKICAgIH0sCiAgICB1bmJsb2NrOiBmdW5jdGlvbiB1bmJsb2NrKHQsIG4sIGUpIHsKICAgICAgY24odC5lbGVtZW50LCAiYXJpYS1idXN5IiksIGUuaXNCbG9ja2VkKCkgJiYgbi5vblVuYmxvY2sodCksIGUuY2xlYXIoKTsKICAgIH0KICB9KSwKICAgICAgY08gPSB5YSh7CiAgICBmaWVsZHM6IFtGbygiZ2V0Um9vdCIsIHZ0Lm5vbmUpLCBBbygiZm9jdXMiLCAhMCksIEt1KCJvbkJsb2NrIiksIEt1KCJvblVuYmxvY2siKV0sCiAgICBuYW1lOiAiYmxvY2tpbmciLAogICAgYXBpczogYU8sCiAgICBzdGF0ZTogT2JqZWN0LmZyZWV6ZSh7CiAgICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB2YXIgbiA9IGxjKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC5kZXN0cm95KCk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHh1KHsKICAgICAgICAgIHJlYWRTdGF0ZTogbi5pc1NldCwKICAgICAgICAgIGJsb2NrV2l0aDogZnVuY3Rpb24gYmxvY2tXaXRoKHQpIHsKICAgICAgICAgICAgbi5zZXQoewogICAgICAgICAgICAgIGRlc3Ryb3k6IHQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgY2xlYXI6IG4uY2xlYXIsCiAgICAgICAgICBpc0Jsb2NrZWQ6IG4uaXNTZXQKICAgICAgICB9KTsKICAgICAgfQogICAgfSkKICB9KSwKICAgICAgc08gPSBydChbJHMoInNwbGl0VG9vbGJhckJlaGF2aW91cnMiLCBbWXldKSwgYXIoImJ1aWx0R3JvdXBzIiwgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIFZvKFtdKTsKICB9KV0pLAogICAgICBsTyA9IHJ0KFtZdShbIm92ZXJmbG93VG9nZ2xlZENsYXNzIl0pLCBrbygiZ2V0T3ZlcmZsb3dCb3VuZHMiKSwgZm8oImxhenlTaW5rIiksIGFyKCJvdmVyZmxvd0dyb3VwcyIsIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBWbyhbXSk7CiAgfSldLmNvbmNhdChzTygpKSksCiAgICAgIGZPID0gcnQoW3FmKHsKICAgIGZhY3Rvcnk6IEYxLAogICAgc2NoZW1hOiBNMSgpLAogICAgbmFtZTogInByaW1hcnkiCiAgfSksIEtmKHsKICAgIHNjaGVtYTogTTEoKSwKICAgIG5hbWU6ICJvdmVyZmxvdyIKICB9KSwgS2YoewogICAgbmFtZTogIm92ZXJmbG93LWJ1dHRvbiIKICB9KSwgS2YoewogICAgbmFtZTogIm92ZXJmbG93LWdyb3VwIgogIH0pXSksCiAgICAgIGRPID0gcnQoZnVuY3Rpb24gKHQsIG4pIHsKICAgIHZhciBlID0gdCwKICAgICAgICBvID0gTWF0aC5mbG9vcihuKTsKICAgIGZuKGUsICJtYXgtd2lkdGgiLCBrZS5tYXgoZSwgbywgWyJtYXJnaW4tbGVmdCIsICJib3JkZXItbGVmdC13aWR0aCIsICJwYWRkaW5nLWxlZnQiLCAicGFkZGluZy1yaWdodCIsICJib3JkZXItcmlnaHQtd2lkdGgiLCAibWFyZ2luLXJpZ2h0Il0pICsgInB4Iik7CiAgfSksCiAgICAgIG1PID0gcnQoW1l1KFsidG9nZ2xlZENsYXNzIl0pLCBmbygibGF6eVNpbmsiKSwgaG8oImZldGNoIiksIGtvKCJnZXRCb3VuZHMiKSwgX28oImZpcmVEaXNtaXNzYWxFdmVudEluc3RlYWQiLCBbVG8oImV2ZW50IiwgWGkoKSldKSwgTmMoKV0pLAogICAgICBnTyA9IHJ0KFtLZih7CiAgICBuYW1lOiAiYnV0dG9uIiwKICAgIG92ZXJyaWRlczogZnVuY3Rpb24gb3ZlcnJpZGVzKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBkb206IHsKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgImFyaWEtaGFzcG9wdXAiOiAidHJ1ZSIKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGJ1dHRvbkJlaGF2aW91cnM6IHRjKFt6Zy5jb25maWcoewogICAgICAgICAgdG9nZ2xlQ2xhc3M6IHQubWFya2Vycy50b2dnbGVkQ2xhc3MsCiAgICAgICAgICBhcmlhOiB7CiAgICAgICAgICAgIG1vZGU6ICJleHBhbmRlZCIKICAgICAgICAgIH0sCiAgICAgICAgICB0b2dnbGVPbkV4ZWN1dGU6ICExCiAgICAgICAgfSldKQogICAgICB9OwogICAgfQogIH0pLCBLZih7CiAgICBmYWN0b3J5OiBGMSwKICAgIHNjaGVtYTogTTEoKSwKICAgIG5hbWU6ICJ0b29sYmFyIiwKICAgIG92ZXJyaWRlczogZnVuY3Rpb24gb3ZlcnJpZGVzKG4pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0b29sYmFyQmVoYXZpb3VyczogdGMoW01nLmNvbmZpZyh7CiAgICAgICAgICBtb2RlOiAiY3ljbGljIiwKICAgICAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiBvbkVzY2FwZSh0KSB7CiAgICAgICAgICAgIHJldHVybiBmbCh0LCBuLCAiYnV0dG9uIikuZWFjaChWZy5mb2N1cyksIHZ0Lm5vbmUoKTsKICAgICAgICAgIH0KICAgICAgICB9KV0pCiAgICAgIH07CiAgICB9CiAgfSldKSwKICAgICAgcE8gPSBTbCh7CiAgICBuYW1lOiAiRmxvYXRpbmdUb29sYmFyQnV0dG9uIiwKICAgIGZhY3Rvcnk6IGZ1bmN0aW9uIGZhY3RvcnkodSwgdCwgYSwgbikgewogICAgICByZXR1cm4gX2x0KF9sdCh7fSwgc3Auc2tldGNoKF9sdChfbHQoe30sIG4uYnV0dG9uKCkpLCB7CiAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiBhY3Rpb24odCkgewogICAgICAgICAgT2sodCwgbik7CiAgICAgICAgfSwKICAgICAgICBidXR0b25CZWhhdmlvdXJzOiBEZih7CiAgICAgICAgICBkdW1wOiBuLmJ1dHRvbigpLmJ1dHRvbkJlaGF2aW91cnMKICAgICAgICB9LCBbWXkuY29uZmlnKHsKICAgICAgICAgIG90aGVyczogewogICAgICAgICAgICB0b29sYmFyU2FuZGJveDogZnVuY3Rpb24gdG9vbGJhclNhbmRib3godCkgewogICAgICAgICAgICAgIHJldHVybiBvID0gdCwgZSA9IGEsIHIgPSB1LCB7CiAgICAgICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICAgICAgICAgIGlkOiAoaSA9IFJ1KCkpLmlkCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBiZWhhdmlvdXJzOiB0YyhbTWcuY29uZmlnKHsKICAgICAgICAgICAgICAgICAgbW9kZTogInNwZWNpYWwiLAogICAgICAgICAgICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gb25Fc2NhcGUodCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBoZi5jbG9zZSh0KSwgdnQuc29tZSghMCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLCBoZi5jb25maWcoewogICAgICAgICAgICAgICAgICBvbk9wZW46IGZ1bmN0aW9uIG9uT3Blbih0LCBuKSB7CiAgICAgICAgICAgICAgICAgICAgci5mZXRjaCgpLmdldChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICAgICAgVGsobywgbiwgciwgZS5sYXlvdXRzLCB0KSwgaS5saW5rKG8uZWxlbWVudCksIE1nLmZvY3VzSW4obik7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UoKSB7CiAgICAgICAgICAgICAgICAgICAgemcub2ZmKG8pLCBWZy5mb2N1cyhvKSwgaS51bmxpbmsoby5lbGVtZW50KTsKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgaXNQYXJ0T2Y6IGZ1bmN0aW9uIGlzUGFydE9mKHQsIG4sIGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gSHUobiwgZSkgfHwgSHUobywgZSk7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGdldEF0dGFjaFBvaW50OiBmdW5jdGlvbiBnZXRBdHRhY2hQb2ludCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5sYXp5U2luayhvKS5nZXRPckRpZSgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwgcmMuY29uZmlnKHsKICAgICAgICAgICAgICAgICAgY2hhbm5lbHM6IF9sdChfbHQoe30sIGpzKF9sdCh7CiAgICAgICAgICAgICAgICAgICAgaXNFeHRyYVBhcnQ6IE8KICAgICAgICAgICAgICAgICAgfSwgci5maXJlRGlzbWlzc2FsRXZlbnRJbnN0ZWFkLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICBmaXJlRXZlbnRJbnN0ZWFkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiB0LmV2ZW50CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgfSkuZ2V0T3Ioe30pKSkpLCBHcyh7CiAgICAgICAgICAgICAgICAgICAgZG9SZXBvc2l0aW9uOiBmdW5jdGlvbiBkb1JlcG9zaXRpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICBoZi5nZXRTdGF0ZShZeS5nZXRDb3VwbGVkKG8sICJ0b29sYmFyU2FuZGJveCIpKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9rKG8sIHQsIHIsIGUubGF5b3V0cyk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgfSldKQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgdmFyIG8sIGUsIHIsIGk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KV0pCiAgICAgIH0pKSksIHsKICAgICAgICBhcGlzOiB7CiAgICAgICAgICBzZXRHcm91cHM6IGZ1bmN0aW9uIHNldEdyb3VwcyhuLCBlKSB7CiAgICAgICAgICAgIGhmLmdldFN0YXRlKFl5LmdldENvdXBsZWQobiwgInRvb2xiYXJTYW5kYm94IikpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBUayhuLCB0LCB1LCBhLmxheW91dHMsIGUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICByZXBvc2l0aW9uOiBmdW5jdGlvbiByZXBvc2l0aW9uKG4pIHsKICAgICAgICAgICAgaGYuZ2V0U3RhdGUoWXkuZ2V0Q291cGxlZChuLCAidG9vbGJhclNhbmRib3giKSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIF9rKG4sIHQsIHUsIGEubGF5b3V0cyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHRvZ2dsZTogZnVuY3Rpb24gdG9nZ2xlKHQpIHsKICAgICAgICAgICAgT2sodCwgbik7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0VG9vbGJhcjogZnVuY3Rpb24gZ2V0VG9vbGJhcih0KSB7CiAgICAgICAgICAgIHJldHVybiBoZi5nZXRTdGF0ZShZeS5nZXRDb3VwbGVkKHQsICJ0b29sYmFyU2FuZGJveCIpKTsKICAgICAgICAgIH0sCiAgICAgICAgICBpc09wZW46IGZ1bmN0aW9uIGlzT3Blbih0KSB7CiAgICAgICAgICAgIHJldHVybiBoZi5pc09wZW4oWXkuZ2V0Q291cGxlZCh0LCAidG9vbGJhclNhbmRib3giKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjb25maWdGaWVsZHM6IG1PKCksCiAgICBwYXJ0RmllbGRzOiBnTygpLAogICAgYXBpczogewogICAgICBzZXRHcm91cHM6IGZ1bmN0aW9uIHNldEdyb3Vwcyh0LCBuLCBlKSB7CiAgICAgICAgdC5zZXRHcm91cHMobiwgZSk7CiAgICAgIH0sCiAgICAgIHJlcG9zaXRpb246IGZ1bmN0aW9uIHJlcG9zaXRpb24odCwgbikgewogICAgICAgIHQucmVwb3NpdGlvbihuKTsKICAgICAgfSwKICAgICAgdG9nZ2xlOiBmdW5jdGlvbiB0b2dnbGUodCwgbikgewogICAgICAgIHQudG9nZ2xlKG4pOwogICAgICB9LAogICAgICBnZXRUb29sYmFyOiBmdW5jdGlvbiBnZXRUb29sYmFyKHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5nZXRUb29sYmFyKG4pOwogICAgICB9LAogICAgICBpc09wZW46IGZ1bmN0aW9uIGlzT3Blbih0LCBuKSB7CiAgICAgICAgcmV0dXJuIHQuaXNPcGVuKG4pOwogICAgICB9CiAgICB9CiAgfSksCiAgICAgIGhPID0gcnQoW2ZvKCJpdGVtcyIpLCBZdShbIml0ZW1TZWxlY3RvciJdKSwgJHMoInRncm91cEJlaGF2aW91cnMiLCBbTWddKV0pLAogICAgICB2TyA9IHJ0KFskZih7CiAgICBuYW1lOiAiaXRlbXMiLAogICAgdW5pdDogIml0ZW0iCiAgfSldKSwKICAgICAgYk8gPSBTbCh7CiAgICBuYW1lOiAiVG9vbGJhckdyb3VwIiwKICAgIGNvbmZpZ0ZpZWxkczogaE8oKSwKICAgIHBhcnRGaWVsZHM6IHZPKCksCiAgICBmYWN0b3J5OiBmdW5jdGlvbiBmYWN0b3J5KHQsIG4sIGUsIG8pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB1aWQ6IHQudWlkLAogICAgICAgIGRvbTogdC5kb20sCiAgICAgICAgY29tcG9uZW50czogbiwKICAgICAgICBiZWhhdmlvdXJzOiBacyh0LnRncm91cEJlaGF2aW91cnMsIFtNZy5jb25maWcoewogICAgICAgICAgbW9kZTogImZsb3ciLAogICAgICAgICAgc2VsZWN0b3I6IHQubWFya2Vycy5pdGVtU2VsZWN0b3IKICAgICAgICB9KV0pLAogICAgICAgIGRvbU1vZGlmaWNhdGlvbjogewogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICByb2xlOiAidG9vbGJhciIKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfSksCiAgICAgIHlPID0gU2woewogICAgbmFtZTogIlNwbGl0RmxvYXRpbmdUb29sYmFyIiwKICAgIGNvbmZpZ0ZpZWxkczogbE8oKSwKICAgIHBhcnRGaWVsZHM6IGZPKCksCiAgICBmYWN0b3J5OiBmdW5jdGlvbiBmYWN0b3J5KGUsIHQsIG4sIG8pIHsKICAgICAgdmFyIHIgPSBQbShwTy5za2V0Y2goewogICAgICAgIGZldGNoOiBmdW5jdGlvbiBmZXRjaCgpIHsKICAgICAgICAgIHJldHVybiBOeShmdW5jdGlvbiAodCkgewogICAgICAgICAgICB0KEVrKGUub3ZlcmZsb3dHcm91cHMuZ2V0KCkpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgbGF5b3V0czogewogICAgICAgICAgb25MdHI6IGZ1bmN0aW9uIG9uTHRyKCkgewogICAgICAgICAgICByZXR1cm4gW1hhLCBHYV07CiAgICAgICAgICB9LAogICAgICAgICAgb25SdGw6IGZ1bmN0aW9uIG9uUnRsKCkgewogICAgICAgICAgICByZXR1cm4gW0dhLCBYYV07CiAgICAgICAgICB9LAogICAgICAgICAgb25Cb3R0b21MdHI6IGZ1bmN0aW9uIG9uQm90dG9tTHRyKCkgewogICAgICAgICAgICByZXR1cm4gW3FhLCBZYV07CiAgICAgICAgICB9LAogICAgICAgICAgb25Cb3R0b21SdGw6IGZ1bmN0aW9uIG9uQm90dG9tUnRsKCkgewogICAgICAgICAgICByZXR1cm4gW1lhLCBxYV07CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBnZXRCb3VuZHM6IG4uZ2V0T3ZlcmZsb3dCb3VuZHMsCiAgICAgICAgbGF6eVNpbms6IGUubGF6eVNpbmssCiAgICAgICAgZmlyZURpc21pc3NhbEV2ZW50SW5zdGVhZDoge30sCiAgICAgICAgbWFya2VyczogewogICAgICAgICAgdG9nZ2xlZENsYXNzOiBlLm1hcmtlcnMub3ZlcmZsb3dUb2dnbGVkQ2xhc3MKICAgICAgICB9LAogICAgICAgIHBhcnRzOiB7CiAgICAgICAgICBidXR0b246IG9bIm92ZXJmbG93LWJ1dHRvbiJdKCksCiAgICAgICAgICB0b29sYmFyOiBvLm92ZXJmbG93KCkKICAgICAgICB9CiAgICAgIH0pKTsKICAgICAgcmV0dXJuIHsKICAgICAgICB1aWQ6IGUudWlkLAogICAgICAgIGRvbTogZS5kb20sCiAgICAgICAgY29tcG9uZW50czogdCwKICAgICAgICBiZWhhdmlvdXJzOiBacyhlLnNwbGl0VG9vbGJhckJlaGF2aW91cnMsIFtZeS5jb25maWcoewogICAgICAgICAgb3RoZXJzOiB7CiAgICAgICAgICAgIG92ZXJmbG93R3JvdXA6IGZ1bmN0aW9uIG92ZXJmbG93R3JvdXAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGJPLnNrZXRjaChfbHQoX2x0KHt9LCBvWyJvdmVyZmxvdy1ncm91cCJdKCkpLCB7CiAgICAgICAgICAgICAgICBpdGVtczogW3IuYXNTcGVjKCldCiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSldKSwKICAgICAgICBhcGlzOiB7CiAgICAgICAgICBzZXRHcm91cHM6IGZ1bmN0aW9uIHNldEdyb3Vwcyh0LCBuKSB7CiAgICAgICAgICAgIGUuYnVpbHRHcm91cHMuc2V0KE0obiwgdC5nZXRTeXN0ZW0oKS5idWlsZCkpLCBEayh0LCByLCBlKTsKICAgICAgICAgIH0sCiAgICAgICAgICByZWZyZXNoOiBmdW5jdGlvbiByZWZyZXNoKHQpIHsKICAgICAgICAgICAgcmV0dXJuIERrKHQsIHIsIGUpOwogICAgICAgICAgfSwKICAgICAgICAgIHRvZ2dsZTogZnVuY3Rpb24gdG9nZ2xlKHQpIHsKICAgICAgICAgICAgci5nZXRPcHQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHBPLnRvZ2dsZSh0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgaXNPcGVuOiBmdW5jdGlvbiBpc09wZW4odCkgewogICAgICAgICAgICByZXR1cm4gci5nZXRPcHQodCkubWFwKHBPLmlzT3BlbikuZ2V0T3IoITEpOwogICAgICAgICAgfSwKICAgICAgICAgIHJlcG9zaXRpb246IGZ1bmN0aW9uIHJlcG9zaXRpb24odCkgewogICAgICAgICAgICByLmdldE9wdCh0KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcE8ucmVwb3NpdGlvbih0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0T3ZlcmZsb3c6IGZ1bmN0aW9uIGdldE92ZXJmbG93KHQpIHsKICAgICAgICAgICAgcmV0dXJuIHIuZ2V0T3B0KHQpLmJpbmQocE8uZ2V0VG9vbGJhcik7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBkb21Nb2RpZmljYXRpb246IHsKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgcm9sZTogImdyb3VwIgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0sCiAgICBhcGlzOiB7CiAgICAgIHNldEdyb3VwczogZnVuY3Rpb24gc2V0R3JvdXBzKHQsIG4sIGUpIHsKICAgICAgICB0LnNldEdyb3VwcyhuLCBlKTsKICAgICAgfSwKICAgICAgcmVmcmVzaDogZnVuY3Rpb24gcmVmcmVzaCh0LCBuKSB7CiAgICAgICAgdC5yZWZyZXNoKG4pOwogICAgICB9LAogICAgICByZXBvc2l0aW9uOiBmdW5jdGlvbiByZXBvc2l0aW9uKHQsIG4pIHsKICAgICAgICB0LnJlcG9zaXRpb24obik7CiAgICAgIH0sCiAgICAgIHRvZ2dsZTogZnVuY3Rpb24gdG9nZ2xlKHQsIG4pIHsKICAgICAgICB0LnRvZ2dsZShuKTsKICAgICAgfSwKICAgICAgaXNPcGVuOiBmdW5jdGlvbiBpc09wZW4odCwgbikgewogICAgICAgIHJldHVybiB0LmlzT3BlbihuKTsKICAgICAgfSwKICAgICAgZ2V0T3ZlcmZsb3c6IGZ1bmN0aW9uIGdldE92ZXJmbG93KHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5nZXRPdmVyZmxvdyhuKTsKICAgICAgfQogICAgfQogIH0pLAogICAgICB4TyA9IHJ0KFtZdShbImNsb3NlZENsYXNzIiwgIm9wZW5DbGFzcyIsICJzaHJpbmtpbmdDbGFzcyIsICJncm93aW5nQ2xhc3MiLCAib3ZlcmZsb3dUb2dnbGVkQ2xhc3MiXSksIEt1KCJvbk9wZW5lZCIpLCBLdSgib25DbG9zZWQiKV0uY29uY2F0KHNPKCkpKSwKICAgICAgd08gPSBydChbcWYoewogICAgZmFjdG9yeTogRjEsCiAgICBzY2hlbWE6IE0xKCksCiAgICBuYW1lOiAicHJpbWFyeSIKICB9KSwgcWYoewogICAgZmFjdG9yeTogRjEsCiAgICBzY2hlbWE6IE0xKCksCiAgICBuYW1lOiAib3ZlcmZsb3ciLAogICAgb3ZlcnJpZGVzOiBmdW5jdGlvbiBvdmVycmlkZXMobikgewogICAgICByZXR1cm4gewogICAgICAgIHRvb2xiYXJCZWhhdmlvdXJzOiB0YyhbWjEuY29uZmlnKHsKICAgICAgICAgIGRpbWVuc2lvbjogewogICAgICAgICAgICBwcm9wZXJ0eTogImhlaWdodCIKICAgICAgICAgIH0sCiAgICAgICAgICBjbG9zZWRDbGFzczogbi5tYXJrZXJzLmNsb3NlZENsYXNzLAogICAgICAgICAgb3BlbkNsYXNzOiBuLm1hcmtlcnMub3BlbkNsYXNzLAogICAgICAgICAgc2hyaW5raW5nQ2xhc3M6IG4ubWFya2Vycy5zaHJpbmtpbmdDbGFzcywKICAgICAgICAgIGdyb3dpbmdDbGFzczogbi5tYXJrZXJzLmdyb3dpbmdDbGFzcywKICAgICAgICAgIG9uU2hydW5rOiBmdW5jdGlvbiBvblNocnVuayh0KSB7CiAgICAgICAgICAgIGZsKHQsIG4sICJvdmVyZmxvdy1idXR0b24iKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgemcub2ZmKHQpLCBWZy5mb2N1cyh0KTsKICAgICAgICAgICAgfSksIG4ub25DbG9zZWQodCk7CiAgICAgICAgICB9LAogICAgICAgICAgb25Hcm93bjogZnVuY3Rpb24gb25Hcm93bih0KSB7CiAgICAgICAgICAgIE1nLmZvY3VzSW4odCksIG4ub25PcGVuZWQodCk7CiAgICAgICAgICB9LAogICAgICAgICAgb25TdGFydEdyb3c6IGZ1bmN0aW9uIG9uU3RhcnRHcm93KHQpIHsKICAgICAgICAgICAgZmwodCwgbiwgIm92ZXJmbG93LWJ1dHRvbiIpLmVhY2goemcub24pOwogICAgICAgICAgfQogICAgICAgIH0pLCBNZy5jb25maWcoewogICAgICAgICAgbW9kZTogImFjeWNsaWMiLAogICAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uIG9uRXNjYXBlKHQpIHsKICAgICAgICAgICAgcmV0dXJuIGZsKHQsIG4sICJvdmVyZmxvdy1idXR0b24iKS5lYWNoKFZnLmZvY3VzKSwgdnQuc29tZSghMCk7CiAgICAgICAgICB9CiAgICAgICAgfSldKQogICAgICB9OwogICAgfQogIH0pLCBLZih7CiAgICBuYW1lOiAib3ZlcmZsb3ctYnV0dG9uIiwKICAgIG92ZXJyaWRlczogZnVuY3Rpb24gb3ZlcnJpZGVzKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBidXR0b25CZWhhdmlvdXJzOiB0YyhbemcuY29uZmlnKHsKICAgICAgICAgIHRvZ2dsZUNsYXNzOiB0Lm1hcmtlcnMub3ZlcmZsb3dUb2dnbGVkQ2xhc3MsCiAgICAgICAgICBhcmlhOiB7CiAgICAgICAgICAgIG1vZGU6ICJwcmVzc2VkIgogICAgICAgICAgfSwKICAgICAgICAgIHRvZ2dsZU9uRXhlY3V0ZTogITEKICAgICAgICB9KV0pCiAgICAgIH07CiAgICB9CiAgfSksIEtmKHsKICAgIG5hbWU6ICJvdmVyZmxvdy1ncm91cCIKICB9KV0pLAogICAgICBTTyA9IFNsKHsKICAgIG5hbWU6ICJTcGxpdFNsaWRpbmdUb29sYmFyIiwKICAgIGNvbmZpZ0ZpZWxkczogeE8oKSwKICAgIHBhcnRGaWVsZHM6IHdPKCksCiAgICBmYWN0b3J5OiBmdW5jdGlvbiBmYWN0b3J5KG8sIHQsIG4sIGUpIHsKICAgICAgdmFyIHIgPSAiYWxsb3kudG9vbGJhci50b2dnbGUiOwogICAgICByZXR1cm4gewogICAgICAgIHVpZDogby51aWQsCiAgICAgICAgZG9tOiBvLmRvbSwKICAgICAgICBjb21wb25lbnRzOiB0LAogICAgICAgIGJlaGF2aW91cnM6IFpzKG8uc3BsaXRUb29sYmFyQmVoYXZpb3VycywgW1l5LmNvbmZpZyh7CiAgICAgICAgICBvdGhlcnM6IHsKICAgICAgICAgICAgb3ZlcmZsb3dHcm91cDogZnVuY3Rpb24gb3ZlcmZsb3dHcm91cChuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGJPLnNrZXRjaChfbHQoX2x0KHt9LCBlWyJvdmVyZmxvdy1ncm91cCJdKCkpLCB7CiAgICAgICAgICAgICAgICBpdGVtczogW3NwLnNrZXRjaChfbHQoX2x0KHt9LCBlWyJvdmVyZmxvdy1idXR0b24iXSgpKSwgewogICAgICAgICAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIGFjdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgICAgaHIobiwgcik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pKV0KICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSwgZm0oInRvb2xiYXItdG9nZ2xlLWV2ZW50cyIsIFtDcihyLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgQmsodCwgbyk7CiAgICAgICAgfSldKV0pLAogICAgICAgIGFwaXM6IHsKICAgICAgICAgIHNldEdyb3VwczogZnVuY3Rpb24gc2V0R3JvdXBzKHQsIG4pIHsKICAgICAgICAgICAgdmFyIGUgPSBNKG4sIHQuZ2V0U3lzdGVtKCkuYnVpbGQpOwogICAgICAgICAgICBvLmJ1aWx0R3JvdXBzLnNldChlKSwgS2sodCwgbyk7CiAgICAgICAgICB9LAogICAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24gcmVmcmVzaCh0KSB7CiAgICAgICAgICAgIHJldHVybiBLayh0LCBvKTsKICAgICAgICAgIH0sCiAgICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uIHRvZ2dsZSh0KSB7CiAgICAgICAgICAgIHJldHVybiBCayh0LCBvKTsKICAgICAgICAgIH0sCiAgICAgICAgICBpc09wZW46IGZ1bmN0aW9uIGlzT3Blbih0KSB7CiAgICAgICAgICAgIHJldHVybiBmbCh0LCBvLCAib3ZlcmZsb3ciKS5tYXAoWjEuaGFzR3Jvd24pLmdldE9yKCExKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGRvbU1vZGlmaWNhdGlvbjogewogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICByb2xlOiAiZ3JvdXAiCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgfSwKICAgIGFwaXM6IHsKICAgICAgc2V0R3JvdXBzOiBmdW5jdGlvbiBzZXRHcm91cHModCwgbiwgZSkgewogICAgICAgIHQuc2V0R3JvdXBzKG4sIGUpOwogICAgICB9LAogICAgICByZWZyZXNoOiBmdW5jdGlvbiByZWZyZXNoKHQsIG4pIHsKICAgICAgICB0LnJlZnJlc2gobik7CiAgICAgIH0sCiAgICAgIHRvZ2dsZTogZnVuY3Rpb24gdG9nZ2xlKHQsIG4pIHsKICAgICAgICB0LnRvZ2dsZShuKTsKICAgICAgfSwKICAgICAgaXNPcGVuOiBmdW5jdGlvbiBpc09wZW4odCwgbikgewogICAgICAgIHJldHVybiB0LmlzT3BlbihuKTsKICAgICAgfQogICAgfQogIH0pLAogICAgICBDTyA9IFQxLm9wdGlvbmFsKHsKICAgIGZhY3Rvcnk6IEoxLAogICAgbmFtZTogIm1lbnViYXIiLAogICAgc2NoZW1hOiBbZm8oImJhY2tzdGFnZSIpXQogIH0pLAogICAgICBrTyA9IFQxLm9wdGlvbmFsKHsKICAgIGZhY3Rvcnk6IHsKICAgICAgc2tldGNoOiBmdW5jdGlvbiBza2V0Y2godCkgewogICAgICAgIHJldHVybiBCMS5za2V0Y2goewogICAgICAgICAgdWlkOiB0LnVpZCwKICAgICAgICAgIGRvbTogdC5kb20sCiAgICAgICAgICBsaXN0QmVoYXZpb3VyczogdGMoW01nLmNvbmZpZyh7CiAgICAgICAgICAgIG1vZGU6ICJhY3ljbGljIiwKICAgICAgICAgICAgc2VsZWN0b3I6ICIudG94LXRvb2xiYXIiCiAgICAgICAgICB9KV0pLAogICAgICAgICAgbWFrZUl0ZW06IGZ1bmN0aW9uIG1ha2VJdGVtKCkgewogICAgICAgICAgICByZXR1cm4gUmsoewogICAgICAgICAgICAgIHR5cGU6IHQudHlwZSwKICAgICAgICAgICAgICB1aWQ6IEZyKCJtdWx0aXBsZS10b29sYmFyLWl0ZW0iKSwKICAgICAgICAgICAgICBjeWNsaWNLZXlpbmc6ICExLAogICAgICAgICAgICAgIGluaXRHcm91cHM6IFtdLAogICAgICAgICAgICAgIHByb3ZpZGVyczogdC5wcm92aWRlcnMsCiAgICAgICAgICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uIG9uRXNjYXBlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHQub25Fc2NhcGUoKSwgdnQuc29tZSghMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXR1cEl0ZW06IGZ1bmN0aW9uIHNldHVwSXRlbSh0LCBuLCBlLCBvKSB7CiAgICAgICAgICAgIEYxLnNldEdyb3VwcyhuLCBlKTsKICAgICAgICAgIH0sCiAgICAgICAgICBzaGVsbDogITAKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIG5hbWU6ICJtdWx0aXBsZS10b29sYmFyIiwKICAgIHNjaGVtYTogW2ZvKCJkb20iKSwgZm8oIm9uRXNjYXBlIildCiAgfSksCiAgICAgIE9PID0gVDEub3B0aW9uYWwoewogICAgZmFjdG9yeTogewogICAgICBza2V0Y2g6IGZ1bmN0aW9uIHNrZXRjaCh0KSB7CiAgICAgICAgcmV0dXJuICh0LnR5cGUgPT09IGhoLnNsaWRpbmcgPyBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIG4gPSBTTy5wYXJ0cy5wcmltYXJ5KHsKICAgICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgICBjbGFzc2VzOiBbInRveC10b29sYmFyX19wcmltYXJ5Il0KICAgICAgICAgICAgfQogICAgICAgICAgfSksCiAgICAgICAgICAgICAgZSA9IFNPLnBhcnRzLm92ZXJmbG93KHsKICAgICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgICBjbGFzc2VzOiBbInRveC10b29sYmFyX19vdmVyZmxvdyJdCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLAogICAgICAgICAgICAgIG8gPSBJayh0KTsKICAgICAgICAgIHJldHVybiBTTy5za2V0Y2goX2x0KF9sdCh7fSwgbyksIHsKICAgICAgICAgICAgY29tcG9uZW50czogW24sIGVdLAogICAgICAgICAgICBtYXJrZXJzOiB7CiAgICAgICAgICAgICAgb3BlbkNsYXNzOiAidG94LXRvb2xiYXJfX292ZXJmbG93LS1vcGVuIiwKICAgICAgICAgICAgICBjbG9zZWRDbGFzczogInRveC10b29sYmFyX19vdmVyZmxvdy0tY2xvc2VkIiwKICAgICAgICAgICAgICBncm93aW5nQ2xhc3M6ICJ0b3gtdG9vbGJhcl9fb3ZlcmZsb3ctLWdyb3dpbmciLAogICAgICAgICAgICAgIHNocmlua2luZ0NsYXNzOiAidG94LXRvb2xiYXJfX292ZXJmbG93LS1zaHJpbmtpbmciLAogICAgICAgICAgICAgIG92ZXJmbG93VG9nZ2xlZENsYXNzOiAidG94LXRidG4tLWVuYWJsZWQiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uT3BlbmVkOiBmdW5jdGlvbiBvbk9wZW5lZCh0KSB7CiAgICAgICAgICAgICAgdC5nZXRTeXN0ZW0oKS5icm9hZGNhc3RPbihbTDEoKV0sIHsKICAgICAgICAgICAgICAgIHR5cGU6ICJvcGVuZWQiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uQ2xvc2VkOiBmdW5jdGlvbiBvbkNsb3NlZCh0KSB7CiAgICAgICAgICAgICAgdC5nZXRTeXN0ZW0oKS5icm9hZGNhc3RPbihbTDEoKV0sIHsKICAgICAgICAgICAgICAgIHR5cGU6ICJjbG9zZWQiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKTsKICAgICAgICB9IDogdC50eXBlID09PSBoaC5mbG9hdGluZyA/IGZ1bmN0aW9uIChpKSB7CiAgICAgICAgICB2YXIgdCA9IElrKGkpLAogICAgICAgICAgICAgIG4gPSB5Ty5wYXJ0cy5wcmltYXJ5KHsKICAgICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgICBjbGFzc2VzOiBbInRveC10b29sYmFyX19wcmltYXJ5Il0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4geU8uc2tldGNoKF9sdChfbHQoe30sIHQpLCB7CiAgICAgICAgICAgIGxhenlTaW5rOiBpLmdldFNpbmssCiAgICAgICAgICAgIGdldE92ZXJmbG93Qm91bmRzOiBmdW5jdGlvbiBnZXRPdmVyZmxvd0JvdW5kcygpIHsKICAgICAgICAgICAgICB2YXIgdCA9IGkubW9yZURyYXdlckRhdGEubGF6eUhlYWRlcigpLmVsZW1lbnQsCiAgICAgICAgICAgICAgICAgIG4gPSB6bih0KSwKICAgICAgICAgICAgICAgICAgZSA9IEd0KHQpLAogICAgICAgICAgICAgICAgICBvID0gem4oZSksCiAgICAgICAgICAgICAgICAgIHIgPSBNYXRoLm1heChlLmRvbS5zY3JvbGxIZWlnaHQsIG8uaGVpZ2h0KTsKICAgICAgICAgICAgICByZXR1cm4gQmUobi54ICsgNCwgby55LCBuLndpZHRoIC0gOCwgcik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHBhcnRzOiBfbHQoX2x0KHt9LCB0LnBhcnRzKSwgewogICAgICAgICAgICAgIG92ZXJmbG93OiB7CiAgICAgICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgICAgICAgY2xhc3NlczogWyJ0b3gtdG9vbGJhcl9fb3ZlcmZsb3ciXSwKICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogaS5hdHRyaWJ1dGVzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgY29tcG9uZW50czogW25dLAogICAgICAgICAgICBtYXJrZXJzOiB7CiAgICAgICAgICAgICAgb3ZlcmZsb3dUb2dnbGVkQ2xhc3M6ICJ0b3gtdGJ0bi0tZW5hYmxlZCIKICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0gOiBSaykoewogICAgICAgICAgdHlwZTogdC50eXBlLAogICAgICAgICAgdWlkOiB0LnVpZCwKICAgICAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiBvbkVzY2FwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHQub25Fc2NhcGUoKSwgdnQuc29tZSghMCk7CiAgICAgICAgICB9LAogICAgICAgICAgY3ljbGljS2V5aW5nOiAhMSwKICAgICAgICAgIGluaXRHcm91cHM6IFtdLAogICAgICAgICAgZ2V0U2luazogdC5nZXRTaW5rLAogICAgICAgICAgcHJvdmlkZXJzOiB0LnByb3ZpZGVycywKICAgICAgICAgIG1vcmVEcmF3ZXJEYXRhOiB7CiAgICAgICAgICAgIGxhenlUb29sYmFyOiB0LmxhenlUb29sYmFyLAogICAgICAgICAgICBsYXp5TW9yZUJ1dHRvbjogdC5sYXp5TW9yZUJ1dHRvbiwKICAgICAgICAgICAgbGF6eUhlYWRlcjogdC5sYXp5SGVhZGVyCiAgICAgICAgICB9LAogICAgICAgICAgYXR0cmlidXRlczogdC5hdHRyaWJ1dGVzCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBuYW1lOiAidG9vbGJhciIsCiAgICBzY2hlbWE6IFtmbygiZG9tIiksIGZvKCJvbkVzY2FwZSIpLCBmbygiZ2V0U2luayIpXQogIH0pLAogICAgICBfTyA9IFQxLm9wdGlvbmFsKHsKICAgIGZhY3Rvcnk6IHsKICAgICAgc2tldGNoOiBmdW5jdGlvbiBza2V0Y2godCkgewogICAgICAgIHZhciBuID0gdC5lZGl0b3IsCiAgICAgICAgICAgIGUgPSB0LnN0aWNreSA/IHRrIDogSTE7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHVpZDogdC51aWQsCiAgICAgICAgICBkb206IHQuZG9tLAogICAgICAgICAgY29tcG9uZW50czogdC5jb21wb25lbnRzLAogICAgICAgICAgYmVoYXZpb3VyczogdGMoZShuLCB0LnNoYXJlZEJhY2tzdGFnZSkpCiAgICAgICAgfTsKICAgICAgfQogICAgfSwKICAgIG5hbWU6ICJoZWFkZXIiLAogICAgc2NoZW1hOiBbZm8oImRvbSIpXQogIH0pLAogICAgICBUTyA9IFQxLm9wdGlvbmFsKHsKICAgIG5hbWU6ICJzb2NrZXQiLAogICAgc2NoZW1hOiBbZm8oImRvbSIpXQogIH0pLAogICAgICBFTyA9IFQxLm9wdGlvbmFsKHsKICAgIGZhY3Rvcnk6IHsKICAgICAgc2tldGNoOiBmdW5jdGlvbiBza2V0Y2godCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB1aWQ6IHQudWlkLAogICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgIGNsYXNzZXM6IFsidG94LXNpZGViYXIiXSwKICAgICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICAgIHJvbGU6ICJjb21wbGVtZW50YXJ5IgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgY29tcG9uZW50czogW3sKICAgICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgICBjbGFzc2VzOiBbInRveC1zaWRlYmFyX19zbGlkZXIiXQogICAgICAgICAgICB9LAogICAgICAgICAgICBjb21wb25lbnRzOiBbXSwKICAgICAgICAgICAgYmVoYXZpb3VyczogdGMoW2Z5LmNvbmZpZyh7fSksIFZnLmNvbmZpZyh7fSksIFoxLmNvbmZpZyh7CiAgICAgICAgICAgICAgZGltZW5zaW9uOiB7CiAgICAgICAgICAgICAgICBwcm9wZXJ0eTogIndpZHRoIgogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgY2xvc2VkQ2xhc3M6ICJ0b3gtc2lkZWJhci0tc2xpZGluZy1jbG9zZWQiLAogICAgICAgICAgICAgIG9wZW5DbGFzczogInRveC1zaWRlYmFyLS1zbGlkaW5nLW9wZW4iLAogICAgICAgICAgICAgIHNocmlua2luZ0NsYXNzOiAidG94LXNpZGViYXItLXNsaWRpbmctc2hyaW5raW5nIiwKICAgICAgICAgICAgICBncm93aW5nQ2xhc3M6ICJ0b3gtc2lkZWJhci0tc2xpZGluZy1ncm93aW5nIiwKICAgICAgICAgICAgICBvblNocnVuazogZnVuY3Rpb24gb25TaHJ1bmsodCkgewogICAgICAgICAgICAgICAgdWQuZ2V0Q3VycmVudCh0KS5lYWNoKG9PLmhpZGVBbGxTbG90cyksIGhyKHQsIHVPKTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIG9uR3Jvd246IGZ1bmN0aW9uIG9uR3Jvd24odCkgewogICAgICAgICAgICAgICAgaHIodCwgdU8pOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb25TdGFydEdyb3c6IGZ1bmN0aW9uIG9uU3RhcnRHcm93KHQpIHsKICAgICAgICAgICAgICAgIHZyKHQsIGlPLCB7CiAgICAgICAgICAgICAgICAgIHdpZHRoOiBwbih0LmVsZW1lbnQsICJ3aWR0aCIpLmdldE9yKCIiKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBvblN0YXJ0U2hyaW5rOiBmdW5jdGlvbiBvblN0YXJ0U2hyaW5rKHQpIHsKICAgICAgICAgICAgICAgIHZyKHQsIGlPLCB7CiAgICAgICAgICAgICAgICAgIHdpZHRoOiBrbih0LmVsZW1lbnQpICsgInB4IgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwgRmcuY29uZmlnKHt9KSwgdWQuY29uZmlnKHsKICAgICAgICAgICAgICBmaW5kOiBmdW5jdGlvbiBmaW5kKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBZKEZnLmNvbnRlbnRzKHQpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pXSkKICAgICAgICAgIH1dLAogICAgICAgICAgYmVoYXZpb3VyczogdGMoW3JTKDApLCBmbSgic2lkZWJhci1zbGlkaW5nLWV2ZW50cyIsIFtDcihpTywgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgZm4odC5lbGVtZW50LCAid2lkdGgiLCBuLmV2ZW50LndpZHRoKTsKICAgICAgICAgIH0pLCBDcih1TywgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgdm4odC5lbGVtZW50LCAid2lkdGgiKTsKICAgICAgICAgIH0pXSldKQogICAgICAgIH07CiAgICAgIH0KICAgIH0sCiAgICBuYW1lOiAic2lkZWJhciIsCiAgICBzY2hlbWE6IFtmbygiZG9tIildCiAgfSksCiAgICAgIERPID0gVDEub3B0aW9uYWwoewogICAgZmFjdG9yeTogewogICAgICBza2V0Y2g6IGZ1bmN0aW9uIHNrZXRjaCh0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHVpZDogdC51aWQsCiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICAgICJhcmlhLWhpZGRlbiI6ICJ0cnVlIgogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGFzc2VzOiBbInRveC10aHJvYmJlciJdLAogICAgICAgICAgICBzdHlsZXM6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAibm9uZSIKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGJlaGF2aW91cnM6IHRjKFtGZy5jb25maWcoe30pLCBjTy5jb25maWcoewogICAgICAgICAgICBmb2N1czogITEKICAgICAgICAgIH0pLCB1ZC5jb25maWcoewogICAgICAgICAgICBmaW5kOiBmdW5jdGlvbiBmaW5kKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gWSh0LmNvbXBvbmVudHMoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pXSksCiAgICAgICAgICBjb21wb25lbnRzOiBbXQogICAgICAgIH07CiAgICAgIH0KICAgIH0sCiAgICBuYW1lOiAidGhyb2JiZXIiLAogICAgc2NoZW1hOiBbZm8oImRvbSIpXQogIH0pLAogICAgICBCTyA9IFNsKHsKICAgIG5hbWU6ICJPdXRlckNvbnRhaW5lciIsCiAgICBmYWN0b3J5OiBmdW5jdGlvbiBmYWN0b3J5KGUsIHQsIG4pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB1aWQ6IGUudWlkLAogICAgICAgIGRvbTogZS5kb20sCiAgICAgICAgY29tcG9uZW50czogdCwKICAgICAgICBhcGlzOiB7CiAgICAgICAgICBnZXRTb2NrZXQ6IGZ1bmN0aW9uIGdldFNvY2tldCh0KSB7CiAgICAgICAgICAgIHJldHVybiBfMS5nZXRQYXJ0KHQsIGUsICJzb2NrZXQiKTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXRTaWRlYmFyOiBmdW5jdGlvbiBzZXRTaWRlYmFyKHQsIG4pIHsKICAgICAgICAgICAgXzEuZ2V0UGFydCh0LCBlLCAic2lkZWJhciIpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gcGsodCwgbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHRvZ2dsZVNpZGViYXI6IGZ1bmN0aW9uIHRvZ2dsZVNpZGViYXIodCwgbikgewogICAgICAgICAgICBfMS5nZXRQYXJ0KHQsIGUsICJzaWRlYmFyIikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHZhciBlID0gbjsKICAgICAgICAgICAgICB1ZC5nZXRDdXJyZW50KHQpLmVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgIHVkLmdldEN1cnJlbnQobikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICBaMS5oYXNHcm93bihuKSA/IG9PLmlzU2hvd2luZyh0LCBlKSA/IFoxLnNocmluayhuKSA6IChvTy5oaWRlQWxsU2xvdHModCksIG9PLnNob3dTbG90KHQsIGUpKSA6IChvTy5oaWRlQWxsU2xvdHModCksIG9PLnNob3dTbG90KHQsIGUpLCBaMS5ncm93KG4pKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICB3aGljaFNpZGViYXI6IGZ1bmN0aW9uIHdoaWNoU2lkZWJhcih0KSB7CiAgICAgICAgICAgIHJldHVybiBfMS5nZXRQYXJ0KHQsIGUsICJzaWRlYmFyIikuYmluZChoaykuZ2V0T3JOdWxsKCk7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0SGVhZGVyOiBmdW5jdGlvbiBnZXRIZWFkZXIodCkgewogICAgICAgICAgICByZXR1cm4gXzEuZ2V0UGFydCh0LCBlLCAiaGVhZGVyIik7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0VG9vbGJhcjogZnVuY3Rpb24gZ2V0VG9vbGJhcih0KSB7CiAgICAgICAgICAgIHJldHVybiBfMS5nZXRQYXJ0KHQsIGUsICJ0b29sYmFyIik7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0VG9vbGJhcjogZnVuY3Rpb24gc2V0VG9vbGJhcih0LCBuKSB7CiAgICAgICAgICAgIF8xLmdldFBhcnQodCwgZSwgInRvb2xiYXIiKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgdC5nZXRBcGlzKCkuc2V0R3JvdXBzKHQsIG4pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXRUb29sYmFyczogZnVuY3Rpb24gc2V0VG9vbGJhcnModCwgbikgewogICAgICAgICAgICBfMS5nZXRQYXJ0KHQsIGUsICJtdWx0aXBsZS10b29sYmFyIikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIEIxLnNldEl0ZW1zKHQsIG4pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICByZWZyZXNoVG9vbGJhcjogZnVuY3Rpb24gcmVmcmVzaFRvb2xiYXIodCkgewogICAgICAgICAgICBfMS5nZXRQYXJ0KHQsIGUsICJ0b29sYmFyIikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiB0LmdldEFwaXMoKS5yZWZyZXNoKHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICB0b2dnbGVUb29sYmFyRHJhd2VyOiBmdW5jdGlvbiB0b2dnbGVUb29sYmFyRHJhd2VyKHQpIHsKICAgICAgICAgICAgXzEuZ2V0UGFydCh0LCBlLCAidG9vbGJhciIpLmVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICB2YXIgdCA9IG4uZ2V0QXBpcygpLnRvZ2dsZTsKICAgICAgICAgICAgICBudWxsICE9IHQgPyB2dC5zb21lKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdChuKTsKICAgICAgICAgICAgICB9KHQpKSA6IHZ0Lm5vbmUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgaXNUb29sYmFyRHJhd2VyVG9nZ2xlZDogZnVuY3Rpb24gaXNUb29sYmFyRHJhd2VyVG9nZ2xlZCh0KSB7CiAgICAgICAgICAgIHJldHVybiBfMS5nZXRQYXJ0KHQsIGUsICJ0b29sYmFyIikuYmluZChmdW5jdGlvbiAobikgewogICAgICAgICAgICAgIHJldHVybiB2dC5mcm9tKG4uZ2V0QXBpcygpLmlzT3BlbikubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdChuKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkuZ2V0T3IoITEpOwogICAgICAgICAgfSwKICAgICAgICAgIGdldFRocm9iYmVyOiBmdW5jdGlvbiBnZXRUaHJvYmJlcih0KSB7CiAgICAgICAgICAgIHJldHVybiBfMS5nZXRQYXJ0KHQsIGUsICJ0aHJvYmJlciIpOwogICAgICAgICAgfSwKICAgICAgICAgIGZvY3VzVG9vbGJhcjogZnVuY3Rpb24gZm9jdXNUb29sYmFyKHQpIHsKICAgICAgICAgICAgXzEuZ2V0UGFydCh0LCBlLCAidG9vbGJhciIpLm9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBfMS5nZXRQYXJ0KHQsIGUsICJtdWx0aXBsZS10b29sYmFyIik7CiAgICAgICAgICAgIH0pLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBNZy5mb2N1c0luKHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXRNZW51YmFyOiBmdW5jdGlvbiBzZXRNZW51YmFyKHQsIG4pIHsKICAgICAgICAgICAgXzEuZ2V0UGFydCh0LCBlLCAibWVudWJhciIpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBKMS5zZXRNZW51cyh0LCBuKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgZm9jdXNNZW51YmFyOiBmdW5jdGlvbiBmb2N1c01lbnViYXIodCkgewogICAgICAgICAgICBfMS5nZXRQYXJ0KHQsIGUsICJtZW51YmFyIikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIEoxLmZvY3VzKHQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGJlaGF2aW91cnM6IGUuYmVoYXZpb3VycwogICAgICB9OwogICAgfSwKICAgIGNvbmZpZ0ZpZWxkczogW2ZvKCJkb20iKSwgZm8oImJlaGF2aW91cnMiKV0sCiAgICBwYXJ0RmllbGRzOiBbX08sIENPLCBPTywga08sIFRPLCBFTywgRE9dLAogICAgYXBpczogewogICAgICBnZXRTb2NrZXQ6IGZ1bmN0aW9uIGdldFNvY2tldCh0LCBuKSB7CiAgICAgICAgcmV0dXJuIHQuZ2V0U29ja2V0KG4pOwogICAgICB9LAogICAgICBzZXRTaWRlYmFyOiBmdW5jdGlvbiBzZXRTaWRlYmFyKHQsIG4sIGUpIHsKICAgICAgICB0LnNldFNpZGViYXIobiwgZSk7CiAgICAgIH0sCiAgICAgIHRvZ2dsZVNpZGViYXI6IGZ1bmN0aW9uIHRvZ2dsZVNpZGViYXIodCwgbiwgZSkgewogICAgICAgIHQudG9nZ2xlU2lkZWJhcihuLCBlKTsKICAgICAgfSwKICAgICAgd2hpY2hTaWRlYmFyOiBmdW5jdGlvbiB3aGljaFNpZGViYXIodCwgbikgewogICAgICAgIHJldHVybiB0LndoaWNoU2lkZWJhcihuKTsKICAgICAgfSwKICAgICAgZ2V0SGVhZGVyOiBmdW5jdGlvbiBnZXRIZWFkZXIodCwgbikgewogICAgICAgIHJldHVybiB0LmdldEhlYWRlcihuKTsKICAgICAgfSwKICAgICAgZ2V0VG9vbGJhcjogZnVuY3Rpb24gZ2V0VG9vbGJhcih0LCBuKSB7CiAgICAgICAgcmV0dXJuIHQuZ2V0VG9vbGJhcihuKTsKICAgICAgfSwKICAgICAgc2V0VG9vbGJhcjogZnVuY3Rpb24gc2V0VG9vbGJhcih0LCBuLCBlKSB7CiAgICAgICAgdmFyIG8gPSBNKGUsIEFrKTsKICAgICAgICB0LnNldFRvb2xiYXIobiwgbyk7CiAgICAgIH0sCiAgICAgIHNldFRvb2xiYXJzOiBmdW5jdGlvbiBzZXRUb29sYmFycyh0LCBuLCBlKSB7CiAgICAgICAgdmFyIG8gPSBNKGUsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gTSh0LCBBayk7CiAgICAgICAgfSk7CiAgICAgICAgdC5zZXRUb29sYmFycyhuLCBvKTsKICAgICAgfSwKICAgICAgcmVmcmVzaFRvb2xiYXI6IGZ1bmN0aW9uIHJlZnJlc2hUb29sYmFyKHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5yZWZyZXNoVG9vbGJhcihuKTsKICAgICAgfSwKICAgICAgdG9nZ2xlVG9vbGJhckRyYXdlcjogZnVuY3Rpb24gdG9nZ2xlVG9vbGJhckRyYXdlcih0LCBuKSB7CiAgICAgICAgdC50b2dnbGVUb29sYmFyRHJhd2VyKG4pOwogICAgICB9LAogICAgICBpc1Rvb2xiYXJEcmF3ZXJUb2dnbGVkOiBmdW5jdGlvbiBpc1Rvb2xiYXJEcmF3ZXJUb2dnbGVkKHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5pc1Rvb2xiYXJEcmF3ZXJUb2dnbGVkKG4pOwogICAgICB9LAogICAgICBnZXRUaHJvYmJlcjogZnVuY3Rpb24gZ2V0VGhyb2JiZXIodCwgbikgewogICAgICAgIHJldHVybiB0LmdldFRocm9iYmVyKG4pOwogICAgICB9LAogICAgICBzZXRNZW51YmFyOiBmdW5jdGlvbiBzZXRNZW51YmFyKHQsIG4sIGUpIHsKICAgICAgICB0LnNldE1lbnViYXIobiwgZSk7CiAgICAgIH0sCiAgICAgIGZvY3VzTWVudWJhcjogZnVuY3Rpb24gZm9jdXNNZW51YmFyKHQsIG4pIHsKICAgICAgICB0LmZvY3VzTWVudWJhcihuKTsKICAgICAgfSwKICAgICAgZm9jdXNUb29sYmFyOiBmdW5jdGlvbiBmb2N1c1Rvb2xiYXIodCwgbikgewogICAgICAgIHQuZm9jdXNUb29sYmFyKG4pOwogICAgICB9CiAgICB9CiAgfSksCiAgICAgIE1PID0gewogICAgZmlsZTogewogICAgICB0aXRsZTogIkZpbGUiLAogICAgICBpdGVtczogIm5ld2RvY3VtZW50IHJlc3RvcmVkcmFmdCB8IHByZXZpZXcgfCBleHBvcnQgcHJpbnQgfCBkZWxldGVhbGxjb252ZXJzYXRpb25zIgogICAgfSwKICAgIGVkaXQ6IHsKICAgICAgdGl0bGU6ICJFZGl0IiwKICAgICAgaXRlbXM6ICJ1bmRvIHJlZG8gfCBjdXQgY29weSBwYXN0ZSBwYXN0ZXRleHQgfCBzZWxlY3RhbGwgfCBzZWFyY2hyZXBsYWNlIgogICAgfSwKICAgIHZpZXc6IHsKICAgICAgdGl0bGU6ICJWaWV3IiwKICAgICAgaXRlbXM6ICJjb2RlIHwgdmlzdWFsYWlkIHZpc3VhbGNoYXJzIHZpc3VhbGJsb2NrcyB8IHNwZWxsY2hlY2tlciB8IHByZXZpZXcgZnVsbHNjcmVlbiB8IHNob3djb21tZW50cyIKICAgIH0sCiAgICBpbnNlcnQ6IHsKICAgICAgdGl0bGU6ICJJbnNlcnQiLAogICAgICBpdGVtczogImltYWdlIGxpbmsgbWVkaWEgYWRkY29tbWVudCBwYWdlZW1iZWQgdGVtcGxhdGUgY29kZXNhbXBsZSBpbnNlcnR0YWJsZSB8IGNoYXJtYXAgZW1vdGljb25zIGhyIHwgcGFnZWJyZWFrIG5vbmJyZWFraW5nIGFuY2hvciB0b2MgfCBpbnNlcnRkYXRldGltZSIKICAgIH0sCiAgICBmb3JtYXQ6IHsKICAgICAgdGl0bGU6ICJGb3JtYXQiLAogICAgICBpdGVtczogImJvbGQgaXRhbGljIHVuZGVybGluZSBzdHJpa2V0aHJvdWdoIHN1cGVyc2NyaXB0IHN1YnNjcmlwdCBjb2RlZm9ybWF0IHwgZm9ybWF0cyBibG9ja2Zvcm1hdHMgZm9udGZvcm1hdHMgZm9udHNpemVzIGFsaWduIGxpbmVoZWlnaHQgfCBmb3JlY29sb3IgYmFja2NvbG9yIHwgbGFuZ3VhZ2UgfCByZW1vdmVmb3JtYXQiCiAgICB9LAogICAgdG9vbHM6IHsKICAgICAgdGl0bGU6ICJUb29scyIsCiAgICAgIGl0ZW1zOiAic3BlbGxjaGVja2VyIHNwZWxsY2hlY2tlcmxhbmd1YWdlIHwgYTExeWNoZWNrIGNvZGUgd29yZGNvdW50IgogICAgfSwKICAgIHRhYmxlOiB7CiAgICAgIHRpdGxlOiAiVGFibGUiLAogICAgICBpdGVtczogImluc2VydHRhYmxlIHwgY2VsbCByb3cgY29sdW1uIHwgYWR2dGFibGVzb3J0IHwgdGFibGVwcm9wcyBkZWxldGV0YWJsZSIKICAgIH0sCiAgICBoZWxwOiB7CiAgICAgIHRpdGxlOiAiSGVscCIsCiAgICAgIGl0ZW1zOiAiaGVscCIKICAgIH0KICB9LAogICAgICBBTyA9IFMoTmssICExKSwKICAgICAgRk8gPSBTKE5rLCAhMCk7CgogIGZ1bmN0aW9uIElPKHQsIG4sIGUsIG8pIHsKICAgIHZhciByOwogICAgcmV0dXJuIHsKICAgICAgdHlwZTogImJhc2ljIiwKICAgICAgZGF0YTogKHIgPSB0LmdldFBhcmFtKG4sIGUsICJzdHJpbmciKSwgTShvID09PSAkay5TZW1pQ29sb24gPyByLnJlcGxhY2UoLzskLywgIiIpLnNwbGl0KCI7IikgOiByLnNwbGl0KCIgIiksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSB0LAogICAgICAgICAgICBlID0gdCwKICAgICAgICAgICAgbyA9IHQuc3BsaXQoIj0iKTsKICAgICAgICByZXR1cm4gMSA8IG8ubGVuZ3RoICYmIChuID0gb1swXSwgZSA9IG9bMV0pLCB7CiAgICAgICAgICB0aXRsZTogbiwKICAgICAgICAgIGZvcm1hdDogZQogICAgICAgIH07CiAgICAgIH0pKQogICAgfTsKICB9CgogIGZ1bmN0aW9uIFJPKGUpIHsKICAgIHZhciB0ID0gewogICAgICB0eXBlOiAiYmFzaWMiLAogICAgICBkYXRhOiBnXwogICAgfTsKICAgIHJldHVybiB7CiAgICAgIHRvb2x0aXA6ICJBbGlnbiIsCiAgICAgIHRleHQ6IHZ0Lm5vbmUoKSwKICAgICAgaWNvbjogdnQuc29tZSgiYWxpZ24tbGVmdCIpLAogICAgICBpc1NlbGVjdGVkRm9yOiBmdW5jdGlvbiBpc1NlbGVjdGVkRm9yKHQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGUuZm9ybWF0dGVyLm1hdGNoKHQpOwogICAgICAgIH07CiAgICAgIH0sCiAgICAgIGdldEN1cnJlbnRWYWx1ZTogdnQubm9uZSwKICAgICAgZ2V0UHJldmlld0ZvcjogZnVuY3Rpb24gZ2V0UHJldmlld0Zvcih0KSB7CiAgICAgICAgcmV0dXJuIHZ0Lm5vbmU7CiAgICAgIH0sCiAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiBvbkFjdGlvbihuKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBWKGdfLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdC5mb3JtYXQgPT09IG4uZm9ybWF0OwogICAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gZS5leGVjQ29tbWFuZCh0LmNvbW1hbmQpOwogICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgdXBkYXRlVGV4dDogZnVuY3Rpb24gdXBkYXRlVGV4dCh0KSB7CiAgICAgICAgdmFyIG4gPSBWKGdfLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIGUuZm9ybWF0dGVyLm1hdGNoKHQuZm9ybWF0KTsKICAgICAgICB9KS5mb2xkKHJ0KCJsZWZ0IiksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC50aXRsZS50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0pOwogICAgICAgIHZyKHQsIEZTLCB7CiAgICAgICAgICBpY29uOiAiYWxpZ24tIiArIG4KICAgICAgICB9KTsKICAgICAgfSwKICAgICAgZGF0YXNldDogdCwKICAgICAgc2hvdWxkSGlkZTogITEsCiAgICAgIGlzSW52YWxpZDogZnVuY3Rpb24gaXNJbnZhbGlkKHQpIHsKICAgICAgICByZXR1cm4gIWUuZm9ybWF0dGVyLmNhbkFwcGx5KHQuZm9ybWF0KTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIFZPKHQpIHsKICAgIHJldHVybiBNKHQuc3BsaXQoL1xzKixccyovKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQucmVwbGFjZSgvXlsnIl0rfFsnIl0rJC9nLCAiIik7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIFBPKHIpIHsKICAgIGZ1bmN0aW9uIGkoKSB7CiAgICAgIGZ1bmN0aW9uIGUodCkgewogICAgICAgIHJldHVybiB0ID8gVk8odClbMF0gOiAiIjsKICAgICAgfQoKICAgICAgdmFyIHQgPSByLnF1ZXJ5Q29tbWFuZFZhbHVlKCJGb250TmFtZSIpLAogICAgICAgICAgbiA9IGEuZGF0YSwKICAgICAgICAgIG8gPSB0ID8gdC50b0xvd2VyQ2FzZSgpIDogIiI7CiAgICAgIHJldHVybiB7CiAgICAgICAgbWF0Y2hPcHQ6IFYobiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gdC5mb3JtYXQ7CiAgICAgICAgICByZXR1cm4gbi50b0xvd2VyQ2FzZSgpID09PSBvIHx8IGUobikudG9Mb3dlckNhc2UoKSA9PT0gZShvKS50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0pLm9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIG90KDAgPT09ICh0ID0gbykuaW5kZXhPZigiLWFwcGxlLXN5c3RlbSIpICYmIChuID0gVk8odC50b0xvd2VyQ2FzZSgpKSwgTihwXywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIC0xIDwgbi5pbmRleE9mKHQudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICB9KSksIHsKICAgICAgICAgICAgdGl0bGU6IHUsCiAgICAgICAgICAgIGZvcm1hdDogbwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgdCwgbjsKICAgICAgICB9KSwKICAgICAgICBmb250OiB0CiAgICAgIH07CiAgICB9CgogICAgdmFyIHUgPSAiU3lzdGVtIEZvbnQiLAogICAgICAgIGEgPSBJTyhyLCAiZm9udF9mb3JtYXRzIiwgIkFuZGFsZSBNb25vPWFuZGFsZSBtb25vLG1vbm9zcGFjZTtBcmlhbD1hcmlhbCxoZWx2ZXRpY2Esc2Fucy1zZXJpZjtBcmlhbCBCbGFjaz1hcmlhbCBibGFjayxzYW5zLXNlcmlmO0Jvb2sgQW50aXF1YT1ib29rIGFudGlxdWEscGFsYXRpbm8sc2VyaWY7Q29taWMgU2FucyBNUz1jb21pYyBzYW5zIG1zLHNhbnMtc2VyaWY7Q291cmllciBOZXc9Y291cmllciBuZXcsY291cmllcixtb25vc3BhY2U7R2VvcmdpYT1nZW9yZ2lhLHBhbGF0aW5vLHNlcmlmO0hlbHZldGljYT1oZWx2ZXRpY2EsYXJpYWwsc2Fucy1zZXJpZjtJbXBhY3Q9aW1wYWN0LHNhbnMtc2VyaWY7U3ltYm9sPXN5bWJvbDtUYWhvbWE9dGFob21hLGFyaWFsLGhlbHZldGljYSxzYW5zLXNlcmlmO1Rlcm1pbmFsPXRlcm1pbmFsLG1vbmFjbyxtb25vc3BhY2U7VGltZXMgTmV3IFJvbWFuPXRpbWVzIG5ldyByb21hbix0aW1lcyxzZXJpZjtUcmVidWNoZXQgTVM9dHJlYnVjaGV0IG1zLGdlbmV2YSxzYW5zLXNlcmlmO1ZlcmRhbmE9dmVyZGFuYSxnZW5ldmEsc2Fucy1zZXJpZjtXZWJkaW5ncz13ZWJkaW5ncztXaW5nZGluZ3M9d2luZ2RpbmdzLHphcGYgZGluZ2JhdHMiLCAkay5TZW1pQ29sb24pOwogICAgcmV0dXJuIHsKICAgICAgdG9vbHRpcDogIkZvbnRzIiwKICAgICAgdGV4dDogdnQuc29tZSh1KSwKICAgICAgaWNvbjogdnQubm9uZSgpLAogICAgICBpc1NlbGVjdGVkRm9yOiBmdW5jdGlvbiBpc1NlbGVjdGVkRm9yKG4pIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LmV4aXN0cyhmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdC5mb3JtYXQgPT09IG47CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICB9LAogICAgICBnZXRDdXJyZW50VmFsdWU6IGZ1bmN0aW9uIGdldEN1cnJlbnRWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gaSgpLm1hdGNoT3B0OwogICAgICB9LAogICAgICBnZXRQcmV2aWV3Rm9yOiBmdW5jdGlvbiBnZXRQcmV2aWV3Rm9yKHQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHZ0LnNvbWUoewogICAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgICBzdHlsZXM6IC0xID09PSB0LmluZGV4T2YoImRpbmdzIikgPyB7CiAgICAgICAgICAgICAgImZvbnQtZmFtaWx5IjogdAogICAgICAgICAgICB9IDoge30KICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgIH0sCiAgICAgIG9uQWN0aW9uOiBmdW5jdGlvbiBvbkFjdGlvbih0KSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHIudW5kb01hbmFnZXIudHJhbnNhY3QoZnVuY3Rpb24gKCkgewogICAgICAgICAgICByLmZvY3VzKCksIHIuZXhlY0NvbW1hbmQoIkZvbnROYW1lIiwgITEsIHQuZm9ybWF0KTsKICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgIH0sCiAgICAgIHVwZGF0ZVRleHQ6IGZ1bmN0aW9uIHVwZGF0ZVRleHQodCkgewogICAgICAgIHZhciBuID0gaSgpLAogICAgICAgICAgICBlID0gbi5tYXRjaE9wdCwKICAgICAgICAgICAgbyA9IG4uZm9udCwKICAgICAgICAgICAgciA9IGUuZm9sZChydChvKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LnRpdGxlOwogICAgICAgIH0pOwogICAgICAgIHZyKHQsIEFTLCB7CiAgICAgICAgICB0ZXh0OiByCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGRhdGFzZXQ6IGEsCiAgICAgIHNob3VsZEhpZGU6ICExLAogICAgICBpc0ludmFsaWQ6IE8KICAgIH07CiAgfQoKICBmdW5jdGlvbiBITyhlKSB7CiAgICBmdW5jdGlvbiBpKCkgewogICAgICB2YXIgYSA9IHZ0Lm5vbmUoKSwKICAgICAgICAgIGMgPSBvLmRhdGEsCiAgICAgICAgICBzID0gZS5xdWVyeUNvbW1hbmRWYWx1ZSgiRm9udFNpemUiKTsKICAgICAgaWYgKHMpIGZvciAodmFyIHQgPSBmdW5jdGlvbiB0KF90MykgewogICAgICAgIHZhciBuLAogICAgICAgICAgICBlLAogICAgICAgICAgICBvLAogICAgICAgICAgICByLAogICAgICAgICAgICBpID0gKGUgPSBfdDMsIC9bMC05Ll0rcHgkLy50ZXN0KG4gPSBzKSA/IChvID0gNzIgKiBwYXJzZUludChuLCAxMCkgLyA5NiwgciA9IE1hdGgucG93KDEwLCBlIHx8IDApLCBNYXRoLnJvdW5kKG8gKiByKSAvIHIgKyAicHQiKSA6IHR0KHZfLCBuKS5nZXRPcihuKSksCiAgICAgICAgICAgIHUgPSB0dChoXywgaSkuZ2V0T3IoIiIpOwogICAgICAgIGEgPSBWKGMsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC5mb3JtYXQgPT09IHMgfHwgdC5mb3JtYXQgPT09IGkgfHwgdC5mb3JtYXQgPT09IHU7CiAgICAgICAgfSk7CiAgICAgIH0sIG4gPSAzOyBhLmlzTm9uZSgpICYmIDAgPD0gbjsgbi0tKSB7CiAgICAgICAgdChuKTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIG1hdGNoT3B0OiBhLAogICAgICAgIHNpemU6IHMKICAgICAgfTsKICAgIH0KCiAgICB2YXIgdCA9IHJ0KHZ0Lm5vbmUpLAogICAgICAgIG8gPSBJTyhlLCAiZm9udHNpemVfZm9ybWF0cyIsICI4cHQgMTBwdCAxMnB0IDE0cHQgMThwdCAyNHB0IDM2cHQiLCAkay5TcGFjZSk7CiAgICByZXR1cm4gewogICAgICB0b29sdGlwOiAiRm9udCBzaXplcyIsCiAgICAgIHRleHQ6IHZ0LnNvbWUoIjEycHQiKSwKICAgICAgaWNvbjogdnQubm9uZSgpLAogICAgICBpc1NlbGVjdGVkRm9yOiBmdW5jdGlvbiBpc1NlbGVjdGVkRm9yKG4pIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LmV4aXN0cyhmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdC5mb3JtYXQgPT09IG47CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICB9LAogICAgICBnZXRQcmV2aWV3Rm9yOiB0LAogICAgICBnZXRDdXJyZW50VmFsdWU6IGZ1bmN0aW9uIGdldEN1cnJlbnRWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gaSgpLm1hdGNoT3B0OwogICAgICB9LAogICAgICBvbkFjdGlvbjogZnVuY3Rpb24gb25BY3Rpb24odCkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBlLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZS5mb2N1cygpLCBlLmV4ZWNDb21tYW5kKCJGb250U2l6ZSIsICExLCB0LmZvcm1hdCk7CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICB9LAogICAgICB1cGRhdGVUZXh0OiBmdW5jdGlvbiB1cGRhdGVUZXh0KHQpIHsKICAgICAgICB2YXIgbiA9IGkoKSwKICAgICAgICAgICAgZSA9IG4ubWF0Y2hPcHQsCiAgICAgICAgICAgIG8gPSBuLnNpemUsCiAgICAgICAgICAgIHIgPSBlLmZvbGQocnQobyksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC50aXRsZTsKICAgICAgICB9KTsKICAgICAgICB2cih0LCBBUywgewogICAgICAgICAgdGV4dDogcgogICAgICAgIH0pOwogICAgICB9LAogICAgICBkYXRhc2V0OiBvLAogICAgICBzaG91bGRIaWRlOiAhMSwKICAgICAgaXNJbnZhbGlkOiBPCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gek8odCwgbikgewogICAgdmFyIGUgPSBuKCksCiAgICAgICAgbyA9IE0oZSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQuZm9ybWF0OwogICAgfSk7CiAgICByZXR1cm4gdnQuZnJvbSh0LmZvcm1hdHRlci5jbG9zZXN0KG8pKS5iaW5kKGZ1bmN0aW9uIChuKSB7CiAgICAgIHJldHVybiBWKGUsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHQuZm9ybWF0ID09PSBuOwogICAgICB9KTsKICAgIH0pLm9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gb3QodC5mb3JtYXR0ZXIubWF0Y2goInAiKSwgewogICAgICAgIHRpdGxlOiAiUGFyYWdyYXBoIiwKICAgICAgICBmb3JtYXQ6ICJwIgogICAgICB9KTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gTk8oZSkgewogICAgdmFyIG8gPSBJTyhlLCAiYmxvY2tfZm9ybWF0cyIsICJQYXJhZ3JhcGg9cDtIZWFkaW5nIDE9aDE7SGVhZGluZyAyPWgyO0hlYWRpbmcgMz1oMztIZWFkaW5nIDQ9aDQ7SGVhZGluZyA1PWg1O0hlYWRpbmcgNj1oNjtQcmVmb3JtYXR0ZWQ9cHJlIiwgJGsuU2VtaUNvbG9uKTsKICAgIHJldHVybiB7CiAgICAgIHRvb2x0aXA6ICJCbG9ja3MiLAogICAgICB0ZXh0OiB2dC5zb21lKCJQYXJhZ3JhcGgiKSwKICAgICAgaWNvbjogdnQubm9uZSgpLAogICAgICBpc1NlbGVjdGVkRm9yOiBmdW5jdGlvbiBpc1NlbGVjdGVkRm9yKHQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGUuZm9ybWF0dGVyLm1hdGNoKHQpOwogICAgICAgIH07CiAgICAgIH0sCiAgICAgIGdldEN1cnJlbnRWYWx1ZTogdnQubm9uZSwKICAgICAgZ2V0UHJldmlld0ZvcjogZnVuY3Rpb24gZ2V0UHJldmlld0ZvcihuKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0ID0gZS5mb3JtYXR0ZXIuZ2V0KG4pOwogICAgICAgICAgcmV0dXJuIHZ0LnNvbWUoewogICAgICAgICAgICB0YWc6IDAgPCB0Lmxlbmd0aCAmJiAodFswXS5pbmxpbmUgfHwgdFswXS5ibG9jaykgfHwgImRpdiIsCiAgICAgICAgICAgIHN0eWxlczogZS5kb20ucGFyc2VTdHlsZShlLmZvcm1hdHRlci5nZXRDc3NUZXh0KG4pKQogICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgb25BY3Rpb246IFVrKGUpLAogICAgICB1cGRhdGVUZXh0OiBmdW5jdGlvbiB1cGRhdGVUZXh0KHQpIHsKICAgICAgICB2YXIgbiA9IHpPKGUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBvLmRhdGE7CiAgICAgICAgfSkuZm9sZChydCgiUGFyYWdyYXBoIiksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC50aXRsZTsKICAgICAgICB9KTsKICAgICAgICB2cih0LCBBUywgewogICAgICAgICAgdGV4dDogbgogICAgICAgIH0pOwogICAgICB9LAogICAgICBkYXRhc2V0OiBvLAogICAgICBzaG91bGRIaWRlOiAhMSwKICAgICAgaXNJbnZhbGlkOiBmdW5jdGlvbiBpc0ludmFsaWQodCkgewogICAgICAgIHJldHVybiAhZS5mb3JtYXR0ZXIuY2FuQXBwbHkodC5mb3JtYXQpOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gTE8ociwgdCkgewogICAgcmV0dXJuIHsKICAgICAgdG9vbHRpcDogIkZvcm1hdHMiLAogICAgICB0ZXh0OiB2dC5zb21lKCJQYXJhZ3JhcGgiKSwKICAgICAgaWNvbjogdnQubm9uZSgpLAogICAgICBpc1NlbGVjdGVkRm9yOiBmdW5jdGlvbiBpc1NlbGVjdGVkRm9yKHQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHIuZm9ybWF0dGVyLm1hdGNoKHQpOwogICAgICAgIH07CiAgICAgIH0sCiAgICAgIGdldEN1cnJlbnRWYWx1ZTogdnQubm9uZSwKICAgICAgZ2V0UHJldmlld0ZvcjogZnVuY3Rpb24gZ2V0UHJldmlld0ZvcihuKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0ID0gci5mb3JtYXR0ZXIuZ2V0KG4pOwogICAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdCA/IHZ0LnNvbWUoewogICAgICAgICAgICB0YWc6IDAgPCB0Lmxlbmd0aCAmJiAodFswXS5pbmxpbmUgfHwgdFswXS5ibG9jaykgfHwgImRpdiIsCiAgICAgICAgICAgIHN0eWxlczogci5kb20ucGFyc2VTdHlsZShyLmZvcm1hdHRlci5nZXRDc3NUZXh0KG4pKQogICAgICAgICAgfSkgOiB2dC5ub25lKCk7CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgb25BY3Rpb246IFVrKHIpLAogICAgICB1cGRhdGVUZXh0OiBmdW5jdGlvbiB1cGRhdGVUZXh0KHQpIHsKICAgICAgICB2YXIgZSA9IGZ1bmN0aW9uIGUodCkgewogICAgICAgICAgdmFyIG4gPSB0Lml0ZW1zOwogICAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gbiAmJiAwIDwgbi5sZW5ndGggPyB6KG4sIGUpIDogW3sKICAgICAgICAgICAgdGl0bGU6IHQudGl0bGUsCiAgICAgICAgICAgIGZvcm1hdDogdC5mb3JtYXQKICAgICAgICAgIH1dOwogICAgICAgIH0sCiAgICAgICAgICAgIG4gPSB6KHBDKHIpLCBlKSwKICAgICAgICAgICAgbyA9IHpPKHIsIHJ0KG4pKS5mb2xkKHJ0KCJQYXJhZ3JhcGgiKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LnRpdGxlOwogICAgICAgIH0pOwoKICAgICAgICB2cih0LCBBUywgewogICAgICAgICAgdGV4dDogbwogICAgICAgIH0pOwogICAgICB9LAogICAgICBzaG91bGRIaWRlOiByLmdldFBhcmFtKCJzdHlsZV9mb3JtYXRzX2F1dG9oaWRlIiwgITEsICJib29sZWFuIiksCiAgICAgIGlzSW52YWxpZDogZnVuY3Rpb24gaXNJbnZhbGlkKHQpIHsKICAgICAgICByZXR1cm4gIXIuZm9ybWF0dGVyLmNhbkFwcGx5KHQuZm9ybWF0KTsKICAgICAgfSwKICAgICAgZGF0YXNldDogdAogICAgfTsKICB9CgogIGZ1bmN0aW9uIFdPKG4pIHsKICAgIHJldHVybiB7CiAgICAgIGlzRGlzYWJsZWQ6IGZ1bmN0aW9uIGlzRGlzYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIGRkLmlzRGlzYWJsZWQobik7CiAgICAgIH0sCiAgICAgIHNldERpc2FibGVkOiBmdW5jdGlvbiBzZXREaXNhYmxlZCh0KSB7CiAgICAgICAgcmV0dXJuIGRkLnNldChuLCB0KTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIFVPKG4pIHsKICAgIHJldHVybiB7CiAgICAgIHNldEFjdGl2ZTogZnVuY3Rpb24gc2V0QWN0aXZlKHQpIHsKICAgICAgICB6Zy5zZXQobiwgdCk7CiAgICAgIH0sCiAgICAgIGlzQWN0aXZlOiBmdW5jdGlvbiBpc0FjdGl2ZSgpIHsKICAgICAgICByZXR1cm4gemcuaXNPbihuKTsKICAgICAgfSwKICAgICAgaXNEaXNhYmxlZDogZnVuY3Rpb24gaXNEaXNhYmxlZCgpIHsKICAgICAgICByZXR1cm4gZGQuaXNEaXNhYmxlZChuKTsKICAgICAgfSwKICAgICAgc2V0RGlzYWJsZWQ6IGZ1bmN0aW9uIHNldERpc2FibGVkKHQpIHsKICAgICAgICByZXR1cm4gZGQuc2V0KG4sIHQpOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gak8odCwgbikgewogICAgcmV0dXJuIHQubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgImFyaWEtbGFiZWwiOiBuLnRyYW5zbGF0ZSh0KSwKICAgICAgICB0aXRsZTogbi50cmFuc2xhdGUodCkKICAgICAgfTsKICAgIH0pLmdldE9yKHt9KTsKICB9CgogIGZ1bmN0aW9uIEdPKG4sIGUsIHQsIG8sIHIsIGkpIHsKICAgIHZhciB1OwogICAgcmV0dXJuIHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiYnV0dG9uIiwKICAgICAgICBjbGFzc2VzOiBbInRveC10YnRuIl0uY29uY2F0KGUuaXNTb21lKCkgPyBbInRveC10YnRuLS1zZWxlY3QiXSA6IFtdKSwKICAgICAgICBhdHRyaWJ1dGVzOiBqTyh0LCBpKQogICAgICB9LAogICAgICBjb21wb25lbnRzOiBRdihbbi5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gSTAodCwgaS5pY29ucyk7CiAgICAgIH0pLCBlLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBWMCh0LCAidG94LXRidG4iLCBpKTsKICAgICAgfSldKSwKICAgICAgZXZlbnRPcmRlcjogKCh1ID0ge30pW2RpKCldID0gWyJmb2N1c2luZyIsICJhbGxveS5iYXNlLmJlaGF2aW91ciIsICJjb21tb24tYnV0dG9uLWRpc3BsYXktZXZlbnRzIl0sIHUpLAogICAgICBidXR0b25CZWhhdmlvdXJzOiB0YyhbSnYoaS5pc0Rpc2FibGVkKSwgbXYoKSwgZm0oImNvbW1vbi1idXR0b24tZGlzcGxheS1ldmVudHMiLCBbQ3IoZGkoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBuLmV2ZW50LnByZXZlbnQoKSwgaHIodCwga18pOwogICAgICB9KV0pXS5jb25jYXQoby5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4geF8uY29uZmlnKHsKICAgICAgICAgIGNoYW5uZWw6IHQsCiAgICAgICAgICBpbml0aWFsRGF0YTogewogICAgICAgICAgICBpY29uOiBuLAogICAgICAgICAgICB0ZXh0OiBlCiAgICAgICAgICB9LAogICAgICAgICAgcmVuZGVyQ29tcG9uZW50czogZnVuY3Rpb24gcmVuZGVyQ29tcG9uZW50cyh0LCBuKSB7CiAgICAgICAgICAgIHJldHVybiBRdihbdC5pY29uLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiBJMCh0LCBpLmljb25zKTsKICAgICAgICAgICAgfSksIHQudGV4dC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gVjAodCwgInRveC10YnRuIiwgaSk7CiAgICAgICAgICAgIH0pXSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pLnRvQXJyYXkoKSkuY29uY2F0KHIuZ2V0T3IoW10pKSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBYTyh0LCBuLCBlKSB7CiAgICB2YXIgbywKICAgICAgICByID0gVm8oc3QpLAogICAgICAgIGkgPSBHTyh0Lmljb24sIHQudGV4dCwgdC50b29sdGlwLCB2dC5ub25lKCksIHZ0Lm5vbmUoKSwgZSk7CiAgICByZXR1cm4gc3Auc2tldGNoKHsKICAgICAgZG9tOiBpLmRvbSwKICAgICAgY29tcG9uZW50czogaS5jb21wb25lbnRzLAogICAgICBldmVudE9yZGVyOiBNUywKICAgICAgYnV0dG9uQmVoYXZpb3VyczogdGMoW2ZtKCJ0b29sYmFyLWJ1dHRvbi1ldmVudHMiLCBbKG8gPSB7CiAgICAgICAgb25BY3Rpb246IHQub25BY3Rpb24sCiAgICAgICAgZ2V0QXBpOiBuLmdldEFwaQogICAgICB9LCBpdShmdW5jdGlvbiAobiwgdCkgewogICAgICAgIGd2KG8sIG4pKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2cihuLCBCUywgewogICAgICAgICAgICBidXR0b25BcGk6IHQKICAgICAgICAgIH0pLCBvLm9uQWN0aW9uKHQpOwogICAgICAgIH0pOwogICAgICB9KSksIHB2KG4sIHIpLCBodihuLCByKV0pLCBKdihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHQuZGlzYWJsZWQgfHwgZS5pc0Rpc2FibGVkKCk7CiAgICAgIH0pLCBtdigpXS5jb25jYXQobi50b29sYmFyQnV0dG9uQmVoYXZpb3VycykpCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIFlPKHIsIGkpIHsKICAgIHJldHVybiBmdW5jdGlvbiAodCwgbiwgZSkgewogICAgICB2YXIgbyA9IHIodCkubWFwRXJyb3IoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gaXIodCk7CiAgICAgIH0pLmdldE9yRGllKCk7CiAgICAgIHJldHVybiBpKG8sIG4sIGUpOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIHFPKGUsIHQsIG8sIHIpIHsKICAgIHZhciBuLAogICAgICAgIGkgPSB0Lm91dGVyQ29udGFpbmVyLAogICAgICAgIHUgPSBvLnRvb2xiYXIsCiAgICAgICAgYSA9IG8uYnV0dG9uczsKICAgIGYodSwgeSkgPyAobiA9IHUubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuID0gewogICAgICAgIHRvb2xiYXI6IHQsCiAgICAgICAgYnV0dG9uczogYSwKICAgICAgICBhbGxvd1Rvb2xiYXJHcm91cHM6IG8uYWxsb3dUb29sYmFyR3JvdXBzCiAgICAgIH07CiAgICAgIHJldHVybiBCXyhlLCBuLCB7CiAgICAgICAgYmFja3N0YWdlOiByCiAgICAgIH0sIHZ0Lm5vbmUoKSk7CiAgICB9KSwgQk8uc2V0VG9vbGJhcnMoaSwgbikpIDogQk8uc2V0VG9vbGJhcihpLCBCXyhlLCBvLCB7CiAgICAgIGJhY2tzdGFnZTogcgogICAgfSwgdnQubm9uZSgpKSk7CiAgfQoKICBmdW5jdGlvbiBLTyh0KSB7CiAgICByZXR1cm4gL15bMC05XC5dKyh8cHgpJC9pLnRlc3QoIiIgKyB0KSA/IHZ0LnNvbWUocGFyc2VJbnQoIiIgKyB0LCAxMCkpIDogdnQubm9uZSgpOwogIH0KCiAgZnVuY3Rpb24gSk8odCkgewogICAgcmV0dXJuIHUodCkgPyB0ICsgInB4IiA6IHQ7CiAgfQoKICBmdW5jdGlvbiAkTyhuLCB0LCBlKSB7CiAgICB2YXIgbyA9IHQuZmlsdGVyKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBuIDwgdDsKICAgIH0pLAogICAgICAgIHIgPSBlLmZpbHRlcihmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gdCA8IG47CiAgICB9KTsKICAgIHJldHVybiBvLm9yKHIpLmdldE9yKG4pOwogIH0KCiAgZnVuY3Rpb24gUU8odCkgewogICAgdmFyIG4gPSBjaCh0KSwKICAgICAgICBlID0gc2godCksCiAgICAgICAgbyA9IGZoKHQpOwogICAgcmV0dXJuIEtPKG4pLm1hcChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gJE8odCwgZSwgbyk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIFpPKHUsIGEsIHQsIG4sIGMpIHsKICAgIGZ1bmN0aW9uIHMoKSB7CiAgICAgIHJldHVybiB4LmdldCgpICYmICF1LnJlbW92ZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gbCh0KSB7CiAgICAgIHJldHVybiB5ID8gdC5mb2xkKHJ0KDApLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiAxIDwgdC5jb21wb25lbnRzKCkubGVuZ3RoID8geG4odC5jb21wb25lbnRzKClbMV0uZWxlbWVudCkgOiAwOwogICAgICB9KSA6IDA7CiAgICB9CgogICAgZnVuY3Rpb24gZigpIHsKICAgICAgci5icm9hZGNhc3RPbihbYmYoKV0sIHt9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgdmFyIG4sIGUsIG8sIHIsIGk7CiAgICAgIHZvaWQgMCA9PT0gdCAmJiAodCA9ICExKSwgcygpICYmIChtIHx8IChuID0gcC5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IEtPKGduKHZlKCksICJtYXJnaW4tbGVmdCIpKS5nZXRPcigwKTsKICAgICAgICByZXR1cm4ga24odmUoKSkgLSBDbihhKS5sZWZ0ICsgdDsKICAgICAgfSksIGZuKGMuZ2V0KCkuZWxlbWVudCwgIm1heC13aWR0aCIsIG4gKyAicHgiKSksIHkgJiYgQk8ucmVmcmVzaFRvb2xiYXIoZCksIG0gfHwgKGUgPSBsKEJPLmdldFRvb2xiYXIoZCkpLCBvID0gTWUoYSksIHIgPSB2KCkgPyBNYXRoLm1heChvLnkgLSB4bihjLmdldCgpLmVsZW1lbnQpICsgZSwgMCkgOiBvLmJvdHRvbSwgZG4oZC5lbGVtZW50LCB7CiAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgdG9wOiBNYXRoLnJvdW5kKHIpICsgInB4IiwKICAgICAgICBsZWZ0OiBNYXRoLnJvdW5kKG8ueCkgKyAicHgiCiAgICAgIH0pKSwgZyAmJiAoaSA9IGMuZ2V0KCksIHQgPyBOMS5yZXNldChpKSA6IE4xLnJlZnJlc2goaSkpLCBmKCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGUodCkgewogICAgICB2YXIgbiwgZTsKICAgICAgdm9pZCAwID09PSB0ICYmICh0ID0gITApLCAhbSAmJiBnICYmIHMoKSAmJiAobiA9IGguZ2V0RG9ja2luZ01vZGUoKSwgKGUgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHN3aXRjaCAocnYodSkpIHsKICAgICAgICAgIGNhc2UgYmguYXV0bzoKICAgICAgICAgICAgdmFyIG4gPSBsKEJPLmdldFRvb2xiYXIoZCkpLAogICAgICAgICAgICAgICAgZSA9IHhuKHQuZWxlbWVudCkgLSBuLAogICAgICAgICAgICAgICAgbyA9IE1lKGEpOwogICAgICAgICAgICBpZiAoby55ID4gZSkgcmV0dXJuICJ0b3AiOwogICAgICAgICAgICB2YXIgciA9IEd0KGEpLAogICAgICAgICAgICAgICAgaSA9IE1hdGgubWF4KHIuZG9tLnNjcm9sbEhlaWdodCwgeG4ocikpOwogICAgICAgICAgICByZXR1cm4gby5ib3R0b20gPCBpIC0gZSB8fCBBZSgpLmJvdHRvbSA8IG8uYm90dG9tIC0gZSA/ICJib3R0b20iIDogInRvcCI7CgogICAgICAgICAgY2FzZSBiaC5ib3R0b206CiAgICAgICAgICAgIHJldHVybiAiYm90dG9tIjsKCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gYmgudG9wLCAidG9wIjsKICAgICAgICB9CiAgICAgIH0oYy5nZXQoKSkpICE9PSBuICYmIChmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBuID0gYy5nZXQoKTsKICAgICAgICBOMS5zZXRNb2RlcyhuLCBbdF0pLCBoLnNldERvY2tpbmdNb2RlKHQpOwogICAgICAgIHZhciBlID0gdigpID8gQ2MuVG9wVG9Cb3R0b20gOiBDYy5Cb3R0b21Ub1RvcDsKICAgICAgICBvbihuLmVsZW1lbnQsIHRzLCBlKTsKICAgICAgfShlKSwgdCAmJiBvKCEwKSkpOwogICAgfQoKICAgIHZhciByID0gdC51aU1vdGhlcnNoaXAsCiAgICAgICAgZCA9IHQub3V0ZXJDb250YWluZXIsCiAgICAgICAgaSA9IHR2LkRPTSwKICAgICAgICBtID0gYXYodSksCiAgICAgICAgZyA9IGx2KHUpLAogICAgICAgIHAgPSBmaCh1KS5vcihRTyh1KSksCiAgICAgICAgaCA9IG4uc2hhcmVkLmhlYWRlciwKICAgICAgICB2ID0gaC5pc1Bvc2l0aW9uZWRBdFRvcCwKICAgICAgICBiID0gb3YodSksCiAgICAgICAgeSA9IGIgPT09IGhoLnNsaWRpbmcgfHwgYiA9PT0gaGguZmxvYXRpbmcsCiAgICAgICAgeCA9IFZvKCExKTsKICAgIHJldHVybiB7CiAgICAgIGlzVmlzaWJsZTogcywKICAgICAgaXNQb3NpdGlvbmVkQXRUb3A6IHYsCiAgICAgIHNob3c6IGZ1bmN0aW9uIHNob3coKSB7CiAgICAgICAgeC5zZXQoITApLCBmbihkLmVsZW1lbnQsICJkaXNwbGF5IiwgImZsZXgiKSwgaS5hZGRDbGFzcyh1LmdldEJvZHkoKSwgIm1jZS1lZGl0LWZvY3VzIiksIHZuKHIuZWxlbWVudCwgImRpc3BsYXkiKSwgZSghMSksIG8oKTsKICAgICAgfSwKICAgICAgaGlkZTogZnVuY3Rpb24gaGlkZSgpIHsKICAgICAgICB4LnNldCghMSksIHQub3V0ZXJDb250YWluZXIgJiYgKGZuKGQuZWxlbWVudCwgImRpc3BsYXkiLCAibm9uZSIpLCBpLnJlbW92ZUNsYXNzKHUuZ2V0Qm9keSgpLCAibWNlLWVkaXQtZm9jdXMiKSksIGZuKHIuZWxlbWVudCwgImRpc3BsYXkiLCAibm9uZSIpOwogICAgICB9LAogICAgICB1cGRhdGU6IG8sCiAgICAgIHVwZGF0ZU1vZGU6IGUsCiAgICAgIHJlcG9zaXRpb25Qb3B1cHM6IGYKICAgIH07CiAgfQoKICBmdW5jdGlvbiB0Xyh0LCBuKSB7CiAgICB2YXIgZSA9IE1lKHQpOwogICAgcmV0dXJuIHsKICAgICAgcG9zOiBuID8gZS55IDogZS5ib3R0b20sCiAgICAgIGJvdW5kczogZQogICAgfTsKICB9CgogIGZ1bmN0aW9uIG5fKGksIHUpIHsKICAgIHJldHVybiBDcihCUywgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgdmFyIGUsCiAgICAgICAgICBvID0gaS5nZXQodCksCiAgICAgICAgICByID0gKGUgPSBvLCB7CiAgICAgICAgaGlkZTogZnVuY3Rpb24gaGlkZSgpIHsKICAgICAgICAgIHJldHVybiBocihlLCBQaSgpKTsKICAgICAgICB9LAogICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHsKICAgICAgICAgIHJldHVybiBUZi5nZXRWYWx1ZShlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB1Lm9uQWN0aW9uKHIsIG4uZXZlbnQuYnV0dG9uQXBpKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZV8odCwgbiwgZSkgewogICAgcmV0dXJuIG4uYm90dG9tIC0gdC55ID49IChlID0gdm9pZCAwID09PSBlID8gLjAxIDogZSkgJiYgdC5ib3R0b20gLSBuLnkgPj0gZTsKICB9CgogIGZ1bmN0aW9uIG9fKHQpIHsKICAgIHZhciBuID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSB0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoKICAgICAgaWYgKG4uaGVpZ2h0IDw9IDAgJiYgbi53aWR0aCA8PSAwKSB7CiAgICAgICAgdmFyIGUgPSBRdChBdC5mcm9tRG9tKHQuc3RhcnRDb250YWluZXIpLCB0LnN0YXJ0T2Zmc2V0KS5lbGVtZW50OwogICAgICAgIHJldHVybiAoWG4oZSkgPyBZdChlKSA6IHZ0LnNvbWUoZSkpLmZpbHRlcihHbikubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gdC5kb20uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgfSkuZ2V0T3Iobik7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfSh0LnNlbGVjdGlvbi5nZXRSbmcoKSk7CgogICAgaWYgKHQuaW5saW5lKSB7CiAgICAgIHZhciBlID0gSW4oKTsKICAgICAgcmV0dXJuIEJlKGUubGVmdCArIG4ubGVmdCwgZS50b3AgKyBuLnRvcCwgbi53aWR0aCwgbi5oZWlnaHQpOwogICAgfQoKICAgIHZhciBvID0gem4oQXQuZnJvbURvbSh0LmdldEJvZHkoKSkpOwogICAgcmV0dXJuIEJlKG8ueCArIG4ubGVmdCwgby55ICsgbi50b3AsIG4ud2lkdGgsIG4uaGVpZ2h0KTsKICB9CgogIGZ1bmN0aW9uIHJfKHQsIG4sIGUsIG8pIHsKICAgIHZvaWQgMCA9PT0gbyAmJiAobyA9IDApOwogICAgdmFyIHIsCiAgICAgICAgaSwKICAgICAgICB1LAogICAgICAgIGEsCiAgICAgICAgYyA9IFBuKHdpbmRvdyksCiAgICAgICAgcyA9IE1lKEF0LmZyb21Eb20odC5nZXRDb250ZW50QXJlYUNvbnRhaW5lcigpKSksCiAgICAgICAgbCA9IG1oKHQpIHx8IGdoKHQpIHx8IGV2KHQpLAogICAgICAgIGYgPSAociA9IHMsIGkgPSBjLCB1ID0gbywgewogICAgICB4OiBhID0gTWF0aC5tYXgoci54ICsgdSwgaS54KSwKICAgICAgd2lkdGg6IE1hdGgubWluKHIucmlnaHQgLSB1LCBpLnJpZ2h0KSAtIGEKICAgIH0pLAogICAgICAgIGQgPSBmLngsCiAgICAgICAgbSA9IGYud2lkdGg7CiAgICBpZiAodC5pbmxpbmUgJiYgIWwpIHJldHVybiBCZShkLCBjLnksIG0sIGMuaGVpZ2h0KTsKCiAgICB2YXIgZyA9IGZ1bmN0aW9uICh0LCBuLCBlLCBvLCByLCBpKSB7CiAgICAgIHZhciB1ID0gQXQuZnJvbURvbSh0LmdldENvbnRhaW5lcigpKSwKICAgICAgICAgIGEgPSBGdSh1LCAiLnRveC1lZGl0b3ItaGVhZGVyIikuZ2V0T3IodSksCiAgICAgICAgICBjID0gTWUoYSksCiAgICAgICAgICBzID0gYy55ID49IG4uYm90dG9tLAogICAgICAgICAgbCA9IG8gJiYgIXM7CiAgICAgIGlmICh0LmlubGluZSAmJiBsKSByZXR1cm4gewogICAgICAgIHk6IE1hdGgubWF4KGMuYm90dG9tICsgaSwgZS55KSwKICAgICAgICBib3R0b206IGUuYm90dG9tCiAgICAgIH07CiAgICAgIGlmICh0LmlubGluZSAmJiAhbCkgcmV0dXJuIHsKICAgICAgICB5OiBlLnksCiAgICAgICAgYm90dG9tOiBNYXRoLm1pbihjLnkgLSBpLCBlLmJvdHRvbSkKICAgICAgfTsKICAgICAgdmFyIGYgPSAibGluZSIgPT09IHIgPyBNZSh1KSA6IG47CiAgICAgIHJldHVybiBsID8gewogICAgICAgIHk6IE1hdGgubWF4KGMuYm90dG9tICsgaSwgZS55KSwKICAgICAgICBib3R0b206IE1hdGgubWluKGYuYm90dG9tIC0gaSwgZS5ib3R0b20pCiAgICAgIH0gOiB7CiAgICAgICAgeTogTWF0aC5tYXgoZi55ICsgaSwgZS55KSwKICAgICAgICBib3R0b206IE1hdGgubWluKGMueSAtIGksIGUuYm90dG9tKQogICAgICB9OwogICAgfSh0LCBzLCBjLCBuLmhlYWRlci5pc1Bvc2l0aW9uZWRBdFRvcCgpLCBlLCBvKSwKICAgICAgICBwID0gZy55LAogICAgICAgIGggPSBnLmJvdHRvbTsKCiAgICByZXR1cm4gQmUoZCwgcCwgbSwgaCAtIHApOwogIH0KCiAgZnVuY3Rpb24gaV8odCkgewogICAgcmV0dXJuICJub2RlIiA9PT0gdDsKICB9CgogIGZ1bmN0aW9uIHVfKHQsIHIsIG4sIGksIGUpIHsKICAgIHZhciB1ID0gb18odCksCiAgICAgICAgbyA9IGkubGFzdEVsZW1lbnQoKS5leGlzdHMoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIEx0KG4sIHQpOwogICAgfSksCiAgICAgICAgYSA9IG4sCiAgICAgICAgYyA9IHQuc2VsZWN0aW9uLmdldFJuZygpLAogICAgICAgIHMgPSBRdChBdC5mcm9tRG9tKGMuc3RhcnRDb250YWluZXIpLCBjLnN0YXJ0T2Zmc2V0KTsKICAgIHJldHVybiBjLnN0YXJ0Q29udGFpbmVyID09PSBjLmVuZENvbnRhaW5lciAmJiBjLnN0YXJ0T2Zmc2V0ID09PSBjLmVuZE9mZnNldCAtIDEgJiYgTHQocy5lbGVtZW50LCBhKSA/IG8gPyBJbSA6IHVwIDogbyA/IGZ1bmN0aW9uIChuLCB0KSB7CiAgICAgIHZhciBlID0gcG4obiwgInBvc2l0aW9uIik7CiAgICAgIGZuKG4sICJwb3NpdGlvbiIsIHQpOwogICAgICB2YXIgbyA9IGVfKHUsIE1lKHIpKSAmJiAhaS5pc1JlcG9zaXRpb24oKSA/IFZtIDogSW07CiAgICAgIHJldHVybiBlLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gZm4obiwgInBvc2l0aW9uIiwgdCk7CiAgICAgIH0pLCBvOwogICAgfShyLCBpLmdldE1vZGUoKSkgOiAoImZpeGVkIiA9PT0gaS5nZXRNb2RlKCkgPyBlLnkgKyBJbigpLnRvcCA6IGUueSkgKyAoeG4ocikgKyAxMikgPD0gdS55ID8gdXAgOiBhcDsKICB9CgogIGZ1bmN0aW9uIGFfKG4sIHQpIHsKICAgIHZhciBlID0gQShGKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0LnByZWRpY2F0ZShuLmRvbSk7CiAgICB9KSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuICJjb250ZXh0dG9vbGJhciIgPT09IHQudHlwZTsKICAgIH0pOwogICAgcmV0dXJuIHsKICAgICAgY29udGV4dFRvb2xiYXJzOiBlLnBhc3MsCiAgICAgIGNvbnRleHRGb3JtczogZS5mYWlsCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gY18oZSwgdCkgewogICAgZnVuY3Rpb24gbyh0KSB7CiAgICAgIHJldHVybiBMdCh0LCByKTsKICAgIH0KCiAgICB2YXIgbiwKICAgICAgICByID0gQXQuZnJvbURvbSh0LmdldEJvZHkoKSksCiAgICAgICAgaSA9IEF0LmZyb21Eb20odC5zZWxlY3Rpb24uZ2V0Tm9kZSgpKTsKICAgIHJldHVybiBvKG4gPSBpKSB8fCBXdChyLCBuKSA/IGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgIHZhciBvID0gYV8odCwgbik7CiAgICAgIGlmICgwIDwgby5jb250ZXh0Rm9ybXMubGVuZ3RoKSByZXR1cm4gdnQuc29tZSh7CiAgICAgICAgZWxlbTogdCwKICAgICAgICB0b29sYmFyczogW28uY29udGV4dEZvcm1zWzBdXQogICAgICB9KTsKICAgICAgdmFyIHIgPSBhXyh0LCBlKTsKICAgICAgaWYgKDAgPCByLmNvbnRleHRGb3Jtcy5sZW5ndGgpIHJldHVybiB2dC5zb21lKHsKICAgICAgICBlbGVtOiB0LAogICAgICAgIHRvb2xiYXJzOiBbci5jb250ZXh0Rm9ybXNbMF1dCiAgICAgIH0pOwoKICAgICAgaWYgKDAgPCBvLmNvbnRleHRUb29sYmFycy5sZW5ndGggfHwgMCA8IHIuY29udGV4dFRvb2xiYXJzLmxlbmd0aCkgewogICAgICAgIHZhciBpID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGlmICh0Lmxlbmd0aCA8PSAxKSByZXR1cm4gdDsKCiAgICAgICAgICBmdW5jdGlvbiBuKG4pIHsKICAgICAgICAgICAgcmV0dXJuIFQodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gdC5wb3NpdGlvbiA9PT0gbjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZShuKSB7CiAgICAgICAgICAgIHJldHVybiBGKHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQucG9zaXRpb24gPT09IG47CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvID0gbigic2VsZWN0aW9uIiksCiAgICAgICAgICAgICAgciA9IG4oIm5vZGUiKTsKCiAgICAgICAgICBpZiAobyB8fCByKSB7CiAgICAgICAgICAgIGlmIChyICYmIG8pIHsKICAgICAgICAgICAgICB2YXIgaSA9IGUoIm5vZGUiKSwKICAgICAgICAgICAgICAgICAgdSA9IE0oZSgic2VsZWN0aW9uIiksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX2x0KF9sdCh7fSwgdCksIHsKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJub2RlIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIGkuY29uY2F0KHUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZShvID8gInNlbGVjdGlvbiIgOiAibm9kZSIpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBlKCJsaW5lIik7CiAgICAgICAgfShvLmNvbnRleHRUb29sYmFycy5jb25jYXQoci5jb250ZXh0VG9vbGJhcnMpKTsKCiAgICAgICAgcmV0dXJuIHZ0LnNvbWUoewogICAgICAgICAgZWxlbTogdCwKICAgICAgICAgIHRvb2xiYXJzOiBpCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB2dC5ub25lKCk7CiAgICB9KGksIGUuaW5Ob2RlU2NvcGUsIGUuaW5FZGl0b3JTY29wZSkub3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBhID0gZSwgKHQgPSBvKShuID0gaSkgPyB2dC5ub25lKCkgOiBmcihuLCBmdW5jdGlvbiAodCkgewogICAgICAgIGlmIChHbih0KSkgewogICAgICAgICAgdmFyIG4gPSBhXyh0LCBhLmluTm9kZVNjb3BlKSwKICAgICAgICAgICAgICBlID0gbi5jb250ZXh0VG9vbGJhcnMsCiAgICAgICAgICAgICAgbyA9IG4uY29udGV4dEZvcm1zLAogICAgICAgICAgICAgIHIgPSAwIDwgby5sZW5ndGggPyBvIDogKHUgPSBlKS5sZW5ndGggPD0gMSA/IHUgOiBpKCJzZWxlY3Rpb24iKS5vclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGkoIm5vZGUiKTsKICAgICAgICAgIH0pLm9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaSgibGluZSIpOwogICAgICAgICAgfSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB0LnBvc2l0aW9uOwogICAgICAgICAgfSkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIH0sIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHJldHVybiBGKHUsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQucG9zaXRpb24gPT09IG47CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gMCA8IHIubGVuZ3RoID8gdnQuc29tZSh7CiAgICAgICAgICAgIGVsZW06IHQsCiAgICAgICAgICAgIHRvb2xiYXJzOiByCiAgICAgICAgICB9KSA6IHZ0Lm5vbmUoKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGkobikgewogICAgICAgICAgcmV0dXJuIFYodSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHQucG9zaXRpb24gPT09IG47CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciB1OwogICAgICAgIHJldHVybiB2dC5ub25lKCk7CiAgICAgIH0sIHQpOwogICAgICB2YXIgdCwgbiwgYTsKICAgIH0pIDogdnQubm9uZSgpOwogIH0KCiAgZnVuY3Rpb24gc18oYSwgYykgewogICAgdmFyIHMgPSB7fSwKICAgICAgICBsID0gW10sCiAgICAgICAgZiA9IFtdLAogICAgICAgIGQgPSB7fSwKICAgICAgICBtID0ge30sCiAgICAgICAgdCA9IGt0KGEpOwogICAgcmV0dXJuIFN0KHQsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuLAogICAgICAgICAgZSwKICAgICAgICAgIG8sCiAgICAgICAgICByLAogICAgICAgICAgaSwKICAgICAgICAgIHUgPSBhW3RdOwogICAgICAiY29udGV4dGZvcm0iID09PSB1LnR5cGUgPyAobyA9IHQsIGkgPSBhbyh1bygiQ29udGV4dEZvcm0iLCBYcCwgciA9IHUpKSwgKHNbb10gPSBpKS5sYXVuY2gubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgZFsiZm9ybToiICsgb10gPSBfbHQoX2x0KHt9LCByLmxhdW5jaCksIHsKICAgICAgICAgIHR5cGU6ICJjb250ZXh0Zm9ybXRvZ2dsZWJ1dHRvbiIgPT09IHQudHlwZSA/ICJ0b2dnbGVidXR0b24iIDogImJ1dHRvbiIsCiAgICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gb25BY3Rpb24oKSB7CiAgICAgICAgICAgIGMoaSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pLCAoImVkaXRvciIgPT09IGkuc2NvcGUgPyBmIDogbCkucHVzaChpKSwgbVtvXSA9IGkpIDogImNvbnRleHR0b29sYmFyIiA9PT0gdS50eXBlICYmIChuID0gdCwgdW8oIkNvbnRleHRUb29sYmFyIiwgWXAsIGUgPSB1KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgKCJlZGl0b3IiID09PSBlLnNjb3BlID8gZiA6IGwpLnB1c2godCksIG1bbl0gPSB0OwogICAgICB9KSk7CiAgICB9KSwgewogICAgICBmb3JtczogcywKICAgICAgaW5Ob2RlU2NvcGU6IGwsCiAgICAgIGluRWRpdG9yU2NvcGU6IGYsCiAgICAgIGxvb2t1cFRhYmxlOiBtLAogICAgICBmb3JtTmF2aWdhdG9yczogZAogICAgfTsKICB9CgogIGZ1bmN0aW9uIGxfKGQsIHQsIG0sIHUpIHsKICAgIGZ1bmN0aW9uIGEoKSB7CiAgICAgIHZhciB0ID0geS5nZXQoKS5nZXRPcigibm9kZSIpLAogICAgICAgICAgbiA9IGlfKHQpID8gMSA6IDA7CiAgICAgIHJldHVybiByXyhkLCBwLCB0LCBuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjKCkgewogICAgICByZXR1cm4gIShkLnJlbW92ZWQgfHwgaCgpICYmIGcuaXNDb250ZXh0TWVudU9wZW4oKSk7CiAgICB9CgogICAgZnVuY3Rpb24gcygpIHsKICAgICAgaWYgKGMoKSkgewogICAgICAgIHZhciB0ID0gYSgpLAogICAgICAgICAgICBuID0gbXQoeS5nZXQoKSwgIm5vZGUiKSA/IChlID0gZCwgdi5nZXQoKS5maWx0ZXIoaGUpLm1hcCh6bikuZ2V0T3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gb18oZSk7CiAgICAgICAgfSkpIDogb18oZCk7CiAgICAgICAgcmV0dXJuIHQuaGVpZ2h0IDw9IDAgfHwgIWVfKG4sIHQpOwogICAgICB9CgogICAgICByZXR1cm4gMTsKICAgICAgdmFyIGU7CiAgICB9CgogICAgZnVuY3Rpb24gbigpIHsKICAgICAgdi5jbGVhcigpLCBiLmNsZWFyKCksIHkuY2xlYXIoKSwgcnAuaGlkZSh4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBlKCkgewogICAgICB2YXIgdDsKICAgICAgcnAuaXNPcGVuKHgpICYmICh2bih0ID0geC5lbGVtZW50LCAiZGlzcGxheSIpLCBzKCkgPyBmbih0LCAiZGlzcGxheSIsICJub25lIikgOiAoYi5zZXQoMCksIHJwLnJlcG9zaXRpb24oeCkpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBsKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1wb3BfX2RpYWxvZyJdCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiBbdF0sCiAgICAgICAgYmVoYXZpb3VyczogdGMoW01nLmNvbmZpZyh7CiAgICAgICAgICBtb2RlOiAiYWN5Y2xpYyIKICAgICAgICB9KSwgZm0oInBvcC1kaWFsb2ctd3JhcC1ldmVudHMiLCBbZXUoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGQuc2hvcnRjdXRzLmFkZCgiY3RybCtGOSIsICJmb2N1cyBzdGF0dXNiYXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBNZy5mb2N1c0luKHQpOwogICAgICAgICAgfSk7CiAgICAgICAgfSksIG91KGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBkLnNob3J0Y3V0cy5yZW1vdmUoImN0cmwrRjkiKTsKICAgICAgICB9KV0pXSkKICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBmKHQsIG4pIHsKICAgICAgdmFyIGUsCiAgICAgICAgICBvLAogICAgICAgICAgciwKICAgICAgICAgIGksCiAgICAgICAgICBjLAogICAgICAgICAgcywKICAgICAgICAgIHUsCiAgICAgICAgICBhID0gIm5vZGUiID09PSB0ID8gcC5hbmNob3JzLm5vZGUobikgOiBwLmFuY2hvcnMuY3Vyc29yKCksCiAgICAgICAgICBsID0gKGUgPSBkLCBvID0gdCwgciA9IGgoKSwgaSA9IHsKICAgICAgICBsYXN0RWxlbWVudDogdi5nZXQsCiAgICAgICAgaXNSZXBvc2l0aW9uOiBmdW5jdGlvbiBpc1JlcG9zaXRpb24oKSB7CiAgICAgICAgICByZXR1cm4gbXQoYi5nZXQoKSwgMCk7CiAgICAgICAgfSwKICAgICAgICBnZXRNb2RlOiBmdW5jdGlvbiBnZXRNb2RlKCkgewogICAgICAgICAgcmV0dXJuIHNmLmdldE1vZGUobSk7CiAgICAgICAgfQogICAgICB9LCAibGluZSIgPT09IG8gPyB7CiAgICAgICAgYnViYmxlOiB4YygxMiwgMCwgUF8pLAogICAgICAgIGxheW91dHM6IHsKICAgICAgICAgIG9uTHRyOiBmdW5jdGlvbiBvbkx0cigpIHsKICAgICAgICAgICAgcmV0dXJuIFtzYV07CiAgICAgICAgICB9LAogICAgICAgICAgb25SdGw6IGZ1bmN0aW9uIG9uUnRsKCkgewogICAgICAgICAgICByZXR1cm4gW2xhXTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG92ZXJyaWRlczogSF8KICAgICAgfSA6IHsKICAgICAgICBidWJibGU6IHhjKDAsIDEyLCBQXywgMSAvIDEyKSwKICAgICAgICBsYXlvdXRzOiAoYyA9IGUsIHMgPSBpLCB1ID0gbywgciA/IHsKICAgICAgICAgIG9uTHRyOiBmdW5jdGlvbiBvbkx0cih0KSB7CiAgICAgICAgICAgIHJldHVybiBbSmEsIEdhLCBYYSwgWWEsIHFhLCBLYV0uY29uY2F0KGYodCkpOwogICAgICAgICAgfSwKICAgICAgICAgIG9uUnRsOiBmdW5jdGlvbiBvblJ0bCh0KSB7CiAgICAgICAgICAgIHJldHVybiBbSmEsIFhhLCBHYSwgcWEsIFlhLCBLYV0uY29uY2F0KGYodCkpOwogICAgICAgICAgfQogICAgICAgIH0gOiB7CiAgICAgICAgICBvbkx0cjogZnVuY3Rpb24gb25MdHIodCkgewogICAgICAgICAgICByZXR1cm4gW0thLCBKYSwgWWEsIEdhLCBxYSwgWGFdLmNvbmNhdChmKHQpKTsKICAgICAgICAgIH0sCiAgICAgICAgICBvblJ0bDogZnVuY3Rpb24gb25SdGwodCkgewogICAgICAgICAgICByZXR1cm4gW0thLCBKYSwgcWEsIFhhLCBZYSwgR2FdLmNvbmNhdChmKHQpKTsKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBvdmVycmlkZXM6IEhfCiAgICAgIH0pOwoKICAgICAgZnVuY3Rpb24gZih0KSB7CiAgICAgICAgcmV0dXJuIGlfKHUpID8gWyhhID0gdCwgZnVuY3Rpb24gKHQsIG4sIGUsIG8sIHIpIHsKICAgICAgICAgIHZhciBpID0gdV8oYywgbywgYSwgcywgciksCiAgICAgICAgICAgICAgdSA9IF9sdChfbHQoe30sIHQpLCB7CiAgICAgICAgICAgIHk6IHIueSwKICAgICAgICAgICAgaGVpZ2h0OiByLmhlaWdodAogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuIF9sdChfbHQoe30sIGkodSwgbiwgZSwgbywgcikpLCB7CiAgICAgICAgICAgIGFsd2F5c0ZpdDogITAKICAgICAgICAgIH0pOwogICAgICAgIH0pXSA6IFtdOwogICAgICAgIHZhciBhOwogICAgICB9CgogICAgICByZXR1cm4gWG8oYSwgbCk7CiAgICB9CgogICAgZnVuY3Rpb24gbyh0LCBuKSB7CiAgICAgIHZhciBlLCBvLCByLCBpOwogICAgICBDLmNhbmNlbCgpLCBjKCkgJiYgKGUgPSBTKHQpLCByID0gZihvID0gdFswXS5wb3NpdGlvbiwgbiksIHkuc2V0KG8pLCBiLnNldCgxKSwgdm4oaSA9IHguZWxlbWVudCwgImRpc3BsYXkiKSwgbXQoRXQobiwgdi5nZXQoKSwgTHQpLCAhMCkgfHwgKFlyKGksIFVfKSwgc2YucmVzZXQobSwgeCkpLCBycC5zaG93V2l0aGluQm91bmRzKHgsIGwoZSksIHsKICAgICAgICBhbmNob3I6IHIsCiAgICAgICAgdHJhbnNpdGlvbjogewogICAgICAgICAgY2xhc3NlczogW1VfXSwKICAgICAgICAgIG1vZGU6ICJwbGFjZW1lbnQiCiAgICAgICAgfQogICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHZ0LnNvbWUoYSgpKTsKICAgICAgfSksIG4uZm9sZCh2LmNsZWFyLCB2LnNldCksIHMoKSAmJiBmbihpLCAiZGlzcGxheSIsICJub25lIikpOwogICAgfQoKICAgIHZhciByLAogICAgICAgIGksCiAgICAgICAgZyA9IHUuYmFja3N0YWdlLAogICAgICAgIHAgPSBnLnNoYXJlZCwKICAgICAgICBoID0gc2UoKS5kZXZpY2VUeXBlLmlzVG91Y2gsCiAgICAgICAgdiA9IGRjKCksCiAgICAgICAgYiA9IGRjKCksCiAgICAgICAgeSA9IGRjKCksCiAgICAgICAgeCA9IF91KChyID0gewogICAgICBzaW5rOiBtLAogICAgICBvbkVzY2FwZTogZnVuY3Rpb24gb25Fc2NhcGUoKSB7CiAgICAgICAgcmV0dXJuIGQuZm9jdXMoKSwgdnQuc29tZSghMCk7CiAgICAgIH0KICAgIH0sIGkgPSBWbyhbXSksIHJwLnNrZXRjaCh7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtcG9wIl0KICAgICAgfSwKICAgICAgZmlyZURpc21pc3NhbEV2ZW50SW5zdGVhZDogewogICAgICAgIGV2ZW50OiAiZG9Ob3REaXNtaXNzWWV0IgogICAgICB9LAogICAgICBvblNob3c6IGZ1bmN0aW9uIG9uU2hvdyh0KSB7CiAgICAgICAgaS5zZXQoW10pLCBycC5nZXRDb250ZW50KHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZuKHQuZWxlbWVudCwgInZpc2liaWxpdHkiKTsKICAgICAgICB9KSwgWXIodC5lbGVtZW50LCBXXyksIHZuKHQuZWxlbWVudCwgIndpZHRoIik7CiAgICAgIH0sCiAgICAgIGlubGluZUJlaGF2aW91cnM6IHRjKFtmbSgiY29udGV4dC10b29sYmFyLWV2ZW50cyIsIFtEcihPaSgpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICJ3aWR0aCIgPT09IG4uZXZlbnQucmF3LnByb3BlcnR5TmFtZSAmJiAoWXIodC5lbGVtZW50LCBXXyksIHZuKHQuZWxlbWVudCwgIndpZHRoIikpOwogICAgICB9KSwgQ3IoTF8sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgdmFyIGUgPSB0LmVsZW1lbnQ7CiAgICAgICAgdm4oZSwgIndpZHRoIik7CiAgICAgICAgdmFyIG8gPSBrbihlKTsKICAgICAgICBycC5zZXRDb250ZW50KHQsIG4uZXZlbnQuY29udGVudHMpLCBYcihlLCBXXyk7CiAgICAgICAgdmFyIHIgPSBrbihlKTsKICAgICAgICBmbihlLCAid2lkdGgiLCBvICsgInB4IiksIHJwLmdldENvbnRlbnQodCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgbi5ldmVudC5mb2N1cy5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiBTYSh0KSwgT2EoZSk7CiAgICAgICAgICB9KS5vclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIE1nLmZvY3VzSW4odCksIGthKG1lKGUpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pLCBjcC5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGZuKHQuZWxlbWVudCwgIndpZHRoIiwgciArICJweCIpOwogICAgICAgIH0sIDApOwogICAgICB9KSwgQ3Ioel8sIGZ1bmN0aW9uIChuLCB0KSB7CiAgICAgICAgcnAuZ2V0Q29udGVudChuKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBpLnNldChpLmdldCgpLmNvbmNhdChbewogICAgICAgICAgICBiYXI6IHQsCiAgICAgICAgICAgIGZvY3VzOiBrYShtZShuLmVsZW1lbnQpKQogICAgICAgICAgfV0pKTsKICAgICAgICB9KSwgdnIobiwgTF8sIHsKICAgICAgICAgIGNvbnRlbnRzOiB0LmV2ZW50LmZvcndhcmRDb250ZW50cywKICAgICAgICAgIGZvY3VzOiB2dC5ub25lKCkKICAgICAgICB9KTsKICAgICAgfSksIENyKE5fLCBmdW5jdGlvbiAobiwgdCkgewogICAgICAgIHEoaS5nZXQoKSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgaS5zZXQoaS5nZXQoKS5zbGljZSgwLCBpLmdldCgpLmxlbmd0aCAtIDEpKSwgdnIobiwgTF8sIHsKICAgICAgICAgICAgY29udGVudHM6IFR1KHQuYmFyKSwKICAgICAgICAgICAgZm9jdXM6IHQuZm9jdXMKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KV0pLCBNZy5jb25maWcoewogICAgICAgIG1vZGU6ICJzcGVjaWFsIiwKICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gb25Fc2NhcGUobikgewogICAgICAgICAgcmV0dXJuIHEoaS5nZXQoKSkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiByLm9uRXNjYXBlKCk7CiAgICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gaHIobiwgTl8pLCB2dC5zb21lKCEwKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSldKSwKICAgICAgbGF6eVNpbms6IGZ1bmN0aW9uIGxhenlTaW5rKCkgewogICAgICAgIHJldHVybiBSZS52YWx1ZShyLnNpbmspOwogICAgICB9CiAgICB9KSkpLAogICAgICAgIHcgPSBSdChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBzXyh0LCBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBuID0gUyhbdF0pOwogICAgICAgIHZyKHgsIHpfLCB7CiAgICAgICAgICBmb3J3YXJkQ29udGVudHM6IGwobikKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KSwKICAgICAgICBTID0gZnVuY3Rpb24gUyh0KSB7CiAgICAgIHZhciBuID0gZC51aS5yZWdpc3RyeS5nZXRBbGwoKS5idXR0b25zLAogICAgICAgICAgZSA9IHcoKSwKICAgICAgICAgIG8gPSBfbHQoX2x0KHt9LCBuKSwgZS5mb3JtTmF2aWdhdG9ycyksCiAgICAgICAgICByID0gb3YoZCkgPT09IGhoLnNjcm9sbGluZyA/IGhoLnNjcm9sbGluZyA6IGhoLmRlZmF1bHQsCiAgICAgICAgICBpID0gZnQoTSh0LCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiAiY29udGV4dHRvb2xiYXIiID09PSB0LnR5cGUgPyBCXyhkLCB7CiAgICAgICAgICBidXR0b25zOiBvLAogICAgICAgICAgdG9vbGJhcjogdC5pdGVtcywKICAgICAgICAgIGFsbG93VG9vbGJhckdyb3VwczogITEKICAgICAgICB9LCB1LCB2dC5zb21lKFsiZm9ybToiXSkpIDogKG4gPSBwLnByb3ZpZGVycywgVl8odCwgbikpOwogICAgICAgIHZhciBuOwogICAgICB9KSk7CgogICAgICByZXR1cm4gUmsoewogICAgICAgIHR5cGU6IHIsCiAgICAgICAgdWlkOiBGcigiY29udGV4dC10b29sYmFyIiksCiAgICAgICAgaW5pdEdyb3VwczogaSwKICAgICAgICBvbkVzY2FwZTogdnQubm9uZSwKICAgICAgICBjeWNsaWNLZXlpbmc6ICEwLAogICAgICAgIHByb3ZpZGVyczogcC5wcm92aWRlcnMKICAgICAgfSk7CiAgICB9LAogICAgICAgIEMgPSBwcChmdW5jdGlvbiAoKSB7CiAgICAgIGQuaGFzRm9jdXMoKSAmJiAhZC5yZW1vdmVkICYmIChxcih4LmVsZW1lbnQsIFVfKSA/IEMudGhyb3R0bGUoKSA6IGNfKHcoKSwgZCkuZm9sZChuLCBmdW5jdGlvbiAodCkgewogICAgICAgIG8odC50b29sYmFycywgdnQuc29tZSh0LmVsZW0pKTsKICAgICAgfSkpOwogICAgfSwgMTcpOwoKICAgIGQub24oImluaXQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGQub24oInJlbW92ZSIsIG4pLCBkLm9uKCJTY3JvbGxDb250ZW50IFNjcm9sbFdpbmRvdyBPYmplY3RSZXNpemVkIFJlc2l6ZUVkaXRvciBsb25ncHJlc3MiLCBlKSwgZC5vbigiY2xpY2sga2V5dXAgZm9jdXMgU2V0Q29udGVudCIsIEMudGhyb3R0bGUpLCBkLm9uKFJfLCBuKSwgZC5vbigiY29udGV4dHRvb2xiYXItc2hvdyIsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgdHQodygpLmxvb2t1cFRhYmxlLCBuLnRvb2xiYXJLZXkpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIG8oW3RdLCBvdChuLnRhcmdldCAhPT0gZCwgbi50YXJnZXQpKSwgcnAuZ2V0Q29udGVudCh4KS5lYWNoKE1nLmZvY3VzSW4pOwogICAgICAgIH0pOwogICAgICB9KSwgZC5vbigiZm9jdXNvdXQiLCBmdW5jdGlvbiAodCkgewogICAgICAgIGNwLnNldEVkaXRvclRpbWVvdXQoZCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgT2EobS5lbGVtZW50KS5pc05vbmUoKSAmJiBPYSh4LmVsZW1lbnQpLmlzTm9uZSgpICYmIG4oKTsKICAgICAgICB9LCAwKTsKICAgICAgfSksIGQub24oIlN3aXRjaE1vZGUiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgZC5tb2RlLmlzUmVhZE9ubHkoKSAmJiBuKCk7CiAgICAgIH0pLCBkLm9uKCJBZnRlclByb2dyZXNzU3RhdGUiLCBmdW5jdGlvbiAodCkgewogICAgICAgIHQuc3RhdGUgPyBuKCkgOiBkLmhhc0ZvY3VzKCkgJiYgQy50aHJvdHRsZSgpOwogICAgICB9KSwgZC5vbigiTm9kZUNoYW5nZSIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgT2EoeC5lbGVtZW50KS5mb2xkKEMudGhyb3R0bGUsIHN0KTsKICAgICAgfSk7CiAgICB9KTsKICB9CgogIChRayA9ICRrID0gJGsgfHwge30pW1FrLlNlbWlDb2xvbiA9IDBdID0gIlNlbWlDb2xvbiIsIFFrW1FrLlNwYWNlID0gMV0gPSAiU3BhY2UiOwoKICB2YXIgZl8sCiAgICAgIGRfLAogICAgICBtXywKICAgICAgZ18gPSBbewogICAgdGl0bGU6ICJMZWZ0IiwKICAgIGljb246ICJhbGlnbi1sZWZ0IiwKICAgIGZvcm1hdDogImFsaWdubGVmdCIsCiAgICBjb21tYW5kOiAiSnVzdGlmeUxlZnQiCiAgfSwgewogICAgdGl0bGU6ICJDZW50ZXIiLAogICAgaWNvbjogImFsaWduLWNlbnRlciIsCiAgICBmb3JtYXQ6ICJhbGlnbmNlbnRlciIsCiAgICBjb21tYW5kOiAiSnVzdGlmeUNlbnRlciIKICB9LCB7CiAgICB0aXRsZTogIlJpZ2h0IiwKICAgIGljb246ICJhbGlnbi1yaWdodCIsCiAgICBmb3JtYXQ6ICJhbGlnbnJpZ2h0IiwKICAgIGNvbW1hbmQ6ICJKdXN0aWZ5UmlnaHQiCiAgfSwgewogICAgdGl0bGU6ICJKdXN0aWZ5IiwKICAgIGljb246ICJhbGlnbi1qdXN0aWZ5IiwKICAgIGZvcm1hdDogImFsaWduanVzdGlmeSIsCiAgICBjb21tYW5kOiAiSnVzdGlmeUZ1bGwiCiAgfV0sCiAgICAgIHBfID0gWyItYXBwbGUtc3lzdGVtIiwgIlNlZ29lIFVJIiwgIlJvYm90byIsICJIZWx2ZXRpY2EgTmV1ZSIsICJzYW5zLXNlcmlmIl0sCiAgICAgIGhfID0gewogICAgIjhwdCI6ICIxIiwKICAgICIxMHB0IjogIjIiLAogICAgIjEycHQiOiAiMyIsCiAgICAiMTRwdCI6ICI0IiwKICAgICIxOHB0IjogIjUiLAogICAgIjI0cHQiOiAiNiIsCiAgICAiMzZwdCI6ICI3IgogIH0sCiAgICAgIHZfID0gewogICAgInh4LXNtYWxsIjogIjdwdCIsCiAgICAieC1zbWFsbCI6ICI4cHQiLAogICAgc21hbGw6ICIxMHB0IiwKICAgIG1lZGl1bTogIjEycHQiLAogICAgbGFyZ2U6ICIxNHB0IiwKICAgICJ4LWxhcmdlIjogIjE4cHQiLAogICAgInh4LWxhcmdlIjogIjI0cHQiCiAgfSwKICAgICAgYl8gPSBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGV2ZW50czogZnVuY3Rpb24gZXZlbnRzKHIsIGkpIHsKICAgICAgZnVuY3Rpb24gdShlLCBvKSB7CiAgICAgICAgci51cGRhdGVTdGF0ZS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgbiA9IHQoZSwgbyk7CiAgICAgICAgICBpLnNldChuKTsKICAgICAgICB9KSwgci5yZW5kZXJDb21wb25lbnRzLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gTSh0KG8sIGkuZ2V0KCkpLCBlLmdldFN5c3RlbSgpLmJ1aWxkKTsKICAgICAgICAgIEZzKGUsIG4pOwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gbnUoW0NyKEFpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgdmFyIGUsCiAgICAgICAgICAgIG8gPSBuOwogICAgICAgIG8udW5pdmVyc2FsIHx8IChlID0gci5jaGFubmVsLCB3dChvLmNoYW5uZWxzLCBlKSAmJiB1KHQsIG8uZGF0YSkpOwogICAgICB9KSwgZXUoZnVuY3Rpb24gKG4sIHQpIHsKICAgICAgICByLmluaXRpYWxEYXRhLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHUobiwgdCk7CiAgICAgICAgfSk7CiAgICAgIH0pXSk7CiAgICB9CiAgfSksCiAgICAgIHlfID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZXRTdGF0ZTogZnVuY3Rpb24gZ2V0U3RhdGUodCwgbiwgZSkgewogICAgICByZXR1cm4gZTsKICAgIH0KICB9KSwKICAgICAgeF8gPSB5YSh7CiAgICBmaWVsZHM6IFtmbygiY2hhbm5lbCIpLCB4bygicmVuZGVyQ29tcG9uZW50cyIpLCB4bygidXBkYXRlU3RhdGUiKSwgeG8oImluaXRpYWxEYXRhIildLAogICAgbmFtZTogInJlZmxlY3RpbmciLAogICAgYWN0aXZlOiBiXywKICAgIGFwaXM6IHlfLAogICAgc3RhdGU6IE9iamVjdC5mcmVlemUoewogICAgICBfX3Byb3RvX186IG51bGwsCiAgICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdmFyIHQgPSBWbyh2dC5ub25lKCkpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICByZWFkU3RhdGU6IGZ1bmN0aW9uIHJlYWRTdGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHQuZ2V0KCkuZ2V0T3IoIm5vbmUiKTsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXQ6IHQuZ2V0LAogICAgICAgICAgc2V0OiB0LnNldCwKICAgICAgICAgIGNsZWFyOiBmdW5jdGlvbiBjbGVhcigpIHsKICAgICAgICAgICAgcmV0dXJuIHQuc2V0KHZ0Lm5vbmUoKSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQogICAgfSkKICB9KSwKICAgICAgd18gPSBydChbZm8oInRvZ2dsZUNsYXNzIiksIGZvKCJmZXRjaCIpLCAkdSgib25FeGVjdXRlIiksIFRvKCJnZXRIb3RzcG90IiwgdnQuc29tZSksIFRvKCJnZXRBbmNob3JPdmVycmlkZXMiLCBydCh7fSkpLCBOYygpLCAkdSgib25JdGVtRXhlY3V0ZSIpLCB4bygibGF6eVNpbmsiKSwgZm8oImRvbSIpLCBLdSgib25PcGVuIiksICRzKCJzcGxpdERyb3Bkb3duQmVoYXZpb3VycyIsIFtZeSwgTWcsIFZnXSksIFRvKCJtYXRjaFdpZHRoIiwgITEpLCBUbygidXNlTWluV2lkdGgiLCAhMSksIFRvKCJldmVudE9yZGVyIiwge30pLCB4bygicm9sZSIpXS5jb25jYXQoZXgoKSkpLAogICAgICBTXyA9IHJ0KFtxZih7CiAgICBmYWN0b3J5OiBzcCwKICAgIHNjaGVtYTogW2ZvKCJkb20iKV0sCiAgICBuYW1lOiAiYXJyb3ciLAogICAgZGVmYXVsdHM6IGZ1bmN0aW9uIGRlZmF1bHRzKCkgewogICAgICByZXR1cm4gewogICAgICAgIGJ1dHRvbkJlaGF2aW91cnM6IHRjKFtWZy5yZXZva2UoKV0pCiAgICAgIH07CiAgICB9LAogICAgb3ZlcnJpZGVzOiBmdW5jdGlvbiBvdmVycmlkZXMobikgewogICAgICByZXR1cm4gewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAic3BhbiIsCiAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgIHJvbGU6ICJwcmVzZW50YXRpb24iCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIGFjdGlvbih0KSB7CiAgICAgICAgICB0LmdldFN5c3RlbSgpLmdldEJ5VWlkKG4udWlkKS5lYWNoKGJyKTsKICAgICAgICB9LAogICAgICAgIGJ1dHRvbkJlaGF2aW91cnM6IHRjKFt6Zy5jb25maWcoewogICAgICAgICAgdG9nZ2xlT25FeGVjdXRlOiAhMSwKICAgICAgICAgIHRvZ2dsZUNsYXNzOiBuLnRvZ2dsZUNsYXNzCiAgICAgICAgfSldKQogICAgICB9OwogICAgfQogIH0pLCBxZih7CiAgICBmYWN0b3J5OiBzcCwKICAgIHNjaGVtYTogW2ZvKCJkb20iKV0sCiAgICBuYW1lOiAiYnV0dG9uIiwKICAgIGRlZmF1bHRzOiBmdW5jdGlvbiBkZWZhdWx0cygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBidXR0b25CZWhhdmlvdXJzOiB0YyhbVmcucmV2b2tlKCldKQogICAgICB9OwogICAgfSwKICAgIG92ZXJyaWRlczogZnVuY3Rpb24gb3ZlcnJpZGVzKGUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogInNwYW4iLAogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICByb2xlOiAicHJlc2VudGF0aW9uIgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiBhY3Rpb24obikgewogICAgICAgICAgbi5nZXRTeXN0ZW0oKS5nZXRCeVVpZChlLnVpZCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICBlLm9uRXhlY3V0ZSh0LCBuKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9KSwgSmYoewogICAgZmFjdG9yeTogewogICAgICBza2V0Y2g6IGZ1bmN0aW9uIHNrZXRjaCh0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHVpZDogdC51aWQsCiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAic3BhbiIsCiAgICAgICAgICAgIHN0eWxlczogewogICAgICAgICAgICAgIGRpc3BsYXk6ICJub25lIgogICAgICAgICAgICB9LAogICAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgICAgImFyaWEtaGlkZGVuIjogInRydWUiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlubmVySHRtbDogdC50ZXh0CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQogICAgfSwKICAgIHNjaGVtYTogW2ZvKCJ0ZXh0IildLAogICAgbmFtZTogImFyaWEtZGVzY3JpcHRvciIKICB9KSwgS2YoewogICAgc2NoZW1hOiBbWHUoKV0sCiAgICBuYW1lOiAibWVudSIsCiAgICBkZWZhdWx0czogZnVuY3Rpb24gZGVmYXVsdHMobykgewogICAgICByZXR1cm4gewogICAgICAgIG9uRXhlY3V0ZTogZnVuY3Rpb24gb25FeGVjdXRlKG4sIGUpIHsKICAgICAgICAgIG4uZ2V0U3lzdGVtKCkuZ2V0QnlVaWQoby51aWQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgby5vbkl0ZW1FeGVjdXRlKHQsIG4sIGUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0pLCBLeSgpXSksCiAgICAgIENfID0gU2woewogICAgbmFtZTogIlNwbGl0RHJvcGRvd24iLAogICAgY29uZmlnRmllbGRzOiB3XygpLAogICAgcGFydEZpZWxkczogU18oKSwKICAgIGZhY3Rvcnk6IGZ1bmN0aW9uIGZhY3RvcnkobywgdCwgbiwgZSkgewogICAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgICB1ZC5nZXRDdXJyZW50KHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGdkLmhpZ2hsaWdodEZpcnN0KHQpLCBNZy5mb2N1c0luKHQpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpKHQpIHsKICAgICAgICBReShvLCBoLCB0LCBlLCByLCBJeS5IaWdobGlnaHRGaXJzdCkuZ2V0KHN0KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gdSh0KSB7CiAgICAgICAgcmV0dXJuIGJyKGRsKHQsIG8sICJidXR0b24iKSksIHZ0LnNvbWUoITApOwogICAgICB9CgogICAgICB2YXIgYSwKICAgICAgICAgIGMgPSBfbHQoX2x0KHt9LCBudShbZXUoZnVuY3Rpb24gKGUsIHQpIHsKICAgICAgICBmbChlLCBvLCAiYXJpYS1kZXNjcmlwdG9yIikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIG4gPSBGcigiYXJpYSIpOwogICAgICAgICAgb24odC5lbGVtZW50LCAiaWQiLCBuKSwgb24oZS5lbGVtZW50LCAiYXJpYS1kZXNjcmliZWRieSIsIG4pOwogICAgICAgIH0pOwogICAgICB9KV0pKSwgeG0odnQuc29tZShpKSkpLAogICAgICAgICAgcyA9IHsKICAgICAgICByZXBvc2l0aW9uTWVudXM6IGZ1bmN0aW9uIHJlcG9zaXRpb25NZW51cyh0KSB7CiAgICAgICAgICB6Zy5pc09uKHQpICYmIG54KHQpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgdWlkOiBvLnVpZCwKICAgICAgICBkb206IG8uZG9tLAogICAgICAgIGNvbXBvbmVudHM6IHQsCiAgICAgICAgYXBpczogcywKICAgICAgICBldmVudE9yZGVyOiBfbHQoX2x0KHt9LCBvLmV2ZW50T3JkZXIpLCAoKGEgPSB7fSlbRmkoKV0gPSBbImRpc2FibGluZyIsICJ0b2dnbGluZyIsICJhbGxveS5iYXNlLmJlaGF2aW91ciJdLCBhKSksCiAgICAgICAgZXZlbnRzOiBjLAogICAgICAgIGJlaGF2aW91cnM6IFpzKG8uc3BsaXREcm9wZG93bkJlaGF2aW91cnMsIFtZeS5jb25maWcoewogICAgICAgICAgb3RoZXJzOiB7CiAgICAgICAgICAgIHNhbmRib3g6IGZ1bmN0aW9uIHNhbmRib3godCkgewogICAgICAgICAgICAgIHZhciBuID0gZGwodCwgbywgImFycm93Iik7CiAgICAgICAgICAgICAgcmV0dXJuIHR4KG8sIHQsIHsKICAgICAgICAgICAgICAgIG9uT3BlbjogZnVuY3Rpb24gb25PcGVuKCkgewogICAgICAgICAgICAgICAgICB6Zy5vbihuKSwgemcub24odCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24gb25DbG9zZSgpIHsKICAgICAgICAgICAgICAgICAgemcub2ZmKG4pLCB6Zy5vZmYodCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSwgTWcuY29uZmlnKHsKICAgICAgICAgIG1vZGU6ICJzcGVjaWFsIiwKICAgICAgICAgIG9uU3BhY2U6IHUsCiAgICAgICAgICBvbkVudGVyOiB1LAogICAgICAgICAgb25Eb3duOiBmdW5jdGlvbiBvbkRvd24odCkgewogICAgICAgICAgICByZXR1cm4gaSh0KSwgdnQuc29tZSghMCk7CiAgICAgICAgICB9CiAgICAgICAgfSksIFZnLmNvbmZpZyh7fSksIHpnLmNvbmZpZyh7CiAgICAgICAgICB0b2dnbGVPbkV4ZWN1dGU6ICExLAogICAgICAgICAgYXJpYTogewogICAgICAgICAgICBtb2RlOiAiZXhwYW5kZWQiCiAgICAgICAgICB9CiAgICAgICAgfSldKSwKICAgICAgICBkb21Nb2RpZmljYXRpb246IHsKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgcm9sZTogby5yb2xlLmdldE9yKCJidXR0b24iKSwKICAgICAgICAgICAgImFyaWEtaGFzcG9wdXAiOiAhMAogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0sCiAgICBhcGlzOiB7CiAgICAgIHJlcG9zaXRpb25NZW51czogZnVuY3Rpb24gcmVwb3NpdGlvbk1lbnVzKHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5yZXBvc2l0aW9uTWVudXMobik7CiAgICAgIH0KICAgIH0KICB9KSwKICAgICAga18gPSBGcigiZm9jdXMtYnV0dG9uIiksCiAgICAgIE9fID0gZnVuY3Rpb24gT18odCwgbiwgZSkgewogICAgcmV0dXJuIFhPKHQsIHsKICAgICAgdG9vbGJhckJ1dHRvbkJlaGF2aW91cnM6IFtdLmNvbmNhdCgwIDwgZS5sZW5ndGggPyBbZm0oInRvb2xiYXJCdXR0b25XaXRoIiwgZSldIDogW10pLAogICAgICBnZXRBcGk6IFdPLAogICAgICBvblNldHVwOiB0Lm9uU2V0dXAKICAgIH0sIG4pOwogIH0sCiAgICAgIF9fID0gZnVuY3Rpb24gX18odCwgbiwgZSkgewogICAgcmV0dXJuIFhvKFhPKHQsIHsKICAgICAgdG9vbGJhckJ1dHRvbkJlaGF2aW91cnM6IFtGZy5jb25maWcoe30pLCB6Zy5jb25maWcoewogICAgICAgIHRvZ2dsZUNsYXNzOiAidG94LXRidG4tLWVuYWJsZWQiLAogICAgICAgIGFyaWE6IHsKICAgICAgICAgIG1vZGU6ICJwcmVzc2VkIgogICAgICAgIH0sCiAgICAgICAgdG9nZ2xlT25FeGVjdXRlOiAhMQogICAgICB9KV0uY29uY2F0KDAgPCBlLmxlbmd0aCA/IFtmbSgidG9vbGJhclRvZ2dsZUJ1dHRvbldpdGgiLCBlKV0gOiBbXSksCiAgICAgIGdldEFwaTogVU8sCiAgICAgIG9uU2V0dXA6IHQub25TZXR1cAogICAgfSwgbikpOwogIH0sCiAgICAgIFRfID0gW3sKICAgIG5hbWU6ICJoaXN0b3J5IiwKICAgIGl0ZW1zOiBbInVuZG8iLCAicmVkbyJdCiAgfSwgewogICAgbmFtZTogInN0eWxlcyIsCiAgICBpdGVtczogWyJzdHlsZXNlbGVjdCJdCiAgfSwgewogICAgbmFtZTogImZvcm1hdHRpbmciLAogICAgaXRlbXM6IFsiYm9sZCIsICJpdGFsaWMiXQogIH0sIHsKICAgIG5hbWU6ICJhbGlnbm1lbnQiLAogICAgaXRlbXM6IFsiYWxpZ25sZWZ0IiwgImFsaWduY2VudGVyIiwgImFsaWducmlnaHQiLCAiYWxpZ25qdXN0aWZ5Il0KICB9LCB7CiAgICBuYW1lOiAiaW5kZW50YXRpb24iLAogICAgaXRlbXM6IFsib3V0ZGVudCIsICJpbmRlbnQiXQogIH0sIHsKICAgIG5hbWU6ICJwZXJtYW5lbnQgcGVuIiwKICAgIGl0ZW1zOiBbInBlcm1hbmVudHBlbiJdCiAgfSwgewogICAgbmFtZTogImNvbW1lbnRzIiwKICAgIGl0ZW1zOiBbImFkZGNvbW1lbnQiXQogIH1dLAogICAgICBFXyA9IHsKICAgIGJ1dHRvbjogWU8oQ3AsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiBlID0gbi5iYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycywgT18odCwgZSwgW10pOwogICAgICB2YXIgZTsKICAgIH0pLAogICAgdG9nZ2xlYnV0dG9uOiBZTyhrcCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIGUgPSBuLmJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzLCBfXyh0LCBlLCBbXSk7CiAgICAgIHZhciBlOwogICAgfSksCiAgICBtZW51YnV0dG9uOiBZTyhuaywgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIEwwKHQsICJ0b3gtdGJ0biIsIG4uYmFja3N0YWdlLCB2dC5ub25lKCkpOwogICAgfSksCiAgICBzcGxpdGJ1dHRvbjogWU8oZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHVvKCJTcGxpdEJ1dHRvbiIsIEsxLCB0KTsKICAgIH0sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiBvID0gdCwgciA9IG4uYmFja3N0YWdlLnNoYXJlZCwgcyA9IEZyKCJjaGFubmVsLXVwZGF0ZS1zcGxpdC1kcm9wZG93bi1kaXNwbGF5IiksIGwgPSBWbyhzdCksIGYgPSB7CiAgICAgICAgZ2V0QXBpOiBlLAogICAgICAgIG9uU2V0dXA6IG8ub25TZXR1cAogICAgICB9LCBDXy5za2V0Y2goewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LXNwbGl0LWJ1dHRvbiJdLAogICAgICAgICAgYXR0cmlidXRlczogX2x0KHsKICAgICAgICAgICAgImFyaWEtcHJlc3NlZCI6ICExCiAgICAgICAgICB9LCBqTyhvLnRvb2x0aXAsIHIucHJvdmlkZXJzKSkKICAgICAgICB9LAogICAgICAgIG9uRXhlY3V0ZTogZnVuY3Rpb24gb25FeGVjdXRlKHQpIHsKICAgICAgICAgIG8ub25BY3Rpb24oZSh0KSk7CiAgICAgICAgfSwKICAgICAgICBvbkl0ZW1FeGVjdXRlOiBmdW5jdGlvbiBvbkl0ZW1FeGVjdXRlKHQsIG4sIGUpIHt9LAogICAgICAgIHNwbGl0RHJvcGRvd25CZWhhdmlvdXJzOiB0YyhbR3Yoci5wcm92aWRlcnMuaXNEaXNhYmxlZCksIG12KCksIGZtKCJzcGxpdC1kcm9wZG93bi1ldmVudHMiLCBbQ3Ioa18sIFZnLmZvY3VzKSwgcHYoZiwgbCksIGh2KGYsIGwpXSksIG13LmNvbmZpZyh7fSldKSwKICAgICAgICBldmVudE9yZGVyOiAoKGkgPSB7fSlbamkoKV0gPSBbImFsbG95LmJhc2UuYmVoYXZpb3VyIiwgInNwbGl0LWRyb3Bkb3duLWV2ZW50cyJdLCBpKSwKICAgICAgICB0b2dnbGVDbGFzczogInRveC10YnRuLS1lbmFibGVkIiwKICAgICAgICBsYXp5U2luazogci5nZXRTaW5rLAogICAgICAgIGZldGNoOiAodSA9IGUsIGEgPSBvLCBjID0gci5wcm92aWRlcnMsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICByZXR1cm4gTnkoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIGEuZmV0Y2godCk7CiAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHZ0LmZyb20oV2IoWG8oQ2IoRnIoIm1lbnUtdmFsdWUiKSwgdCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBhLm9uSXRlbUFjdGlvbih1KG4pLCB0KTsKICAgICAgICAgICAgfSwgYS5jb2x1bW5zLCBhLnByZXNldHMsIHhoLkNMT1NFX09OX0VYRUNVVEUsIGEuc2VsZWN0LmdldE9yKE8pLCBjKSwgewogICAgICAgICAgICAgIG1vdmVtZW50OiBrYihhLmNvbHVtbnMsIGEucHJlc2V0cyksCiAgICAgICAgICAgICAgbWVudUJlaGF2aW91cnM6IFloKCJhdXRvIiAhPT0gYS5jb2x1bW5zID8gW10gOiBbZXUoZnVuY3Rpb24gKG8sIHQpIHsKICAgICAgICAgICAgICAgIGloKG8sIDQsIHFwKGEucHJlc2V0cykpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgdmFyIG4gPSB0Lm51bVJvd3MsCiAgICAgICAgICAgICAgICAgICAgICBlID0gdC5udW1Db2x1bW5zOwogICAgICAgICAgICAgICAgICBNZy5zZXRHcmlkU2l6ZShvLCBuLCBlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pXSkKICAgICAgICAgICAgfSkpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pLAogICAgICAgIHBhcnRzOiB7CiAgICAgICAgICBtZW51OiAkcCgwLCBvLmNvbHVtbnMsIG8ucHJlc2V0cykKICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IFtDXy5wYXJ0cy5idXR0b24oR08oby5pY29uLCBvLnRleHQsIHZ0Lm5vbmUoKSwgdnQuc29tZShzKSwgdnQuc29tZShbemcuY29uZmlnKHsKICAgICAgICAgIHRvZ2dsZUNsYXNzOiAidG94LXRidG4tLWVuYWJsZWQiLAogICAgICAgICAgdG9nZ2xlT25FeGVjdXRlOiAhMQogICAgICAgIH0pXSksIHIucHJvdmlkZXJzKSksIENfLnBhcnRzLmFycm93KHsKICAgICAgICAgIGRvbTogewogICAgICAgICAgICB0YWc6ICJidXR0b24iLAogICAgICAgICAgICBjbGFzc2VzOiBbInRveC10YnRuIiwgInRveC1zcGxpdC1idXR0b25fX2NoZXZyb24iXSwKICAgICAgICAgICAgaW5uZXJIdG1sOiBMbSgiY2hldnJvbi1kb3duIiwgci5wcm92aWRlcnMuaWNvbnMpCiAgICAgICAgICB9LAogICAgICAgICAgYnV0dG9uQmVoYXZpb3VyczogdGMoW0d2KHIucHJvdmlkZXJzLmlzRGlzYWJsZWQpLCBtdigpLCBXbSgpXSkKICAgICAgICB9KSwgQ18ucGFydHNbImFyaWEtZGVzY3JpcHRvciJdKHsKICAgICAgICAgIHRleHQ6IHIucHJvdmlkZXJzLnRyYW5zbGF0ZSgiVG8gb3BlbiB0aGUgcG9wdXAsIHByZXNzIFNoaWZ0K0VudGVyIikKICAgICAgICB9KV0KICAgICAgfSk7CgogICAgICBmdW5jdGlvbiBlKGUpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaXNEaXNhYmxlZDogZnVuY3Rpb24gaXNEaXNhYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIGRkLmlzRGlzYWJsZWQoZSk7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0RGlzYWJsZWQ6IGZ1bmN0aW9uIHNldERpc2FibGVkKHQpIHsKICAgICAgICAgICAgcmV0dXJuIGRkLnNldChlLCB0KTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXRJY29uRmlsbDogZnVuY3Rpb24gc2V0SWNvbkZpbGwodCwgbikgewogICAgICAgICAgICBGdShlLmVsZW1lbnQsICdzdmcgcGF0aFtpZD0iJyArIHQgKyAnIl0sIHJlY3RbaWQ9IicgKyB0ICsgJyJdJykuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIG9uKHQsICJmaWxsIiwgbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHNldEljb25TdHJva2U6IGZ1bmN0aW9uIHNldEljb25TdHJva2UodCwgbikgewogICAgICAgICAgICBGdShlLmVsZW1lbnQsICdzdmcgcGF0aFtpZD0iJyArIHQgKyAnIl0sIHJlY3RbaWQ9IicgKyB0ICsgJyJdJykuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIG9uKHQsICJzdHJva2UiLCBuKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0QWN0aXZlOiBmdW5jdGlvbiBzZXRBY3RpdmUobikgewogICAgICAgICAgICBvbihlLmVsZW1lbnQsICJhcmlhLXByZXNzZWQiLCBuKSwgRnUoZS5lbGVtZW50LCAic3BhbiIpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICBlLmdldFN5c3RlbSgpLmdldEJ5RG9tKHQpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB6Zy5zZXQodCwgbik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGlzQWN0aXZlOiBmdW5jdGlvbiBpc0FjdGl2ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIEZ1KGUuZWxlbWVudCwgInNwYW4iKS5leGlzdHMoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gZS5nZXRTeXN0ZW0oKS5nZXRCeURvbSh0KS5leGlzdHMoemcuaXNPbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHZhciBvLCByLCBpLCB1LCBhLCBjLCBzLCBsLCBmOwogICAgfSksCiAgICBncm91cHRvb2xiYXJidXR0b246IFlPKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB1bygiR3JvdXBUb29sYmFyQnV0dG9uIiwgWDEsIHQpOwogICAgfSwgZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgdmFyIG8sCiAgICAgICAgICByLAogICAgICAgICAgaSwKICAgICAgICAgIHUsCiAgICAgICAgICBhLAogICAgICAgICAgYywKICAgICAgICAgIHMgPSBlLnVpLnJlZ2lzdHJ5LmdldEFsbCgpLmJ1dHRvbnMsCiAgICAgICAgICBsID0gKChvID0ge30pW3RzXSA9IG4uYmFja3N0YWdlLnNoYXJlZC5oZWFkZXIuaXNQb3NpdGlvbmVkQXRUb3AoKSA/IENjLlRvcFRvQm90dG9tIDogQ2MuQm90dG9tVG9Ub3AsIG8pOwogICAgICBpZiAob3YoZSkgIT09IGhoLmZsb2F0aW5nKSB0aHJvdyBuZXcgRXJyb3IoIlRvb2xiYXIgZ3JvdXBzIGFyZSBvbmx5IHN1cHBvcnRlZCB3aGVuIHVzaW5nIGZsb2F0aW5nIHRvb2xiYXIgbW9kZSIpOwogICAgICByZXR1cm4gaSA9IG4uYmFja3N0YWdlLCB1ID0gZnVuY3Rpb24gdSh0KSB7CiAgICAgICAgcmV0dXJuIEJfKGUsIHsKICAgICAgICAgIGJ1dHRvbnM6IHMsCiAgICAgICAgICB0b29sYmFyOiB0LAogICAgICAgICAgYWxsb3dUb29sYmFyR3JvdXBzOiAhMQogICAgICAgIH0sIG4sIHZ0Lm5vbmUoKSk7CiAgICAgIH0sIGEgPSBsLCBjID0gaS5zaGFyZWQsIHBPLnNrZXRjaCh7CiAgICAgICAgbGF6eVNpbms6IGMuZ2V0U2luaywKICAgICAgICBmZXRjaDogZnVuY3Rpb24gZmV0Y2goKSB7CiAgICAgICAgICByZXR1cm4gTnkoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdChNKHUoci5pdGVtcyksIEFrKSk7CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIG1hcmtlcnM6IHsKICAgICAgICAgIHRvZ2dsZWRDbGFzczogInRveC10YnRuLS1lbmFibGVkIgogICAgICAgIH0sCiAgICAgICAgcGFydHM6IHsKICAgICAgICAgIGJ1dHRvbjogR08oKHIgPSB0KS5pY29uLCByLnRleHQsIHIudG9vbHRpcCwgdnQubm9uZSgpLCB2dC5ub25lKCksIGMucHJvdmlkZXJzKSwKICAgICAgICAgIHRvb2xiYXI6IHsKICAgICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgICBjbGFzc2VzOiBbInRveC10b29sYmFyX19vdmVyZmxvdyJdLAogICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGEKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KSwKICAgIHN0eWxlU2VsZWN0QnV0dG9uOiBmdW5jdGlvbiBzdHlsZVNlbGVjdEJ1dHRvbih0LCBuKSB7CiAgICAgIHJldHVybiBYayh0LCBlID0gbi5iYWNrc3RhZ2UsIExPKHQsIF9sdCh7CiAgICAgICAgdHlwZTogImFkdmFuY2VkIgogICAgICB9LCBlLnN0eWxlc2VsZWN0KSkpOwogICAgICB2YXIgZTsKICAgIH0sCiAgICBmb250c2l6ZVNlbGVjdEJ1dHRvbjogZnVuY3Rpb24gZm9udHNpemVTZWxlY3RCdXR0b24odCwgbikgewogICAgICByZXR1cm4gWGsodCwgbi5iYWNrc3RhZ2UsIEhPKHQpKTsKICAgIH0sCiAgICBmb250U2VsZWN0QnV0dG9uOiBmdW5jdGlvbiBmb250U2VsZWN0QnV0dG9uKHQsIG4pIHsKICAgICAgcmV0dXJuIFhrKHQsIG4uYmFja3N0YWdlLCBQTyh0KSk7CiAgICB9LAogICAgZm9ybWF0QnV0dG9uOiBmdW5jdGlvbiBmb3JtYXRCdXR0b24odCwgbikgewogICAgICByZXR1cm4gWGsodCwgbi5iYWNrc3RhZ2UsIE5PKHQpKTsKICAgIH0sCiAgICBhbGlnbk1lbnVCdXR0b246IGZ1bmN0aW9uIGFsaWduTWVudUJ1dHRvbih0LCBuKSB7CiAgICAgIHJldHVybiBYayh0LCBuLmJhY2tzdGFnZSwgUk8odCkpOwogICAgfQogIH0sCiAgICAgIERfID0gewogICAgc3R5bGVzZWxlY3Q6IEVfLnN0eWxlU2VsZWN0QnV0dG9uLAogICAgZm9udHNpemVzZWxlY3Q6IEVfLmZvbnRzaXplU2VsZWN0QnV0dG9uLAogICAgZm9udHNlbGVjdDogRV8uZm9udFNlbGVjdEJ1dHRvbiwKICAgIGZvcm1hdHNlbGVjdDogRV8uZm9ybWF0QnV0dG9uLAogICAgYWxpZ246IEVfLmFsaWduTWVudUJ1dHRvbgogIH0sCiAgICAgIEJfID0gZnVuY3Rpb24gQl8obywgYywgcywgbCkgewogICAgdmFyIGUsCiAgICAgICAgdCwKICAgICAgICBuLAogICAgICAgIHIsCiAgICAgICAgaSA9IChuID0gYy50b29sYmFyLCByID0gYy5idXR0b25zLCAhMSA9PT0gbiA/IFtdIDogdm9pZCAwID09PSBuIHx8ICEwID09PSBuID8gKGUgPSByLCB0ID0gTShUXywgZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSBGKHQuaXRlbXMsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIFR0KGUsIHQpIHx8IFR0KERfLCB0KTsKICAgICAgfSk7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogdC5uYW1lLAogICAgICAgIGl0ZW1zOiBuCiAgICAgIH07CiAgICB9KSwgRih0LCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gMCA8IHQuaXRlbXMubGVuZ3RoOwogICAgfSkpIDogeShuKSA/IE0obi5zcGxpdCgifCIpLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gewogICAgICAgIGl0ZW1zOiB0LnRyaW0oKS5zcGxpdCgiICIpCiAgICAgIH07CiAgICB9KSA6IGYobiwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIFR0KHQsICJuYW1lIikgJiYgVHQodCwgIml0ZW1zIik7CiAgICB9KSA/IG4gOiAoY29uc29sZS5lcnJvcigiVG9vbGJhciB0eXBlIHNob3VsZCBiZSBzdHJpbmcsIHN0cmluZ1tdLCBib29sZWFuIG9yIFRvb2xiYXJHcm91cFtdIiksIFtdKSk7CiAgICByZXR1cm4gRihNKGksIGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuID0geih0Lml0ZW1zLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiAwID09PSB0LnRyaW0oKS5sZW5ndGggPyBbXSA6IChyID0gbywgbiA9IGMuYnV0dG9ucywgaSA9IHQsIHUgPSBjLmFsbG93VG9vbGJhckdyb3VwcywgYSA9IHMsIGUgPSBsLCB0dChuLCBpLnRvTG93ZXJDYXNlKCkpLm9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGUuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gSyh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiB0dChuLCB0ICsgaS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0dChEXywgaS50b0xvd2VyQ2FzZSgpKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHQociwgYSk7CiAgICAgICAgICB9KS5vclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHZ0Lm5vbmUoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gImdyb3VwdG9vbGJhcmJ1dHRvbiIgIT09IHQudHlwZSB8fCB1ID8gKGUgPSBhLCBvID0gciwgdHQoRV8sIChuID0gdCkudHlwZSkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKCJza2lwcGluZyBidXR0b24gZGVmaW5lZCBieSIsIG4pLCB2dC5ub25lKCk7CiAgICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdnQuc29tZSh0KG4sIGUsIG8pKTsKICAgICAgICAgIH0pKSA6IChjb25zb2xlLndhcm4oIklnbm9yaW5nIHRoZSAnIiArIGkgKyAiJyB0b29sYmFyIGJ1dHRvbi4gR3JvdXAgdG9vbGJhciBidXR0b25zIGFyZSBvbmx5IHN1cHBvcnRlZCB3aGVuIHVzaW5nIGZsb2F0aW5nIHRvb2xiYXIgbW9kZSBhbmQgY2Fubm90IGJlIG5lc3RlZC4iKSwgdnQubm9uZSgpKTsKICAgICAgICAgIHZhciBuLCBlLCBvOwogICAgICAgIH0pLnRvQXJyYXkoKSk7CiAgICAgICAgdmFyIHIsIG4sIGksIHUsIGEsIGU7CiAgICAgIH0pOwogICAgICByZXR1cm4gewogICAgICAgIHRpdGxlOiB2dC5mcm9tKG8udHJhbnNsYXRlKHQubmFtZSkpLAogICAgICAgIGl0ZW1zOiBuCiAgICAgIH07CiAgICB9KSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIDAgPCB0Lml0ZW1zLmxlbmd0aDsKICAgIH0pOwogIH0sCiAgICAgIE1fID0gc2UoKSwKICAgICAgQV8gPSBNXy5vcy5pc2lPUygpICYmIE1fLm9zLnZlcnNpb24ubWFqb3IgPD0gMTIsCiAgICAgIEZfID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihlLCBuLCB0LCBvLCByKSB7CiAgICAgIHZhciBpID0gVm8oMCksCiAgICAgICAgICB1ID0gbi5vdXRlckNvbnRhaW5lcjsKICAgICAgQU8oZSk7CiAgICAgIHZhciBhID0gQXQuZnJvbURvbShyLnRhcmdldE5vZGUpLAogICAgICAgICAgYyA9IHRuKG1lKGEpKSwKICAgICAgICAgIHMgPSBuLm1vdGhlcnNoaXA7CiAgICAgIG1mKGEsIHMsIERuKSwgSHMoYywgbi51aU1vdGhlcnNoaXApLCBlLm9uKCJQb3N0UmVuZGVyIiwgZnVuY3Rpb24gKCkgewogICAgICAgIHFPKGUsIG4sIHQsIG8pLCBpLnNldChlLmdldFdpbigpLmlubmVyV2lkdGgpLCBCTy5zZXRNZW51YmFyKHUsIFBrKGUsIHQpKSwgQk8uc2V0U2lkZWJhcih1LCB0LnNpZGViYXIpLCBmdW5jdGlvbiAoZSwgdCkgewogICAgICAgICAgZnVuY3Rpb24gbigpIHsKICAgICAgICAgICAgdmFyIHQgPSBjLmdldCgpOwogICAgICAgICAgICB0LmxlZnQgPT09IHUuaW5uZXJXaWR0aCAmJiB0LnRvcCA9PT0gdS5pbm5lckhlaWdodCB8fCAoYy5zZXQoU2UodS5pbm5lcldpZHRoLCB1LmlubmVySGVpZ2h0KSksIE52KGUpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBvKCkgewogICAgICAgICAgICB2YXIgdCA9IGUuZ2V0RG9jKCkuZG9jdW1lbnRFbGVtZW50LAogICAgICAgICAgICAgICAgbiA9IHMuZ2V0KCk7CiAgICAgICAgICAgIG4ubGVmdCA9PT0gdC5vZmZzZXRXaWR0aCAmJiBuLnRvcCA9PT0gdC5vZmZzZXRIZWlnaHQgfHwgKHMuc2V0KFNlKHQub2Zmc2V0V2lkdGgsIHQub2Zmc2V0SGVpZ2h0KSksIE52KGUpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiByKHQpIHsKICAgICAgICAgICAgcmV0dXJuIGUuZmlyZSgiU2Nyb2xsQ29udGVudCIsIHQpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpID0gZS5kb20sCiAgICAgICAgICAgICAgdSA9IGUuZ2V0V2luKCksCiAgICAgICAgICAgICAgYSA9IGUuZ2V0RG9jKCkuZG9jdW1lbnRFbGVtZW50LAogICAgICAgICAgICAgIGMgPSBWbyhTZSh1LmlubmVyV2lkdGgsIHUuaW5uZXJIZWlnaHQpKSwKICAgICAgICAgICAgICBzID0gVm8oU2UoYS5vZmZzZXRXaWR0aCwgYS5vZmZzZXRIZWlnaHQpKTsKICAgICAgICAgIGkuYmluZCh1LCAicmVzaXplIiwgbiksIGkuYmluZCh1LCAic2Nyb2xsIiwgcik7CiAgICAgICAgICB2YXIgbCA9IGdjKEF0LmZyb21Eb20oZS5nZXRCb2R5KCkpLCAibG9hZCIsIG8pLAogICAgICAgICAgICAgIGYgPSB0LnVpTW90aGVyc2hpcC5lbGVtZW50OwogICAgICAgICAgZS5vbigiaGlkZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZm4oZiwgImRpc3BsYXkiLCAibm9uZSIpOwogICAgICAgICAgfSksIGUub24oInNob3ciLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZuKGYsICJkaXNwbGF5Iik7CiAgICAgICAgICB9KSwgZS5vbigiTm9kZUNoYW5nZSIsIG8pLCBlLm9uKCJyZW1vdmUiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGwudW5iaW5kKCksIGkudW5iaW5kKHUsICJyZXNpemUiLCBuKSwgaS51bmJpbmQodSwgInNjcm9sbCIsIHIpLCB1ID0gbnVsbDsKICAgICAgICAgIH0pOwogICAgICAgIH0oZSwgbik7CiAgICAgIH0pOwogICAgICB2YXIgbCwKICAgICAgICAgIGYsCiAgICAgICAgICBkLAogICAgICAgICAgbSwKICAgICAgICAgIGcgPSBCTy5nZXRTb2NrZXQodSkuZ2V0T3JEaWUoIkNvdWxkIG5vdCBmaW5kIGV4cGVjdGVkIHNvY2tldCBlbGVtZW50Iik7CiAgICAgIEFfICYmIChkbihnLmVsZW1lbnQsIHsKICAgICAgICBvdmVyZmxvdzogInNjcm9sbCIsCiAgICAgICAgIi13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nIjogInRvdWNoIgogICAgICB9KSwgZiA9IGZ1bmN0aW9uIGYoKSB7CiAgICAgICAgZS5maXJlKCJTY3JvbGxDb250ZW50Iik7CiAgICAgIH0sIGQgPSBudWxsLCBtID0gZnVuY3Rpb24gbSgpIHsKICAgICAgICBmb3IgKHZhciB0ID0gW10sIG4gPSAwOyBuIDwgYXJndW1lbnRzLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICB0W25dID0gYXJndW1lbnRzW25dOwogICAgICAgIH0KCiAgICAgICAgYihkKSAmJiAoZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgZCA9IG51bGwsIGYuYXBwbHkobnVsbCwgdCk7CiAgICAgICAgfSwgMjApKTsKICAgICAgfSwgbCA9IG1jKGcuZWxlbWVudCwgInNjcm9sbCIsIG0pLCBlLm9uKCJyZW1vdmUiLCBsLnVuYmluZCkpLCBkdihlLCBuKSwgZS5hZGRDb21tYW5kKCJUb2dnbGVTaWRlYmFyIiwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBCTy50b2dnbGVTaWRlYmFyKHUsIG4pLCBlLmZpcmUoIlRvZ2dsZVNpZGViYXIiKTsKICAgICAgfSksIGUuYWRkUXVlcnlWYWx1ZUhhbmRsZXIoIlRvZ2dsZVNpZGViYXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIEJPLndoaWNoU2lkZWJhcih1KTsKICAgICAgfSk7CiAgICAgIHZhciBwID0gb3YoZSk7CiAgICAgIHAgIT09IGhoLnNsaWRpbmcgJiYgcCAhPT0gaGguZmxvYXRpbmcgfHwgZS5vbigiUmVzaXplV2luZG93IFJlc2l6ZUVkaXRvciBSZXNpemVDb250ZW50IiwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ID0gZS5nZXRXaW4oKS5pbm5lcldpZHRoOwogICAgICAgIHQgIT09IGkuZ2V0KCkgJiYgKEJPLnJlZnJlc2hUb29sYmFyKG4ub3V0ZXJDb250YWluZXIpLCBpLnNldCh0KSk7CiAgICAgIH0pOwogICAgICB2YXIgaCA9IHsKICAgICAgICBlbmFibGU6IGZ1bmN0aW9uIGVuYWJsZSgpIHsKICAgICAgICAgIGZ2KG4sICExKTsKICAgICAgICB9LAogICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uIGRpc2FibGUoKSB7CiAgICAgICAgICBmdihuLCAhMCk7CiAgICAgICAgfSwKICAgICAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbiBpc0Rpc2FibGVkKCkgewogICAgICAgICAgcmV0dXJuIGRkLmlzRGlzYWJsZWQodSk7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gewogICAgICAgIGlmcmFtZUNvbnRhaW5lcjogZy5lbGVtZW50LmRvbSwKICAgICAgICBlZGl0b3JDb250YWluZXI6IHUuZWxlbWVudC5kb20sCiAgICAgICAgYXBpOiBoCiAgICAgIH07CiAgICB9CiAgfSksCiAgICAgIElfID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihuLCBlLCBvLCByLCB0KSB7CiAgICAgIHZhciBpID0gZS5tb3RoZXJzaGlwLAogICAgICAgICAgdSA9IGUudWlNb3RoZXJzaGlwLAogICAgICAgICAgYSA9IGUub3V0ZXJDb250YWluZXIsCiAgICAgICAgICBjID0gVm8obnVsbCksCiAgICAgICAgICBzID0gQXQuZnJvbURvbSh0LnRhcmdldE5vZGUpLAogICAgICAgICAgbCA9IFpPKG4sIHMsIGUsIHIsIGMpLAogICAgICAgICAgZiA9IG4uZ2V0UGFyYW0oInRvb2xiYXJfcGVyc2lzdCIsICExLCAiYm9vbGVhbiIpOwoKICAgICAgZnVuY3Rpb24gZCgpIHsKICAgICAgICB2YXIgdDsKICAgICAgICBjLmdldCgpID8gbC5zaG93KCkgOiAoYy5zZXQoQk8uZ2V0SGVhZGVyKGEpLmdldE9yRGllKCkpLCBIcyh0ID0gY3YobiksIGkpLCBIcyh0LCB1KSwgcU8obiwgZSwgbywgciksIEJPLnNldE1lbnViYXIoYSwgUGsobiwgbykpLCBsLnNob3coKSwgZnVuY3Rpb24gKGMsIHMsIGwsIHQpIHsKICAgICAgICAgIGZ1bmN0aW9uIG4odCkgewogICAgICAgICAgICB2YXIgbiA9IHRfKHMsIGwuaXNQb3NpdGlvbmVkQXRUb3AoKSksCiAgICAgICAgICAgICAgICBlID0gbi5wb3MsCiAgICAgICAgICAgICAgICBvID0gbi5ib3VuZHMsCiAgICAgICAgICAgICAgICByID0gZi5nZXQoKSwKICAgICAgICAgICAgICAgIGkgPSByLnBvcywKICAgICAgICAgICAgICAgIHUgPSByLmJvdW5kcywKICAgICAgICAgICAgICAgIGEgPSBvLmhlaWdodCAhPT0gdS5oZWlnaHQgfHwgby53aWR0aCAhPT0gdS53aWR0aDsKICAgICAgICAgICAgZi5zZXQoewogICAgICAgICAgICAgIHBvczogZSwKICAgICAgICAgICAgICBib3VuZHM6IG8KICAgICAgICAgICAgfSksIGEgJiYgTnYoYywgdCksIGwuaXNWaXNpYmxlKCkgJiYgKGkgIT09IGUgPyBsLnVwZGF0ZSghMCkgOiBhICYmIChsLnVwZGF0ZU1vZGUoKSwgbC5yZXBvc2l0aW9uUG9wdXBzKCkpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZiA9IFZvKHRfKHMsIGwuaXNQb3NpdGlvbmVkQXRUb3AoKSkpOwogICAgICAgICAgdCB8fCAoYy5vbigiYWN0aXZhdGUiLCBsLnNob3cpLCBjLm9uKCJkZWFjdGl2YXRlIiwgbC5oaWRlKSksIGMub24oIlNraW5Mb2FkZWQgUmVzaXplV2luZG93IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbC51cGRhdGUoITApOwogICAgICAgICAgfSksIGMub24oIk5vZGVDaGFuZ2Uga2V5ZG93biIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIGNwLnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG4odCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSksIGMub24oIlNjcm9sbFdpbmRvdyIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGwudXBkYXRlTW9kZSgpOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgZSA9IGZjKCk7CiAgICAgICAgICBlLnNldChnYyhBdC5mcm9tRG9tKGMuZ2V0Qm9keSgpKSwgImxvYWQiLCBuKSksIGMub24oInJlbW92ZSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZS5jbGVhcigpOwogICAgICAgICAgfSk7CiAgICAgICAgfShuLCBzLCBsLCBmKSwgbi5ub2RlQ2hhbmdlZCgpKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbSgpIHsKICAgICAgICByZXR1cm4gY3Auc2V0RWRpdG9yVGltZW91dChuLCBkLCAwKTsKICAgICAgfQoKICAgICAgRk8obiksIG4ub24oInNob3ciLCBkKSwgbi5vbigiaGlkZSIsIGwuaGlkZSksIGYgfHwgKG4ub24oImZvY3VzIiwgbSksIG4ub24oImJsdXIiLCBsLmhpZGUpKSwgbi5vbigiaW5pdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAobi5oYXNGb2N1cygpIHx8IGYpICYmIG0oKTsKICAgICAgfSksIGR2KG4sIGUpOwogICAgICB2YXIgZyA9IHsKICAgICAgICBzaG93OiBmdW5jdGlvbiBzaG93KCkgewogICAgICAgICAgbC5zaG93KCk7CiAgICAgICAgfSwKICAgICAgICBoaWRlOiBmdW5jdGlvbiBoaWRlKCkgewogICAgICAgICAgbC5oaWRlKCk7CiAgICAgICAgfSwKICAgICAgICBlbmFibGU6IGZ1bmN0aW9uIGVuYWJsZSgpIHsKICAgICAgICAgIGZ2KGUsICExKTsKICAgICAgICB9LAogICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uIGRpc2FibGUoKSB7CiAgICAgICAgICBmdihlLCAhMCk7CiAgICAgICAgfSwKICAgICAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbiBpc0Rpc2FibGVkKCkgewogICAgICAgICAgcmV0dXJuIGRkLmlzRGlzYWJsZWQoYSk7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gewogICAgICAgIGVkaXRvckNvbnRhaW5lcjogYS5lbGVtZW50LmRvbSwKICAgICAgICBhcGk6IGcKICAgICAgfTsKICAgIH0KICB9KSwKICAgICAgUl8gPSAiY29udGV4dHRvb2xiYXItaGlkZSIsCiAgICAgIFZfID0gZnVuY3Rpb24gVl8odCwgbikgewogICAgdmFyIGUsCiAgICAgICAgbywKICAgICAgICByLAogICAgICAgIGksCiAgICAgICAgdSA9IHQubGFiZWwuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB7fTsKICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgImFyaWEtbGFiZWwiOiB0CiAgICAgIH07CiAgICB9KSwKICAgICAgICBhID0gUG0oT3kuc2tldGNoKHsKICAgICAgaW5wdXRDbGFzc2VzOiBbInRveC10b29sYmFyLXRleHRmaWVsZCIsICJ0b3gtdG9vbGJhci1uYXYtanMiXSwKICAgICAgZGF0YTogdC5pbml0VmFsdWUoKSwKICAgICAgaW5wdXRBdHRyaWJ1dGVzOiB1LAogICAgICBzZWxlY3RPbkZvY3VzOiAhMCwKICAgICAgaW5wdXRCZWhhdmlvdXJzOiB0YyhbTWcuY29uZmlnKHsKICAgICAgICBtb2RlOiAic3BlY2lhbCIsCiAgICAgICAgb25FbnRlcjogZnVuY3Rpb24gb25FbnRlcih0KSB7CiAgICAgICAgICByZXR1cm4gYy5maW5kUHJpbWFyeSh0KS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIGJyKHQpLCAhMDsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25MZWZ0OiBmdW5jdGlvbiBvbkxlZnQodCwgbikgewogICAgICAgICAgcmV0dXJuIG4uY3V0KCksIHZ0Lm5vbmUoKTsKICAgICAgICB9LAogICAgICAgIG9uUmlnaHQ6IGZ1bmN0aW9uIG9uUmlnaHQodCwgbikgewogICAgICAgICAgcmV0dXJuIG4uY3V0KCksIHZ0Lm5vbmUoKTsKICAgICAgICB9CiAgICAgIH0pXSkKICAgIH0pKSwKICAgICAgICBjID0gKGUgPSBhLCBvID0gdC5jb21tYW5kcywgciA9IG4sIGkgPSBNKG8sIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBQbSgoImNvbnRleHRmb3JtdG9nZ2xlYnV0dG9uIiA9PT0gdC50eXBlID8gZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgICB2YXIgbyA9IG4ub3JpZ2luYWw7CiAgICAgICAgby5wcmltYXJ5OwogICAgICAgIHZhciByID0gcyhvLCBbInByaW1hcnkiXSksCiAgICAgICAgICAgIGkgPSBhbyhrcChfbHQoX2x0KHt9LCByKSwgewogICAgICAgICAgdHlwZTogInRvZ2dsZWJ1dHRvbiIsCiAgICAgICAgICBvbkFjdGlvbjogc3QKICAgICAgICB9KSkpOwogICAgICAgIHJldHVybiBfXyhpLCBlLmJhY2tzdGFnZS5zaGFyZWQucHJvdmlkZXJzLCBbbl8odCwgbildKTsKICAgICAgfSA6IGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgICAgdmFyIG8gPSBuLm9yaWdpbmFsOwogICAgICAgIG8ucHJpbWFyeTsKICAgICAgICB2YXIgciA9IHMobywgWyJwcmltYXJ5Il0pLAogICAgICAgICAgICBpID0gYW8oQ3AoX2x0KF9sdCh7fSwgciksIHsKICAgICAgICAgIHR5cGU6ICJidXR0b24iLAogICAgICAgICAgb25BY3Rpb246IHN0CiAgICAgICAgfSkpKTsKICAgICAgICByZXR1cm4gT18oaSwgZS5iYWNrc3RhZ2Uuc2hhcmVkLnByb3ZpZGVycywgW25fKHQsIG4pXSk7CiAgICAgIH0pKGUsIHQsIHsKICAgICAgICBiYWNrc3RhZ2U6IHsKICAgICAgICAgIHNoYXJlZDogewogICAgICAgICAgICBwcm92aWRlcnM6IHIKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pKTsKICAgIH0pLCB7CiAgICAgIGFzU3BlY3M6IGZ1bmN0aW9uIGFzU3BlY3MoKSB7CiAgICAgICAgcmV0dXJuIE0oaSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LmFzU3BlYygpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBmaW5kUHJpbWFyeTogZnVuY3Rpb24gZmluZFByaW1hcnkoZSkgewogICAgICAgIHJldHVybiBLKG8sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICByZXR1cm4gdC5wcmltYXJ5ID8gdnQuZnJvbShpW25dKS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB0LmdldE9wdChlKTsKICAgICAgICAgIH0pLmZpbHRlcihDKGRkLmlzRGlzYWJsZWQpKSA6IHZ0Lm5vbmUoKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gW3sKICAgICAgdGl0bGU6IHZ0Lm5vbmUoKSwKICAgICAgaXRlbXM6IFthLmFzU3BlYygpXQogICAgfSwgewogICAgICB0aXRsZTogdnQubm9uZSgpLAogICAgICBpdGVtczogYy5hc1NwZWNzKCkKICAgIH1dOwogIH0sCiAgICAgIFBfID0gewogICAgdmFsaWduQ2VudHJlOiBbXSwKICAgIGFsaWduQ2VudHJlOiBbXSwKICAgIGFsaWduTGVmdDogWyJ0b3gtcG9wLS1hbGlnbi1sZWZ0Il0sCiAgICBhbGlnblJpZ2h0OiBbInRveC1wb3AtLWFsaWduLXJpZ2h0Il0sCiAgICByaWdodDogWyJ0b3gtcG9wLS1yaWdodCJdLAogICAgbGVmdDogWyJ0b3gtcG9wLS1sZWZ0Il0sCiAgICBib3R0b206IFsidG94LXBvcC0tYm90dG9tIl0sCiAgICB0b3A6IFsidG94LXBvcC0tdG9wIl0sCiAgICBpbnNldDogWyJ0b3gtcG9wLS1pbnNldCJdCiAgfSwKICAgICAgSF8gPSB7CiAgICBtYXhIZWlnaHRGdW5jdGlvbjogSWMoKSwKICAgIG1heFdpZHRoRnVuY3Rpb246IGRPKCkKICB9LAogICAgICB6XyA9IEZyKCJmb3J3YXJkLXNsaWRlIiksCiAgICAgIE5fID0gRnIoImJhY2t3YXJkLXNsaWRlIiksCiAgICAgIExfID0gRnIoImNoYW5nZS1zbGlkZS1ldmVudCIpLAogICAgICBXXyA9ICJ0b3gtcG9wLS1yZXNpemluZyIsCiAgICAgIFVfID0gInRveC1wb3AtLXRyYW5zaXRpb24iLAogICAgICBqXyA9IHsKICAgIHVuc3VwcG9ydGVkTGVuZ3RoOiBbImVtIiwgImV4IiwgImNhcCIsICJjaCIsICJpYyIsICJyZW0iLCAibGgiLCAicmxoIiwgInZ3IiwgInZoIiwgInZpIiwgInZiIiwgInZtaW4iLCAidm1heCIsICJjbSIsICJtbSIsICJRIiwgImluIiwgInBjIiwgInB0IiwgInB4Il0sCiAgICBmaXhlZDogWyJweCIsICJwdCJdLAogICAgcmVsYXRpdmU6IFsiJSJdLAogICAgZW1wdHk6IFsiIl0KICB9LAogICAgICBHXyA9IChtXyA9IFsiSW5maW5pdHkiLCAoZl8gPSAiWzAtOV0rIikgKyAiXFwuIiArIFhfKGZfKSArIFhfKGRfID0gIltlRV1bKy1dP1swLTldKyIpLCAiXFwuIiArIGZfICsgWF8oZF8pLCBmXyArIFhfKGRfKV0uam9pbigifCIpLCBuZXcgUmVnRXhwKCJeKFsrLV0/KD86IiArIG1fICsgIikpKC4qKSQiKSk7CgogIGZ1bmN0aW9uIFhfKHQpIHsKICAgIHJldHVybiAiKD86IiArIHQgKyAiKT8iOwogIH0KCiAgZnVuY3Rpb24gWV8odSwgYSkgewogICAgZnVuY3Rpb24gbigpIHsKICAgICAgdmFyIHQgPSBhLmdldE9wdGlvbnModSksCiAgICAgICAgICByID0gYS5nZXRDdXJyZW50KHUpLm1hcChhLmhhc2gpLAogICAgICAgICAgaSA9IGRjKCk7CiAgICAgIHJldHVybiBNKHQsIGZ1bmN0aW9uIChvKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICJ0b2dnbGVtZW51aXRlbSIsCiAgICAgICAgICB0ZXh0OiBhLmRpc3BsYXkobyksCiAgICAgICAgICBvblNldHVwOiBmdW5jdGlvbiBvblNldHVwKG4pIHsKICAgICAgICAgICAgZnVuY3Rpb24gdCh0KSB7CiAgICAgICAgICAgICAgdCAmJiAoaS5vbihmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHQuc2V0QWN0aXZlKCExKTsKICAgICAgICAgICAgICB9KSwgaS5zZXQobikpLCBuLnNldEFjdGl2ZSh0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdChtdChyLCBhLmhhc2gobykpKTsKICAgICAgICAgICAgdmFyIGUgPSBhLndhdGNoZXIodSwgbywgdCk7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgaS5jbGVhcigpLCBlKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9LAogICAgICAgICAgb25BY3Rpb246IGZ1bmN0aW9uIG9uQWN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gYS5zZXRDdXJyZW50KHUsIG8pOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0pOwogICAgfQoKICAgIHUudWkucmVnaXN0cnkuYWRkTWVudUJ1dHRvbihhLm5hbWUsIHsKICAgICAgdG9vbHRpcDogYS50ZXh0LAogICAgICBpY29uOiBhLmljb24sCiAgICAgIGZldGNoOiBmdW5jdGlvbiBmZXRjaCh0KSB7CiAgICAgICAgcmV0dXJuIHQobigpKTsKICAgICAgfSwKICAgICAgb25TZXR1cDogYS5vblRvb2xiYXJTZXR1cAogICAgfSksIHUudWkucmVnaXN0cnkuYWRkTmVzdGVkTWVudUl0ZW0oYS5uYW1lLCB7CiAgICAgIHR5cGU6ICJuZXN0ZWRtZW51aXRlbSIsCiAgICAgIHRleHQ6IGEudGV4dCwKICAgICAgZ2V0U3VibWVudUl0ZW1zOiBuLAogICAgICBvblNldHVwOiBhLm9uTWVudVNldHVwCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHFfKHQsIG4pIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHQuZXhlY0NvbW1hbmQoIm1jZVRvZ2dsZUZvcm1hdCIsICExLCBuKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBLXyh0KSB7CiAgICB2YXIgbiwgZTsKICAgICFmdW5jdGlvbiAoZSkgewogICAgICBhUy5lYWNoKFt7CiAgICAgICAgbmFtZTogImJvbGQiLAogICAgICAgIHRleHQ6ICJCb2xkIiwKICAgICAgICBpY29uOiAiYm9sZCIKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJpdGFsaWMiLAogICAgICAgIHRleHQ6ICJJdGFsaWMiLAogICAgICAgIGljb246ICJpdGFsaWMiCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAidW5kZXJsaW5lIiwKICAgICAgICB0ZXh0OiAiVW5kZXJsaW5lIiwKICAgICAgICBpY29uOiAidW5kZXJsaW5lIgogICAgICB9LCB7CiAgICAgICAgbmFtZTogInN0cmlrZXRocm91Z2giLAogICAgICAgIHRleHQ6ICJTdHJpa2V0aHJvdWdoIiwKICAgICAgICBpY29uOiAic3RyaWtlLXRocm91Z2giCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAic3Vic2NyaXB0IiwKICAgICAgICB0ZXh0OiAiU3Vic2NyaXB0IiwKICAgICAgICBpY29uOiAic3Vic2NyaXB0IgogICAgICB9LCB7CiAgICAgICAgbmFtZTogInN1cGVyc2NyaXB0IiwKICAgICAgICB0ZXh0OiAiU3VwZXJzY3JpcHQiLAogICAgICAgIGljb246ICJzdXBlcnNjcmlwdCIKICAgICAgfV0sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgZS51aS5yZWdpc3RyeS5hZGRUb2dnbGVCdXR0b24odC5uYW1lLCB7CiAgICAgICAgICB0b29sdGlwOiB0LnRleHQsCiAgICAgICAgICBpY29uOiB0Lmljb24sCiAgICAgICAgICBvblNldHVwOiBMayhlLCB0Lm5hbWUpLAogICAgICAgICAgb25BY3Rpb246IHFfKGUsIHQubmFtZSkKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBmb3IgKHZhciB0ID0gMTsgdCA8PSA2OyB0KyspIHsKICAgICAgICB2YXIgbiA9ICJoIiArIHQ7CiAgICAgICAgZS51aS5yZWdpc3RyeS5hZGRUb2dnbGVCdXR0b24obiwgewogICAgICAgICAgdGV4dDogbi50b1VwcGVyQ2FzZSgpLAogICAgICAgICAgdG9vbHRpcDogIkhlYWRpbmcgIiArIHQsCiAgICAgICAgICBvblNldHVwOiBMayhlLCBuKSwKICAgICAgICAgIG9uQWN0aW9uOiBxXyhlLCBuKQogICAgICAgIH0pOwogICAgICB9CiAgICB9KHQpLCBuID0gdCwgYVMuZWFjaChbewogICAgICBuYW1lOiAiY3V0IiwKICAgICAgdGV4dDogIkN1dCIsCiAgICAgIGFjdGlvbjogIkN1dCIsCiAgICAgIGljb246ICJjdXQiCiAgICB9LCB7CiAgICAgIG5hbWU6ICJjb3B5IiwKICAgICAgdGV4dDogIkNvcHkiLAogICAgICBhY3Rpb246ICJDb3B5IiwKICAgICAgaWNvbjogImNvcHkiCiAgICB9LCB7CiAgICAgIG5hbWU6ICJwYXN0ZSIsCiAgICAgIHRleHQ6ICJQYXN0ZSIsCiAgICAgIGFjdGlvbjogIlBhc3RlIiwKICAgICAgaWNvbjogInBhc3RlIgogICAgfSwgewogICAgICBuYW1lOiAiaGVscCIsCiAgICAgIHRleHQ6ICJIZWxwIiwKICAgICAgYWN0aW9uOiAibWNlSGVscCIsCiAgICAgIGljb246ICJoZWxwIgogICAgfSwgewogICAgICBuYW1lOiAic2VsZWN0YWxsIiwKICAgICAgdGV4dDogIlNlbGVjdCBhbGwiLAogICAgICBhY3Rpb246ICJTZWxlY3RBbGwiLAogICAgICBpY29uOiAic2VsZWN0LWFsbCIKICAgIH0sIHsKICAgICAgbmFtZTogIm5ld2RvY3VtZW50IiwKICAgICAgdGV4dDogIk5ldyBkb2N1bWVudCIsCiAgICAgIGFjdGlvbjogIm1jZU5ld0RvY3VtZW50IiwKICAgICAgaWNvbjogIm5ldy1kb2N1bWVudCIKICAgIH0sIHsKICAgICAgbmFtZTogInJlbW92ZWZvcm1hdCIsCiAgICAgIHRleHQ6ICJDbGVhciBmb3JtYXR0aW5nIiwKICAgICAgYWN0aW9uOiAiUmVtb3ZlRm9ybWF0IiwKICAgICAgaWNvbjogInJlbW92ZS1mb3JtYXR0aW5nIgogICAgfSwgewogICAgICBuYW1lOiAicmVtb3ZlIiwKICAgICAgdGV4dDogIlJlbW92ZSIsCiAgICAgIGFjdGlvbjogIkRlbGV0ZSIsCiAgICAgIGljb246ICJyZW1vdmUiCiAgICB9XSwgZnVuY3Rpb24gKHQpIHsKICAgICAgbi51aS5yZWdpc3RyeS5hZGRCdXR0b24odC5uYW1lLCB7CiAgICAgICAgdG9vbHRpcDogdC50ZXh0LAogICAgICAgIGljb246IHQuaWNvbiwKICAgICAgICBvbkFjdGlvbjogamsobiwgdC5hY3Rpb24pCiAgICAgIH0pOwogICAgfSksIGUgPSB0LCBhUy5lYWNoKFt7CiAgICAgIG5hbWU6ICJibG9ja3F1b3RlIiwKICAgICAgdGV4dDogIkJsb2NrcXVvdGUiLAogICAgICBhY3Rpb246ICJtY2VCbG9ja1F1b3RlIiwKICAgICAgaWNvbjogInF1b3RlIgogICAgfV0sIGZ1bmN0aW9uICh0KSB7CiAgICAgIGUudWkucmVnaXN0cnkuYWRkVG9nZ2xlQnV0dG9uKHQubmFtZSwgewogICAgICAgIHRvb2x0aXA6IHQudGV4dCwKICAgICAgICBpY29uOiB0Lmljb24sCiAgICAgICAgb25BY3Rpb246IGprKGUsIHQuYWN0aW9uKSwKICAgICAgICBvblNldHVwOiBMayhlLCB0Lm5hbWUpCiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBKXyhuLCBlKSB7CiAgICByZXR1cm4gV2sobiwgIlVuZG8gUmVkbyBBZGRVbmRvIFR5cGluZ1VuZG8gQ2xlYXJVbmRvcyBTd2l0Y2hNb2RlIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgdC5zZXREaXNhYmxlZChuLm1vZGUuaXNSZWFkT25seSgpIHx8ICFuLnVuZG9NYW5hZ2VyW2VdKCkpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiAkXyh0KSB7CiAgICB2YXIgbjsKICAgIHQudWkucmVnaXN0cnkuYWRkQnV0dG9uKCJ2aXN1YWxhaWQiLCB7CiAgICAgIHRvb2x0aXA6ICJWaXN1YWwgYWlkcyIsCiAgICAgIHRleHQ6ICJWaXN1YWwgYWlkcyIsCiAgICAgIG9uQWN0aW9uOiBqayh0LCAibWNlVG9nZ2xlVmlzdWFsQWlkIikKICAgIH0pLCB0LnVpLnJlZ2lzdHJ5LmFkZFRvZ2dsZU1lbnVJdGVtKCJ2aXN1YWxhaWQiLCB7CiAgICAgIHRleHQ6ICJWaXN1YWwgYWlkcyIsCiAgICAgIG9uU2V0dXA6IFdrKG4gPSB0LCAiVmlzdWFsQWlkIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB0LnNldEFjdGl2ZShuLmhhc1Zpc3VhbCk7CiAgICAgIH0pLAogICAgICBvbkFjdGlvbjogamsodCwgIm1jZVRvZ2dsZVZpc3VhbEFpZCIpCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIFFfKHQsIG4pIHsKICAgIHZhciBlLAogICAgICAgIG8sCiAgICAgICAgciwKICAgICAgICBpLAogICAgICAgIHUsCiAgICAgICAgYSwKICAgICAgICBjLAogICAgICAgIHMsCiAgICAgICAgbCwKICAgICAgICBmLAogICAgICAgIGQsCiAgICAgICAgbSwKICAgICAgICBnLAogICAgICAgIHAsCiAgICAgICAgaCwKICAgICAgICB2LAogICAgICAgIGIsCiAgICAgICAgeSwKICAgICAgICB4LAogICAgICAgIHcsCiAgICAgICAgUywKICAgICAgICBDLAogICAgICAgIGssCiAgICAgICAgTywKICAgICAgICBfLAogICAgICAgIFQgPSB0OwoKICAgIFN0KFt7CiAgICAgIG5hbWU6ICJhbGlnbmxlZnQiLAogICAgICB0ZXh0OiAiQWxpZ24gbGVmdCIsCiAgICAgIGNtZDogIkp1c3RpZnlMZWZ0IiwKICAgICAgaWNvbjogImFsaWduLWxlZnQiCiAgICB9LCB7CiAgICAgIG5hbWU6ICJhbGlnbmNlbnRlciIsCiAgICAgIHRleHQ6ICJBbGlnbiBjZW50ZXIiLAogICAgICBjbWQ6ICJKdXN0aWZ5Q2VudGVyIiwKICAgICAgaWNvbjogImFsaWduLWNlbnRlciIKICAgIH0sIHsKICAgICAgbmFtZTogImFsaWducmlnaHQiLAogICAgICB0ZXh0OiAiQWxpZ24gcmlnaHQiLAogICAgICBjbWQ6ICJKdXN0aWZ5UmlnaHQiLAogICAgICBpY29uOiAiYWxpZ24tcmlnaHQiCiAgICB9LCB7CiAgICAgIG5hbWU6ICJhbGlnbmp1c3RpZnkiLAogICAgICB0ZXh0OiAiSnVzdGlmeSIsCiAgICAgIGNtZDogIkp1c3RpZnlGdWxsIiwKICAgICAgaWNvbjogImFsaWduLWp1c3RpZnkiCiAgICB9XSwgZnVuY3Rpb24gKHQpIHsKICAgICAgVC51aS5yZWdpc3RyeS5hZGRUb2dnbGVCdXR0b24odC5uYW1lLCB7CiAgICAgICAgdG9vbHRpcDogdC50ZXh0LAogICAgICAgIGljb246IHQuaWNvbiwKICAgICAgICBvbkFjdGlvbjogamsoVCwgdC5jbWQpLAogICAgICAgIG9uU2V0dXA6IExrKFQsIHQubmFtZSkKICAgICAgfSk7CiAgICB9KSwgVC51aS5yZWdpc3RyeS5hZGRCdXR0b24oImFsaWdubm9uZSIsIHsKICAgICAgdG9vbHRpcDogIk5vIGFsaWdubWVudCIsCiAgICAgIGljb246ICJhbGlnbi1ub25lIiwKICAgICAgb25BY3Rpb246IGprKFQsICJKdXN0aWZ5Tm9uZSIpCiAgICB9KSwgS18oTyA9IHQpLCBfID0gTywgYVMuZWFjaChbewogICAgICBuYW1lOiAiYm9sZCIsCiAgICAgIHRleHQ6ICJCb2xkIiwKICAgICAgYWN0aW9uOiAiQm9sZCIsCiAgICAgIGljb246ICJib2xkIiwKICAgICAgc2hvcnRjdXQ6ICJNZXRhK0IiCiAgICB9LCB7CiAgICAgIG5hbWU6ICJpdGFsaWMiLAogICAgICB0ZXh0OiAiSXRhbGljIiwKICAgICAgYWN0aW9uOiAiSXRhbGljIiwKICAgICAgaWNvbjogIml0YWxpYyIsCiAgICAgIHNob3J0Y3V0OiAiTWV0YStJIgogICAgfSwgewogICAgICBuYW1lOiAidW5kZXJsaW5lIiwKICAgICAgdGV4dDogIlVuZGVybGluZSIsCiAgICAgIGFjdGlvbjogIlVuZGVybGluZSIsCiAgICAgIGljb246ICJ1bmRlcmxpbmUiLAogICAgICBzaG9ydGN1dDogIk1ldGErVSIKICAgIH0sIHsKICAgICAgbmFtZTogInN0cmlrZXRocm91Z2giLAogICAgICB0ZXh0OiAiU3RyaWtldGhyb3VnaCIsCiAgICAgIGFjdGlvbjogIlN0cmlrZXRocm91Z2giLAogICAgICBpY29uOiAic3RyaWtlLXRocm91Z2giLAogICAgICBzaG9ydGN1dDogIiIKICAgIH0sIHsKICAgICAgbmFtZTogInN1YnNjcmlwdCIsCiAgICAgIHRleHQ6ICJTdWJzY3JpcHQiLAogICAgICBhY3Rpb246ICJTdWJzY3JpcHQiLAogICAgICBpY29uOiAic3Vic2NyaXB0IiwKICAgICAgc2hvcnRjdXQ6ICIiCiAgICB9LCB7CiAgICAgIG5hbWU6ICJzdXBlcnNjcmlwdCIsCiAgICAgIHRleHQ6ICJTdXBlcnNjcmlwdCIsCiAgICAgIGFjdGlvbjogIlN1cGVyc2NyaXB0IiwKICAgICAgaWNvbjogInN1cGVyc2NyaXB0IiwKICAgICAgc2hvcnRjdXQ6ICIiCiAgICB9LCB7CiAgICAgIG5hbWU6ICJyZW1vdmVmb3JtYXQiLAogICAgICB0ZXh0OiAiQ2xlYXIgZm9ybWF0dGluZyIsCiAgICAgIGFjdGlvbjogIlJlbW92ZUZvcm1hdCIsCiAgICAgIGljb246ICJyZW1vdmUtZm9ybWF0dGluZyIsCiAgICAgIHNob3J0Y3V0OiAiIgogICAgfSwgewogICAgICBuYW1lOiAibmV3ZG9jdW1lbnQiLAogICAgICB0ZXh0OiAiTmV3IGRvY3VtZW50IiwKICAgICAgYWN0aW9uOiAibWNlTmV3RG9jdW1lbnQiLAogICAgICBpY29uOiAibmV3LWRvY3VtZW50IiwKICAgICAgc2hvcnRjdXQ6ICIiCiAgICB9LCB7CiAgICAgIG5hbWU6ICJjdXQiLAogICAgICB0ZXh0OiAiQ3V0IiwKICAgICAgYWN0aW9uOiAiQ3V0IiwKICAgICAgaWNvbjogImN1dCIsCiAgICAgIHNob3J0Y3V0OiAiTWV0YStYIgogICAgfSwgewogICAgICBuYW1lOiAiY29weSIsCiAgICAgIHRleHQ6ICJDb3B5IiwKICAgICAgYWN0aW9uOiAiQ29weSIsCiAgICAgIGljb246ICJjb3B5IiwKICAgICAgc2hvcnRjdXQ6ICJNZXRhK0MiCiAgICB9LCB7CiAgICAgIG5hbWU6ICJwYXN0ZSIsCiAgICAgIHRleHQ6ICJQYXN0ZSIsCiAgICAgIGFjdGlvbjogIlBhc3RlIiwKICAgICAgaWNvbjogInBhc3RlIiwKICAgICAgc2hvcnRjdXQ6ICJNZXRhK1YiCiAgICB9LCB7CiAgICAgIG5hbWU6ICJzZWxlY3RhbGwiLAogICAgICB0ZXh0OiAiU2VsZWN0IGFsbCIsCiAgICAgIGFjdGlvbjogIlNlbGVjdEFsbCIsCiAgICAgIGljb246ICJzZWxlY3QtYWxsIiwKICAgICAgc2hvcnRjdXQ6ICJNZXRhK0EiCiAgICB9XSwgZnVuY3Rpb24gKHQpIHsKICAgICAgXy51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSh0Lm5hbWUsIHsKICAgICAgICB0ZXh0OiB0LnRleHQsCiAgICAgICAgaWNvbjogdC5pY29uLAogICAgICAgIHNob3J0Y3V0OiB0LnNob3J0Y3V0LAogICAgICAgIG9uQWN0aW9uOiBqayhfLCB0LmFjdGlvbikKICAgICAgfSk7CiAgICB9KSwgXy51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgiY29kZWZvcm1hdCIsIHsKICAgICAgdGV4dDogIkNvZGUiLAogICAgICBpY29uOiAic291cmNlY29kZSIsCiAgICAgIG9uQWN0aW9uOiBxXyhfLCAiY29kZSIpCiAgICB9KSwgayA9IEdrKDAsIGQgPSBsID0gbiwgUk8oZiA9IHMgPSB0KSksIGYudWkucmVnaXN0cnkuYWRkTmVzdGVkTWVudUl0ZW0oImFsaWduIiwgewogICAgICB0ZXh0OiBkLnNoYXJlZC5wcm92aWRlcnMudHJhbnNsYXRlKCJBbGlnbiIpLAogICAgICBnZXRTdWJtZW51SXRlbXM6IGZ1bmN0aW9uIGdldFN1Ym1lbnVJdGVtcygpIHsKICAgICAgICByZXR1cm4gay5pdGVtcy52YWxpZGF0ZUl0ZW1zKGsuZ2V0U3R5bGVJdGVtcygpKTsKICAgICAgfQogICAgfSksIHAgPSBHaygwLCBnID0gbCwgUE8obSA9IHMpKSwgbS51aS5yZWdpc3RyeS5hZGROZXN0ZWRNZW51SXRlbSgiZm9udGZvcm1hdHMiLCB7CiAgICAgIHRleHQ6IGcuc2hhcmVkLnByb3ZpZGVycy50cmFuc2xhdGUoIkZvbnRzIiksCiAgICAgIGdldFN1Ym1lbnVJdGVtczogZnVuY3Rpb24gZ2V0U3VibWVudUl0ZW1zKCkgewogICAgICAgIHJldHVybiBwLml0ZW1zLnZhbGlkYXRlSXRlbXMocC5nZXRTdHlsZUl0ZW1zKCkpOwogICAgICB9CiAgICB9KSwgaCA9IHMsIGIgPSBfbHQoewogICAgICB0eXBlOiAiYWR2YW5jZWQiCiAgICB9LCAodiA9IGwpLnN0eWxlc2VsZWN0KSwgeSA9IEdrKDAsIHYsIExPKGgsIGIpKSwgaC51aS5yZWdpc3RyeS5hZGROZXN0ZWRNZW51SXRlbSgiZm9ybWF0cyIsIHsKICAgICAgdGV4dDogIkZvcm1hdHMiLAogICAgICBnZXRTdWJtZW51SXRlbXM6IGZ1bmN0aW9uIGdldFN1Ym1lbnVJdGVtcygpIHsKICAgICAgICByZXR1cm4geS5pdGVtcy52YWxpZGF0ZUl0ZW1zKHkuZ2V0U3R5bGVJdGVtcygpKTsKICAgICAgfQogICAgfSksIHcgPSBHaygwLCBsLCBOTyh4ID0gcykpLCB4LnVpLnJlZ2lzdHJ5LmFkZE5lc3RlZE1lbnVJdGVtKCJibG9ja2Zvcm1hdHMiLCB7CiAgICAgIHRleHQ6ICJCbG9ja3MiLAogICAgICBnZXRTdWJtZW51SXRlbXM6IGZ1bmN0aW9uIGdldFN1Ym1lbnVJdGVtcygpIHsKICAgICAgICByZXR1cm4gdy5pdGVtcy52YWxpZGF0ZUl0ZW1zKHcuZ2V0U3R5bGVJdGVtcygpKTsKICAgICAgfQogICAgfSksIEMgPSBHaygwLCBsLCBITyhTID0gcykpLCBTLnVpLnJlZ2lzdHJ5LmFkZE5lc3RlZE1lbnVJdGVtKCJmb250c2l6ZXMiLCB7CiAgICAgIHRleHQ6ICJGb250IHNpemVzIiwKICAgICAgZ2V0U3VibWVudUl0ZW1zOiBmdW5jdGlvbiBnZXRTdWJtZW51SXRlbXMoKSB7CiAgICAgICAgcmV0dXJuIEMuaXRlbXMudmFsaWRhdGVJdGVtcyhDLmdldFN0eWxlSXRlbXMoKSk7CiAgICAgIH0KICAgIH0pLCAoYSA9IHUgPSB0KS51aS5yZWdpc3RyeS5hZGRNZW51SXRlbSgidW5kbyIsIHsKICAgICAgdGV4dDogIlVuZG8iLAogICAgICBpY29uOiAidW5kbyIsCiAgICAgIHNob3J0Y3V0OiAiTWV0YStaIiwKICAgICAgb25TZXR1cDogSl8oYSwgImhhc1VuZG8iKSwKICAgICAgb25BY3Rpb246IGprKGEsICJ1bmRvIikKICAgIH0pLCBhLnVpLnJlZ2lzdHJ5LmFkZE1lbnVJdGVtKCJyZWRvIiwgewogICAgICB0ZXh0OiAiUmVkbyIsCiAgICAgIGljb246ICJyZWRvIiwKICAgICAgc2hvcnRjdXQ6ICJNZXRhK1kiLAogICAgICBvblNldHVwOiBKXyhhLCAiaGFzUmVkbyIpLAogICAgICBvbkFjdGlvbjogamsoYSwgInJlZG8iKQogICAgfSksIChjID0gdSkudWkucmVnaXN0cnkuYWRkQnV0dG9uKCJ1bmRvIiwgewogICAgICB0b29sdGlwOiAiVW5kbyIsCiAgICAgIGljb246ICJ1bmRvIiwKICAgICAgZGlzYWJsZWQ6ICEwLAogICAgICBvblNldHVwOiBKXyhjLCAiaGFzVW5kbyIpLAogICAgICBvbkFjdGlvbjogamsoYywgInVuZG8iKQogICAgfSksIGMudWkucmVnaXN0cnkuYWRkQnV0dG9uKCJyZWRvIiwgewogICAgICB0b29sdGlwOiAiUmVkbyIsCiAgICAgIGljb246ICJyZWRvIiwKICAgICAgZGlzYWJsZWQ6ICEwLAogICAgICBvblNldHVwOiBKXyhjLCAiaGFzUmVkbyIpLAogICAgICBvbkFjdGlvbjogamsoYywgInJlZG8iKQogICAgfSksIGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBpOwogICAgICAoaSA9IHQpLmFkZENvbW1hbmQoIm1jZUFwcGx5VGV4dGNvbG9yIiwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICB2YXIgZSwKICAgICAgICAgICAgbyA9IHQsCiAgICAgICAgICAgIHIgPSBuOwogICAgICAgIChlID0gaSkudW5kb01hbmFnZXIudHJhbnNhY3QoZnVuY3Rpb24gKCkgewogICAgICAgICAgZS5mb2N1cygpLCBlLmZvcm1hdHRlci5hcHBseShvLCB7CiAgICAgICAgICAgIHZhbHVlOiByCiAgICAgICAgICB9KSwgZS5ub2RlQ2hhbmdlZCgpOwogICAgICAgIH0pOwogICAgICB9KSwgaS5hZGRDb21tYW5kKCJtY2VSZW1vdmVUZXh0Y29sb3IiLCBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBuLAogICAgICAgICAgICBlID0gdDsKICAgICAgICAobiA9IGkpLnVuZG9NYW5hZ2VyLnRyYW5zYWN0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG4uZm9jdXMoKSwgbi5mb3JtYXR0ZXIucmVtb3ZlKGUsIHsKICAgICAgICAgICAgdmFsdWU6IG51bGwKICAgICAgICAgIH0sIG51bGwsICEwKSwgbi5ub2RlQ2hhbmdlZCgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgdmFyIG4gPSBWbyhudWxsKSwKICAgICAgICAgIGUgPSBWbyhudWxsKTsKICAgICAgd2IodCwgImZvcmVjb2xvciIsICJmb3JlY29sb3IiLCAiVGV4dCBjb2xvciIsIG4pLCB3Yih0LCAiYmFja2NvbG9yIiwgImhpbGl0ZWNvbG9yIiwgIkJhY2tncm91bmQgY29sb3IiLCBlKSwgU2IodCwgImZvcmVjb2xvciIsICJmb3JlY29sb3IiLCAiVGV4dCBjb2xvciIpLCBTYih0LCAiYmFja2NvbG9yIiwgImhpbGl0ZWNvbG9yIiwgIkJhY2tncm91bmQgY29sb3IiKTsKICAgIH0odCksICRfKHQpLCAociA9IHQpLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbigib3V0ZGVudCIsIHsKICAgICAgdG9vbHRpcDogIkRlY3JlYXNlIGluZGVudCIsCiAgICAgIGljb246ICJvdXRkZW50IiwKICAgICAgb25TZXR1cDogV2soaSA9IHIsICJOb2RlQ2hhbmdlIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB0LnNldERpc2FibGVkKCFpLnF1ZXJ5Q29tbWFuZFN0YXRlKCJvdXRkZW50IikpOwogICAgICB9KSwKICAgICAgb25BY3Rpb246IGprKHIsICJvdXRkZW50IikKICAgIH0pLCByLnVpLnJlZ2lzdHJ5LmFkZEJ1dHRvbigiaW5kZW50IiwgewogICAgICB0b29sdGlwOiAiSW5jcmVhc2UgaW5kZW50IiwKICAgICAgaWNvbjogImluZGVudCIsCiAgICAgIG9uQWN0aW9uOiBqayhyLCAiaW5kZW50IikKICAgIH0pLCBZXyhlID0gdCwgUFQpLCBvID0gZSwgdnQuZnJvbShvLmdldFBhcmFtKCJjb250ZW50X2xhbmdzIiwgdm9pZCAwLCAiYXJyYXkiKSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogImxhbmd1YWdlIiwKICAgICAgICB0ZXh0OiAiTGFuZ3VhZ2UiLAogICAgICAgIGljb246ICJsYW5ndWFnZSIsCiAgICAgICAgZ2V0T3B0aW9uczogcnQodCksCiAgICAgICAgaGFzaDogZnVuY3Rpb24gaGFzaCh0KSB7CiAgICAgICAgICByZXR1cm4gRSh0LmN1c3RvbUNvZGUpID8gdC5jb2RlIDogdC5jb2RlICsgIi8iICsgdC5jdXN0b21Db2RlOwogICAgICAgIH0sCiAgICAgICAgZGlzcGxheTogZnVuY3Rpb24gZGlzcGxheSh0KSB7CiAgICAgICAgICByZXR1cm4gdC50aXRsZTsKICAgICAgICB9LAogICAgICAgIHdhdGNoZXI6IGZ1bmN0aW9uIHdhdGNoZXIodCwgbiwgZSkgewogICAgICAgICAgcmV0dXJuIHQuZm9ybWF0dGVyLmZvcm1hdENoYW5nZWQoImxhbmciLCBlLCAhMSwgewogICAgICAgICAgICB2YWx1ZTogbi5jb2RlLAogICAgICAgICAgICBjdXN0b21WYWx1ZTogbi5jdXN0b21Db2RlCiAgICAgICAgICB9KS51bmJpbmQ7CiAgICAgICAgfSwKICAgICAgICBnZXRDdXJyZW50OiBmdW5jdGlvbiBnZXRDdXJyZW50KHQpIHsKICAgICAgICAgIHJldHVybiBkcihBdC5mcm9tRG9tKHQuc2VsZWN0aW9uLmdldE5vZGUoKSksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB2dC5zb21lKHQpLmZpbHRlcihHbikuYmluZChmdW5jdGlvbiAobikgewogICAgICAgICAgICAgIHJldHVybiB1bihuLCAibGFuZyIpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgY29kZTogdCwKICAgICAgICAgICAgICAgICAgY3VzdG9tQ29kZTogdW4obiwgImRhdGEtbWNlLWxhbmciKS5nZXRPclVuZGVmaW5lZCgpLAogICAgICAgICAgICAgICAgICB0aXRsZTogIiIKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBzZXRDdXJyZW50OiBmdW5jdGlvbiBzZXRDdXJyZW50KHQsIG4pIHsKICAgICAgICAgIHJldHVybiB0LmV4ZWNDb21tYW5kKCJMYW5nIiwgITEsIG4pOwogICAgICAgIH0sCiAgICAgICAgb25Ub29sYmFyU2V0dXA6IGZ1bmN0aW9uIG9uVG9vbGJhclNldHVwKHQpIHsKICAgICAgICAgIHZhciBuID0gZmMoKTsKICAgICAgICAgIHJldHVybiB0LnNldEFjdGl2ZShvLmZvcm1hdHRlci5tYXRjaCgibGFuZyIsIHt9LCB2b2lkIDAsICEwKSksIG4uc2V0KG8uZm9ybWF0dGVyLmZvcm1hdENoYW5nZWQoImxhbmciLCB0LnNldEFjdGl2ZSwgITApKSwgbi5jbGVhcjsKICAgICAgICB9CiAgICAgIH07CiAgICB9KS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBZXyhlLCB0KTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gWl8odCwgbikgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogIm1ha2VzaGlmdCIsCiAgICAgIHg6IHQsCiAgICAgIHk6IG4KICAgIH07CiAgfQoKICBmdW5jdGlvbiB0VCh0KSB7CiAgICByZXR1cm4gImxvbmdwcmVzcyIgPT09IHQudHlwZSB8fCAwID09PSB0LnR5cGUuaW5kZXhPZigidG91Y2giKTsKICB9CgogIGZ1bmN0aW9uIG5UKHQsIG4pIHsKICAgIHJldHVybiAiY29udGV4dG1lbnUiID09PSBuLnR5cGUgfHwgImxvbmdwcmVzcyIgPT09IG4udHlwZSA/IHQuaW5saW5lID8gZnVuY3Rpb24gKHQpIHsKICAgICAgaWYgKHRUKHQpKSB7CiAgICAgICAgdmFyIG4gPSB0LnRvdWNoZXNbMF07CiAgICAgICAgcmV0dXJuIFpfKG4ucGFnZVgsIG4ucGFnZVkpOwogICAgICB9CgogICAgICByZXR1cm4gWl8odC5wYWdlWCwgdC5wYWdlWSk7CiAgICB9KG4pIDogKGUgPSB0LmdldENvbnRlbnRBcmVhQ29udGFpbmVyKCksIG8gPSBmdW5jdGlvbiAodCkgewogICAgICBpZiAodFQodCkpIHsKICAgICAgICB2YXIgbiA9IHQudG91Y2hlc1swXTsKICAgICAgICByZXR1cm4gWl8obi5jbGllbnRYLCBuLmNsaWVudFkpOwogICAgICB9CgogICAgICByZXR1cm4gWl8odC5jbGllbnRYLCB0LmNsaWVudFkpOwogICAgfShuKSwgciA9IHR2LkRPTS5nZXRQb3MoZSksIGkgPSByLngsIHUgPSByLnksIFpfKG8ueCArIGksIG8ueSArIHUpKSA6IEhUKHQpOwogICAgdmFyIGUsIG8sIHIsIGksIHU7CiAgfQoKICBmdW5jdGlvbiBlVCh0LCBuLCBlKSB7CiAgICBzd2l0Y2ggKGUpIHsKICAgICAgY2FzZSAibm9kZSI6CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICJub2RlIiwKICAgICAgICAgIG5vZGU6IHZ0LnNvbWUoQXQuZnJvbURvbSgobyA9IHQpLnNlbGVjdGlvbi5nZXROb2RlKCkpKSwKICAgICAgICAgIHJvb3Q6IEF0LmZyb21Eb20oby5nZXRCb2R5KCkpCiAgICAgICAgfTsKCiAgICAgIGNhc2UgInBvaW50IjoKICAgICAgICByZXR1cm4gblQodCwgbik7CgogICAgICBjYXNlICJzZWxlY3Rpb24iOgogICAgICAgIHJldHVybiBIVCh0KTsKICAgIH0KCiAgICB2YXIgbzsKICB9CgogIGZ1bmN0aW9uIG9UKGYsIGQsIG0sIGcsIHAsIGgpIHsKICAgIGZ1bmN0aW9uIHQoKSB7CiAgICAgIHZhciBuLAogICAgICAgICAgZSwKICAgICAgICAgIHQsCiAgICAgICAgICBvLAogICAgICAgICAgciwKICAgICAgICAgIGksCiAgICAgICAgICB1LAogICAgICAgICAgYSwKICAgICAgICAgIGMsCiAgICAgICAgICBzLAogICAgICAgICAgbCA9IG0oKTsKICAgICAgdCA9IGwsIG8gPSBnLCByID0gcCwgdSA9ICEoeSB8fCB2IHx8IGIgJiYgeCksIGMgPSBlVChuID0gZiwgZSA9IGQsIGEgPSBpID0gaCksIHMgPSBfbHQoewogICAgICAgIGJ1YmJsZTogeGMoMCwgInBvaW50IiA9PT0gYSA/IDEyIDogMCwgTlQpLAogICAgICAgIGxheW91dHM6IHpULAogICAgICAgIG92ZXJyaWRlczogewogICAgICAgICAgbWF4V2lkdGhGdW5jdGlvbjogZE8oKSwKICAgICAgICAgIG1heEhlaWdodEZ1bmN0aW9uOiBJYygpCiAgICAgICAgfQogICAgICB9LCBjKSwgejAodCwgeGguQ0xPU0VfT05fRVhFQ1VURSwgbywgITApLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKSwgcnAuc2hvd01lbnVXaXRoaW5Cb3VuZHMociwgewogICAgICAgICAgYW5jaG9yOiBzCiAgICAgICAgfSwgewogICAgICAgICAgbWVudTogewogICAgICAgICAgICBtYXJrZXJzOiBKcCgibm9ybWFsIiksCiAgICAgICAgICAgIGhpZ2hsaWdodEltbWVkaWF0ZWx5OiB1CiAgICAgICAgICB9LAogICAgICAgICAgZGF0YTogdCwKICAgICAgICAgIHR5cGU6ICJob3Jpem9udGFsIgogICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB2dC5zb21lKHJfKG4sIG8uc2hhcmVkLCAibm9kZSIgPT09IGkgPyAibm9kZSIgOiAic2VsZWN0aW9uIikpOwogICAgICAgIH0pLCBuLmZpcmUoUl8pOwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgbiwKICAgICAgICBlID0gc2UoKSwKICAgICAgICB2ID0gZS5vcy5pc2lPUygpLAogICAgICAgIGIgPSBlLm9zLmlzT1NYKCksCiAgICAgICAgeSA9IGUub3MuaXNBbmRyb2lkKCksCiAgICAgICAgeCA9IGUuZGV2aWNlVHlwZS5pc1RvdWNoKCk7CiAgICAoYiB8fCB2KSAmJiAibm9kZSIgIT09IGggPyAobiA9IGZ1bmN0aW9uIG4oKSB7CiAgICAgIChmdW5jdGlvbiAodCkgewogICAgICAgIGZ1bmN0aW9uIG4oKSB7CiAgICAgICAgICBjcC5zZXRFZGl0b3JUaW1lb3V0KHQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdC5zZWxlY3Rpb24uc2V0Um5nKGUpOwogICAgICAgICAgfSwgMTApLCBpKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgZSA9IHQuc2VsZWN0aW9uLmdldFJuZygpOwoKICAgICAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgICAgIHQucHJldmVudERlZmF1bHQoKSwgdC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgICByZXR1cm4gaSgpOwogICAgICAgIH0KCiAgICAgICAgdC5vbmNlKCJ0b3VjaGVuZCIsIG4pLCB0Lm9uKCJtb3VzZWRvd24iLCBvLCAhMCksIHQub25jZSgibG9uZ3ByZXNzY2FuY2VsIiwgcik7CgogICAgICAgIHZhciBpID0gZnVuY3Rpb24gaSgpIHsKICAgICAgICAgIHQub2ZmKCJ0b3VjaGVuZCIsIG4pLCB0Lm9mZigibG9uZ3ByZXNzY2FuY2VsIiwgciksIHQub2ZmKCJtb3VzZWRvd24iLCBvKTsKICAgICAgICB9OwogICAgICB9KShmKSwgdCgpOwogICAgfSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgdmFyIGUgPSB0LnNlbGVjdGlvbjsKCiAgICAgIGlmICghKGUuaXNDb2xsYXBzZWQoKSB8fCBuLnRvdWNoZXMubGVuZ3RoIDwgMSkpIHsKICAgICAgICB2YXIgbyA9IG4udG91Y2hlc1swXSwKICAgICAgICAgICAgciA9IGUuZ2V0Um5nKCk7CiAgICAgICAgcmV0dXJuIGJzKHQuZ2V0V2luKCksIGZzLmRvbVJhbmdlKHIpKS5leGlzdHMoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LmxlZnQgPD0gby5jbGllbnRYICYmIHQucmlnaHQgPj0gby5jbGllbnRYICYmIHQudG9wIDw9IG8uY2xpZW50WSAmJiB0LmJvdHRvbSA+PSBvLmNsaWVudFk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0oZiwgZCkgPyBuKCkgOiAoZi5vbmNlKCJzZWxlY3Rpb25jaGFuZ2UiLCBuKSwgZi5vbmNlKCJ0b3VjaGVuZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGYub2ZmKCJzZWxlY3Rpb25jaGFuZ2UiLCBuKTsKICAgIH0pKSkgOiB0KCk7CiAgfQoKICBmdW5jdGlvbiByVCh0KSB7CiAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIHQgPyB0LnNwbGl0KC9bICxdLykgOiB0OwogIH0KCiAgZnVuY3Rpb24gaVQodCkgewogICAgcmV0dXJuIHQuZ2V0UGFyYW0oImNvbnRleHRtZW51X25ldmVyX3VzZV9uYXRpdmUiLCAhMSwgImJvb2xlYW4iKTsKICB9CgogIGZ1bmN0aW9uIHVUKHQpIHsKICAgIHJldHVybiB5KHQpID8gInwiID09PSB0IDogInNlcGFyYXRvciIgPT09IHQudHlwZTsKICB9CgogIGZ1bmN0aW9uIGFUKHQsIG4pIHsKICAgIGlmICgwID09PSBuLmxlbmd0aCkgcmV0dXJuIHQ7CiAgICB2YXIgZSA9IHEodCkuZmlsdGVyKGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiAhdVQodCk7CiAgICB9KS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIFtMVF07CiAgICB9KTsKICAgIHJldHVybiB0LmNvbmNhdChlKS5jb25jYXQobikuY29uY2F0KFtMVF0pOwogIH0KCiAgZnVuY3Rpb24gY1QodCwgbikgewogICAgcmV0dXJuICJsb25ncHJlc3MiICE9PSBuLnR5cGUgJiYgKDIgIT09IG4uYnV0dG9uIHx8IG4udGFyZ2V0ID09PSB0LmdldEJvZHkoKSAmJiAiIiA9PT0gbi5wb2ludGVyVHlwZSk7CiAgfQoKICBmdW5jdGlvbiBzVCh0LCBuKSB7CiAgICByZXR1cm4gY1QodCwgbikgPyB0LnNlbGVjdGlvbi5nZXRTdGFydCghMCkgOiBuLnRhcmdldDsKICB9CgogIGZ1bmN0aW9uIGxUKHMsIHQsIG4pIHsKICAgIGZ1bmN0aW9uIGUodCkgewogICAgICByZXR1cm4gcnAuaGlkZShpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvKGMpIHsKICAgICAgdmFyIHQ7CiAgICAgIGlUKHMpICYmIGMucHJldmVudERlZmF1bHQoKSwgYy5jdHJsS2V5ICYmICFpVChzKSB8fCAhMSA9PT0gcy5nZXRQYXJhbSgiY29udGV4dG1lbnUiKSB8fCAodCA9IGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgdmFyIGUgPSB0LmdldFBhcmFtKCJjb250ZXh0bWVudV9hdm9pZF9vdmVybGFwIiwgIiIsICJzdHJpbmciKSwKICAgICAgICAgICAgbyA9IGNUKHQsIG4pID8gInNlbGVjdGlvbiIgOiAicG9pbnQiOwoKICAgICAgICBpZiAoYXQoZSkpIHsKICAgICAgICAgIHZhciByID0gc1QodCwgbik7CiAgICAgICAgICByZXR1cm4gVWIoQXQuZnJvbURvbShyKSwgZSkgPyAibm9kZSIgOiBvOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG87CiAgICAgIH0ocywgYyksIChyKCkgPyBvVCA6IGZ1bmN0aW9uICh0LCBuLCBlLCBvLCByLCBpKSB7CiAgICAgICAgdmFyIHUgPSBlKCksCiAgICAgICAgICAgIGEgPSBlVCh0LCBuLCBpKTsKICAgICAgICB6MCh1LCB4aC5DTE9TRV9PTl9FWEVDVVRFLCBvLCAhMSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBuLnByZXZlbnREZWZhdWx0KCksIHJwLnNob3dNZW51QXQociwgewogICAgICAgICAgICBhbmNob3I6IGEKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgbWVudTogewogICAgICAgICAgICAgIG1hcmtlcnM6IEpwKCJub3JtYWwiKQogICAgICAgICAgICB9LAogICAgICAgICAgICBkYXRhOiB0CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSkocywgYywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0LAogICAgICAgICAgICBuLAogICAgICAgICAgICBlLAogICAgICAgICAgICBvID0gc1QocywgYyksCiAgICAgICAgICAgIHIgPSBzLnVpLnJlZ2lzdHJ5LmdldEFsbCgpLAogICAgICAgICAgICBpID0gKGUgPSAobiA9IHMpLnVpLnJlZ2lzdHJ5LmdldEFsbCgpLmNvbnRleHRNZW51cywgdnQuZnJvbShuLmdldFBhcmFtKCJjb250ZXh0bWVudSIpKS5tYXAoclQpLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIEYoclQoImxpbmsgbGlua2NoZWNrZXIgaW1hZ2UgaW1hZ2V0b29scyB0YWJsZSBzcGVsbGNoZWNrZXIgY29uZmlndXJlcGVybWFuZW50cGVuIiksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiBUdChlLCB0KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pKSwKICAgICAgICAgICAgdSA9IHIuY29udGV4dE1lbnVzLAogICAgICAgICAgICBhID0gbzsKICAgICAgICByZXR1cm4gMCA8ICh0ID0gUihpLCBmdW5jdGlvbiAobywgdCkgewogICAgICAgICAgcmV0dXJuIHR0KHUsIHQudG9Mb3dlckNhc2UoKSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHZhciBuID0gdC51cGRhdGUoYSk7CiAgICAgICAgICAgIGlmICh5KG4pKSByZXR1cm4gYVQobywgbi5zcGxpdCgiICIpKTsKCiAgICAgICAgICAgIGlmICgwIDwgbi5sZW5ndGgpIHsKICAgICAgICAgICAgICB2YXIgZSA9IE0obiwgV1QpOwogICAgICAgICAgICAgIHJldHVybiBhVChvLCBlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG87CiAgICAgICAgICB9KS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG8uY29uY2F0KFt0XSk7CiAgICAgICAgICB9KTsKICAgICAgICB9LCBbXSkpLmxlbmd0aCAmJiB1VCh0W3QubGVuZ3RoIC0gMV0pICYmIHQucG9wKCksIHQ7CiAgICAgIH0sIG4sIGksIHQpKTsKICAgIH0KCiAgICB2YXIgciA9IHNlKCkuZGV2aWNlVHlwZS5pc1RvdWNoLAogICAgICAgIGkgPSBfdShycC5za2V0Y2goewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiCiAgICAgIH0sCiAgICAgIGxhenlTaW5rOiB0LAogICAgICBvbkVzY2FwZTogZnVuY3Rpb24gb25Fc2NhcGUoKSB7CiAgICAgICAgcmV0dXJuIHMuZm9jdXMoKTsKICAgICAgfSwKICAgICAgb25TaG93OiBmdW5jdGlvbiBvblNob3coKSB7CiAgICAgICAgcmV0dXJuIG4uc2V0Q29udGV4dE1lbnVTdGF0ZSghMCk7CiAgICAgIH0sCiAgICAgIG9uSGlkZTogZnVuY3Rpb24gb25IaWRlKCkgewogICAgICAgIHJldHVybiBuLnNldENvbnRleHRNZW51U3RhdGUoITEpOwogICAgICB9LAogICAgICBmaXJlRGlzbWlzc2FsRXZlbnRJbnN0ZWFkOiB7fSwKICAgICAgaW5saW5lQmVoYXZpb3VyczogdGMoW2ZtKCJkaXNtaXNzQ29udGV4dE1lbnUiLCBbQ3IoWGkoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBoZi5jbG9zZSh0KSwgcy5mb2N1cygpOwogICAgICB9KV0pXSkKICAgIH0pKTsKCiAgICBzLm9uKCJpbml0IiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgdCA9ICJSZXNpemVFZGl0b3IgU2Nyb2xsQ29udGVudCBTY3JvbGxXaW5kb3cgbG9uZ3ByZXNzY2FuY2VsIiArIChyKCkgPyAiIiA6ICIgUmVzaXplV2luZG93Iik7CiAgICAgIHMub24odCwgZSksIHMub24oImxvbmdwcmVzcyBjb250ZXh0bWVudSIsIG8pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBmVChuKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQudHJhbnNsYXRlKC1uLmxlZnQsIC1uLnRvcCk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gZFQobikgewogICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0LnRyYW5zbGF0ZShuLmxlZnQsIG4udG9wKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBtVChlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIFIoZSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICByZXR1cm4gbih0KTsKICAgICAgfSwgU2UodCwgbikpOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIGdUKHQsIG4sIGUpIHsKICAgIHJldHVybiB0LmZvbGQobVQoW2RUKGUpLCBmVChuKV0pLCBtVChbZlQobildKSwgbVQoW10pKTsKICB9CgogIGZ1bmN0aW9uIHBUKHQsIG4sIGUpIHsKICAgIHJldHVybiB0LmZvbGQobVQoW2RUKGUpXSksIG1UKFtdKSwgbVQoW2RUKG4pXSkpOwogIH0KCiAgZnVuY3Rpb24gaFQodCwgbiwgZSkgewogICAgcmV0dXJuIHQuZm9sZChtVChbXSksIG1UKFtmVChlKV0pLCBtVChbZFQobiksIGZUKGUpXSkpOwogIH0KCiAgZnVuY3Rpb24gdlQodCwgbiwgZSkgewogICAgdmFyIG8gPSB0LmZvbGQoZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBwb3NpdGlvbjogdnQuc29tZSgiYWJzb2x1dGUiKSwKICAgICAgICBsZWZ0OiB2dC5zb21lKHQgKyAicHgiKSwKICAgICAgICB0b3A6IHZ0LnNvbWUobiArICJweCIpCiAgICAgIH07CiAgICB9LCBmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gewogICAgICAgIHBvc2l0aW9uOiB2dC5zb21lKCJhYnNvbHV0ZSIpLAogICAgICAgIGxlZnQ6IHZ0LnNvbWUodCAtIGUubGVmdCArICJweCIpLAogICAgICAgIHRvcDogdnQuc29tZShuIC0gZS50b3AgKyAicHgiKQogICAgICB9OwogICAgfSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBwb3NpdGlvbjogdnQuc29tZSgiZml4ZWQiKSwKICAgICAgICBsZWZ0OiB2dC5zb21lKHQgKyAicHgiKSwKICAgICAgICB0b3A6IHZ0LnNvbWUobiArICJweCIpCiAgICAgIH07CiAgICB9KTsKICAgIHJldHVybiBfbHQoewogICAgICByaWdodDogdnQubm9uZSgpLAogICAgICBib3R0b206IHZ0Lm5vbmUoKQogICAgfSwgbyk7CiAgfQoKICBmdW5jdGlvbiBiVCh0LCBpLCB1LCBhKSB7CiAgICBmdW5jdGlvbiBuKG8sIHIpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgdmFyIGUgPSBvKGksIHUsIGEpOwogICAgICAgIHJldHVybiByKHQuZ2V0T3IoZS5sZWZ0KSwgbi5nZXRPcihlLnRvcCkpOwogICAgICB9OwogICAgfQoKICAgIHJldHVybiB0LmZvbGQobihoVCwgalQpLCBuKHBULCBHVCksIG4oZ1QsIFhUKSk7CiAgfQoKICBmdW5jdGlvbiB5VCh0LCBuKSB7CiAgICB2YXIgZSA9IHJuKHQsIG4pOwogICAgcmV0dXJuIEUoZSkgPyBOYU4gOiBwYXJzZUludChlLCAxMCk7CiAgfQoKICBmdW5jdGlvbiB4VCh0LCBuLCBlLCBvLCByLCBpKSB7CiAgICB2YXIgdSwKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICAgcywKICAgICAgICBsLAogICAgICAgIGYsCiAgICAgICAgZCA9ICh1ID0gZSwgYSA9IG8sIGwgPSB5VChzID0gdC5lbGVtZW50LCAoYyA9IG4pLmxlZnRBdHRyKSwgZiA9IHlUKHMsIGMudG9wQXR0ciksIChpc05hTihsKSB8fCBpc05hTihmKSA/IHZ0Lm5vbmUoKSA6IHZ0LnNvbWUoU2UobCwgZikpKS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHU7CiAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gWFQodC5sZWZ0ICsgYS5sZWZ0LCB0LnRvcCArIGEudG9wKTsKICAgIH0pKSwKICAgICAgICBtID0gKG4ubXVzdFNuYXAgPyBZVCA6IHFUKSh0LCBuLCBkLCByLCBpKSwKICAgICAgICBnID0gZ1QoZCwgciwgaSksCiAgICAgICAgcCA9IG4sCiAgICAgICAgaCA9IGcsCiAgICAgICAgdiA9IHQuZWxlbWVudDsKICAgIHJldHVybiBvbih2LCBwLmxlZnRBdHRyLCBoLmxlZnQgKyAicHgiKSwgb24odiwgcC50b3BBdHRyLCBoLnRvcCArICJweCIpLCBtLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gewogICAgICAgIGNvb3JkOiBYVChnLmxlZnQsIGcudG9wKSwKICAgICAgICBleHRyYTogdnQubm9uZSgpCiAgICAgIH07CiAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gewogICAgICAgIGNvb3JkOiB0Lm91dHB1dCwKICAgICAgICBleHRyYTogdC5leHRyYQogICAgICB9OwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB3VCh0LCBjLCBzLCBsKSB7CiAgICByZXR1cm4gSyh0LCBmdW5jdGlvbiAodCkgewogICAgICB2YXIgbiwKICAgICAgICAgIGUsCiAgICAgICAgICBvID0gdC5zZW5zb3IsCiAgICAgICAgICByID0gdC5yYW5nZS5sZWZ0LAogICAgICAgICAgaSA9IHQucmFuZ2UudG9wLAogICAgICAgICAgdSA9IHBUKGMsIG4gPSBzLCBlID0gbCksCiAgICAgICAgICBhID0gcFQobywgbiwgZSk7CiAgICAgIHJldHVybiBNYXRoLmFicyh1LmxlZnQgLSBhLmxlZnQpIDw9IHIgJiYgTWF0aC5hYnModS50b3AgLSBhLnRvcCkgPD0gaSA/IHZ0LnNvbWUoewogICAgICAgIG91dHB1dDogYlQodC5vdXRwdXQsIGMsIHMsIGwpLAogICAgICAgIGV4dHJhOiB0LmV4dHJhCiAgICAgIH0pIDogdnQubm9uZSgpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBTVCh0LCBuKSB7CiAgICB2YXIgZTsKICAgIHQuZ2V0U3lzdGVtKCkuYWRkVG9HdWkobiksIFl0KChlID0gbikuZWxlbWVudCkuZmlsdGVyKEduKS5lYWNoKGZ1bmN0aW9uIChuKSB7CiAgICAgIHBuKG4sICJ6LWluZGV4IikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIG9uKG4sIEpULCB0KTsKICAgICAgfSksIGZuKG4sICJ6LWluZGV4IiwgZ24oZS5lbGVtZW50LCAiei1pbmRleCIpKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gQ1QodCkgewogICAgWXQodC5lbGVtZW50KS5maWx0ZXIoR24pLmVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgdW4obiwgSlQpLmZvbGQoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB2bihuLCAiei1pbmRleCIpOwogICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBmbihuLCAiei1pbmRleCIsIHQpOwogICAgICB9KSwgY24obiwgSlQpOwogICAgfSksIHQuZ2V0U3lzdGVtKCkucmVtb3ZlRnJvbUd1aSh0KTsKICB9CgogIGZ1bmN0aW9uIGtUKHQsIG4sIGUpIHsKICAgIHJldHVybiB0LmdldFN5c3RlbSgpLmJ1aWxkKHV5LnNrZXRjaCh7CiAgICAgIGRvbTogewogICAgICAgIHN0eWxlczogewogICAgICAgICAgbGVmdDogIjBweCIsCiAgICAgICAgICB0b3A6ICIwcHgiLAogICAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICAgIGhlaWdodDogIjEwMCUiLAogICAgICAgICAgcG9zaXRpb246ICJmaXhlZCIsCiAgICAgICAgICAiei1pbmRleCI6ICIxMDAwMDAwMDAwMDAwMDAwIgogICAgICAgIH0sCiAgICAgICAgY2xhc3NlczogW25dCiAgICAgIH0sCiAgICAgIGV2ZW50czogZQogICAgfSkpOwogIH0KCiAgZnVuY3Rpb24gT1QodCwgbikgewogICAgcmV0dXJuIHsKICAgICAgYm91bmRzOiB0LmdldEJvdW5kcygpLAogICAgICBoZWlnaHQ6IHduKG4uZWxlbWVudCksCiAgICAgIHdpZHRoOiBPbihuLmVsZW1lbnQpCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gX1QoQiwgTSwgdCwgbiwgZSkgewogICAgdmFyIG8gPSB0LnVwZGF0ZShuLCBlKSwKICAgICAgICBBID0gdC5nZXRTdGFydERhdGEoKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE9UKE0sIEIpOwogICAgfSk7CiAgICBvLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBlLAogICAgICAgICAgbywKICAgICAgICAgIHIsCiAgICAgICAgICBpLAogICAgICAgICAgdSwKICAgICAgICAgIGEsCiAgICAgICAgICBjLAogICAgICAgICAgcywKICAgICAgICAgIGwsCiAgICAgICAgICBmLAogICAgICAgICAgZCwKICAgICAgICAgIG0sCiAgICAgICAgICBnLAogICAgICAgICAgcCwKICAgICAgICAgIGgsCiAgICAgICAgICB2LAogICAgICAgICAgYiwKICAgICAgICAgIHksCiAgICAgICAgICB4LAogICAgICAgICAgdywKICAgICAgICAgIFMsCiAgICAgICAgICBDLAogICAgICAgICAgaywKICAgICAgICAgIE8sCiAgICAgICAgICBfID0gQiwKICAgICAgICAgIFQgPSBBLAogICAgICAgICAgRSA9IHQsCiAgICAgICAgICBEID0gKG4gPSBNKS5nZXRUYXJnZXQoXy5lbGVtZW50KTsKICAgICAgbi5yZXBvc2l0aW9uVGFyZ2V0ICYmIChlID0gSW4oVXQoXy5lbGVtZW50KSksIG8gPSB6QyhEKSwgUyA9IHBuKHcgPSBELCAibGVmdCIpLCBDID0gcG4odywgInRvcCIpLCBrID0gcG4odywgInBvc2l0aW9uIiksIE8gPSBmdW5jdGlvbiBPKHQsIG4sIGUpIHsKICAgICAgICByZXR1cm4gKCJmaXhlZCIgPT09IGUgPyBYVCA6IGpUKShwYXJzZUludCh0LCAxMCksIHBhcnNlSW50KG4sIDEwKSk7CiAgICAgIH0sIHIgPSAoUy5pc1NvbWUoKSAmJiBDLmlzU29tZSgpICYmIGsuaXNTb21lKCkgPyB2dC5zb21lKE8oUy5nZXRPckRpZSgpLCBDLmdldE9yRGllKCksIGsuZ2V0T3JEaWUoKSkpIDogdnQubm9uZSgpKS5nZXRPclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IENuKHcpOwogICAgICAgIHJldHVybiBHVCh0LmxlZnQsIHQudG9wKTsKICAgICAgfSksIGkgPSBfLCB1ID0gbi5zbmFwcywgYSA9IHIsIGMgPSBlLCBzID0gbywgbCA9IEUsIGYgPSBULCBtID0gdS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZSwKICAgICAgICAgICAgbywKICAgICAgICAgICAgdCA9IGdUKChlID0gbC5sZWZ0LCBvID0gbC50b3AsIGEuZm9sZChmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgcmV0dXJuIGpUKHQgKyBlLCBuICsgbyk7CiAgICAgICAgfSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIHJldHVybiBHVCh0ICsgZSwgbiArIG8pOwogICAgICAgIH0sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICByZXR1cm4gWFQodCArIGUsIG4gKyBvKTsKICAgICAgICB9KSksIGMsIHMpOwogICAgICAgIHJldHVybiBYVCh0LmxlZnQsIHQudG9wKTsKICAgICAgfSwgZnVuY3Rpb24gKG4pIHsKICAgICAgICB2YXIgdCA9IHhUKGksIG4sIGEsIGwsIGMsIHMpOwogICAgICAgIHJldHVybiB0LmV4dHJhLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIG4ub25TZW5zb3IoaSwgdCk7CiAgICAgICAgfSksIHQuY29vcmQ7CiAgICAgIH0pLCBnID0gYywgcCA9IHMsIGggPSAoZCA9IGYpLmJvdW5kcywgdiA9IHBUKG0sIGcsIHApLCBiID0gVWEodi5sZWZ0LCBoLngsIGgueCArIGgud2lkdGggLSBkLndpZHRoKSwgeSA9IFVhKHYudG9wLCBoLnksIGgueSArIGguaGVpZ2h0IC0gZC5oZWlnaHQpLCB4ID0gR1QoYiwgeSksIG1uKEQsIHZUKG0uZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQgPSBoVCh4LCBnLCBwKTsKICAgICAgICByZXR1cm4galQodC5sZWZ0LCB0LnRvcCk7CiAgICAgIH0sIHJ0KHgpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQgPSBnVCh4LCBnLCBwKTsKICAgICAgICByZXR1cm4gWFQodC5sZWZ0LCB0LnRvcCk7CiAgICAgIH0pLCAwLCBvKSkpLCBuLm9uRHJhZyhfLCBELCBFKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gVFQobywgdCwgbiwgZSkgewogICAgdC5lYWNoKENUKSwgbi5zbmFwcy5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBuLCBlOwogICAgICBuID0gdCwgY24oZSA9IG8uZWxlbWVudCwgbi5sZWZ0QXR0ciksIGNuKGUsIG4udG9wQXR0cik7CiAgICB9KTsKICAgIHZhciByID0gbi5nZXRUYXJnZXQoby5lbGVtZW50KTsKICAgIGUucmVzZXQoKSwgbi5vbkRyb3Aobywgcik7CiAgfQoKICBmdW5jdGlvbiBFVCh0KSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKG4sIGUpIHsKICAgICAgZnVuY3Rpb24gbyh0KSB7CiAgICAgICAgZS5zZXRTdGFydERhdGEoT1QobiwgdCkpOwogICAgICB9CgogICAgICByZXR1cm4gbnUoSChbQ3IoV2koKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICBlLmdldFN0YXJ0RGF0YSgpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIG8odCk7CiAgICAgICAgfSk7CiAgICAgIH0pXSwgdChuLCBlLCBvKSwgITApKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBEVChhLCBjLCBzKSB7CiAgICByZXR1cm4gW0NyKGRpKCksIGZ1bmN0aW9uIChuLCB0KSB7CiAgICAgIHZhciBlLCBvLCByLCBpLCB1OwogICAgICAwID09PSB0LmV2ZW50LnJhdy5idXR0b24gJiYgKHQuc3RvcCgpLCByID0gewogICAgICAgIGRyb3A6IGUgPSBmdW5jdGlvbiBlKCkgewogICAgICAgICAgcmV0dXJuIFRUKG4sIHZ0LnNvbWUoaSksIGEsIGMpOwogICAgICAgIH0sCiAgICAgICAgZGVsYXlEcm9wOiAobyA9IGpiKGUsIDIwMCkpLnNjaGVkdWxlLAogICAgICAgIGZvcmNlRHJvcDogZSwKICAgICAgICBtb3ZlOiBmdW5jdGlvbiBtb3ZlKHQpIHsKICAgICAgICAgIG8uY2FuY2VsKCksIF9UKG4sIGEsIGMsIFpULCB0KTsKICAgICAgICB9CiAgICAgIH0sIGkgPSBrVChuLCBhLmJsb2NrZXJDbGFzcywgKHUgPSByLCBudShbQ3IoZGkoKSwgdS5mb3JjZURyb3ApLCBDcihwaSgpLCB1LmRyb3ApLCBDcihtaSgpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIHUubW92ZShuLmV2ZW50KTsKICAgICAgfSksIENyKGdpKCksIHUuZGVsYXlEcm9wKV0pKSksIHMobiksIFNUKG4sIGkpKTsKICAgIH0pXTsKICB9CgogIGZ1bmN0aW9uIEJUKGEsIGMsIHMpIHsKICAgIGZ1bmN0aW9uIGwodCkgewogICAgICBUVCh0LCBmLmdldCgpLCBhLCBjKSwgZi5jbGVhcigpOwogICAgfQoKICAgIHZhciBmID0gZGMoKTsKICAgIHJldHVybiBbQ3IoY2koKSwgZnVuY3Rpb24gKG4sIHQpIHsKICAgICAgZnVuY3Rpb24gZSgpIHsKICAgICAgICByZXR1cm4gbChuKTsKICAgICAgfQoKICAgICAgdC5zdG9wKCk7CiAgICAgIHZhciBvLAogICAgICAgICAgciwKICAgICAgICAgIGksCiAgICAgICAgICB1ID0ga1QobiwgYS5ibG9ja2VyQ2xhc3MsIChyID0gbyA9IGUsIGkgPSBmdW5jdGlvbiBpKHQpIHsKICAgICAgICBfVChuLCBhLCBjLCBuRSwgdCk7CiAgICAgIH0sIG51KFtDcihjaSgpLCByKSwgQ3IobGkoKSwgbyksIENyKGZpKCksIG8pLCBDcihzaSgpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIGkobi5ldmVudCk7CiAgICAgIH0pXSkpKTsKICAgICAgZi5zZXQodSksIHMobiksIFNUKG4sIHUpOwogICAgfSksIENyKHNpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIG4uc3RvcCgpLCBfVCh0LCBhLCBjLCBuRSwgbi5ldmVudCk7CiAgICB9KSwgQ3IobGkoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgbi5zdG9wKCksIGwodCk7CiAgICB9KSwgQ3IoZmkoKSwgbCldOwogIH0KCiAgZnVuY3Rpb24gTVQodCwgciwgaSwgdSwgbiwgZSkgewogICAgcmV0dXJuIHQuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiByRS5zbmFwKHsKICAgICAgICBzZW5zb3I6IEdUKGkgLSAyMCwgdSAtIDIwKSwKICAgICAgICByYW5nZTogU2UobiwgZSksCiAgICAgICAgb3V0cHV0OiBHVCh2dC5zb21lKGkpLCB2dC5zb21lKHUpKSwKICAgICAgICBleHRyYTogewogICAgICAgICAgdGQ6IHIKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSBpIC0gMjAsCiAgICAgICAgICBlID0gdSAtIDIwLAogICAgICAgICAgbyA9IHQuZWxlbWVudC5kb20uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIHJldHVybiByRS5zbmFwKHsKICAgICAgICBzZW5zb3I6IEdUKG4sIGUpLAogICAgICAgIHJhbmdlOiBTZSg0MCwgNDApLAogICAgICAgIG91dHB1dDogR1QodnQuc29tZShpIC0gby53aWR0aCAvIDIpLCB2dC5zb21lKHUgLSBvLmhlaWdodCAvIDIpKSwKICAgICAgICBleHRyYTogewogICAgICAgICAgdGQ6IHIKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBBVCh0LCBpLCB1KSB7CiAgICByZXR1cm4gewogICAgICBnZXRTbmFwUG9pbnRzOiB0LAogICAgICBsZWZ0QXR0cjogImRhdGEtZHJhZy1sZWZ0IiwKICAgICAgdG9wQXR0cjogImRhdGEtZHJhZy10b3AiLAogICAgICBvblNlbnNvcjogZnVuY3Rpb24gb25TZW5zb3IodCwgbikgewogICAgICAgIHZhciBlID0gbi50ZCwKICAgICAgICAgICAgbyA9IGkuZ2V0KCksCiAgICAgICAgICAgIHIgPSBlOwogICAgICAgIG8uZXhpc3RzKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gTHQodCwgcik7CiAgICAgICAgfSkgfHwgKGkuc2V0KGUpLCB1KGUpKTsKICAgICAgfSwKICAgICAgbXVzdFNuYXA6ICEwCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gRlQodCkgewogICAgcmV0dXJuIFBtKHNwLnNrZXRjaCh7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtc2VsZWN0b3IiXQogICAgICB9LAogICAgICBidXR0b25CZWhhdmlvdXJzOiB0YyhbckUuY29uZmlnKHsKICAgICAgICBtb2RlOiAibW91c2VPclRvdWNoIiwKICAgICAgICBibG9ja2VyQ2xhc3M6ICJibG9ja2VyIiwKICAgICAgICBzbmFwczogdAogICAgICB9KSwgbXcuY29uZmlnKHt9KV0pLAogICAgICBldmVudE9yZGVyOiB7CiAgICAgICAgbW91c2Vkb3duOiBbImRyYWdnaW5nIiwgImFsbG95LmJhc2UuYmVoYXZpb3VyIl0sCiAgICAgICAgdG91Y2hzdGFydDogWyJkcmFnZ2luZyIsICJhbGxveS5iYXNlLmJlaGF2aW91ciJdCiAgICAgIH0KICAgIH0pKTsKICB9CgogIGZ1bmN0aW9uIElUKGEsIGUpIHsKICAgIGZ1bmN0aW9uIG4odCkgewogICAgICB2YXIgbiA9IHpuKHQpOwogICAgICByZXR1cm4gTVQoZy5nZXRPcHQoZSksIHQsIG4ueCwgbi55LCBuLndpZHRoLCBuLmhlaWdodCk7CiAgICB9CgogICAgZnVuY3Rpb24gbyh0KSB7CiAgICAgIHZhciBuID0gem4odCk7CiAgICAgIHJldHVybiBNVChwLmdldE9wdChlKSwgdCwgbi5yaWdodCwgbi5ib3R0b20sIG4ud2lkdGgsIG4uaGVpZ2h0KTsKICAgIH0KCiAgICBmdW5jdGlvbiByKHQsIGksIG4sIHUpIHsKICAgICAgdmFyIGUgPSBuKGkpOwogICAgICByRS5zbmFwVG8odCwgZSksIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSBpLmRvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICB2bih0LmVsZW1lbnQsICJkaXNwbGF5Iik7CiAgICAgICAgdmFyIGUgPSBYdChBdC5mcm9tRG9tKGEuZ2V0Qm9keSgpKSkuZG9tLmlubmVySGVpZ2h0LAogICAgICAgICAgICBvID0gblt1XSA8IDAsCiAgICAgICAgICAgIHIgPSBuW3VdID4gZTsKICAgICAgICAobyB8fCByKSAmJiBmbih0LmVsZW1lbnQsICJkaXNwbGF5IiwgIm5vbmUiKTsKICAgICAgfSh0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBpKHQpIHsKICAgICAgcmV0dXJuIHIoaCwgdCwgbiwgInRvcCIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHUodCkgewogICAgICByZXR1cm4gcih2LCB0LCBvLCAiYm90dG9tIik7CiAgICB9CgogICAgdmFyIGMgPSBWbyhbXSksCiAgICAgICAgcyA9IFZvKFtdKSwKICAgICAgICB0ID0gVm8oITEpLAogICAgICAgIGwgPSBkYygpLAogICAgICAgIGYgPSBkYygpLAogICAgICAgIGQgPSBBVChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBNKGMuZ2V0KCksIG4pOwogICAgfSwgbCwgZnVuY3Rpb24gKG4pIHsKICAgICAgZi5nZXQoKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgYS5maXJlKCJUYWJsZVNlbGVjdG9yQ2hhbmdlIiwgewogICAgICAgICAgc3RhcnQ6IG4sCiAgICAgICAgICBmaW5pc2g6IHQKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KSwKICAgICAgICBtID0gQVQoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gTShzLmdldCgpLCBvKTsKICAgIH0sIGYsIGZ1bmN0aW9uIChuKSB7CiAgICAgIGwuZ2V0KCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIGEuZmlyZSgiVGFibGVTZWxlY3RvckNoYW5nZSIsIHsKICAgICAgICAgIHN0YXJ0OiB0LAogICAgICAgICAgZmluaXNoOiBuCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSksCiAgICAgICAgZyA9IEZUKGQpLAogICAgICAgIHAgPSBGVChtKSwKICAgICAgICBoID0gX3UoZy5hc1NwZWMoKSksCiAgICAgICAgdiA9IF91KHAuYXNTcGVjKCkpOwoKICAgIHNlKCkuZGV2aWNlVHlwZS5pc1RvdWNoKCkgJiYgKGEub24oIlRhYmxlU2VsZWN0aW9uQ2hhbmdlIiwgZnVuY3Rpb24gKG4pIHsKICAgICAgdC5nZXQoKSB8fCAoSXMoZSwgaCksIElzKGUsIHYpLCB0LnNldCghMCkpLCBsLnNldChuLnN0YXJ0KSwgZi5zZXQobi5maW5pc2gpLCBuLm90aGVyQ2VsbHMuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgIGMuc2V0KHQudXBPckxlZnRDZWxscyksIHMuc2V0KHQuZG93bk9yUmlnaHRDZWxscyksIGkobi5zdGFydCksIHUobi5maW5pc2gpOwogICAgICB9KTsKICAgIH0pLCBhLm9uKCJSZXNpemVFZGl0b3IgUmVzaXplV2luZG93IFNjcm9sbENvbnRlbnQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIGwuZ2V0KCkuZWFjaChpKSwgZi5nZXQoKS5lYWNoKHUpOwogICAgfSksIGEub24oIlRhYmxlU2VsZWN0aW9uQ2xlYXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHQuZ2V0KCkgJiYgKFZzKGgpLCBWcyh2KSwgdC5zZXQoITEpKSwgbC5jbGVhcigpLCBmLmNsZWFyKCk7CiAgICB9KSk7CiAgfQoKICB2YXIgUlQsCiAgICAgIFZULAogICAgICBQVCA9IHsKICAgIG5hbWU6ICJsaW5laGVpZ2h0IiwKICAgIHRleHQ6ICJMaW5lIGhlaWdodCIsCiAgICBpY29uOiAibGluZS1oZWlnaHQiLAogICAgZ2V0T3B0aW9uczogZnVuY3Rpb24gZ2V0T3B0aW9ucyh0KSB7CiAgICAgIHJldHVybiB0LmdldFBhcmFtKCJsaW5laGVpZ2h0X2Zvcm1hdHMiLCAiMSAxLjEgMS4yIDEuMyAxLjQgMS41IDIiLCAic3RyaW5nIikuc3BsaXQoIiAiKTsKICAgIH0sCiAgICBoYXNoOiBmdW5jdGlvbiBoYXNoKHQpIHsKICAgICAgcmV0dXJuIHIgPSBbImZpeGVkIiwgInJlbGF0aXZlIiwgImVtcHR5Il0sIHZ0LmZyb20oR18uZXhlYyh0KSkuYmluZChmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBuID0gTnVtYmVyKHRbMV0pLAogICAgICAgICAgICBlID0gdFsyXSwKICAgICAgICAgICAgbyA9IGU7CiAgICAgICAgcmV0dXJuIFQociwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBUKGpfW3RdLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gbyA9PT0gdDsKICAgICAgICAgIH0pOwogICAgICAgIH0pID8gdnQuc29tZSh7CiAgICAgICAgICB2YWx1ZTogbiwKICAgICAgICAgIHVuaXQ6IGUKICAgICAgICB9KSA6IHZ0Lm5vbmUoKTsKICAgICAgfSkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHQudmFsdWUgKyB0LnVuaXQ7CiAgICAgIH0pLmdldE9yKHQpOwogICAgICB2YXIgcjsKICAgIH0sCiAgICBkaXNwbGF5OiBoLAogICAgd2F0Y2hlcjogZnVuY3Rpb24gd2F0Y2hlcih0LCBuLCBlKSB7CiAgICAgIHJldHVybiB0LmZvcm1hdHRlci5mb3JtYXRDaGFuZ2VkKCJsaW5laGVpZ2h0IiwgZSwgITEsIHsKICAgICAgICB2YWx1ZTogbgogICAgICB9KS51bmJpbmQ7CiAgICB9LAogICAgZ2V0Q3VycmVudDogZnVuY3Rpb24gZ2V0Q3VycmVudCh0KSB7CiAgICAgIHJldHVybiB2dC5mcm9tKHQucXVlcnlDb21tYW5kVmFsdWUoIkxpbmVIZWlnaHQiKSk7CiAgICB9LAogICAgc2V0Q3VycmVudDogZnVuY3Rpb24gc2V0Q3VycmVudCh0LCBuKSB7CiAgICAgIHJldHVybiB0LmV4ZWNDb21tYW5kKCJMaW5lSGVpZ2h0IiwgITEsIG4pOwogICAgfQogIH0sCiAgICAgIEhUID0gZnVuY3Rpb24gSFQodCkgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogInNlbGVjdGlvbiIsCiAgICAgIHJvb3Q6IEF0LmZyb21Eb20odC5zZWxlY3Rpb24uZ2V0Tm9kZSgpKQogICAgfTsKICB9LAogICAgICB6VCA9IHsKICAgIG9uTHRyOiBmdW5jdGlvbiBvbkx0cigpIHsKICAgICAgcmV0dXJuIFtKYSwgR2EsIFhhLCBZYSwgcWEsIEthLCB1cCwgYXAsIEJtLCBFbSwgRG0sIFRtXTsKICAgIH0sCiAgICBvblJ0bDogZnVuY3Rpb24gb25SdGwoKSB7CiAgICAgIHJldHVybiBbSmEsIFhhLCBHYSwgcWEsIFlhLCBLYSwgdXAsIGFwLCBEbSwgVG0sIEJtLCBFbV07CiAgICB9CiAgfSwKICAgICAgTlQgPSB7CiAgICB2YWxpZ25DZW50cmU6IFtdLAogICAgYWxpZ25DZW50cmU6IFtdLAogICAgYWxpZ25MZWZ0OiBbInRveC1wb3AtLWFsaWduLWxlZnQiXSwKICAgIGFsaWduUmlnaHQ6IFsidG94LXBvcC0tYWxpZ24tcmlnaHQiXSwKICAgIHJpZ2h0OiBbInRveC1wb3AtLXJpZ2h0Il0sCiAgICBsZWZ0OiBbInRveC1wb3AtLWxlZnQiXSwKICAgIGJvdHRvbTogWyJ0b3gtcG9wLS1ib3R0b20iXSwKICAgIHRvcDogWyJ0b3gtcG9wLS10b3AiXQogIH0sCiAgICAgIExUID0gewogICAgdHlwZTogInNlcGFyYXRvciIKICB9LAogICAgICBXVCA9IGZ1bmN0aW9uIFdUKG4pIHsKICAgIGZ1bmN0aW9uIHQodCkgewogICAgICByZXR1cm4gewogICAgICAgIHRleHQ6IHQudGV4dCwKICAgICAgICBpY29uOiB0Lmljb24sCiAgICAgICAgZGlzYWJsZWQ6IHQuZGlzYWJsZWQsCiAgICAgICAgc2hvcnRjdXQ6IHQuc2hvcnRjdXQKICAgICAgfTsKICAgIH0KCiAgICB2YXIgZTsKICAgIGlmICh5KG4pKSByZXR1cm4gbjsKCiAgICBzd2l0Y2ggKG4udHlwZSkgewogICAgICBjYXNlICJzZXBhcmF0b3IiOgogICAgICAgIHJldHVybiBMVDsKCiAgICAgIGNhc2UgInN1Ym1lbnUiOgogICAgICAgIHJldHVybiBfbHQoX2x0KHsKICAgICAgICAgIHR5cGU6ICJuZXN0ZWRtZW51aXRlbSIKICAgICAgICB9LCB0KG4pKSwgewogICAgICAgICAgZ2V0U3VibWVudUl0ZW1zOiBmdW5jdGlvbiBnZXRTdWJtZW51SXRlbXMoKSB7CiAgICAgICAgICAgIHZhciB0ID0gbi5nZXRTdWJtZW51SXRlbXMoKTsKICAgICAgICAgICAgcmV0dXJuIHkodCkgPyB0IDogTSh0LCBXVCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiBfbHQoX2x0KHsKICAgICAgICAgIHR5cGU6ICJtZW51aXRlbSIKICAgICAgICB9LCB0KG4pKSwgewogICAgICAgICAgb25BY3Rpb246IChlID0gbi5vbkFjdGlvbiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZSgpOwogICAgICAgICAgfSkKICAgICAgICB9KTsKICAgIH0KICB9LAogICAgICBVVCA9IFBvKFt7CiAgICBvZmZzZXQ6IFsieCIsICJ5Il0KICB9LCB7CiAgICBhYnNvbHV0ZTogWyJ4IiwgInkiXQogIH0sIHsKICAgIGZpeGVkOiBbIngiLCAieSJdCiAgfV0pLAogICAgICBqVCA9IFVULm9mZnNldCwKICAgICAgR1QgPSBVVC5hYnNvbHV0ZSwKICAgICAgWFQgPSBVVC5maXhlZCwKICAgICAgWVQgPSBmdW5jdGlvbiBZVCh0LCBuLCBsLCBmLCBkKSB7CiAgICB2YXIgZSA9IG4uZ2V0U25hcFBvaW50cyh0KTsKICAgIHJldHVybiB3VChlLCBsLCBmLCBkKS5vclRodW5rKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFIoZSwgZnVuY3Rpb24gKG4sIGUpIHsKICAgICAgICB2YXIgdCwKICAgICAgICAgICAgbywKICAgICAgICAgICAgciwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgdSwKICAgICAgICAgICAgYSwKICAgICAgICAgICAgYywKICAgICAgICAgICAgcyA9ICh0ID0gZS5zZW5zb3IsIGUucmFuZ2UubGVmdCwgZS5yYW5nZS50b3AsIGkgPSBwVChsLCBvID0gZiwgciA9IGQpLCB1ID0gcFQodCwgbywgciksIGEgPSBNYXRoLmFicyhpLmxlZnQgLSB1LmxlZnQpLCBjID0gTWF0aC5hYnMoaS50b3AgLSB1LnRvcCksIFNlKGEsIGMpKTsKICAgICAgICByZXR1cm4gbi5kZWx0YXMuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkZWx0YXM6IHZ0LnNvbWUocyksCiAgICAgICAgICAgIHNuYXA6IHZ0LnNvbWUoZSkKICAgICAgICAgIH07CiAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAocy5sZWZ0ICsgcy50b3ApIC8gMiA8PSAodC5sZWZ0ICsgdC50b3ApIC8gMiA/IHsKICAgICAgICAgICAgZGVsdGFzOiB2dC5zb21lKHMpLAogICAgICAgICAgICBzbmFwOiB2dC5zb21lKGUpCiAgICAgICAgICB9IDogbjsKICAgICAgICB9KTsKICAgICAgfSwgewogICAgICAgIGRlbHRhczogdnQubm9uZSgpLAogICAgICAgIHNuYXA6IHZ0Lm5vbmUoKQogICAgICB9KS5zbmFwLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBvdXRwdXQ6IGJUKHQub3V0cHV0LCBsLCBmLCBkKSwKICAgICAgICAgIGV4dHJhOiB0LmV4dHJhCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKICB9LAogICAgICBxVCA9IGZ1bmN0aW9uIHFUKHQsIG4sIGUsIG8sIHIpIHsKICAgIHJldHVybiB3VChuLmdldFNuYXBQb2ludHModCksIGUsIG8sIHIpOwogIH0sCiAgICAgIEtUID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBzbmFwVG86IGZ1bmN0aW9uIHNuYXBUbyh0LCBuLCBlLCBvKSB7CiAgICAgIHZhciByLAogICAgICAgICAgaSwKICAgICAgICAgIHUsCiAgICAgICAgICBhID0gbi5nZXRUYXJnZXQodC5lbGVtZW50KTsKICAgICAgbi5yZXBvc2l0aW9uVGFyZ2V0ICYmIChyID0gSW4oVXQodC5lbGVtZW50KSksIGkgPSB6QyhhKSwgbW4oYSwgdlQoewogICAgICAgIGNvb3JkOiBiVCgodSA9IG8pLm91dHB1dCwgdS5vdXRwdXQsIHIsIGkpLAogICAgICAgIGV4dHJhOiB1LmV4dHJhCiAgICAgIH0uY29vcmQsIDAsIGkpKSk7CiAgICB9CiAgfSksCiAgICAgIEpUID0gImRhdGEtaW5pdGlhbC16LWluZGV4IiwKICAgICAgJFQgPSBfbygic25hcHMiLCBbZm8oImdldFNuYXBQb2ludHMiKSwgS3UoIm9uU2Vuc29yIiksIGZvKCJsZWZ0QXR0ciIpLCBmbygidG9wQXR0ciIpLCBUbygibGF6eVZpZXdwb3J0IiwgQWUpLCBUbygibXVzdFNuYXAiLCAhMSldKSwKICAgICAgUVQgPSBbVG8oInVzZUZpeGVkIiwgTyksIGZvKCJibG9ja2VyQ2xhc3MiKSwgVG8oImdldFRhcmdldCIsIGgpLCBUbygib25EcmFnIiwgc3QpLCBUbygicmVwb3NpdGlvblRhcmdldCIsICEwKSwgVG8oIm9uRHJvcCIsIHN0KSwgRm8oImdldEJvdW5kcyIsIEFlKSwgJFRdLAogICAgICBaVCA9IE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2V0RGF0YTogZnVuY3Rpb24gZ2V0RGF0YSh0KSB7CiAgICAgIHJldHVybiB2dC5mcm9tKFNlKHQueCwgdC55KSk7CiAgICB9LAogICAgZ2V0RGVsdGE6IGZ1bmN0aW9uIGdldERlbHRhKHQsIG4pIHsKICAgICAgcmV0dXJuIFNlKG4ubGVmdCAtIHQubGVmdCwgbi50b3AgLSB0LnRvcCk7CiAgICB9CiAgfSksCiAgICAgIHRFID0gSChIKFtdLCBRVCwgITApLCBbWnUoImRyYWdnZXIiLCB7CiAgICBoYW5kbGVyczogRVQoRFQpCiAgfSldLCAhMSksCiAgICAgIG5FID0gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZXREYXRhOiBmdW5jdGlvbiBnZXREYXRhKHQpIHsKICAgICAgdmFyIG4sCiAgICAgICAgICBlID0gdC5yYXcudG91Y2hlczsKICAgICAgcmV0dXJuIDEgPT09IGUubGVuZ3RoID8gKG4gPSBlWzBdLCB2dC5zb21lKFNlKG4uY2xpZW50WCwgbi5jbGllbnRZKSkpIDogdnQubm9uZSgpOwogICAgfSwKICAgIGdldERlbHRhOiBmdW5jdGlvbiBnZXREZWx0YSh0LCBuKSB7CiAgICAgIHJldHVybiBTZShuLmxlZnQgLSB0LmxlZnQsIG4udG9wIC0gdC50b3ApOwogICAgfQogIH0pLAogICAgICBlRSA9IEgoSChbXSwgUVQsICEwKSwgW1p1KCJkcmFnZ2VyIiwgewogICAgaGFuZGxlcnM6IEVUKEJUKQogIH0pXSwgITEpLAogICAgICBvRSA9IEgoSChbXSwgUVQsICEwKSwgW1p1KCJkcmFnZ2VyIiwgewogICAgaGFuZGxlcnM6IEVUKGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgIHJldHVybiBIKEgoW10sIERUKHQsIG4sIGUpLCAhMCksIEJUKHQsIG4sIGUpLCAhMCk7CiAgICB9KQogIH0pXSwgITEpLAogICAgICByRSA9IHhhKHsKICAgIGJyYW5jaEtleTogIm1vZGUiLAogICAgYnJhbmNoZXM6IE9iamVjdC5mcmVlemUoewogICAgICBfX3Byb3RvX186IG51bGwsCiAgICAgIG1vdXNlOiB0RSwKICAgICAgdG91Y2g6IGVFLAogICAgICBtb3VzZU9yVG91Y2g6IG9FCiAgICB9KSwKICAgIG5hbWU6ICJkcmFnZ2luZyIsCiAgICBhY3RpdmU6IHsKICAgICAgZXZlbnRzOiBmdW5jdGlvbiBldmVudHModCwgbikgewogICAgICAgIHJldHVybiB0LmRyYWdnZXIuaGFuZGxlcnModCwgbik7CiAgICAgIH0KICAgIH0sCiAgICBleHRyYTogewogICAgICBzbmFwOiBmdW5jdGlvbiBzbmFwKHQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgc2Vuc29yOiB0LnNlbnNvciwKICAgICAgICAgIHJhbmdlOiB0LnJhbmdlLAogICAgICAgICAgb3V0cHV0OiB0Lm91dHB1dCwKICAgICAgICAgIGV4dHJhOiB2dC5mcm9tKHQuZXh0cmEpCiAgICAgICAgfTsKICAgICAgfQogICAgfSwKICAgIHN0YXRlOiBPYmplY3QuZnJlZXplKHsKICAgICAgX19wcm90b19fOiBudWxsLAogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHZhciBpID0gdnQubm9uZSgpLAogICAgICAgICAgICBuID0gdnQubm9uZSgpLAogICAgICAgICAgICB0ID0gcnQoe30pOwogICAgICAgIHJldHVybiB4dSh7CiAgICAgICAgICByZWFkU3RhdGU6IHQsCiAgICAgICAgICByZXNldDogZnVuY3Rpb24gcmVzZXQoKSB7CiAgICAgICAgICAgIGkgPSB2dC5ub25lKCksIG4gPSB2dC5ub25lKCk7CiAgICAgICAgICB9LAogICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUociwgdCkgewogICAgICAgICAgICByZXR1cm4gci5nZXREYXRhKHQpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gbiA9IHIsIGUgPSB0LCBvID0gaS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuLmdldERlbHRhKHQsIGUpOwogICAgICAgICAgICAgIH0pLCBpID0gdnQuc29tZShlKSwgbzsKICAgICAgICAgICAgICB2YXIgbiwgZSwgbzsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0U3RhcnREYXRhOiBmdW5jdGlvbiBnZXRTdGFydERhdGEoKSB7CiAgICAgICAgICAgIHJldHVybiBuOwogICAgICAgICAgfSwKICAgICAgICAgIHNldFN0YXJ0RGF0YTogZnVuY3Rpb24gc2V0U3RhcnREYXRhKHQpIHsKICAgICAgICAgICAgbiA9IHZ0LnNvbWUodCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pLAogICAgYXBpczogS1QKICB9KTsKCiAgZnVuY3Rpb24gaUUodCwgbiwgZSkgewogICAgdmFyIG8sCiAgICAgICAgciwKICAgICAgICBpLAogICAgICAgIHUsCiAgICAgICAgYSwKICAgICAgICBjLAogICAgICAgIHMgPSBBdC5mcm9tRG9tKHQuZ2V0Q29udGFpbmVyKCkpOwogICAgSigobyA9IHQsIHIgPSBuLCBpID0gZSwgdSA9IHhuKHMpLCBhID0ga24ocyksIChjID0ge30pLmhlaWdodCA9ICRPKHUgKyByLnRvcCwgbGgobyksIGRoKG8pKSwgaSA9PT0gUlQuQm90aCAmJiAoYy53aWR0aCA9ICRPKGEgKyByLmxlZnQsIHNoKG8pLCBmaChvKSkpLCBjKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgcmV0dXJuIGZuKHMsIG4sIEpPKHQpKSwgMDsKICAgIH0pLCB0LmZpcmUoIlJlc2l6ZUVkaXRvciIpOwogIH0KCiAgZnVuY3Rpb24gdUUodCwgbiwgZSwgbykgewogICAgcmV0dXJuIGlFKHQsIFNlKDIwICogZSwgMjAgKiBvKSwgbiksIHZ0LnNvbWUoITApOwogIH0KCiAgZnVuY3Rpb24gYUUodCwgbikgewogICAgdmFyIGUsIG8sIHIsIGksIHUsIGEsIGMsIHMsIGwsIGYsIGQsIG0sIGcsIHAsIGgsIHY7CiAgICByZXR1cm4gewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LXN0YXR1c2JhciJdCiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6ICh2ID0gW10sIHQuZ2V0UGFyYW0oImVsZW1lbnRwYXRoIiwgITAsICJib29sZWFuIikgJiYgdi5wdXNoKChnID0gdCwgaCA9IG4sIChwID0ge30pLmRlbGltaXRlciB8fCAocC5kZWxpbWl0ZXIgPSAiXHhiYiIpLCB7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtc3RhdHVzYmFyX19wYXRoIl0sCiAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgIHJvbGU6ICJuYXZpZ2F0aW9uIgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYmVoYXZpb3VyczogdGMoW01nLmNvbmZpZyh7CiAgICAgICAgICBtb2RlOiAiZmxvdyIsCiAgICAgICAgICBzZWxlY3RvcjogImRpdltyb2xlPWJ1dHRvbl0iCiAgICAgICAgfSksIGRkLmNvbmZpZyh7CiAgICAgICAgICBkaXNhYmxlZDogaC5pc0Rpc2FibGVkCiAgICAgICAgfSksIG12KCksIGZ5LmNvbmZpZyh7fSksIEZnLmNvbmZpZyh7fSksIGZtKCJlbGVtZW50UGF0aEV2ZW50cyIsIFtldShmdW5jdGlvbiAociwgdCkgewogICAgICAgICAgZy5zaG9ydGN1dHMuYWRkKCJhbHQrRjExIiwgImZvY3VzIHN0YXR1c2JhciBlbGVtZW50cGF0aCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIE1nLmZvY3VzSW4ocik7CiAgICAgICAgICB9KSwgZy5vbigiTm9kZUNoYW5nZSIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgICAgbywKICAgICAgICAgICAgICAgIGUgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIGZvciAodmFyIG4gPSBbXSwgZSA9IHQubGVuZ3RoOyAwIDwgZS0tOykgewogICAgICAgICAgICAgICAgdmFyIG8gPSB0W2VdOwoKICAgICAgICAgICAgICAgIGlmICgxID09PSBvLm5vZGVUeXBlICYmICFmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgICBpZiAoMSA9PT0gdC5ub2RlVHlwZSkgewogICAgICAgICAgICAgICAgICAgIGlmICgiQlIiID09PSB0Lm5vZGVOYW1lIHx8IHQuZ2V0QXR0cmlidXRlKCJkYXRhLW1jZS1ib2d1cyIpKSByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoImJvb2ttYXJrIiA9PT0gdC5nZXRBdHRyaWJ1dGUoImRhdGEtbWNlLXR5cGUiKSkgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0obykpIHsKICAgICAgICAgICAgICAgICAgdmFyIHIgPSBnLmZpcmUoIlJlc29sdmVOYW1lIiwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6IG8ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IG8KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGlmIChyLmlzRGVmYXVsdFByZXZlbnRlZCgpIHx8IG4ucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogci5uYW1lLAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IG8KICAgICAgICAgICAgICAgICAgfSksIHIuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gbjsKICAgICAgICAgICAgfSh0LnBhcmVudHMpOwoKICAgICAgICAgICAgMCA8IGUubGVuZ3RoID8gRmcuc2V0KHIsIChuID0gTShlIHx8IFtdLCBmdW5jdGlvbiAobiwgdCkgewogICAgICAgICAgICAgIHJldHVybiBzcC5za2V0Y2goewogICAgICAgICAgICAgICAgZG9tOiB7CiAgICAgICAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgICAgICAgIGNsYXNzZXM6IFsidG94LXN0YXR1c2Jhcl9fcGF0aC1pdGVtIl0sCiAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgICAgICAgICByb2xlOiAiYnV0dG9uIiwKICAgICAgICAgICAgICAgICAgICAiZGF0YS1pbmRleCI6IHQsCiAgICAgICAgICAgICAgICAgICAgInRhYi1pbmRleCI6IC0xLAogICAgICAgICAgICAgICAgICAgICJhcmlhLWxldmVsIjogdCArIDEKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgaW5uZXJIdG1sOiBuLm5hbWUKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIGFjdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgIGcuZm9jdXMoKSwgZy5zZWxlY3Rpb24uc2VsZWN0KG4uZWxlbWVudCksIGcubm9kZUNoYW5nZWQoKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBidXR0b25CZWhhdmlvdXJzOiB0YyhbS3YoaC5pc0Rpc2FibGVkKSwgbXYoKV0pCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pLCBvID0gewogICAgICAgICAgICAgIGRvbTogewogICAgICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgICAgIGNsYXNzZXM6IFsidG94LXN0YXR1c2Jhcl9fcGF0aC1kaXZpZGVyIl0sCiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgICAgICAgICJhcmlhLWhpZGRlbiI6ICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaW5uZXJIdG1sOiAiICIgKyBwLmRlbGltaXRlciArICIgIgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgUihuLnNsaWNlKDEpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICAgIHZhciBlID0gdDsKICAgICAgICAgICAgICByZXR1cm4gZS5wdXNoKG8pLCBlLnB1c2gobiksIGU7CiAgICAgICAgICAgIH0sIFtuWzBdXSkpKSA6IEZnLnNldChyLCBbXSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KV0pXSksCiAgICAgICAgY29tcG9uZW50czogW10KICAgICAgfSkpLCB0Lmhhc1BsdWdpbigid29yZGNvdW50IikgJiYgdi5wdXNoKChmID0gdCwgZCA9IG4sIHNwLnNrZXRjaCh7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJidXR0b24iLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtc3RhdHVzYmFyX193b3JkY291bnQiXQogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogW10sCiAgICAgICAgYnV0dG9uQmVoYXZpb3VyczogdGMoW0t2KGQuaXNEaXNhYmxlZCksIG12KCksIGZ5LmNvbmZpZyh7fSksIEZnLmNvbmZpZyh7fSksIFRmLmNvbmZpZyh7CiAgICAgICAgICBzdG9yZTogewogICAgICAgICAgICBtb2RlOiAibWVtb3J5IiwKICAgICAgICAgICAgaW5pdGlhbFZhbHVlOiB7CiAgICAgICAgICAgICAgbW9kZTogIndvcmRzIiwKICAgICAgICAgICAgICBjb3VudDogewogICAgICAgICAgICAgICAgd29yZHM6IDAsCiAgICAgICAgICAgICAgICBjaGFyYWN0ZXJzOiAwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSksIGZtKCJ3b3JkY291bnQtZXZlbnRzIiwgW2l1KGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgbiA9IFRmLmdldFZhbHVlKHQpLAogICAgICAgICAgICAgIGUgPSAid29yZHMiID09PSBuLm1vZGUgPyAiY2hhcmFjdGVycyIgOiAid29yZHMiOwogICAgICAgICAgVGYuc2V0VmFsdWUodCwgewogICAgICAgICAgICBtb2RlOiBlLAogICAgICAgICAgICBjb3VudDogbi5jb3VudAogICAgICAgICAgfSksIGIodCwgbi5jb3VudCwgZSk7CiAgICAgICAgfSksIGV1KGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBmLm9uKCJ3b3JkQ291bnRVcGRhdGUiLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICB2YXIgbiA9IFRmLmdldFZhbHVlKGUpLm1vZGU7CiAgICAgICAgICAgIFRmLnNldFZhbHVlKGUsIHsKICAgICAgICAgICAgICBtb2RlOiBuLAogICAgICAgICAgICAgIGNvdW50OiB0LndvcmRDb3VudAogICAgICAgICAgICB9KSwgYihlLCB0LndvcmRDb3VudCwgbik7CiAgICAgICAgICB9KTsKICAgICAgICB9KV0pXSksCiAgICAgICAgZXZlbnRPcmRlcjogKChtID0ge30pW0ZpKCldID0gWyJkaXNhYmxpbmciLCAiYWxsb3kuYmFzZS5iZWhhdmlvdXIiLCAid29yZGNvdW50LWV2ZW50cyJdLCBtKQogICAgICB9KSkpLCB0LmdldFBhcmFtKCJicmFuZGluZyIsICEwLCAiYm9vbGVhbiIpICYmIHYucHVzaCh7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJzcGFuIiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LXN0YXR1c2Jhcl9fYnJhbmRpbmciXSwKICAgICAgICAgIGlubmVySHRtbDogJzxhIGhyZWY9Imh0dHBzOi8vd3d3LnRpbnkuY2xvdWQvP3V0bV9jYW1wYWlnbj1lZGl0b3JfcmVmZXJyYWwmYW1wO3V0bV9tZWRpdW09cG93ZXJlZGJ5JmFtcDt1dG1fc291cmNlPXRpbnltY2UmYW1wO3V0bV9jb250ZW50PXY1IiByZWw9Im5vb3BlbmVyIiB0YXJnZXQ9Il9ibGFuayIgdGFiaW5kZXg9Ii0xIiBhcmlhLWxhYmVsPSInICsgKGwgPSBscC50cmFuc2xhdGUoWyJQb3dlcmVkIGJ5IHswfSIsICJUaW55Il0pKSArICciPicgKyBsICsgIjwvYT4iCiAgICAgICAgfQogICAgICB9KSwgZSA9IDAgPCB2Lmxlbmd0aCA/IFt7CiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtc3RhdHVzYmFyX190ZXh0LWNvbnRhaW5lciJdCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiB2CiAgICAgIH1dIDogW10sIGkgPSBuLCBhID0gISh1ID0gciA9IHQpLmhhc1BsdWdpbigiYXV0b3Jlc2l6ZSIpLCBvID0gKHMgPSAhMSA9PT0gKGMgPSB1LmdldFBhcmFtKCJyZXNpemUiLCBhKSkgPyBSVC5Ob25lIDogImJvdGgiID09PSBjID8gUlQuQm90aCA6IFJULlZlcnRpY2FsKSA9PT0gUlQuTm9uZSA/IHZ0Lm5vbmUoKSA6IHZ0LnNvbWUoam0oInJlc2l6ZS1oYW5kbGUiLCB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbInRveC1zdGF0dXNiYXJfX3Jlc2l6ZS1oYW5kbGUiXSwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB0aXRsZTogaS50cmFuc2xhdGUoIlJlc2l6ZSIpCiAgICAgICAgfSwKICAgICAgICBiZWhhdmlvdXJzOiBbckUuY29uZmlnKHsKICAgICAgICAgIG1vZGU6ICJtb3VzZSIsCiAgICAgICAgICByZXBvc2l0aW9uVGFyZ2V0OiAhMSwKICAgICAgICAgIG9uRHJhZzogZnVuY3Rpb24gb25EcmFnKHQsIG4sIGUpIHsKICAgICAgICAgICAgcmV0dXJuIGlFKHIsIGUsIHMpOwogICAgICAgICAgfSwKICAgICAgICAgIGJsb2NrZXJDbGFzczogInRveC1ibG9ja2VyIgogICAgICAgIH0pLCBNZy5jb25maWcoewogICAgICAgICAgbW9kZTogInNwZWNpYWwiLAogICAgICAgICAgb25MZWZ0OiBmdW5jdGlvbiBvbkxlZnQoKSB7CiAgICAgICAgICAgIHJldHVybiB1RShyLCBzLCAtMSwgMCk7CiAgICAgICAgICB9LAogICAgICAgICAgb25SaWdodDogZnVuY3Rpb24gb25SaWdodCgpIHsKICAgICAgICAgICAgcmV0dXJuIHVFKHIsIHMsIDEsIDApOwogICAgICAgICAgfSwKICAgICAgICAgIG9uVXA6IGZ1bmN0aW9uIG9uVXAoKSB7CiAgICAgICAgICAgIHJldHVybiB1RShyLCBzLCAwLCAtMSk7CiAgICAgICAgICB9LAogICAgICAgICAgb25Eb3duOiBmdW5jdGlvbiBvbkRvd24oKSB7CiAgICAgICAgICAgIHJldHVybiB1RShyLCBzLCAwLCAxKTsKICAgICAgICAgIH0KICAgICAgICB9KSwgZnkuY29uZmlnKHt9KSwgVmcuY29uZmlnKHt9KV0KICAgICAgfSwgaS5pY29ucykpLCBlLmNvbmNhdChvLnRvQXJyYXkoKSkpCiAgICB9OwoKICAgIGZ1bmN0aW9uIGIodCwgbiwgZSkgewogICAgICByZXR1cm4gRmcuc2V0KHQsIFtvaShkLnRyYW5zbGF0ZShbInswfSAiICsgZSwgbltlXV0pKV0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY0UoZCkgewogICAgZnVuY3Rpb24gbSgpIHsKICAgICAgcmV0dXJuIGkuYmluZChCTy5nZXRIZWFkZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGcoKSB7CiAgICAgIHJldHVybiBSZS52YWx1ZSh5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBwKCkgewogICAgICByZXR1cm4gaS5iaW5kKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIEJPLmdldFRocm9iYmVyKHQpOwogICAgICB9KS5nZXRPckRpZSgiQ291bGQgbm90IGZpbmQgdGhyb2JiZXIgZWxlbWVudCIpOwogICAgfQoKICAgIHZhciB0LAogICAgICAgIG4sCiAgICAgICAgZSwKICAgICAgICBvLAogICAgICAgIHIgPSBkLmlubGluZSwKICAgICAgICBoID0gciA/IElfIDogRl8sCiAgICAgICAgdiA9IGx2KGQpID8gRzEgOiBSMSwKICAgICAgICBpID0gdnQubm9uZSgpLAogICAgICAgIHUgPSBzZSgpLAogICAgICAgIGEgPSB1LmJyb3dzZXIuaXNJRSgpID8gWyJ0b3gtcGxhdGZvcm0taWUiXSA6IFtdLAogICAgICAgIGMgPSB1LmRldmljZVR5cGUuaXNUb3VjaCgpID8gWyJ0b3gtcGxhdGZvcm0tdG91Y2giXSA6IFtdLAogICAgICAgIHMgPSBpdihkKSwKICAgICAgICBsID0gY3YoZCksCiAgICAgICAgZiA9IGxwLmlzUnRsKCkgPyB7CiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBkaXI6ICJydGwiCiAgICAgIH0KICAgIH0gOiB7fSwKICAgICAgICBiID0gewogICAgICBhdHRyaWJ1dGVzOiAoKHQgPSB7fSlbdHNdID0gcyA/IENjLkJvdHRvbVRvVG9wIDogQ2MuVG9wVG9Cb3R0b20sIHQpCiAgICB9LAogICAgICAgIHkgPSBfdSgobiA9IEx0KHZlKCksIGwpICYmICJncmlkIiA9PT0gZ24obCwgImRpc3BsYXkiKSwgZSA9IHsKICAgICAgZG9tOiBfbHQoewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3giLCAidG94LXNpbHZlci1zaW5rIiwgInRveC10aW55bWNlLWF1eCJdLmNvbmNhdChhKS5jb25jYXQoYykKICAgICAgfSwgZiksCiAgICAgIGJlaGF2aW91cnM6IHRjKFtzZi5jb25maWcoewogICAgICAgIHVzZUZpeGVkOiBmdW5jdGlvbiB1c2VGaXhlZCgpIHsKICAgICAgICAgIHJldHVybiB2LmlzRG9ja2VkKG0pOwogICAgICAgIH0KICAgICAgfSldKQogICAgfSwgbyA9IHsKICAgICAgZG9tOiB7CiAgICAgICAgc3R5bGVzOiB7CiAgICAgICAgICB3aWR0aDogZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCArICJweCIKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGV2ZW50czogbnUoW0NyKFVpKCksIGZ1bmN0aW9uICgpIHsKICAgICAgICBmbihKLmVsZW1lbnQsICJ3aWR0aCIsIGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGggKyAicHgiKTsKICAgICAgfSldKQogICAgfSwgWG8oZSwgbiA/IG8gOiB7fSkpKSwKICAgICAgICB4ID0gUG0oewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LWFuY2hvcmJhciJdCiAgICAgIH0KICAgIH0pLAogICAgICAgIHcgPSBQQyh5LCBkLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4geC5nZXRPcHQodCk7CiAgICAgIH0pLmdldE9yRGllKCJDb3VsZCBub3QgZmluZCBhIGFuY2hvciBiYXIgZWxlbWVudCIpOwogICAgfSksCiAgICAgICAgUyA9IEJPLnBhcnRzLm1lbnViYXIoewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LW1lbnViYXIiXQogICAgICB9LAogICAgICBiYWNrc3RhZ2U6IHcsCiAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiBvbkVzY2FwZSgpIHsKICAgICAgICBkLmZvY3VzKCk7CiAgICAgIH0KICAgIH0pLAogICAgICAgIEMgPSBvdihkKSwKICAgICAgICBrID0gQk8ucGFydHMudG9vbGJhcihfbHQoewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LXRvb2xiYXIiXQogICAgICB9LAogICAgICBnZXRTaW5rOiBnLAogICAgICBwcm92aWRlcnM6IHcuc2hhcmVkLnByb3ZpZGVycywKICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uIG9uRXNjYXBlKCkgewogICAgICAgIGQuZm9jdXMoKTsKICAgICAgfSwKICAgICAgdHlwZTogQywKICAgICAgbGF6eVRvb2xiYXI6IGZ1bmN0aW9uIGxhenlUb29sYmFyKCkgewogICAgICAgIHJldHVybiBpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBCTy5nZXRUb29sYmFyKHQpOwogICAgICAgIH0pLmdldE9yRGllKCJDb3VsZCBub3QgZmluZCBtb3JlIHRvb2xiYXIgZWxlbWVudCIpOwogICAgICB9LAogICAgICBsYXp5SGVhZGVyOiBmdW5jdGlvbiBsYXp5SGVhZGVyKCkgewogICAgICAgIHJldHVybiBtKCkuZ2V0T3JEaWUoIkNvdWxkIG5vdCBmaW5kIGhlYWRlciBlbGVtZW50Iik7CiAgICAgIH0KICAgIH0sIGIpKSwKICAgICAgICBPID0gQk8ucGFydHNbIm11bHRpcGxlLXRvb2xiYXIiXSh7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtdG9vbGJhci1vdmVybG9yZCJdCiAgICAgIH0sCiAgICAgIHByb3ZpZGVyczogdy5zaGFyZWQucHJvdmlkZXJzLAogICAgICBvbkVzY2FwZTogZnVuY3Rpb24gb25Fc2NhcGUoKSB7CiAgICAgICAgZC5mb2N1cygpOwogICAgICB9LAogICAgICB0eXBlOiBDCiAgICB9KSwKICAgICAgICBfID0gQk8ucGFydHMuc29ja2V0KHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbInRveC1lZGl0LWFyZWEiXQogICAgICB9CiAgICB9KSwKICAgICAgICBUID0gQk8ucGFydHMuc2lkZWJhcih7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtc2lkZWJhciJdCiAgICAgIH0KICAgIH0pLAogICAgICAgIEUgPSBCTy5wYXJ0cy50aHJvYmJlcih7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtdGhyb2JiZXIiXQogICAgICB9LAogICAgICBiYWNrc3RhZ2U6IHcKICAgIH0pLAogICAgICAgIEQgPSBkLmdldFBhcmFtKCJzdGF0dXNiYXIiLCAhMCwgImJvb2xlYW4iKSAmJiAhciA/IHZ0LnNvbWUoYUUoZCwgdy5zaGFyZWQucHJvdmlkZXJzKSkgOiB2dC5ub25lKCksCiAgICAgICAgQiA9IHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbInRveC1zaWRlYmFyLXdyYXAiXQogICAgICB9LAogICAgICBjb21wb25lbnRzOiBbXywgVF0KICAgIH0sCiAgICAgICAgTSA9IGV2KGQpLAogICAgICAgIEEgPSBnaChkKSwKICAgICAgICBGID0gbWgoZCksCiAgICAgICAgSSA9IEJPLnBhcnRzLmhlYWRlcih7CiAgICAgIGRvbTogX2x0KHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LWVkaXRvci1oZWFkZXIiXQogICAgICB9LCBiKSwKICAgICAgY29tcG9uZW50czogZnQoW0YgPyBbU10gOiBbXSwgTSA/IFtPXSA6IEEgPyBba10gOiBbXSwgYXYoZCkgPyBbXSA6IFt4LmFzU3BlYygpXV0pLAogICAgICBzdGlja3k6IGx2KGQpLAogICAgICBlZGl0b3I6IGQsCiAgICAgIHNoYXJlZEJhY2tzdGFnZTogdy5zaGFyZWQKICAgIH0pLAogICAgICAgIFIgPSBmdChbcyA/IFtdIDogW0ldLCByID8gW10gOiBbQl0sIHMgPyBbSV0gOiBbXV0pLAogICAgICAgIFYgPSBmdChbW3sKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbInRveC1lZGl0b3ItY29udGFpbmVyIl0KICAgICAgfSwKICAgICAgY29tcG9uZW50czogUgogICAgfV0sIHIgPyBbXSA6IEQudG9BcnJheSgpLCBbRV1dKSwKICAgICAgICBQID0gc3YoZCksCiAgICAgICAgSCA9IF9sdChfbHQoewogICAgICByb2xlOiAiYXBwbGljYXRpb24iCiAgICB9LCBscC5pc1J0bCgpID8gewogICAgICBkaXI6ICJydGwiCiAgICB9IDoge30pLCBQID8gewogICAgICAiYXJpYS1oaWRkZW4iOiAidHJ1ZSIKICAgIH0gOiB7fSksCiAgICAgICAgeiA9IF91KEJPLnNrZXRjaCh7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3giLCAidG94LXRpbnltY2UiXS5jb25jYXQociA/IFsidG94LXRpbnltY2UtaW5saW5lIl0gOiBbXSkuY29uY2F0KHMgPyBbInRveC10aW55bWNlLS10b29sYmFyLWJvdHRvbSJdIDogW10pLmNvbmNhdChjKS5jb25jYXQoYSksCiAgICAgICAgc3R5bGVzOiBfbHQoewogICAgICAgICAgdmlzaWJpbGl0eTogImhpZGRlbiIKICAgICAgICB9LCBQID8gewogICAgICAgICAgb3BhY2l0eTogIjAiLAogICAgICAgICAgYm9yZGVyOiAiMCIKICAgICAgICB9IDoge30pLAogICAgICAgIGF0dHJpYnV0ZXM6IEgKICAgICAgfSwKICAgICAgY29tcG9uZW50czogViwKICAgICAgYmVoYXZpb3VyczogdGMoW212KCksIGRkLmNvbmZpZyh7CiAgICAgICAgZGlzYWJsZUNsYXNzOiAidG94LXRpbnltY2UtLWRpc2FibGVkIgogICAgICB9KSwgTWcuY29uZmlnKHsKICAgICAgICBtb2RlOiAiY3ljbGljIiwKICAgICAgICBzZWxlY3RvcjogIi50b3gtbWVudWJhciwgLnRveC10b29sYmFyLCAudG94LXRvb2xiYXJfX3ByaW1hcnksIC50b3gtdG9vbGJhcl9fb3ZlcmZsb3ctLW9wZW4sIC50b3gtc2lkZWJhcl9fb3ZlcmZsb3ctLW9wZW4sIC50b3gtc3RhdHVzYmFyX19wYXRoLCAudG94LXN0YXR1c2Jhcl9fd29yZGNvdW50LCAudG94LXN0YXR1c2Jhcl9fYnJhbmRpbmcgYSwgLnRveC1zdGF0dXNiYXJfX3Jlc2l6ZS1oYW5kbGUiCiAgICAgIH0pXSkKICAgIH0pKSwKICAgICAgICBpID0gdnQuc29tZSh6KTsKCiAgICBkLnNob3J0Y3V0cy5hZGQoImFsdCtGOSIsICJmb2N1cyBtZW51YmFyIiwgZnVuY3Rpb24gKCkgewogICAgICBCTy5mb2N1c01lbnViYXIoeik7CiAgICB9KSwgZC5zaG9ydGN1dHMuYWRkKCJhbHQrRjEwIiwgImZvY3VzIHRvb2xiYXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgIEJPLmZvY3VzVG9vbGJhcih6KTsKICAgIH0pLCBkLmFkZENvbW1hbmQoIlRvZ2dsZVRvb2xiYXJEcmF3ZXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgIEJPLnRvZ2dsZVRvb2xiYXJEcmF3ZXIoeik7CiAgICB9KSwgZC5hZGRRdWVyeVN0YXRlSGFuZGxlcigiVG9nZ2xlVG9vbGJhckRyYXdlciIsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIEJPLmlzVG9vbGJhckRyYXdlclRvZ2dsZWQoeik7CiAgICB9KTsKICAgIHZhciBOLAogICAgICAgIEwsCiAgICAgICAgVywKICAgICAgICBVLAogICAgICAgIGosCiAgICAgICAgRywKICAgICAgICBYLAogICAgICAgIFksCiAgICAgICAgcSwKICAgICAgICBLID0gJGIoeiksCiAgICAgICAgSiA9ICRiKHkpOwoKICAgIGZ1bmN0aW9uICQoKSB7CiAgICAgIHZhciB0LAogICAgICAgICAgbiwKICAgICAgICAgIGUsCiAgICAgICAgICBvLAogICAgICAgICAgciwKICAgICAgICAgIGksCiAgICAgICAgICB1ID0gSk8oKG8gPSBhaChlID0gbiA9IGQpLCByID0gbGgoZSksIGkgPSBkaChlKSwgS08obykubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuICRPKHQsIHIsIGkpOwogICAgICB9KS5nZXRPcihhaChuKSkpKSwKICAgICAgICAgIGEgPSBKTyhRTyh0ID0gZCkuZ2V0T3IoY2godCkpKTsKICAgICAgcmV0dXJuIGQuaW5saW5lIHx8IChobigiZGl2IiwgIndpZHRoIiwgYSkgJiYgZm4oei5lbGVtZW50LCAid2lkdGgiLCBhKSwgaG4oImRpdiIsICJoZWlnaHQiLCB1KSA/IGZuKHouZWxlbWVudCwgImhlaWdodCIsIHUpIDogZm4oei5lbGVtZW50LCAiaGVpZ2h0IiwgIjIwMHB4IikpLCB1OwogICAgfQoKICAgIHJldHVybiBOID0gZCwgTCA9IEssIFcgPSBKLCBVID0gd2EoKSwgaiA9IG1jKFUsICJ0b3VjaHN0YXJ0IiwgdHQpLCBHID0gbWMoVSwgInRvdWNobW92ZSIsIGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBRKE5pKCksIHQpOwogICAgfSksIFggPSBtYyhVLCAidG91Y2hlbmQiLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gUShMaSgpLCB0KTsKICAgIH0pLCBZID0gbWMoVSwgIm1vdXNlZG93biIsIHR0KSwgcSA9IG1jKFUsICJtb3VzZXVwIiwgZnVuY3Rpb24gKHQpIHsKICAgICAgMCA9PT0gdC5yYXcuYnV0dG9uICYmIFooeWYoKSwgewogICAgICAgIHRhcmdldDogdC50YXJnZXQKICAgICAgfSk7CiAgICB9KSwgTi5vbigiUG9zdFJlbmRlciIsIGZ1bmN0aW9uICgpIHsKICAgICAgTi5vbigiY2xpY2siLCBudCksIE4ub24oInRhcCIsIG50KSwgTi5vbigibW91c2V1cCIsIGV0KSwgTi5vbigibW91c2Vkb3duIiwgb3QpLCBOLm9uKCJTY3JvbGxXaW5kb3ciLCBydCksIE4ub24oIlJlc2l6ZVdpbmRvdyIsIGl0KSwgTi5vbigiUmVzaXplRWRpdG9yIiwgdXQpLCBOLm9uKCJBZnRlclByb2dyZXNzU3RhdGUiLCBhdCksIE4ub24oIkRpc21pc3NQb3B1cHMiLCBjdCk7CiAgICB9KSwgTi5vbigicmVtb3ZlIiwgZnVuY3Rpb24gKCkgewogICAgICBOLm9mZigiY2xpY2siLCBudCksIE4ub2ZmKCJ0YXAiLCBudCksIE4ub2ZmKCJtb3VzZXVwIiwgZXQpLCBOLm9mZigibW91c2Vkb3duIiwgb3QpLCBOLm9mZigiU2Nyb2xsV2luZG93IiwgcnQpLCBOLm9mZigiUmVzaXplV2luZG93IiwgaXQpLCBOLm9mZigiUmVzaXplRWRpdG9yIiwgdXQpLCBOLm9mZigiQWZ0ZXJQcm9ncmVzc1N0YXRlIiwgYXQpLCBOLm9mZigiRGlzbWlzc1BvcHVwcyIsIGN0KSwgWS51bmJpbmQoKSwgai51bmJpbmQoKSwgRy51bmJpbmQoKSwgWC51bmJpbmQoKSwgcS51bmJpbmQoKTsKICAgIH0pLCBOLm9uKCJkZXRhY2giLCBmdW5jdGlvbiAoKSB7CiAgICAgIHpzKEwpLCB6cyhXKSwgTC5kZXN0cm95KCksIFcuZGVzdHJveSgpOwogICAgfSksIHsKICAgICAgbW90aGVyc2hpcDogSywKICAgICAgdWlNb3RoZXJzaGlwOiBKLAogICAgICBiYWNrc3RhZ2U6IHcsCiAgICAgIHJlbmRlclVJOiBmdW5jdGlvbiByZW5kZXJVSSgpIHsKICAgICAgICB2YXIgbywgcjsKICAgICAgICB2LnNldHVwKGQsIHcuc2hhcmVkLCBtKSwgUV8oZCwgdyksIGxUKGQsIGcsIHcpLCByID0gKG8gPSBkKS51aS5yZWdpc3RyeS5nZXRBbGwoKS5zaWRlYmFycywgU3Qoa3QociksIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICBmdW5jdGlvbiBlKCkgewogICAgICAgICAgICByZXR1cm4gbXQodnQuZnJvbShvLnF1ZXJ5Q29tbWFuZFZhbHVlKCJUb2dnbGVTaWRlYmFyIikpLCBuKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdCA9IHJbbl07CiAgICAgICAgICBvLnVpLnJlZ2lzdHJ5LmFkZFRvZ2dsZUJ1dHRvbihuLCB7CiAgICAgICAgICAgIGljb246IHQuaWNvbiwKICAgICAgICAgICAgdG9vbHRpcDogdC50b29sdGlwLAogICAgICAgICAgICBvbkFjdGlvbjogZnVuY3Rpb24gb25BY3Rpb24odCkgewogICAgICAgICAgICAgIG8uZXhlY0NvbW1hbmQoIlRvZ2dsZVNpZGViYXIiLCAhMSwgbiksIHQuc2V0QWN0aXZlKGUoKSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uU2V0dXA6IGZ1bmN0aW9uIG9uU2V0dXAodCkgewogICAgICAgICAgICAgIGZ1bmN0aW9uIG4oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdC5zZXRBY3RpdmUoZSgpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBvLm9uKCJUb2dnbGVTaWRlYmFyIiwgbiksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIG8ub2ZmKCJUb2dnbGVTaWRlYmFyIiwgbik7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSksIHlrKGQsIHAsIHcuc2hhcmVkKSwgZHQoZC5nZXRQYXJhbSgidG9vbGJhcl9ncm91cHMiLCB7fSwgIm9iamVjdCIpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgZC51aS5yZWdpc3RyeS5hZGRHcm91cFRvb2xiYXJCdXR0b24obiwgdCk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHQsCiAgICAgICAgICAgIG4gPSBkLnVpLnJlZ2lzdHJ5LmdldEFsbCgpLAogICAgICAgICAgICBlID0gbi5idXR0b25zLAogICAgICAgICAgICBpID0gbi5tZW51SXRlbXMsCiAgICAgICAgICAgIHUgPSBuLmNvbnRleHRUb29sYmFycywKICAgICAgICAgICAgYSA9IG4uc2lkZWJhcnMsCiAgICAgICAgICAgIGMgPSBwaChkKSwKICAgICAgICAgICAgcyA9IHsKICAgICAgICAgIG1lbnVJdGVtczogaSwKICAgICAgICAgIG1lbnVzOiAodCA9IGQuZ2V0UGFyYW0oIm1lbnUiKSkgPyBkdCh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gX2x0KF9sdCh7fSwgdCksIHsKICAgICAgICAgICAgICBpdGVtczogdC5pdGVtcwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pIDoge30sCiAgICAgICAgICBtZW51YmFyOiBkLmdldFBhcmFtKCJtZW51YmFyIiksCiAgICAgICAgICB0b29sYmFyOiBjLmdldE9yVGh1bmsoZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZC5nZXRQYXJhbSgidG9vbGJhciIsICEwKTsKICAgICAgICAgIH0pLAogICAgICAgICAgYWxsb3dUb29sYmFyR3JvdXBzOiBDID09PSBoaC5mbG9hdGluZywKICAgICAgICAgIGJ1dHRvbnM6IGUsCiAgICAgICAgICBzaWRlYmFyOiBhCiAgICAgICAgfTsKICAgICAgICBsXyhkLCB1LCB5LCB7CiAgICAgICAgICBiYWNrc3RhZ2U6IHcKICAgICAgICB9KSwgSVQoZCwgeSk7CiAgICAgICAgdmFyIGwgPSBkLmdldEVsZW1lbnQoKSwKICAgICAgICAgICAgZiA9ICQoKTsKICAgICAgICByZXR1cm4gaC5yZW5kZXIoZCwgewogICAgICAgICAgbW90aGVyc2hpcDogSywKICAgICAgICAgIHVpTW90aGVyc2hpcDogSiwKICAgICAgICAgIG91dGVyQ29udGFpbmVyOiB6CiAgICAgICAgfSwgcywgdywgewogICAgICAgICAgdGFyZ2V0Tm9kZTogbCwKICAgICAgICAgIGhlaWdodDogZgogICAgICAgIH0pOwogICAgICB9LAogICAgICBnZXRVaTogZnVuY3Rpb24gZ2V0VWkoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGNoYW5uZWxzOiB7CiAgICAgICAgICAgIGJyb2FkY2FzdEFsbDogSi5icm9hZGNhc3QsCiAgICAgICAgICAgIGJyb2FkY2FzdE9uOiBKLmJyb2FkY2FzdE9uLAogICAgICAgICAgICByZWdpc3Rlcjogc3QKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIFEobiwgZSkgewogICAgICBTdChbTCwgV10sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdC5icm9hZGNhc3RFdmVudChuLCBlKTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gWihuLCBlKSB7CiAgICAgIFN0KFtMLCBXXSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB0LmJyb2FkY2FzdE9uKFtuXSwgZSk7CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIHR0KHQpIHsKICAgICAgcmV0dXJuIFoodmYoKSwgewogICAgICAgIHRhcmdldDogdC50YXJnZXQKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gbnQodCkgewogICAgICByZXR1cm4gWih2ZigpLCB7CiAgICAgICAgdGFyZ2V0OiBBdC5mcm9tRG9tKHQudGFyZ2V0KQogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBldCh0KSB7CiAgICAgIDAgPT09IHQuYnV0dG9uICYmIFooeWYoKSwgewogICAgICAgIHRhcmdldDogQXQuZnJvbURvbSh0LnRhcmdldCkKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3QoKSB7CiAgICAgIFN0KE4uZWRpdG9yTWFuYWdlci5nZXQoKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICBOICE9PSB0ICYmIHQuZmlyZSgiRGlzbWlzc1BvcHVwcyIsIHsKICAgICAgICAgIHJlbGF0ZWRUYXJnZXQ6IE4KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gcnQodCkgewogICAgICByZXR1cm4gUShXaSgpLCBCYyh0KSk7CiAgICB9CgogICAgZnVuY3Rpb24gaXQodCkgewogICAgICBaKGJmKCksIHt9KSwgUShVaSgpLCBCYyh0KSk7CiAgICB9CgogICAgZnVuY3Rpb24gdXQoKSB7CiAgICAgIHJldHVybiBaKGJmKCksIHt9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBhdCh0KSB7CiAgICAgIHQuc3RhdGUgJiYgWih2ZigpLCB7CiAgICAgICAgdGFyZ2V0OiBBdC5mcm9tRG9tKE4uZ2V0Q29udGFpbmVyKCkpCiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGN0KHQpIHsKICAgICAgWih2ZigpLCB7CiAgICAgICAgdGFyZ2V0OiBBdC5mcm9tRG9tKHQucmVsYXRlZFRhcmdldC5nZXRDb250YWluZXIoKSkKICAgICAgfSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzRShuKSB7CiAgICByZXR1cm4gdXIoIml0ZW1zIiwgIml0ZW1zIiwgV2UoKSwgdG8ocm8oZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHVvKCJDaGVja2luZyBpdGVtIG9mICIgKyBuLCBRRCwgdCkuZm9sZChmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBSZS5lcnJvcihpcih0KSk7CiAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIFJlLnZhbHVlKHQpOwogICAgICB9KTsKICAgIH0pKSk7CiAgfQoKICBmdW5jdGlvbiBsRSh0KSB7CiAgICByZXR1cm4geSh0LnR5cGUpICYmIHkodC5uYW1lKTsKICB9CgogIGZ1bmN0aW9uIGZFKHQpIHsKICAgIHJldHVybiB7CiAgICAgIGludGVybmFsRGlhbG9nOiBhbyh1bygiZGlhbG9nIiwgdUIsIHQpKSwKICAgICAgZGF0YVZhbGlkYXRvcjogKG4gPSB6KEYoc0IodCksIGxFKSwgZnVuY3Rpb24gKG4pIHsKICAgICAgICByZXR1cm4gdnQuZnJvbShsQltuLnR5cGVdKS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICB9LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIFttbyhuLm5hbWUsIHQpXTsKICAgICAgICB9KTsKICAgICAgfSksIEpvKG4pKSwKICAgICAgaW5pdGlhbERhdGE6IHQuaW5pdGlhbERhdGEKICAgIH07CiAgICB2YXIgbjsKICB9CgogIGZ1bmN0aW9uIGRFKHQpIHsKICAgIHZhciBlID0gW10sCiAgICAgICAgbyA9IHt9OwogICAgcmV0dXJuIEoodCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgdC5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICBlLnB1c2gobik7CiAgICAgIH0sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgb1tuXSA9IHQ7CiAgICAgIH0pOwogICAgfSksIDAgPCBlLmxlbmd0aCA/IFJlLmVycm9yKGUpIDogUmUudmFsdWUobyk7CiAgfQoKICBmdW5jdGlvbiBtRSh0LCBuKSB7CiAgICBmbih0LCAiaGVpZ2h0IiwgbiArICJweCIpLCBzZSgpLmJyb3dzZXIuaXNJRSgpID8gdm4odCwgImZsZXgtYmFzaXMiKSA6IGZuKHQsICJmbGV4LWJhc2lzIiwgbiArICJweCIpOwogIH0KCiAgZnVuY3Rpb24gZ0UodCwgZCwgbikgewogICAgQXUodCwgJ1tyb2xlPSJkaWFsb2ciXScpLmVhY2goZnVuY3Rpb24gKGYpIHsKICAgICAgRnUoZiwgJ1tyb2xlPSJ0YWJsaXN0Il0nKS5lYWNoKGZ1bmN0aW9uIChsKSB7CiAgICAgICAgbi5nZXQoKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiBmbihkLCAiaGVpZ2h0IiwgIjAiKSwgZm4oZCwgImZsZXgtYmFzaXMiLCAiMCIpLCBNYXRoLm1pbih0LCAoZSA9IGQsIG8gPSBsLCByID0gR3QobiA9IGYpLmRvbSwgaSA9ICJmaXhlZCIgPT09IGduKEF1KG4sICIudG94LWRpYWxvZy13cmFwIikuZ2V0T3IobiksICJwb3NpdGlvbiIpID8gTWF0aC5tYXgoci5jbGllbnRIZWlnaHQsIHdpbmRvdy5pbm5lckhlaWdodCkgOiBNYXRoLm1heChyLm9mZnNldEhlaWdodCwgci5zY3JvbGxIZWlnaHQpLCB1ID0geG4oZSksIGEgPSBlLmRvbS5vZmZzZXRMZWZ0ID49IG8uZG9tLm9mZnNldExlZnQgKyBrbihvKSA/IE1hdGgubWF4KHhuKG8pLCB1KSA6IHUsIGMgPSBwYXJzZUludChnbihuLCAibWFyZ2luLXRvcCIpLCAxMCkgfHwgMCwgcyA9IHBhcnNlSW50KGduKG4sICJtYXJnaW4tYm90dG9tIiksIDEwKSB8fCAwLCBpIC0gKHhuKG4pICsgYyArIHMgLSBhKSkpOwogICAgICAgICAgdmFyIG4sIGUsIG8sIHIsIGksIHUsIGEsIGMsIHM7CiAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgbUUoZCwgdCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBwRSh0KSB7CiAgICByZXR1cm4gRnUodCwgJ1tyb2xlPSJ0YWJwYW5lbCJdJyk7CiAgfQoKICBmdW5jdGlvbiBoRSh0LCBlKSB7CiAgICBmdW5jdGlvbiBvKHQpIHsKICAgICAgdmFyIG4gPSBkRShUZi5nZXRWYWx1ZSh0KSkuZ2V0T3Ioe30pLAogICAgICAgICAgZSA9IGkuZ2V0KCksCiAgICAgICAgICBvID0gWG8oZSwgbik7CiAgICAgIGkuc2V0KG8pOwogICAgfQoKICAgIGZ1bmN0aW9uIHIodCkgewogICAgICB2YXIgbiA9IGkuZ2V0KCk7CiAgICAgIFRmLnNldFZhbHVlKHQsIG4pOwogICAgfQoKICAgIHZhciB1LAogICAgICAgIGEsCiAgICAgICAgaSA9IFZvKHt9KSwKICAgICAgICBjID0gVm8obnVsbCksCiAgICAgICAgbiA9IE0odC50YWJzLCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB0Lm5hbWUsCiAgICAgICAgZG9tOiB7CiAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgY2xhc3NlczogWyJ0b3gtZGlhbG9nX19ib2R5LW5hdi1pdGVtIl0sCiAgICAgICAgICBpbm5lckh0bWw6IGUuc2hhcmVkLnByb3ZpZGVycy50cmFuc2xhdGUodC50aXRsZSkKICAgICAgICB9LAogICAgICAgIHZpZXc6IGZ1bmN0aW9uIHZpZXcoKSB7CiAgICAgICAgICByZXR1cm4gW1F3LnNrZXRjaChmdW5jdGlvbiAobikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGRvbTogewogICAgICAgICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgICAgICAgIGNsYXNzZXM6IFsidG94LWZvcm0iXQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgY29tcG9uZW50czogTSh0Lml0ZW1zLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1DKG4sIHQsIGUpOwogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGZvcm1CZWhhdmlvdXJzOiB0YyhbTWcuY29uZmlnKHsKICAgICAgICAgICAgICAgIG1vZGU6ICJhY3ljbGljIiwKICAgICAgICAgICAgICAgIHVzZVRhYnN0b3BBdDogQyhmMCkKICAgICAgICAgICAgICB9KSwgZm0oIlRhYlZpZXcuZm9ybS5ldmVudHMiLCBbZXUociksIG91KG8pXSksIHJjLmNvbmZpZyh7CiAgICAgICAgICAgICAgICBjaGFubmVsczogc3IoW3sKICAgICAgICAgICAgICAgICAga2V5OiB4QiwKICAgICAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgICAgICBvblJlY2VpdmU6IG8KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBrZXk6IHdCLAogICAgICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgICAgIG9uUmVjZWl2ZTogcgogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9XSkKICAgICAgICAgICAgICB9KV0pCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KV07CiAgICAgICAgfQogICAgICB9OwogICAgfSksCiAgICAgICAgcyA9ICh1ID0gbiwgYSA9IGRjKCksIHsKICAgICAgZXh0cmFFdmVudHM6IFtldShmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBvID0gdC5lbGVtZW50OwogICAgICAgIHBFKG8pLmVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIHZhciBlOwogICAgICAgICAgZm4obiwgInZpc2liaWxpdHkiLCAiaGlkZGVuIiksIHQuZ2V0U3lzdGVtKCkuZ2V0QnlEb20obikudG9PcHRpb25hbCgpLmVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdmFyIG8sIHIsIGk7CiAgICAgICAgICAgIFkoRygociA9IG4sIGkgPSB0LCBNKG8gPSB1LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICAgIEZnLnNldChpLCBvW25dLnZpZXcoKSk7CiAgICAgICAgICAgICAgdmFyIGUgPSByLmRvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgICByZXR1cm4gRmcuc2V0KGksIFtdKSwgZS5oZWlnaHQ7CiAgICAgICAgICAgIH0pKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgICByZXR1cm4gbiA8IHQgPyAtMSA6IHQgPCBuID8gMSA6IDA7CiAgICAgICAgICAgIH0pKS5mb2xkKGEuY2xlYXIsIGEuc2V0KTsKICAgICAgICAgIH0pLCBnRShvLCBuLCBhKSwgdm4obiwgInZpc2liaWxpdHkiKSwgZSA9IHQsIFkodSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4geUIuc2hvd1RhYihlLCB0LnZhbHVlKTsKICAgICAgICAgIH0pLCBjcC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBnRShvLCBuLCBhKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KSwgQ3IoVWkoKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgbiA9IHQuZWxlbWVudDsKICAgICAgICBwRShuKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBnRShuLCB0LCBhKTsKICAgICAgICB9KTsKICAgICAgfSksIENyKEN5LCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIHZhciByID0gdC5lbGVtZW50OwogICAgICAgIHBFKHIpLmVhY2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgIHZhciB0ID0ga2EobWUobikpOwogICAgICAgICAgZm4obiwgInZpc2liaWxpdHkiLCAiaGlkZGVuIik7CiAgICAgICAgICB2YXIgZSA9IHBuKG4sICJoZWlnaHQiKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHQsIDEwKTsKICAgICAgICAgIH0pOwogICAgICAgICAgdm4obiwgImhlaWdodCIpLCB2bihuLCAiZmxleC1iYXNpcyIpOwogICAgICAgICAgdmFyIG8gPSBuLmRvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7CiAgICAgICAgICBlLmZvcmFsbChmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdCA8IG87CiAgICAgICAgICB9KSA/IChhLnNldChvKSwgZ0UociwgbiwgYSkpIDogZS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIG1FKG4sIHQpOwogICAgICAgICAgfSksIHZuKG4sICJ2aXNpYmlsaXR5IiksIHQuZWFjaChTYSk7CiAgICAgICAgfSk7CiAgICAgIH0pXSwKICAgICAgc2VsZWN0Rmlyc3Q6ICExCiAgICB9KTsKICAgIHJldHVybiB5Qi5za2V0Y2goewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LWRpYWxvZ19fYm9keSJdCiAgICAgIH0sCiAgICAgIG9uQ2hhbmdlVGFiOiBmdW5jdGlvbiBvbkNoYW5nZVRhYih0LCBuLCBlKSB7CiAgICAgICAgdmFyIG8gPSBUZi5nZXRWYWx1ZShuKTsKICAgICAgICB2cih0LCBTeSwgewogICAgICAgICAgbmFtZTogbywKICAgICAgICAgIG9sZE5hbWU6IGMuZ2V0KCkKICAgICAgICB9KSwgYy5zZXQobyk7CiAgICAgIH0sCiAgICAgIHRhYnM6IG4sCiAgICAgIGNvbXBvbmVudHM6IFt5Qi5wYXJ0cy50YWJiYXIoewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LWRpYWxvZ19fYm9keS1uYXYiXQogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogW3BCLnBhcnRzLnRhYnMoe30pXSwKICAgICAgICBtYXJrZXJzOiB7CiAgICAgICAgICB0YWJDbGFzczogInRveC10YWIiLAogICAgICAgICAgc2VsZWN0ZWRDbGFzczogInRveC1kaWFsb2dfX2JvZHktbmF2LWl0ZW0tLWFjdGl2ZSIKICAgICAgICB9LAogICAgICAgIHRhYmJhckJlaGF2aW91cnM6IHRjKFtmeS5jb25maWcoe30pXSkKICAgICAgfSksIHlCLnBhcnRzLnRhYnZpZXcoewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LWRpYWxvZ19fYm9keS1jb250ZW50Il0KICAgICAgICB9CiAgICAgIH0pXSwKICAgICAgc2VsZWN0Rmlyc3Q6IHMuc2VsZWN0Rmlyc3QsCiAgICAgIHRhYlNlY3Rpb25CZWhhdmlvdXJzOiB0YyhbZm0oInRhYnBhbmVsIiwgcy5leHRyYUV2ZW50cyksIE1nLmNvbmZpZyh7CiAgICAgICAgbW9kZTogImFjeWNsaWMiCiAgICAgIH0pLCB1ZC5jb25maWcoewogICAgICAgIGZpbmQ6IGZ1bmN0aW9uIGZpbmQodCkgewogICAgICAgICAgcmV0dXJuIFkoeUIuZ2V0Vmlld0l0ZW1zKHQpKTsKICAgICAgICB9CiAgICAgIH0pLCBUZi5jb25maWcoewogICAgICAgIHN0b3JlOiB7CiAgICAgICAgICBtb2RlOiAibWFudWFsIiwKICAgICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSh0KSB7CiAgICAgICAgICAgIHJldHVybiB0LmdldFN5c3RlbSgpLmJyb2FkY2FzdE9uKFt4Ql0sIHt9KSwgaS5nZXQoKTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUodCwgbikgewogICAgICAgICAgICBpLnNldChuKSwgdC5nZXRTeXN0ZW0oKS5icm9hZGNhc3RPbihbd0JdLCB7fSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KV0pCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHZFKHQsIG4sIHIsIGUpIHsKICAgIHJldHVybiB7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtZGlhbG9nX19jb250ZW50LWpzIl0sCiAgICAgICAgYXR0cmlidXRlczogX2x0KF9sdCh7fSwgbi5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGlkOiB0CiAgICAgICAgICB9OwogICAgICAgIH0pLmdldE9yKHt9KSksIGUgPyB7CiAgICAgICAgICAiYXJpYS1saXZlIjogInBvbGl0ZSIKICAgICAgICB9IDoge30pCiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IFtdLAogICAgICBiZWhhdmlvdXJzOiB0YyhbclMoMCksIHhfLmNvbmZpZyh7CiAgICAgICAgY2hhbm5lbDoga0IsCiAgICAgICAgdXBkYXRlU3RhdGU6IGZ1bmN0aW9uIHVwZGF0ZVN0YXRlKHQsIG4pIHsKICAgICAgICAgIHJldHVybiB2dC5zb21lKHsKICAgICAgICAgICAgaXNUYWJQYW5lbDogZnVuY3Rpb24gaXNUYWJQYW5lbCgpIHsKICAgICAgICAgICAgICByZXR1cm4gInRhYnBhbmVsIiA9PT0gbi5ib2R5LnR5cGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyQ29tcG9uZW50czogZnVuY3Rpb24gcmVuZGVyQ29tcG9uZW50cyh0KSB7CiAgICAgICAgICByZXR1cm4gInRhYnBhbmVsIiAhPT0gdC5ib2R5LnR5cGUgPyBbKGUgPSB0LmJvZHksIG8gPSByLCB7CiAgICAgICAgICAgIGRvbTogewogICAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgICAgY2xhc3NlczogWyJ0b3gtZGlhbG9nX19ib2R5Il0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29tcG9uZW50czogW3sKICAgICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgICAgICBjbGFzc2VzOiBbInRveC1kaWFsb2dfX2JvZHktY29udGVudCJdCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjb21wb25lbnRzOiBbKG4gPSBQbShRdy5za2V0Y2goZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIGRvbTogewogICAgICAgICAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgICAgICAgICAgY2xhc3NlczogWyJ0b3gtZm9ybSJdLmNvbmNhdChlLmNsYXNzZXMpCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGNvbXBvbmVudHM6IE0oZS5pdGVtcywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbUMobiwgdCwgbyk7CiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pKSkuYXNTcGVjKCldCiAgICAgICAgICAgIH1dLAogICAgICAgICAgICBiZWhhdmlvdXJzOiB0YyhbTWcuY29uZmlnKHsKICAgICAgICAgICAgICBtb2RlOiAiYWN5Y2xpYyIsCiAgICAgICAgICAgICAgdXNlVGFic3RvcEF0OiBDKGYwKQogICAgICAgICAgICB9KSwgb1MobiksIHNTKG4sIHsKICAgICAgICAgICAgICBwb3N0cHJvY2VzczogZnVuY3Rpb24gcG9zdHByb2Nlc3ModCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRFKHQpLmZvbGQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IodCksIHt9OwogICAgICAgICAgICAgICAgfSwgaCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KV0pCiAgICAgICAgICB9KV0gOiBbaEUodC5ib2R5LCByKV07CiAgICAgICAgICB2YXIgZSwgbywgbjsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxEYXRhOiB0CiAgICAgIH0pXSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBiRSh0LCBuKSB7CiAgICByZXR1cm4gewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIHN0eWxlczogewogICAgICAgICAgZGlzcGxheTogIm5vbmUiCiAgICAgICAgfSwKICAgICAgICBjbGFzc2VzOiBbInRveC1kaWFsb2dfX2hlYWRlciJdCiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IFt0LCBuXQogICAgfTsKICB9CgogIGZ1bmN0aW9uIHlFKHQsIG4pIHsKICAgIHJldHVybiBZRS5wYXJ0cy5jbG9zZShzcC5za2V0Y2goewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJidXR0b24iLAogICAgICAgIGNsYXNzZXM6IFsidG94LWJ1dHRvbiIsICJ0b3gtYnV0dG9uLS1pY29uIiwgInRveC1idXR0b24tLW5ha2VkIl0sCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgdHlwZTogImJ1dHRvbiIsCiAgICAgICAgICAiYXJpYS1sYWJlbCI6IG4udHJhbnNsYXRlKCJDbG9zZSIpCiAgICAgICAgfQogICAgICB9LAogICAgICBhY3Rpb246IHQsCiAgICAgIGJ1dHRvbkJlaGF2aW91cnM6IHRjKFtmeS5jb25maWcoe30pXSkKICAgIH0pKTsKICB9CgogIGZ1bmN0aW9uIHhFKCkgewogICAgcmV0dXJuIFlFLnBhcnRzLnRpdGxlKHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbInRveC1kaWFsb2dfX3RpdGxlIl0sCiAgICAgICAgaW5uZXJIdG1sOiAiIiwKICAgICAgICBzdHlsZXM6IHsKICAgICAgICAgIGRpc3BsYXk6ICJub25lIgogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB3RSh0LCBuKSB7CiAgICByZXR1cm4gWUUucGFydHMuYm9keSh7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtZGlhbG9nX19ib2R5Il0KICAgICAgfSwKICAgICAgY29tcG9uZW50czogW3sKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1kaWFsb2dfX2JvZHktY29udGVudCJdCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOiBbewogICAgICAgICAgZG9tOiB2aygiPHA+IiArIG4udHJhbnNsYXRlKHQpICsgIjwvcD4iKQogICAgICAgIH1dCiAgICAgIH1dCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIFNFKHQpIHsKICAgIHJldHVybiBZRS5wYXJ0cy5mb290ZXIoewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LWRpYWxvZ19fZm9vdGVyIl0KICAgICAgfSwKICAgICAgY29tcG9uZW50czogdAogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBDRSh0LCBuKSB7CiAgICByZXR1cm4gW3V5LnNrZXRjaCh7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtZGlhbG9nX19mb290ZXItc3RhcnQiXQogICAgICB9LAogICAgICBjb21wb25lbnRzOiB0CiAgICB9KSwgdXkuc2tldGNoKHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbInRveC1kaWFsb2dfX2Zvb3Rlci1lbmQiXQogICAgICB9LAogICAgICBjb21wb25lbnRzOiBuCiAgICB9KV07CiAgfQoKICBmdW5jdGlvbiBrRShuKSB7CiAgICB2YXIgdCwKICAgICAgICBlID0gInRveC1kaWFsb2ciLAogICAgICAgIG8gPSBlICsgIi13cmFwIiwKICAgICAgICByID0gbyArICJfX2JhY2tkcm9wIiwKICAgICAgICBpID0gZSArICJfX2Rpc2FibGUtc2Nyb2xsIjsKICAgIHJldHVybiBZRS5za2V0Y2goewogICAgICBsYXp5U2luazogbi5sYXp5U2luaywKICAgICAgb25Fc2NhcGU6IGZ1bmN0aW9uIG9uRXNjYXBlKHQpIHsKICAgICAgICByZXR1cm4gbi5vbkVzY2FwZSh0KSwgdnQuc29tZSghMCk7CiAgICAgIH0sCiAgICAgIHVzZVRhYnN0b3BBdDogZnVuY3Rpb24gdXNlVGFic3RvcEF0KHQpIHsKICAgICAgICByZXR1cm4gIWYwKHQpOwogICAgICB9LAogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFtlXS5jb25jYXQobi5leHRyYUNsYXNzZXMpLAogICAgICAgIHN0eWxlczogX2x0KHsKICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiCiAgICAgICAgfSwgbi5leHRyYVN0eWxlcykKICAgICAgfSwKICAgICAgY29tcG9uZW50czogSChbbi5oZWFkZXIsIG4uYm9keV0sIG4uZm9vdGVyLnRvQXJyYXkoKSwgITApLAogICAgICBwYXJ0czogewogICAgICAgIGJsb2NrZXI6IHsKICAgICAgICAgIGRvbTogdmsoJzxkaXYgY2xhc3M9IicgKyBvICsgJyI+PC9kaXY+JyksCiAgICAgICAgICBjb21wb25lbnRzOiBbewogICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgICAgIGNsYXNzZXM6IFRCID8gW3IsIHIgKyAiLS1vcGFxdWUiXSA6IFtyXQogICAgICAgICAgICB9CiAgICAgICAgICB9XQogICAgICAgIH0KICAgICAgfSwKICAgICAgZHJhZ0Jsb2NrQ2xhc3M6IG8sCiAgICAgIG1vZGFsQmVoYXZpb3VyczogdGMoSChbVmcuY29uZmlnKHt9KSwgZm0oImRpYWxvZy1ldmVudHMiLCBuLmRpYWxvZ0V2ZW50cy5jb25jYXQoW0RyKHZpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgTWcuZm9jdXNJbih0KTsKICAgICAgfSldKSksIGZtKCJzY3JvbGwtbG9jayIsIFtldShmdW5jdGlvbiAoKSB7CiAgICAgICAgWHIodmUoKSwgaSk7CiAgICAgIH0pLCBvdShmdW5jdGlvbiAoKSB7CiAgICAgICAgWXIodmUoKSwgaSk7CiAgICAgIH0pXSldLCBuLmV4dHJhQmVoYXZpb3VycywgITApKSwKICAgICAgZXZlbnRPcmRlcjogX2x0KCgodCA9IHt9KVtGaSgpXSA9IFsiZGlhbG9nLWV2ZW50cyJdLCB0W2ppKCldID0gWyJzY3JvbGwtbG9jayIsICJkaWFsb2ctZXZlbnRzIiwgImFsbG95LmJhc2UuYmVoYXZpb3VyIl0sIHRbR2koKV0gPSBbImFsbG95LmJhc2UuYmVoYXZpb3VyIiwgImRpYWxvZy1ldmVudHMiLCAic2Nyb2xsLWxvY2siXSwgdCksIG4uZXZlbnRPcmRlcikKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gT0UodCkgewogICAgcmV0dXJuIHNwLnNrZXRjaCh7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImJ1dHRvbiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtYnV0dG9uIiwgInRveC1idXR0b24tLWljb24iLCAidG94LWJ1dHRvbi0tbmFrZWQiXSwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICB0eXBlOiAiYnV0dG9uIiwKICAgICAgICAgICJhcmlhLWxhYmVsIjogdC50cmFuc2xhdGUoIkNsb3NlIiksCiAgICAgICAgICB0aXRsZTogdC50cmFuc2xhdGUoIkNsb3NlIikKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNvbXBvbmVudHM6IFtqbSgiY2xvc2UiLCB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbInRveC1pY29uIl0KICAgICAgfSwgdC5pY29ucyldLAogICAgICBhY3Rpb246IGZ1bmN0aW9uIGFjdGlvbih0KSB7CiAgICAgICAgaHIodCwgdnkpOwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIF9FKHQsIG4sIGUpIHsKICAgIGZ1bmN0aW9uIG8odCkgewogICAgICByZXR1cm4gW29pKGUudHJhbnNsYXRlKHQudGl0bGUpKV07CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgZG9tOiB7CiAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICBjbGFzc2VzOiBbInRveC1kaWFsb2dfX3RpdGxlIl0sCiAgICAgICAgYXR0cmlidXRlczogX2x0KHt9LCBuLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaWQ6IHQKICAgICAgICAgIH07CiAgICAgICAgfSkuZ2V0T3Ioe30pKQogICAgICB9LAogICAgICBjb21wb25lbnRzOiBvKHQpLAogICAgICBiZWhhdmlvdXJzOiB0YyhbeF8uY29uZmlnKHsKICAgICAgICBjaGFubmVsOiBDQiwKICAgICAgICByZW5kZXJDb21wb25lbnRzOiBvCiAgICAgIH0pXSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBURSgpIHsKICAgIHJldHVybiB7CiAgICAgIGRvbTogdmsoJzxkaXYgY2xhc3M9InRveC1kaWFsb2dfX2RyYWdoYW5kbGUiPjwvZGl2PicpCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gRUUodCwgbikgewogICAgcmV0dXJuIGUgPSB7CiAgICAgIHRpdGxlOiBuLnNoYXJlZC5wcm92aWRlcnMudHJhbnNsYXRlKHQpLAogICAgICBkcmFnZ2FibGU6IG4uZGlhbG9nLmlzRHJhZ2dhYmxlTW9kYWwoKQogICAgfSwgbyA9IG4uc2hhcmVkLnByb3ZpZGVycywgciA9IFlFLnBhcnRzLnRpdGxlKF9FKGUsIHZ0Lm5vbmUoKSwgbykpLCBpID0gWUUucGFydHMuZHJhZ2hhbmRsZShURSgpKSwgdSA9IFlFLnBhcnRzLmNsb3NlKE9FKG8pKSwgYSA9IFtyXS5jb25jYXQoZS5kcmFnZ2FibGUgPyBbaV0gOiBbXSkuY29uY2F0KFt1XSksIHV5LnNrZXRjaCh7CiAgICAgIGRvbTogdmsoJzxkaXYgY2xhc3M9InRveC1kaWFsb2dfX2hlYWRlciI+PC9kaXY+JyksCiAgICAgIGNvbXBvbmVudHM6IGEKICAgIH0pOwogICAgdmFyIGUsIG8sIHIsIGksIHUsIGE7CiAgfQoKICBmdW5jdGlvbiBERSh0LCBuLCBlKSB7CiAgICByZXR1cm4gewogICAgICBkb206IHsKICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgIGNsYXNzZXM6IFsidG94LWRpYWxvZ19fYnVzeS1zcGlubmVyIl0sCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgImFyaWEtbGFiZWwiOiBlLnRyYW5zbGF0ZSh0KQogICAgICAgIH0sCiAgICAgICAgc3R5bGVzOiB7CiAgICAgICAgICBsZWZ0OiAiMHB4IiwKICAgICAgICAgIHJpZ2h0OiAiMHB4IiwKICAgICAgICAgIGJvdHRvbTogIjBweCIsCiAgICAgICAgICB0b3A6ICIwcHgiLAogICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGJlaGF2aW91cnM6IG4sCiAgICAgIGNvbXBvbmVudHM6IFt7CiAgICAgICAgZG9tOiB2aygnPGRpdiBjbGFzcz0idG94LXNwaW5uZXIiPjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjwvZGl2PicpCiAgICAgIH1dCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gQkUodCwgbywgbikgewogICAgcmV0dXJuIHsKICAgICAgb25DbG9zZTogZnVuY3Rpb24gb25DbG9zZSgpIHsKICAgICAgICByZXR1cm4gbi5jbG9zZVdpbmRvdygpOwogICAgICB9LAogICAgICBvbkJsb2NrOiBmdW5jdGlvbiBvbkJsb2NrKGUpIHsKICAgICAgICBZRS5zZXRCdXN5KHQoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgIHJldHVybiBERShlLm1lc3NhZ2UsIG4sIG8pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBvblVuYmxvY2s6IGZ1bmN0aW9uIG9uVW5ibG9jaygpIHsKICAgICAgICBZRS5zZXRJZGxlKHQoKSk7CiAgICAgIH0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBNRSh0LCBuLCBlLCBvKSB7CiAgICB2YXIgcjsKICAgIHJldHVybiBfdShrRShfbHQoX2x0KHt9LCB0KSwgewogICAgICBsYXp5U2luazogby5zaGFyZWQuZ2V0U2luaywKICAgICAgZXh0cmFCZWhhdmlvdXJzOiBIKFt4Xy5jb25maWcoewogICAgICAgIGNoYW5uZWw6IFNCLAogICAgICAgIHVwZGF0ZVN0YXRlOiBmdW5jdGlvbiB1cGRhdGVTdGF0ZSh0LCBuKSB7CiAgICAgICAgICByZXR1cm4gdnQuc29tZShuKTsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxEYXRhOiBuCiAgICAgIH0pLCBmUyh7fSldLCB0LmV4dHJhQmVoYXZpb3VycywgITApLAogICAgICBvbkVzY2FwZTogZnVuY3Rpb24gb25Fc2NhcGUodCkgewogICAgICAgIGhyKHQsIHZ5KTsKICAgICAgfSwKICAgICAgZGlhbG9nRXZlbnRzOiBlLAogICAgICBldmVudE9yZGVyOiAoKHIgPSB7fSlbQWkoKV0gPSBbeF8ubmFtZSgpLCByYy5uYW1lKCldLCByW2ppKCldID0gWyJzY3JvbGwtbG9jayIsIHhfLm5hbWUoKSwgIm1lc3NhZ2VzIiwgImRpYWxvZy1ldmVudHMiLCAiYWxsb3kuYmFzZS5iZWhhdmlvdXIiXSwgcltHaSgpXSA9IFsiYWxsb3kuYmFzZS5iZWhhdmlvdXIiLCAiZGlhbG9nLWV2ZW50cyIsICJtZXNzYWdlcyIsIHhfLm5hbWUoKSwgInNjcm9sbC1sb2NrIl0sIHIpCiAgICB9KSkpOwogIH0KCiAgZnVuY3Rpb24gQUUodCkgewogICAgcmV0dXJuIE0odCwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuICJtZW51IiA9PT0gdC50eXBlID8gKGUgPSBNKChuID0gdCkuaXRlbXMsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4gPSBWbyghMSk7CiAgICAgICAgcmV0dXJuIF9sdChfbHQoe30sIHQpLCB7CiAgICAgICAgICBzdG9yYWdlOiBuCiAgICAgICAgfSk7CiAgICAgIH0pLCBfbHQoX2x0KHt9LCBuKSwgewogICAgICAgIGl0ZW1zOiBlCiAgICAgIH0pKSA6IHQ7CiAgICAgIHZhciBuLCBlOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBGRSh0KSB7CiAgICByZXR1cm4gUih0LCBmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gIm1lbnUiICE9PSBuLnR5cGUgPyB0IDogUihuLml0ZW1zLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgIHJldHVybiB0W24ubmFtZV0gPSBuLnN0b3JhZ2UsIHQ7CiAgICAgIH0sIHQpOwogICAgfSwge30pOwogIH0KCiAgZnVuY3Rpb24gSUUodCwgZSkgewogICAgcmV0dXJuIFtUcih2aSgpLCBsMCksIHQoaHksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIGUub25DbG9zZSgpLCBuLm9uQ2xvc2UoKTsKICAgIH0pLCB0KHZ5LCBmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgICBuLm9uQ2FuY2VsKHQpLCBocihvLCBoeSk7CiAgICB9KSwgQ3Iod3ksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiBlLm9uVW5ibG9jaygpOwogICAgfSksIENyKHh5LCBmdW5jdGlvbiAodCwgbikgewogICAgICByZXR1cm4gZS5vbkJsb2NrKG4uZXZlbnQpOwogICAgfSldOwogIH0KCiAgZnVuY3Rpb24gUkUodCwgbikgewogICAgZnVuY3Rpb24gZSh0LCBuKSB7CiAgICAgIHJldHVybiB1eS5za2V0Y2goewogICAgICAgIGRvbTogewogICAgICAgICAgdGFnOiAiZGl2IiwKICAgICAgICAgIGNsYXNzZXM6IFsidG94LWRpYWxvZ19fZm9vdGVyLSIgKyB0XQogICAgICAgIH0sCiAgICAgICAgY29tcG9uZW50czogTShuLCBmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIHQubWVtZW50by5hc1NwZWMoKTsKICAgICAgICB9KQogICAgICB9KTsKICAgIH0KCiAgICB2YXIgbyA9IEEobi5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQuZm9vdGVyQnV0dG9uczsKICAgIH0pLmdldE9yKFtdKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuICJzdGFydCIgPT09IHQuYWxpZ247CiAgICB9KTsKICAgIHJldHVybiBbZSgic3RhcnQiLCBvLnBhc3MpLCBlKCJlbmQiLCBvLmZhaWwpXTsKICB9CgogIGZ1bmN0aW9uIFZFKHQsIGUpIHsKICAgIHJldHVybiB7CiAgICAgIGRvbTogdmsoJzxkaXYgY2xhc3M9InRveC1kaWFsb2dfX2Zvb3RlciI+PC9kaXY+JyksCiAgICAgIGNvbXBvbmVudHM6IFtdLAogICAgICBiZWhhdmlvdXJzOiB0YyhbeF8uY29uZmlnKHsKICAgICAgICBjaGFubmVsOiBPQiwKICAgICAgICBpbml0aWFsRGF0YTogdCwKICAgICAgICB1cGRhdGVTdGF0ZTogZnVuY3Rpb24gdXBkYXRlU3RhdGUodCwgbikgewogICAgICAgICAgdmFyIHIgPSBNKG4uYnV0dG9ucywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdmFyIG4gPSBQbShxMCh0LCB0LnR5cGUsIGUpKTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBuYW1lOiB0Lm5hbWUsCiAgICAgICAgICAgICAgYWxpZ246IHQuYWxpZ24sCiAgICAgICAgICAgICAgbWVtZW50bzogbgogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gdnQuc29tZSh7CiAgICAgICAgICAgIGxvb2t1cEJ5TmFtZTogZnVuY3Rpb24gbG9va3VwQnlOYW1lKHQsIG4pIHsKICAgICAgICAgICAgICByZXR1cm4gZSA9IHQsIG8gPSBuLCBWKHIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdC5uYW1lID09PSBvOwogICAgICAgICAgICAgIH0pLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0Lm1lbWVudG8uZ2V0T3B0KGUpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHZhciBlLCBvOwogICAgICAgICAgICB9LAogICAgICAgICAgICBmb290ZXJCdXR0b25zOiByCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHJlbmRlckNvbXBvbmVudHM6IFJFCiAgICAgIH0pXSkKICAgIH07CiAgfQoKICBmdW5jdGlvbiBQRSh0LCBuKSB7CiAgICByZXR1cm4gWUUucGFydHMuZm9vdGVyKFZFKHQsIG4pKTsKICB9CgogIGZ1bmN0aW9uIEhFKG4sIGUpIHsKICAgIGlmIChuLmdldFJvb3QoKS5nZXRTeXN0ZW0oKS5pc0Nvbm5lY3RlZCgpKSB7CiAgICAgIHZhciBvID0gdWQuZ2V0Q3VycmVudChuLmdldEZvcm1XcmFwcGVyKCkpLmdldE9yKG4uZ2V0Rm9ybVdyYXBwZXIoKSk7CiAgICAgIHJldHVybiBRdy5nZXRGaWVsZChvLCBlKS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IG4uZ2V0Rm9vdGVyKCk7CiAgICAgICAgcmV0dXJuIHhfLmdldFN0YXRlKHQpLmdldCgpLmJpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0Lmxvb2t1cEJ5TmFtZShvLCBlKTsKICAgICAgICB9KTsKICAgICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gdnQuc29tZSh0KTsKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIHZ0Lm5vbmUoKTsKICB9CgogIGZ1bmN0aW9uIHpFKGMsIG8sIHMpIHsKICAgIGZ1bmN0aW9uIHQodCkgewogICAgICB2YXIgbiA9IGMuZ2V0Um9vdCgpOwogICAgICBuLmdldFN5c3RlbSgpLmlzQ29ubmVjdGVkKCkgJiYgdChuKTsKICAgIH0KCiAgICB2YXIgbCA9IHsKICAgICAgZ2V0RGF0YTogZnVuY3Rpb24gZ2V0RGF0YSgpIHsKICAgICAgICB2YXIgdCA9IGMuZ2V0Um9vdCgpLAogICAgICAgICAgICBuID0gdC5nZXRTeXN0ZW0oKS5pc0Nvbm5lY3RlZCgpID8gYy5nZXRGb3JtV3JhcHBlcigpIDogdCwKICAgICAgICAgICAgZSA9IFRmLmdldFZhbHVlKG4pLAogICAgICAgICAgICBvID0gZHQocywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiB0LmdldCgpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBfbHQoX2x0KHt9LCBlKSwgbyk7CiAgICAgIH0sCiAgICAgIHNldERhdGE6IGZ1bmN0aW9uIHNldERhdGEoYSkgewogICAgICAgIHQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgbyA9IGwuZ2V0RGF0YSgpLAogICAgICAgICAgICAgIHIgPSBfbHQoX2x0KHt9LCBvKSwgYSksCiAgICAgICAgICAgICAgaSA9IChuID0gciwgZSA9IGMuZ2V0Um9vdCgpLCB4Xy5nZXRTdGF0ZShlKS5nZXQoKS5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIGFvKHVvKCJkYXRhIiwgdC5kYXRhVmFsaWRhdG9yLCBuKSk7CiAgICAgICAgICB9KS5nZXRPcihuKSksCiAgICAgICAgICAgICAgdSA9IGMuZ2V0Rm9ybVdyYXBwZXIoKTsKCiAgICAgICAgICBUZi5zZXRWYWx1ZSh1LCBpKSwgSihzLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICBUdChyLCBuKSAmJiB0LnNldChyW25dKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBkaXNhYmxlOiBmdW5jdGlvbiBkaXNhYmxlKHQpIHsKICAgICAgICBIRShjLCB0KS5lYWNoKGRkLmRpc2FibGUpOwogICAgICB9LAogICAgICBlbmFibGU6IGZ1bmN0aW9uIGVuYWJsZSh0KSB7CiAgICAgICAgSEUoYywgdCkuZWFjaChkZC5lbmFibGUpOwogICAgICB9LAogICAgICBmb2N1czogZnVuY3Rpb24gZm9jdXModCkgewogICAgICAgIEhFKGMsIHQpLmVhY2goVmcuZm9jdXMpOwogICAgICB9LAogICAgICBibG9jazogZnVuY3Rpb24gYmxvY2sobikgewogICAgICAgIGlmICgheShuKSkgdGhyb3cgbmV3IEVycm9yKCJUaGUgZGlhbG9nSW5zdGFuY2VBUEkuYmxvY2sgZnVuY3Rpb24gc2hvdWxkIGJlIHBhc3NlZCBhIGJsb2NraW5nIG1lc3NhZ2Ugb2YgdHlwZSBzdHJpbmcgYXMgYW4gYXJndW1lbnQiKTsKICAgICAgICB0KGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2cih0LCB4eSwgewogICAgICAgICAgICBtZXNzYWdlOiBuCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgdW5ibG9jazogZnVuY3Rpb24gdW5ibG9jaygpIHsKICAgICAgICB0KGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBocih0LCB3eSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHNob3dUYWI6IGZ1bmN0aW9uIHNob3dUYWIoZSkgewogICAgICAgIHQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gYy5nZXRCb2R5KCk7CiAgICAgICAgICB4Xy5nZXRTdGF0ZShuKS5nZXQoKS5leGlzdHMoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHQuaXNUYWJQYW5lbCgpOwogICAgICAgICAgfSkgJiYgdWQuZ2V0Q3VycmVudChuKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHlCLnNob3dUYWIodCwgZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgcmVkaWFsOiBmdW5jdGlvbiByZWRpYWwoZSkgewogICAgICAgIHQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuID0gbyhlKTsKICAgICAgICAgIHQuZ2V0U3lzdGVtKCkuYnJvYWRjYXN0T24oW1NCXSwgbiksIHQuZ2V0U3lzdGVtKCkuYnJvYWRjYXN0T24oW0NCXSwgbi5pbnRlcm5hbERpYWxvZyksIHQuZ2V0U3lzdGVtKCkuYnJvYWRjYXN0T24oW2tCXSwgbi5pbnRlcm5hbERpYWxvZyksIHQuZ2V0U3lzdGVtKCkuYnJvYWRjYXN0T24oW09CXSwgbi5pbnRlcm5hbERpYWxvZyksIGwuc2V0RGF0YShuLmluaXRpYWxEYXRhKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgIHQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGhyKHQsIGh5KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfTsKICAgIHJldHVybiBsOwogIH0KCiAgZnVuY3Rpb24gTkUodCkgewogICAgcmV0dXJuIHgodCkgJiYgLTEgIT09IEFCLmluZGV4T2YodC5tY2VBY3Rpb24pOwogIH0KCiAgZnVuY3Rpb24gTEUobywgdCwgciwgbikgewogICAgdmFyIGUsCiAgICAgICAgaSwKICAgICAgICB1LAogICAgICAgIGEgPSBFRShvLnRpdGxlLCBuKSwKICAgICAgICBjID0gKGkgPSB7CiAgICAgIGRvbTogewogICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgY2xhc3NlczogWyJ0b3gtZGlhbG9nX19jb250ZW50LWpzIl0KICAgICAgfSwKICAgICAgY29tcG9uZW50czogW3sKICAgICAgICBkb206IHsKICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICBjbGFzc2VzOiBbInRveC1kaWFsb2dfX2JvZHktaWZyYW1lIl0KICAgICAgICB9LAogICAgICAgIGNvbXBvbmVudHM6IFtjMCh7CiAgICAgICAgICBkb206IHsKICAgICAgICAgICAgdGFnOiAiaWZyYW1lIiwKICAgICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICAgIHNyYzogby51cmwKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGJlaGF2aW91cnM6IHRjKFtmeS5jb25maWcoe30pLCBWZy5jb25maWcoe30pXSkKICAgICAgICB9KV0KICAgICAgfV0sCiAgICAgIGJlaGF2aW91cnM6IHRjKFtNZy5jb25maWcoewogICAgICAgIG1vZGU6ICJhY3ljbGljIiwKICAgICAgICB1c2VUYWJzdG9wQXQ6IEMoZjApCiAgICAgIH0pXSkKICAgIH0sIFlFLnBhcnRzLmJvZHkoaSkpLAogICAgICAgIHMgPSBvLmJ1dHRvbnMuYmluZChmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gMCA9PT0gdC5sZW5ndGggPyB2dC5ub25lKCkgOiB2dC5zb21lKFBFKHsKICAgICAgICBidXR0b25zOiB0CiAgICAgIH0sIG4pKTsKICAgIH0pLAogICAgICAgIGwgPSBFQihmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB2OwogICAgfSwgQkUoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gaDsKICAgIH0sIG4uc2hhcmVkLnByb3ZpZGVycywgdCkpLAogICAgICAgIGYgPSBfbHQoX2x0KHt9LCBvLmhlaWdodC5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHt9OwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBoZWlnaHQ6IHQgKyAicHgiLAogICAgICAgICJtYXgtaGVpZ2h0IjogdCArICJweCIKICAgICAgfTsKICAgIH0pKSwgby53aWR0aC5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHt9OwogICAgfSwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB3aWR0aDogdCArICJweCIsCiAgICAgICAgIm1heC13aWR0aCI6IHQgKyAicHgiCiAgICAgIH07CiAgICB9KSksCiAgICAgICAgZCA9IG8ud2lkdGguaXNOb25lKCkgJiYgby5oZWlnaHQuaXNOb25lKCkgPyBbInRveC1kaWFsb2ctLXdpZHRoLWxnIl0gOiBbXSwKICAgICAgICBtID0gbmV3IE1CKG8udXJsLCB7CiAgICAgIGJhc2VfdXJpOiBuZXcgTUIod2luZG93LmxvY2F0aW9uLmhyZWYpCiAgICB9KSwKICAgICAgICBnID0gbS5wcm90b2NvbCArICI6Ly8iICsgbS5ob3N0ICsgKG0ucG9ydCA/ICI6IiArIG0ucG9ydCA6ICIiKSwKICAgICAgICBwID0gZmMoKSwKICAgICAgICBoID0gTUUoewogICAgICBoZWFkZXI6IGEsCiAgICAgIGJvZHk6IGMsCiAgICAgIGZvb3RlcjogcywKICAgICAgZXh0cmFDbGFzc2VzOiBkLAogICAgICBleHRyYUJlaGF2aW91cnM6IFtmbSgibWVzc2FnZXMiLCBbZXUoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ID0gbWMoQXQuZnJvbURvbSh3aW5kb3cpLCAibWVzc2FnZSIsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICB2YXIgbiwgZTsKICAgICAgICAgIG0uaXNTYW1lT3JpZ2luKG5ldyBNQih0LnJhdy5vcmlnaW4pKSAmJiAoTkUobiA9IHQucmF3LmRhdGEpID8gZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgICAgICAgc3dpdGNoIChlLm1jZUFjdGlvbikgewogICAgICAgICAgICAgIGNhc2UgImluc2VydENvbnRlbnQiOgogICAgICAgICAgICAgICAgdC5pbnNlcnRDb250ZW50KGUuY29udGVudCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAic2V0Q29udGVudCI6CiAgICAgICAgICAgICAgICB0LnNldENvbnRlbnQoZS5jb250ZW50KTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJleGVjQ29tbWFuZCI6CiAgICAgICAgICAgICAgICB2YXIgbyA9ICEhdyhlLnVpKSAmJiBlLnVpOwogICAgICAgICAgICAgICAgdC5leGVjQ29tbWFuZChlLmNtZCwgbywgZS52YWx1ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAiY2xvc2UiOgogICAgICAgICAgICAgICAgbi5jbG9zZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgImJsb2NrIjoKICAgICAgICAgICAgICAgIG4uYmxvY2soZS5tZXNzYWdlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlICJ1bmJsb2NrIjoKICAgICAgICAgICAgICAgIG4udW5ibG9jaygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KHIsIHYsIG4pIDogIU5FKGUgPSBuKSAmJiB4KGUpICYmIFR0KGUsICJtY2VBY3Rpb24iKSAmJiBvLm9uTWVzc2FnZSh2LCBuKSk7CiAgICAgICAgfSk7CiAgICAgICAgcC5zZXQodCk7CiAgICAgIH0pLCBvdShwLmNsZWFyKV0pLCByYy5jb25maWcoewogICAgICAgIGNoYW5uZWxzOiAoKGUgPSB7fSlbX0JdID0gewogICAgICAgICAgb25SZWNlaXZlOiBmdW5jdGlvbiBvblJlY2VpdmUodCwgbikgewogICAgICAgICAgICBGdSh0LmVsZW1lbnQsICJpZnJhbWUiKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgdC5kb20uY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZShuLCBnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgZSkKICAgICAgfSldLAogICAgICBleHRyYVN0eWxlczogZgogICAgfSwgbywgbCwgbiksCiAgICAgICAgdiA9IHsKICAgICAgYmxvY2s6IGZ1bmN0aW9uIGJsb2NrKG4pIHsKICAgICAgICBpZiAoIXkobikpIHRocm93IG5ldyBFcnJvcigiVGhlIHVybERpYWxvZ0luc3RhbmNlQVBJLmJsb2NrIGZ1bmN0aW9uIHNob3VsZCBiZSBwYXNzZWQgYSBibG9ja2luZyBtZXNzYWdlIG9mIHR5cGUgc3RyaW5nIGFzIGFuIGFyZ3VtZW50Iik7CiAgICAgICAgYihmdW5jdGlvbiAodCkgewogICAgICAgICAgdnIodCwgeHksIHsKICAgICAgICAgICAgbWVzc2FnZTogbgogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHVuYmxvY2s6IGZ1bmN0aW9uIHVuYmxvY2soKSB7CiAgICAgICAgYihmdW5jdGlvbiAodCkgewogICAgICAgICAgaHIodCwgd3kpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgYihmdW5jdGlvbiAodCkgewogICAgICAgICAgaHIodCwgaHkpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBzZW5kTWVzc2FnZTogZnVuY3Rpb24gc2VuZE1lc3NhZ2UobikgewogICAgICAgIGIoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHQuZ2V0U3lzdGVtKCkuYnJvYWRjYXN0T24oW19CXSwgbik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gYih0KSB7CiAgICAgIHUuZ2V0U3lzdGVtKCkuaXNDb25uZWN0ZWQoKSAmJiB0KHUpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIGRpYWxvZzogdSA9IGgsCiAgICAgIGluc3RhbmNlQXBpOiB2CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gV0UodCkgewogICAgZnVuY3Rpb24gbyh0LCB5KSB7CiAgICAgIHJldHVybiBmQi5vcGVuKGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgICAgdmFyIG8sCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIHUsCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIGMsCiAgICAgICAgICAgIHMsCiAgICAgICAgICAgIGwsCiAgICAgICAgICAgIGYsCiAgICAgICAgICAgIGQsCiAgICAgICAgICAgIG0sCiAgICAgICAgICAgIGcsCiAgICAgICAgICAgIHAsCiAgICAgICAgICAgIGgsCiAgICAgICAgICAgIHYgPSBuLAogICAgICAgICAgICBiID0gKHIgPSB7CiAgICAgICAgICByZWRpYWw6IGZCLnJlZGlhbCwKICAgICAgICAgIGNsb3NlV2luZG93OiBmdW5jdGlvbiBjbG9zZVdpbmRvdygpIHsKICAgICAgICAgICAgWUUuaGlkZShiLmRpYWxvZyksIHkoYi5pbnN0YW5jZUFwaSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgaSA9IFIsIGMgPSBFRSgobyA9IHsKICAgICAgICAgIGRhdGFWYWxpZGF0b3I6IGUsCiAgICAgICAgICBpbml0aWFsRGF0YTogdiwKICAgICAgICAgIGludGVybmFsRGlhbG9nOiB0CiAgICAgICAgfSkuaW50ZXJuYWxEaWFsb2cudGl0bGUsIGkpLCB1ID0gaSwgYSA9IHZFKHsKICAgICAgICAgIGJvZHk6IG8uaW50ZXJuYWxEaWFsb2cuYm9keQogICAgICAgIH0sIHZ0Lm5vbmUoKSwgdSwgITEpLCBzID0gWUUucGFydHMuYm9keShhKSwgbCA9IEFFKG8uaW50ZXJuYWxEaWFsb2cuYnV0dG9ucyksIGYgPSBGRShsKSwgZCA9IFBFKHsKICAgICAgICAgIGJ1dHRvbnM6IGwKICAgICAgICB9LCBpKSwgbSA9IERCKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBoOwogICAgICAgIH0sIEJFKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBwOwogICAgICAgIH0sIGkuc2hhcmVkLnByb3ZpZGVycywgciksIGkuc2hhcmVkLmdldFNpbmspLCBnID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgc3dpdGNoIChvLmludGVybmFsRGlhbG9nLnNpemUpIHsKICAgICAgICAgICAgY2FzZSAibGFyZ2UiOgogICAgICAgICAgICAgIHJldHVybiBbInRveC1kaWFsb2ctLXdpZHRoLWxnIl07CgogICAgICAgICAgICBjYXNlICJtZWRpdW0iOgogICAgICAgICAgICAgIHJldHVybiBbInRveC1kaWFsb2ctLXdpZHRoLW1kIl07CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIH0KICAgICAgICB9KCksIHAgPSBNRSh7CiAgICAgICAgICBoZWFkZXI6IGMsCiAgICAgICAgICBib2R5OiBzLAogICAgICAgICAgZm9vdGVyOiB2dC5zb21lKGQpLAogICAgICAgICAgZXh0cmFDbGFzc2VzOiBnLAogICAgICAgICAgZXh0cmFCZWhhdmlvdXJzOiBbXSwKICAgICAgICAgIGV4dHJhU3R5bGVzOiB7fQogICAgICAgIH0sIG8sIG0sIGkpLCBoID0gekUoewogICAgICAgICAgZ2V0Um9vdDogcnQocCksCiAgICAgICAgICBnZXRCb2R5OiBmdW5jdGlvbiBnZXRCb2R5KCkgewogICAgICAgICAgICByZXR1cm4gWUUuZ2V0Qm9keShwKTsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXRGb290ZXI6IGZ1bmN0aW9uIGdldEZvb3RlcigpIHsKICAgICAgICAgICAgcmV0dXJuIFlFLmdldEZvb3RlcihwKTsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXRGb3JtV3JhcHBlcjogZnVuY3Rpb24gZ2V0Rm9ybVdyYXBwZXIoKSB7CiAgICAgICAgICAgIHZhciB0ID0gWUUuZ2V0Qm9keShwKTsKICAgICAgICAgICAgcmV0dXJuIHVkLmdldEN1cnJlbnQodCkuZ2V0T3IodCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgci5yZWRpYWwsIGYpLCB7CiAgICAgICAgICBkaWFsb2c6IHAsCiAgICAgICAgICBpbnN0YW5jZUFwaTogaAogICAgICAgIH0pOwogICAgICAgIHJldHVybiBZRS5zaG93KGIuZGlhbG9nKSwgYi5pbnN0YW5jZUFwaS5zZXREYXRhKHYpLCBiLmluc3RhbmNlQXBpOwogICAgICB9LCB0KTsKICAgIH0KCiAgICBmdW5jdGlvbiByKHQsIEEsIEYsIEkpIHsKICAgICAgcmV0dXJuIGZCLm9wZW4oZnVuY3Rpb24gKHQsIG4sIGUpIHsKICAgICAgICBmdW5jdGlvbiBvKCkgewogICAgICAgICAgcmV0dXJuIEUub24oZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcnAucmVwb3NpdGlvbih0KSwgTjEucmVmcmVzaCh0KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIHUsCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIGMsCiAgICAgICAgICAgIHMsCiAgICAgICAgICAgIGwsCiAgICAgICAgICAgIGYsCiAgICAgICAgICAgIGQsCiAgICAgICAgICAgIG0sCiAgICAgICAgICAgIGcsCiAgICAgICAgICAgIHAsCiAgICAgICAgICAgIGgsCiAgICAgICAgICAgIHYsCiAgICAgICAgICAgIGIsCiAgICAgICAgICAgIHksCiAgICAgICAgICAgIHgsCiAgICAgICAgICAgIHcsCiAgICAgICAgICAgIFMsCiAgICAgICAgICAgIEMsCiAgICAgICAgICAgIGssCiAgICAgICAgICAgIE8sCiAgICAgICAgICAgIF8sCiAgICAgICAgICAgIFQgPSBhbyh1bygiZGF0YSIsIGUsIG4pKSwKICAgICAgICAgICAgRSA9IGRjKCksCiAgICAgICAgICAgIEQgPSBSLnNoYXJlZC5oZWFkZXIuaXNQb3NpdGlvbmVkQXRUb3AoKSwKICAgICAgICAgICAgQiA9IChpID0gewogICAgICAgICAgZGF0YVZhbGlkYXRvcjogZSwKICAgICAgICAgIGluaXRpYWxEYXRhOiBULAogICAgICAgICAgaW50ZXJuYWxEaWFsb2c6IHQKICAgICAgICB9LCB1ID0gewogICAgICAgICAgcmVkaWFsOiBmQi5yZWRpYWwsCiAgICAgICAgICBjbG9zZVdpbmRvdzogZnVuY3Rpb24gY2xvc2VXaW5kb3coKSB7CiAgICAgICAgICAgIEUub24ocnAuaGlkZSksIFYub2ZmKCJSZXNpemVFZGl0b3IiLCBvKSwgRS5jbGVhcigpLCBGKEIuaW5zdGFuY2VBcGkpOwogICAgICAgICAgfQogICAgICAgIH0sIGEgPSBSLCBjID0gSSwgdiA9IEZyKCJkaWFsb2ctbGFiZWwiKSwgYiA9IEZyKCJkaWFsb2ctY29udGVudCIpLCB5ID0gUG0oKGYgPSB7CiAgICAgICAgICB0aXRsZTogaS5pbnRlcm5hbERpYWxvZy50aXRsZSwKICAgICAgICAgIGRyYWdnYWJsZTogITAKICAgICAgICB9LCBkID0gdiwgbSA9IGEuc2hhcmVkLnByb3ZpZGVycywgdXkuc2tldGNoKHsKICAgICAgICAgIGRvbTogdmsoJzxkaXYgY2xhc3M9InRveC1kaWFsb2dfX2hlYWRlciI+PC9kaXY+JyksCiAgICAgICAgICBjb21wb25lbnRzOiBbX0UoZiwgdnQuc29tZShkKSwgbSksIFRFKCksIE9FKG0pXSwKICAgICAgICAgIGNvbnRhaW5lckJlaGF2aW91cnM6IHRjKFtyRS5jb25maWcoewogICAgICAgICAgICBtb2RlOiAibW91c2UiLAogICAgICAgICAgICBibG9ja2VyQ2xhc3M6ICJibG9ja2VyIiwKICAgICAgICAgICAgZ2V0VGFyZ2V0OiBmdW5jdGlvbiBnZXRUYXJnZXQodCkgewogICAgICAgICAgICAgIHJldHVybiBJdSh0LCAnW3JvbGU9ImRpYWxvZyJdJykuZ2V0T3JEaWUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc25hcHM6IHsKICAgICAgICAgICAgICBnZXRTbmFwUG9pbnRzOiBmdW5jdGlvbiBnZXRTbmFwUG9pbnRzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbGVmdEF0dHI6ICJkYXRhLWRyYWctbGVmdCIsCiAgICAgICAgICAgICAgdG9wQXR0cjogImRhdGEtZHJhZy10b3AiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pXSkKICAgICAgICB9KSkpLCB4ID0gUG0oKGcgPSB7CiAgICAgICAgICBib2R5OiBpLmludGVybmFsRGlhbG9nLmJvZHkKICAgICAgICB9LCBwID0gYSwgaCA9IGMsIHZFKGcsIHZ0LnNvbWUoYiksIHAsIGgpKSksIHcgPSBBRShpLmludGVybmFsRGlhbG9nLmJ1dHRvbnMpLCBTID0gRkUodyksIEMgPSBQbShCQih7CiAgICAgICAgICBidXR0b25zOiB3CiAgICAgICAgfSwgYSkpLCBrID0gREIoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF87CiAgICAgICAgfSwgewogICAgICAgICAgb25CbG9jazogZnVuY3Rpb24gb25CbG9jayhlKSB7CiAgICAgICAgICAgIGNPLmJsb2NrKE8sIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIERFKGUubWVzc2FnZSwgbiwgYS5zaGFyZWQucHJvdmlkZXJzKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgb25VbmJsb2NrOiBmdW5jdGlvbiBvblVuYmxvY2soKSB7CiAgICAgICAgICAgIGNPLnVuYmxvY2soTyk7CiAgICAgICAgICB9LAogICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24gb25DbG9zZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHUuY2xvc2VXaW5kb3coKTsKICAgICAgICAgIH0KICAgICAgICB9LCBhLnNoYXJlZC5nZXRTaW5rKSwgTyA9IF91KHsKICAgICAgICAgIGRvbTogewogICAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgICBjbGFzc2VzOiBbInRveC1kaWFsb2ciLCAidG94LWRpYWxvZy1pbmxpbmUiXSwKICAgICAgICAgICAgYXR0cmlidXRlczogKChzID0gewogICAgICAgICAgICAgIHJvbGU6ICJkaWFsb2ciCiAgICAgICAgICAgIH0pWyJhcmlhLWxhYmVsbGVkYnkiXSA9IHYsIHNbImFyaWEtZGVzY3JpYmVkYnkiXSA9IGIsIHMpCiAgICAgICAgICB9LAogICAgICAgICAgZXZlbnRPcmRlcjogKChsID0ge30pW0FpKCldID0gW3hfLm5hbWUoKSwgcmMubmFtZSgpXSwgbFtGaSgpXSA9IFsiZXhlY3V0ZS1vbi1mb3JtIl0sIGxbamkoKV0gPSBbInJlZmxlY3RpbmciLCAiZXhlY3V0ZS1vbi1mb3JtIl0sIGwpLAogICAgICAgICAgYmVoYXZpb3VyczogdGMoW01nLmNvbmZpZyh7CiAgICAgICAgICAgIG1vZGU6ICJjeWNsaWMiLAogICAgICAgICAgICBvbkVzY2FwZTogZnVuY3Rpb24gb25Fc2NhcGUodCkgewogICAgICAgICAgICAgIHJldHVybiBocih0LCBoeSksIHZ0LnNvbWUoITApOwogICAgICAgICAgICB9LAogICAgICAgICAgICB1c2VUYWJzdG9wQXQ6IGZ1bmN0aW9uIHVzZVRhYnN0b3BBdCh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuICFmMCh0KSAmJiAoImJ1dHRvbiIgIT09IEZ0KHQpIHx8ICJkaXNhYmxlZCIgIT09IHJuKHQsICJkaXNhYmxlZCIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSksIHhfLmNvbmZpZyh7CiAgICAgICAgICAgIGNoYW5uZWw6IFNCLAogICAgICAgICAgICB1cGRhdGVTdGF0ZTogZnVuY3Rpb24gdXBkYXRlU3RhdGUodCwgbikgewogICAgICAgICAgICAgIHJldHVybiB2dC5zb21lKG4pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBpbml0aWFsRGF0YTogaQogICAgICAgICAgfSksIFZnLmNvbmZpZyh7fSksIGZtKCJleGVjdXRlLW9uLWZvcm0iLCBrLmNvbmNhdChbRHIodmkoKSwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICAgICAgTWcuZm9jdXNJbih0KTsKICAgICAgICAgIH0pXSkpLCBjTy5jb25maWcoewogICAgICAgICAgICBnZXRSb290OiBmdW5jdGlvbiBnZXRSb290KCkgewogICAgICAgICAgICAgIHJldHVybiB2dC5zb21lKE8pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KSwgRmcuY29uZmlnKHt9KSwgZlMoe30pXSksCiAgICAgICAgICBjb21wb25lbnRzOiBbeS5hc1NwZWMoKSwgeC5hc1NwZWMoKSwgQy5hc1NwZWMoKV0KICAgICAgICB9KSwgXyA9IHpFKHsKICAgICAgICAgIGdldFJvb3Q6IHJ0KE8pLAogICAgICAgICAgZ2V0Rm9vdGVyOiBmdW5jdGlvbiBnZXRGb290ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBDLmdldChPKTsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXRCb2R5OiBmdW5jdGlvbiBnZXRCb2R5KCkgewogICAgICAgICAgICByZXR1cm4geC5nZXQoTyk7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0Rm9ybVdyYXBwZXI6IGZ1bmN0aW9uIGdldEZvcm1XcmFwcGVyKCkgewogICAgICAgICAgICB2YXIgdCA9IHguZ2V0KE8pOwogICAgICAgICAgICByZXR1cm4gdWQuZ2V0Q3VycmVudCh0KS5nZXRPcih0KTsKICAgICAgICAgIH0KICAgICAgICB9LCB1LnJlZGlhbCwgUyksIHsKICAgICAgICAgIGRpYWxvZzogTywKICAgICAgICAgIGluc3RhbmNlQXBpOiBfCiAgICAgICAgfSksCiAgICAgICAgICAgIE0gPSBfdShycC5za2V0Y2goX2x0KF9sdCh7CiAgICAgICAgICBsYXp5U2luazogUi5zaGFyZWQuZ2V0U2luaywKICAgICAgICAgIGRvbTogewogICAgICAgICAgICB0YWc6ICJkaXYiLAogICAgICAgICAgICBjbGFzc2VzOiBbXQogICAgICAgICAgfSwKICAgICAgICAgIGZpcmVEaXNtaXNzYWxFdmVudEluc3RlYWQ6IHt9CiAgICAgICAgfSwgRCA/IHt9IDogewogICAgICAgICAgZmlyZVJlcG9zaXRpb25FdmVudEluc3RlYWQ6IHt9CiAgICAgICAgfSksIHsKICAgICAgICAgIGlubGluZUJlaGF2aW91cnM6IHRjKEgoW2ZtKCJ3aW5kb3ctbWFuYWdlci1pbmxpbmUtZXZlbnRzIiwgW0NyKFhpKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgIGhyKEIuZGlhbG9nLCB2eSk7CiAgICAgICAgICB9KV0pXSwgKHIgPSBWLCBQICYmIEQgPyBbXSA6IFtOMS5jb25maWcoewogICAgICAgICAgICBjb250ZXh0dWFsOiB7CiAgICAgICAgICAgICAgbGF6eUNvbnRleHQ6IGZ1bmN0aW9uIGxhenlDb250ZXh0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHZ0LnNvbWUoTWUoQXQuZnJvbURvbShyLmdldENvbnRlbnRBcmVhQ29udGFpbmVyKCkpKSk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBmYWRlSW5DbGFzczogInRveC1kaWFsb2ctZG9jay1mYWRlaW4iLAogICAgICAgICAgICAgIGZhZGVPdXRDbGFzczogInRveC1kaWFsb2ctZG9jay1mYWRlb3V0IiwKICAgICAgICAgICAgICB0cmFuc2l0aW9uQ2xhc3M6ICJ0b3gtZGlhbG9nLWRvY2stdHJhbnNpdGlvbiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbW9kZXM6IFsidG9wIl0KICAgICAgICAgIH0pXSksICEwKSksCiAgICAgICAgICBpc0V4dHJhUGFydDogZnVuY3Rpb24gaXNFeHRyYVBhcnQodCwgbikgewogICAgICAgICAgICByZXR1cm4gVWIoZSA9IG4sICIudG94LWFsZXJ0LWRpYWxvZyIpIHx8IFViKGUsICIudG94LWNvbmZpcm0tZGlhbG9nIik7CiAgICAgICAgICAgIHZhciBlOwogICAgICAgICAgfQogICAgICAgIH0pKSk7CgogICAgICAgIHJldHVybiBFLnNldChNKSwgcnAuc2hvd1dpdGhpbihNLCBUdShCLmRpYWxvZyksIHsKICAgICAgICAgIGFuY2hvcjogQQogICAgICAgIH0sIHZ0LnNvbWUodmUoKSkpLCBQICYmIEQgfHwgKE4xLnJlZnJlc2goTSksIFYub24oIlJlc2l6ZUVkaXRvciIsIG8pKSwgQi5pbnN0YW5jZUFwaS5zZXREYXRhKFQpLCBNZy5mb2N1c0luKEIuZGlhbG9nKSwgQi5pbnN0YW5jZUFwaTsKICAgICAgfSwgdCk7CiAgICB9CgogICAgdmFyIGMsCiAgICAgICAgcywKICAgICAgICBsLAogICAgICAgIGYsCiAgICAgICAgUiA9IHQuYmFja3N0YWdlLAogICAgICAgIFYgPSB0LmVkaXRvciwKICAgICAgICBQID0gbHYoViksCiAgICAgICAgZSA9IChzID0gKGMgPSB0KS5iYWNrc3RhZ2Uuc2hhcmVkLCB7CiAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4odCwgbikgewogICAgICAgIGZ1bmN0aW9uIGUoKSB7CiAgICAgICAgICBZRS5oaWRlKHUpLCBuKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbyA9IFBtKHEwKHsKICAgICAgICAgIG5hbWU6ICJjbG9zZS1hbGVydCIsCiAgICAgICAgICB0ZXh0OiAiT0siLAogICAgICAgICAgcHJpbWFyeTogITAsCiAgICAgICAgICBhbGlnbjogImVuZCIsCiAgICAgICAgICBkaXNhYmxlZDogITEsCiAgICAgICAgICBpY29uOiB2dC5ub25lKCkKICAgICAgICB9LCAiY2FuY2VsIiwgYy5iYWNrc3RhZ2UpKSwKICAgICAgICAgICAgciA9IHhFKCksCiAgICAgICAgICAgIGkgPSB5RShlLCBzLnByb3ZpZGVycyksCiAgICAgICAgICAgIHUgPSBfdShrRSh7CiAgICAgICAgICBsYXp5U2luazogZnVuY3Rpb24gbGF6eVNpbmsoKSB7CiAgICAgICAgICAgIHJldHVybiBzLmdldFNpbmsoKTsKICAgICAgICAgIH0sCiAgICAgICAgICBoZWFkZXI6IGJFKHIsIGkpLAogICAgICAgICAgYm9keTogd0UodCwgcy5wcm92aWRlcnMpLAogICAgICAgICAgZm9vdGVyOiB2dC5zb21lKFNFKENFKFtdLCBbby5hc1NwZWMoKV0pKSksCiAgICAgICAgICBvbkVzY2FwZTogZSwKICAgICAgICAgIGV4dHJhQ2xhc3NlczogWyJ0b3gtYWxlcnQtZGlhbG9nIl0sCiAgICAgICAgICBleHRyYUJlaGF2aW91cnM6IFtdLAogICAgICAgICAgZXh0cmFTdHlsZXM6IHt9LAogICAgICAgICAgZGlhbG9nRXZlbnRzOiBbQ3IodnksIGUpXSwKICAgICAgICAgIGV2ZW50T3JkZXI6IHt9CiAgICAgICAgfSkpOwoKICAgICAgICBZRS5zaG93KHUpOwogICAgICAgIHZhciBhID0gby5nZXQodSk7CiAgICAgICAgVmcuZm9jdXMoYSk7CiAgICAgIH0KICAgIH0pLAogICAgICAgIGkgPSAoZiA9IChsID0gdCkuYmFja3N0YWdlLnNoYXJlZCwgewogICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKHQsIG4pIHsKICAgICAgICBmdW5jdGlvbiBlKHQpIHsKICAgICAgICAgIFlFLmhpZGUoYSksIG4odCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbyA9IFBtKHEwKHsKICAgICAgICAgIG5hbWU6ICJ5ZXMiLAogICAgICAgICAgdGV4dDogIlllcyIsCiAgICAgICAgICBwcmltYXJ5OiAhMCwKICAgICAgICAgIGFsaWduOiAiZW5kIiwKICAgICAgICAgIGRpc2FibGVkOiAhMSwKICAgICAgICAgIGljb246IHZ0Lm5vbmUoKQogICAgICAgIH0sICJzdWJtaXQiLCBsLmJhY2tzdGFnZSkpLAogICAgICAgICAgICByID0gcTAoewogICAgICAgICAgbmFtZTogIm5vIiwKICAgICAgICAgIHRleHQ6ICJObyIsCiAgICAgICAgICBwcmltYXJ5OiAhMSwKICAgICAgICAgIGFsaWduOiAiZW5kIiwKICAgICAgICAgIGRpc2FibGVkOiAhMSwKICAgICAgICAgIGljb246IHZ0Lm5vbmUoKQogICAgICAgIH0sICJjYW5jZWwiLCBsLmJhY2tzdGFnZSksCiAgICAgICAgICAgIGkgPSB4RSgpLAogICAgICAgICAgICB1ID0geUUoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGUoITEpOwogICAgICAgIH0sIGYucHJvdmlkZXJzKSwKICAgICAgICAgICAgYSA9IF91KGtFKHsKICAgICAgICAgIGxhenlTaW5rOiBmdW5jdGlvbiBsYXp5U2luaygpIHsKICAgICAgICAgICAgcmV0dXJuIGYuZ2V0U2luaygpOwogICAgICAgICAgfSwKICAgICAgICAgIGhlYWRlcjogYkUoaSwgdSksCiAgICAgICAgICBib2R5OiB3RSh0LCBmLnByb3ZpZGVycyksCiAgICAgICAgICBmb290ZXI6IHZ0LnNvbWUoU0UoQ0UoW10sIFtyLCBvLmFzU3BlYygpXSkpKSwKICAgICAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiBvbkVzY2FwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGUoITEpOwogICAgICAgICAgfSwKICAgICAgICAgIGV4dHJhQ2xhc3NlczogWyJ0b3gtY29uZmlybS1kaWFsb2ciXSwKICAgICAgICAgIGV4dHJhQmVoYXZpb3VyczogW10sCiAgICAgICAgICBleHRyYVN0eWxlczoge30sCiAgICAgICAgICBkaWFsb2dFdmVudHM6IFtDcih2eSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZSghMSk7CiAgICAgICAgICB9KSwgQ3IoeXksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGUoITApOwogICAgICAgICAgfSldLAogICAgICAgICAgZXZlbnRPcmRlcjoge30KICAgICAgICB9KSk7CgogICAgICAgIFlFLnNob3coYSk7CiAgICAgICAgdmFyIGMgPSBvLmdldChhKTsKICAgICAgICBWZy5mb2N1cyhjKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gewogICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKHQsIG4sIGUpIHsKICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBuICYmICJ0b29sYmFyIiA9PT0gbi5pbmxpbmUgPyByKHQsIFIuc2hhcmVkLmFuY2hvcnMuaW5saW5lRGlhbG9nKCksIGUsIG4uYXJpYUF0dHJzKSA6IHZvaWQgMCAhPT0gbiAmJiAiY3Vyc29yIiA9PT0gbi5pbmxpbmUgPyByKHQsIFIuc2hhcmVkLmFuY2hvcnMuY3Vyc29yKCksIGUsIG4uYXJpYUF0dHJzKSA6IG8odCwgZSk7CiAgICAgIH0sCiAgICAgIG9wZW5Vcmw6IGZ1bmN0aW9uIG9wZW5VcmwodCwgbikgewogICAgICAgIHJldHVybiBlID0gbiwgZkIub3BlblVybChmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIG4gPSBMRSh0LCB7CiAgICAgICAgICAgIGNsb3NlV2luZG93OiBmdW5jdGlvbiBjbG9zZVdpbmRvdygpIHsKICAgICAgICAgICAgICBZRS5oaWRlKG4uZGlhbG9nKSwgZShuLmluc3RhbmNlQXBpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgViwgUik7CiAgICAgICAgICByZXR1cm4gWUUuc2hvdyhuLmRpYWxvZyksIG4uaW5zdGFuY2VBcGk7CiAgICAgICAgfSwgdCk7CiAgICAgICAgdmFyIGU7CiAgICAgIH0sCiAgICAgIGFsZXJ0OiBmdW5jdGlvbiBhbGVydCh0LCBuKSB7CiAgICAgICAgZS5vcGVuKHQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG4oKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKHQpIHsKICAgICAgICB0LmNsb3NlKCk7CiAgICAgIH0sCiAgICAgIGNvbmZpcm06IGZ1bmN0aW9uIGNvbmZpcm0odCwgbikgewogICAgICAgIGkub3Blbih0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgbih0KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfTsKICB9CgogIChWVCA9IFJUID0gUlQgfHwge30pW1ZULk5vbmUgPSAwXSA9ICJOb25lIiwgVlRbVlQuQm90aCA9IDFdID0gIkJvdGgiLCBWVFtWVC5WZXJ0aWNhbCA9IDJdID0gIlZlcnRpY2FsIjsKCiAgdmFyIFVFLAogICAgICBqRSA9IHJ0KFtmbygibGF6eVNpbmsiKSwgeG8oImRyYWdCbG9ja0NsYXNzIiksIEZvKCJnZXRCb3VuZHMiLCBBZSksIFRvKCJ1c2VUYWJzdG9wQXQiLCBfKSwgVG8oImV2ZW50T3JkZXIiLCB7fSksICRzKCJtb2RhbEJlaGF2aW91cnMiLCBbTWddKSwgSnUoIm9uRXhlY3V0ZSIpLCBRdSgib25Fc2NhcGUiKV0pLAogICAgICBHRSA9IHsKICAgIHNrZXRjaDogaAogIH0sCiAgICAgIFhFID0gcnQoW0pmKHsKICAgIG5hbWU6ICJkcmFnaGFuZGxlIiwKICAgIG92ZXJyaWRlczogZnVuY3Rpb24gb3ZlcnJpZGVzKHQsIG4pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBiZWhhdmlvdXJzOiB0YyhbckUuY29uZmlnKHsKICAgICAgICAgIG1vZGU6ICJtb3VzZSIsCiAgICAgICAgICBnZXRUYXJnZXQ6IGZ1bmN0aW9uIGdldFRhcmdldCh0KSB7CiAgICAgICAgICAgIHJldHVybiBBdSh0LCAnW3JvbGU9ImRpYWxvZyJdJykuZ2V0T3IodCk7CiAgICAgICAgICB9LAogICAgICAgICAgYmxvY2tlckNsYXNzOiB0LmRyYWdCbG9ja0NsYXNzLmdldE9yRGllKG5ldyBFcnJvcigiVGhlIGRyYWcgYmxvY2tlciBjbGFzcyB3YXMgbm90IHNwZWNpZmllZCBmb3IgYSBkaWFsb2cgd2l0aCBhIGRyYWcgaGFuZGxlOiBcbiIgKyBKU09OLnN0cmluZ2lmeShuLCBudWxsLCAyKSkubWVzc2FnZSksCiAgICAgICAgICBnZXRCb3VuZHM6IHQuZ2V0RHJhZ0JvdW5kcwogICAgICAgIH0pXSkKICAgICAgfTsKICAgIH0KICB9KSwgcWYoewogICAgc2NoZW1hOiBbZm8oImRvbSIpXSwKICAgIG5hbWU6ICJ0aXRsZSIKICB9KSwgcWYoewogICAgZmFjdG9yeTogR0UsCiAgICBzY2hlbWE6IFtmbygiZG9tIildLAogICAgbmFtZTogImNsb3NlIgogIH0pLCBxZih7CiAgICBmYWN0b3J5OiBHRSwKICAgIHNjaGVtYTogW2ZvKCJkb20iKV0sCiAgICBuYW1lOiAiYm9keSIKICB9KSwgSmYoewogICAgZmFjdG9yeTogR0UsCiAgICBzY2hlbWE6IFtmbygiZG9tIildLAogICAgbmFtZTogImZvb3RlciIKICB9KSwgS2YoewogICAgZmFjdG9yeTogewogICAgICBza2V0Y2g6IGZ1bmN0aW9uIHNrZXRjaCh0LCBuKSB7CiAgICAgICAgcmV0dXJuIF9sdChfbHQoe30sIHQpLCB7CiAgICAgICAgICBkb206IG4uZG9tLAogICAgICAgICAgY29tcG9uZW50czogbi5jb21wb25lbnRzCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzY2hlbWE6IFtUbygiZG9tIiwgewogICAgICB0YWc6ICJkaXYiLAogICAgICBzdHlsZXM6IHsKICAgICAgICBwb3NpdGlvbjogImZpeGVkIiwKICAgICAgICBsZWZ0OiAiMHB4IiwKICAgICAgICB0b3A6ICIwcHgiLAogICAgICAgIHJpZ2h0OiAiMHB4IiwKICAgICAgICBib3R0b206ICIwcHgiCiAgICAgIH0KICAgIH0pLCBUbygiY29tcG9uZW50cyIsIFtdKV0sCiAgICBuYW1lOiAiYmxvY2tlciIKICB9KV0pLAogICAgICBZRSA9IFNsKHsKICAgIG5hbWU6ICJNb2RhbERpYWxvZyIsCiAgICBjb25maWdGaWVsZHM6IGpFKCksCiAgICBwYXJ0RmllbGRzOiBYRSgpLAogICAgZmFjdG9yeTogZnVuY3Rpb24gZmFjdG9yeShhLCB0LCBuLCByKSB7CiAgICAgIHZhciBlLAogICAgICAgICAgaSA9IGRjKCksCiAgICAgICAgICBvID0gRnIoIm1vZGFsLWV2ZW50cyIpLAogICAgICAgICAgdSA9IF9sdChfbHQoe30sIGEuZXZlbnRPcmRlciksICgoZSA9IHt9KVtqaSgpXSA9IFtvXS5jb25jYXQoYS5ldmVudE9yZGVyWyJhbGxveS5zeXN0ZW0uYXR0YWNoZWQiXSB8fCBbXSksIGUpKTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgdWlkOiBhLnVpZCwKICAgICAgICBkb206IGEuZG9tLAogICAgICAgIGNvbXBvbmVudHM6IHQsCiAgICAgICAgYXBpczogewogICAgICAgICAgc2hvdzogZnVuY3Rpb24gc2hvdyh0KSB7CiAgICAgICAgICAgIGkuc2V0KHQpOwogICAgICAgICAgICB2YXIgbiA9IGEubGF6eVNpbmsodCkuZ2V0T3JEaWUoKSwKICAgICAgICAgICAgICAgIGUgPSByLmJsb2NrZXIoKSwKICAgICAgICAgICAgICAgIG8gPSBuLmdldFN5c3RlbSgpLmJ1aWxkKF9sdChfbHQoe30sIGUpLCB7CiAgICAgICAgICAgICAgY29tcG9uZW50czogZS5jb21wb25lbnRzLmNvbmNhdChbVHUodCldKSwKICAgICAgICAgICAgICBiZWhhdmlvdXJzOiB0YyhbVmcuY29uZmlnKHt9KSwgZm0oImRpYWxvZy1ibG9ja2VyLWV2ZW50cyIsIFtEcih2aSgpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBNZy5mb2N1c0luKHQpOwogICAgICAgICAgICAgIH0pXSldKQogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIElzKG4sIG8pLCBNZy5mb2N1c0luKHQpOwogICAgICAgICAgfSwKICAgICAgICAgIGhpZGU6IGZ1bmN0aW9uIGhpZGUobikgewogICAgICAgICAgICBpLmNsZWFyKCksIFl0KG4uZWxlbWVudCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIG4uZ2V0U3lzdGVtKCkuZ2V0QnlEb20odCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgVnModCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGdldEJvZHk6IGZ1bmN0aW9uIGdldEJvZHkodCkgewogICAgICAgICAgICByZXR1cm4gZGwodCwgYSwgImJvZHkiKTsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXRGb290ZXI6IGZ1bmN0aW9uIGdldEZvb3Rlcih0KSB7CiAgICAgICAgICAgIHJldHVybiBkbCh0LCBhLCAiZm9vdGVyIik7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0SWRsZTogZnVuY3Rpb24gc2V0SWRsZSh0KSB7CiAgICAgICAgICAgIGNPLnVuYmxvY2sodCk7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0QnVzeTogZnVuY3Rpb24gc2V0QnVzeSh0LCBuKSB7CiAgICAgICAgICAgIGNPLmJsb2NrKHQsIG4pOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZXZlbnRPcmRlcjogdSwKICAgICAgICBkb21Nb2RpZmljYXRpb246IHsKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgcm9sZTogImRpYWxvZyIsCiAgICAgICAgICAgICJhcmlhLW1vZGFsIjogInRydWUiCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBiZWhhdmlvdXJzOiBacyhhLm1vZGFsQmVoYXZpb3VycywgW0ZnLmNvbmZpZyh7fSksIE1nLmNvbmZpZyh7CiAgICAgICAgICBtb2RlOiAiY3ljbGljIiwKICAgICAgICAgIG9uRW50ZXI6IGEub25FeGVjdXRlLAogICAgICAgICAgb25Fc2NhcGU6IGEub25Fc2NhcGUsCiAgICAgICAgICB1c2VUYWJzdG9wQXQ6IGEudXNlVGFic3RvcEF0CiAgICAgICAgfSksIGNPLmNvbmZpZyh7CiAgICAgICAgICBnZXRSb290OiBpLmdldAogICAgICAgIH0pLCBmbShvLCBbZXUoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBuLAogICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgbywKICAgICAgICAgICAgICByID0gdC5lbGVtZW50LAogICAgICAgICAgICAgIGkgPSBkbCh0LCBhLCAidGl0bGUiKS5lbGVtZW50LAogICAgICAgICAgICAgIHUgPSB1bihyLCAiaWQiKS5mb2xkKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHQgPSBGcigiZGlhbG9nLWxhYmVsIik7CiAgICAgICAgICAgIHJldHVybiBvbihpLCAiaWQiLCB0KSwgdDsKICAgICAgICAgIH0sIGgpOwogICAgICAgICAgb24ociwgImFyaWEtbGFiZWxsZWRieSIsIHUpLCBuID0gdC5lbGVtZW50LCBlID0gZGwodCwgYSwgImJvZHkiKS5lbGVtZW50LCBvID0gdnQuZnJvbShybihuLCAiaWQiKSkuZm9sZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB0ID0gRnIoImRpYWxvZy1kZXNjcmliZSIpOwogICAgICAgICAgICByZXR1cm4gb24oZSwgImlkIiwgdCksIHQ7CiAgICAgICAgICB9LCBoKSwgb24obiwgImFyaWEtZGVzY3JpYmVkYnkiLCBvKTsKICAgICAgICB9KV0pXSkKICAgICAgfTsKICAgIH0sCiAgICBhcGlzOiB7CiAgICAgIHNob3c6IGZ1bmN0aW9uIHNob3codCwgbikgewogICAgICAgIHQuc2hvdyhuKTsKICAgICAgfSwKICAgICAgaGlkZTogZnVuY3Rpb24gaGlkZSh0LCBuKSB7CiAgICAgICAgdC5oaWRlKG4pOwogICAgICB9LAogICAgICBnZXRCb2R5OiBmdW5jdGlvbiBnZXRCb2R5KHQsIG4pIHsKICAgICAgICByZXR1cm4gdC5nZXRCb2R5KG4pOwogICAgICB9LAogICAgICBnZXRGb290ZXI6IGZ1bmN0aW9uIGdldEZvb3Rlcih0LCBuKSB7CiAgICAgICAgcmV0dXJuIHQuZ2V0Rm9vdGVyKG4pOwogICAgICB9LAogICAgICBzZXRCdXN5OiBmdW5jdGlvbiBzZXRCdXN5KHQsIG4sIGUpIHsKICAgICAgICB0LnNldEJ1c3kobiwgZSk7CiAgICAgIH0sCiAgICAgIHNldElkbGU6IGZ1bmN0aW9uIHNldElkbGUodCwgbikgewogICAgICAgIHQuc2V0SWRsZShuKTsKICAgICAgfQogICAgfQogIH0pLAogICAgICBxRSA9IEpvKFtnbygidHlwZSIpLCBnbygibmFtZSIpXS5jb25jYXQoemgpKSwKICAgICAgS0UgPSBuciwKICAgICAgSkUgPSBbdXIoIm5hbWUiLCAibmFtZSIsIFVlKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBGcigiYnV0dG9uLW5hbWUiKTsKICB9KSwgdHIpLCBDbygiaWNvbiIpLCBNbygiYWxpZ24iLCAiZW5kIiwgWyJzdGFydCIsICJlbmQiXSksIEFvKCJwcmltYXJ5IiwgITEpLCBBbygiZGlzYWJsZWQiLCAhMSldLAogICAgICAkRSA9IEgoSChbXSwgSkUsICEwKSwgW2dvKCJ0ZXh0IildLCAhMSksCiAgICAgIFFFID0gSChbcG8oInR5cGUiLCBbInN1Ym1pdCIsICJjYW5jZWwiLCAiY3VzdG9tIl0pXSwgJEUsICEwKSwKICAgICAgWkUgPSBzbygidHlwZSIsIHsKICAgIHN1Ym1pdDogUUUsCiAgICBjYW5jZWw6IFFFLAogICAgY3VzdG9tOiBRRSwKICAgIG1lbnU6IEgoW3BvKCJ0eXBlIiwgWyJtZW51Il0pLCBDbygidGV4dCIpLCBDbygidG9vbHRpcCIpLCBDbygiaWNvbiIpLCB5bygiaXRlbXMiLCBxRSldLCBKRSwgITApCiAgfSksCiAgICAgIHREID0gW2dvKCJ0eXBlIiksIGdvKCJ0ZXh0IiksIHBvKCJsZXZlbCIsIFsiaW5mbyIsICJ3YXJuIiwgImVycm9yIiwgInN1Y2Nlc3MiXSksIGdvKCJpY29uIiksIFRvKCJ1cmwiLCAiIildLAogICAgICBuRCA9IEpvKHREKSwKICAgICAgZUQgPSBbZ28oInR5cGUiKSwgZ28oInRleHQiKSwgQW8oImRpc2FibGVkIiwgITEpLCBBbygicHJpbWFyeSIsICExKSwgdXIoIm5hbWUiLCAibmFtZSIsIFVlKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBGcigiYnV0dG9uLW5hbWUiKTsKICB9KSwgdHIpLCBDbygiaWNvbiIpLCBBbygiYm9yZGVybGVzcyIsICExKV0sCiAgICAgIG9EID0gSm8oZUQpLAogICAgICByRCA9IFtnbygidHlwZSIpLCBnbygibmFtZSIpLCBnbygibGFiZWwiKSwgQW8oImRpc2FibGVkIiwgITEpXSwKICAgICAgaUQgPSBKbyhyRCksCiAgICAgIHVEID0gbnIsCiAgICAgIGFEID0gW2dvKCJ0eXBlIiksIGdvKCJuYW1lIildLAogICAgICBjRCA9IGFELmNvbmNhdChbQ28oImxhYmVsIildKSwKICAgICAgc0QgPSBjRC5jb25jYXQoW1RvKCJjb2x1bW5zIiwgImF1dG8iKV0pLAogICAgICBsRCA9IEpvKHNEKSwKICAgICAgZkQgPSAkbyhbZ28oInZhbHVlIiksIGdvKCJ0ZXh0IiksIGdvKCJpY29uIildKSwKICAgICAgZEQgPSBKbyhjRCksCiAgICAgIG1EID0gdHIsCiAgICAgIGdEID0gSm8oY0QpLAogICAgICBwRCA9IHRyLAogICAgICBoRCA9IGFELmNvbmNhdChbQm8oInRhZyIsICJ0ZXh0YXJlYSIpLCBnbygic2NyaXB0SWQiKSwgZ28oInNjcmlwdFVybCIpLCBFbygic2V0dGluZ3MiLCB2b2lkIDAsIHJyKV0pLAogICAgICB2RCA9IGFELmNvbmNhdChbQm8oInRhZyIsICJ0ZXh0YXJlYSIpLCBobygiaW5pdCIpXSksCiAgICAgIGJEID0gcm8oZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiB1bygiY3VzdG9tZWRpdG9yLm9sZCIsIFplKHZEKSwgdCkub3JUaHVuayhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB1bygiY3VzdG9tZWRpdG9yLm5ldyIsIFplKGhEKSwgdCk7CiAgICB9KTsKICB9KSwKICAgICAgeUQgPSB0ciwKICAgICAgeEQgPSBKbyhjRCksCiAgICAgIHdEID0gdG8oS28pLAogICAgICBTRCA9IFtnbygidHlwZSIpLCBnbygiaHRtbCIpLCBNbygicHJlc2V0cyIsICJwcmVzZW50YXRpb24iLCBbInByZXNlbnRhdGlvbiIsICJkb2N1bWVudCJdKV0sCiAgICAgIENEID0gSm8oU0QpLAogICAgICBrRCA9IGNELmNvbmNhdChbQW8oInNhbmRib3hlZCIsICEwKV0pLAogICAgICBPRCA9IEpvKGtEKSwKICAgICAgX0QgPSB0ciwKICAgICAgVEQgPSBjRC5jb25jYXQoW21vKCJjdXJyZW50U3RhdGUiLCBKbyhbZm8oImJsb2IiKSwgZ28oInVybCIpXSkpXSksCiAgICAgIEVEID0gSm8oVEQpLAogICAgICBERCA9IGNELmNvbmNhdChbQ28oImlucHV0TW9kZSIpLCBDbygicGxhY2Vob2xkZXIiKSwgQW8oIm1heGltaXplZCIsICExKSwgQW8oImRpc2FibGVkIiwgITEpXSksCiAgICAgIEJEID0gSm8oREQpLAogICAgICBNRCA9IHRyLAogICAgICBBRCA9IFtnbygidGV4dCIpLCBnbygidmFsdWUiKV0sCiAgICAgIEZEID0gW2dvKCJ0ZXh0IiksIHlvKCJpdGVtcyIsIChVRSA9IFJ0KGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBJRDsKICB9KSwgewogICAgZXh0cmFjdDogZnVuY3Rpb24gZXh0cmFjdCh0LCBuKSB7CiAgICAgIHJldHVybiBVRSgpLmV4dHJhY3QodCwgbik7CiAgICB9LAogICAgdG9TdHJpbmc6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gVUUoKS50b1N0cmluZygpOwogICAgfQogIH0pKV0sCiAgICAgIElEID0gbm8oW0pvKEFEKSwgSm8oRkQpXSksCiAgICAgIFJEID0gY0QuY29uY2F0KFt5bygiaXRlbXMiLCBJRCksIEFvKCJkaXNhYmxlZCIsICExKV0pLAogICAgICBWRCA9IEpvKFJEKSwKICAgICAgUEQgPSB0ciwKICAgICAgSEQgPSBjRC5jb25jYXQoW2JvKCJpdGVtcyIsIFtnbygidGV4dCIpLCBnbygidmFsdWUiKV0pLCBEbygic2l6ZSIsIDEpLCBBbygiZGlzYWJsZWQiLCAhMSldKSwKICAgICAgekQgPSBKbyhIRCksCiAgICAgIE5EID0gdHIsCiAgICAgIExEID0gY0QuY29uY2F0KFtBbygiY29uc3RyYWluIiwgITApLCBBbygiZGlzYWJsZWQiLCAhMSldKSwKICAgICAgV0QgPSBKbyhMRCksCiAgICAgIFVEID0gSm8oW2dvKCJ3aWR0aCIpLCBnbygiaGVpZ2h0IildKSwKICAgICAgakQgPSBbZ28oInR5cGUiKSwgeW8oImhlYWRlciIsIHRyKSwgeW8oImNlbGxzIiwgdG8odHIpKV0sCiAgICAgIEdEID0gSm8oakQpLAogICAgICBYRCA9IGNELmNvbmNhdChbQ28oInBsYWNlaG9sZGVyIiksIEFvKCJtYXhpbWl6ZWQiLCAhMSksIEFvKCJkaXNhYmxlZCIsICExKV0pLAogICAgICBZRCA9IEpvKFhEKSwKICAgICAgcUQgPSB0ciwKICAgICAgS0QgPSBjRC5jb25jYXQoW01vKCJmaWxldHlwZSIsICJmaWxlIiwgWyJpbWFnZSIsICJtZWRpYSIsICJmaWxlIl0pLCBUbygiZGlzYWJsZWQiLCAhMSldKSwKICAgICAgSkQgPSBKbyhLRCksCiAgICAgICREID0gSm8oW2dvKCJ2YWx1ZSIpLCBUbygibWV0YSIsIHt9KV0pLAogICAgICBRRCA9IFFlKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBvbygidHlwZSIsIHsKICAgICAgYWxlcnRiYW5uZXI6IG5ELAogICAgICBiYXI6IEpvKChlID0gc0UoImJhciIpLCBbZ28oInR5cGUiKSwgZV0pKSwKICAgICAgYnV0dG9uOiBvRCwKICAgICAgY2hlY2tib3g6IGlELAogICAgICBjb2xvcmlucHV0OiBkRCwKICAgICAgY29sb3JwaWNrZXI6IGdELAogICAgICBkcm9wem9uZTogeEQsCiAgICAgIGdyaWQ6IEpvKCh0ID0gc0UoImdyaWQiKSwgW2dvKCJ0eXBlIiksIG1vKCJjb2x1bW5zIiwgWm8pLCB0XSkpLAogICAgICBpZnJhbWU6IE9ELAogICAgICBpbnB1dDogQkQsCiAgICAgIGxpc3Rib3g6IFZELAogICAgICBzZWxlY3Rib3g6IHpELAogICAgICBzaXplaW5wdXQ6IFdELAogICAgICB0ZXh0YXJlYTogWUQsCiAgICAgIHVybGlucHV0OiBKRCwKICAgICAgY3VzdG9tZWRpdG9yOiBiRCwKICAgICAgaHRtbHBhbmVsOiBDRCwKICAgICAgaW1hZ2V0b29sczogRUQsCiAgICAgIGNvbGxlY3Rpb246IGxELAogICAgICBsYWJlbDogSm8oKG4gPSBzRSgibGFiZWwiKSwgW2dvKCJ0eXBlIiksIGdvKCJsYWJlbCIpLCBuXSkpLAogICAgICB0YWJsZTogR0QsCiAgICAgIHBhbmVsOiB0QgogICAgfSk7CiAgICB2YXIgdCwgbiwgZTsKICB9KSwKICAgICAgWkQgPSBbZ28oInR5cGUiKSwgVG8oImNsYXNzZXMiLCBbXSksIHlvKCJpdGVtcyIsIFFEKV0sCiAgICAgIHRCID0gSm8oWkQpLAogICAgICBuQiA9IFt1cigibmFtZSIsICJuYW1lIiwgVWUoZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIEZyKCJ0YWItbmFtZSIpOwogIH0pLCB0ciksIGdvKCJ0aXRsZSIpLCB5bygiaXRlbXMiLCBRRCldLAogICAgICBlQiA9IFtnbygidHlwZSIpLCBibygidGFicyIsIG5CKV0sCiAgICAgIG9CID0gSm8oZUIpLAogICAgICByQiA9ICRFLAogICAgICBpQiA9IFpFLAogICAgICB1QiA9IEpvKFtnbygidGl0bGUiKSwgbW8oImJvZHkiLCBvbygidHlwZSIsIHsKICAgIHBhbmVsOiB0QiwKICAgIHRhYnBhbmVsOiBvQgogIH0pKSwgQm8oInNpemUiLCAibm9ybWFsIiksIHlvKCJidXR0b25zIiwgaUIpLCBUbygiaW5pdGlhbERhdGEiLCB7fSksIEZvKCJvbkFjdGlvbiIsIHN0KSwgRm8oIm9uQ2hhbmdlIiwgc3QpLCBGbygib25TdWJtaXQiLCBzdCksIEZvKCJvbkNsb3NlIiwgc3QpLCBGbygib25DYW5jZWwiLCBzdCksIFRvKCJvblRhYkNoYW5nZSIsIHN0KV0pLAogICAgICBhQiA9IEpvKEgoW3BvKCJ0eXBlIiwgWyJjYW5jZWwiLCAiY3VzdG9tIl0pXSwgckIsICEwKSksCiAgICAgIGNCID0gSm8oW2dvKCJ0aXRsZSIpLCBnbygidXJsIiksIFNvKCJoZWlnaHQiKSwgU28oIndpZHRoIiksIE9vKCJidXR0b25zIiwgYUIpLCBGbygib25BY3Rpb24iLCBzdCksIEZvKCJvbkNhbmNlbCIsIHN0KSwgRm8oIm9uQ2xvc2UiLCBzdCksIEZvKCJvbk1lc3NhZ2UiLCBzdCldKSwKICAgICAgc0IgPSBmdW5jdGlvbiBzQih0KSB7CiAgICByZXR1cm4geCh0KSA/IFt0XS5jb25jYXQoeihaKHQpLCBzQikpIDogYyh0KSA/IHoodCwgc0IpIDogW107CiAgfSwKICAgICAgbEIgPSB7CiAgICBjaGVja2JveDogdUQsCiAgICBjb2xvcmlucHV0OiBtRCwKICAgIGNvbG9ycGlja2VyOiBwRCwKICAgIGRyb3B6b25lOiB3RCwKICAgIGlucHV0OiBNRCwKICAgIGlmcmFtZTogX0QsCiAgICBzaXplaW5wdXQ6IFVELAogICAgc2VsZWN0Ym94OiBORCwKICAgIGxpc3Rib3g6IFBELAogICAgc2l6ZTogVUQsCiAgICB0ZXh0YXJlYTogcUQsCiAgICB1cmxpbnB1dDogJEQsCiAgICBjdXN0b21lZGl0b3I6IHlELAogICAgY29sbGVjdGlvbjogZkQsCiAgICB0b2dnbGVtZW51aXRlbTogS0UKICB9LAogICAgICBmQiA9IHsKICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4odCwgbikgewogICAgICB2YXIgZSA9IGZFKG4pOwogICAgICByZXR1cm4gdChlLmludGVybmFsRGlhbG9nLCBlLmluaXRpYWxEYXRhLCBlLmRhdGFWYWxpZGF0b3IpOwogICAgfSwKICAgIG9wZW5Vcmw6IGZ1bmN0aW9uIG9wZW5VcmwodCwgbikgewogICAgICByZXR1cm4gdChhbyh1bygiZGlhbG9nIiwgY0IsIG4pKSk7CiAgICB9LAogICAgcmVkaWFsOiBmRQogIH0sCiAgICAgIGRCID0gd2woewogICAgbmFtZTogIlRhYkJ1dHRvbiIsCiAgICBjb25maWdGaWVsZHM6IFtUbygidWlkIiwgdm9pZCAwKSwgZm8oInZhbHVlIiksIHVyKCJkb20iLCAiZG9tIiwgWGUoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gewogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHJvbGU6ICJ0YWIiLAogICAgICAgICAgaWQ6IEZyKCJhcmlhIiksCiAgICAgICAgICAiYXJpYS1zZWxlY3RlZCI6ICJmYWxzZSIKICAgICAgICB9CiAgICAgIH07CiAgICB9KSwgUW8oKSksIHhvKCJhY3Rpb24iKSwgVG8oImRvbU1vZGlmaWNhdGlvbiIsIHt9KSwgJHMoInRhYkJ1dHRvbkJlaGF2aW91cnMiLCBbVmcsIE1nLCBUZl0pLCBmbygidmlldyIpXSwKICAgIGZhY3Rvcnk6IGZ1bmN0aW9uIGZhY3RvcnkodCwgbikgewogICAgICByZXR1cm4gewogICAgICAgIHVpZDogdC51aWQsCiAgICAgICAgZG9tOiB0LmRvbSwKICAgICAgICBjb21wb25lbnRzOiB0LmNvbXBvbmVudHMsCiAgICAgICAgZXZlbnRzOiB4bSh0LmFjdGlvbiksCiAgICAgICAgYmVoYXZpb3VyczogWnModC50YWJCdXR0b25CZWhhdmlvdXJzLCBbVmcuY29uZmlnKHt9KSwgTWcuY29uZmlnKHsKICAgICAgICAgIG1vZGU6ICJleGVjdXRpb24iLAogICAgICAgICAgdXNlU3BhY2U6ICEwLAogICAgICAgICAgdXNlRW50ZXI6ICEwCiAgICAgICAgfSksIFRmLmNvbmZpZyh7CiAgICAgICAgICBzdG9yZTogewogICAgICAgICAgICBtb2RlOiAibWVtb3J5IiwKICAgICAgICAgICAgaW5pdGlhbFZhbHVlOiB0LnZhbHVlCiAgICAgICAgICB9CiAgICAgICAgfSldKSwKICAgICAgICBkb21Nb2RpZmljYXRpb246IHQuZG9tTW9kaWZpY2F0aW9uCiAgICAgIH07CiAgICB9CiAgfSksCiAgICAgIG1CID0gcnQoW2ZvKCJ0YWJzIiksIGZvKCJkb20iKSwgVG8oImNsaWNrVG9EaXNtaXNzIiwgITEpLCAkcygidGFiYmFyQmVoYXZpb3VycyIsIFtnZCwgTWddKSwgWXUoWyJ0YWJDbGFzcyIsICJzZWxlY3RlZENsYXNzIl0pXSksCiAgICAgIGdCID0gcnQoWyRmKHsKICAgIGZhY3Rvcnk6IGRCLAogICAgbmFtZTogInRhYnMiLAogICAgdW5pdDogInRhYiIsCiAgICBvdmVycmlkZXM6IGZ1bmN0aW9uIG92ZXJyaWRlcyhvKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiBhY3Rpb24odCkgewogICAgICAgICAgdmFyIG4gPSB0LmdldFN5c3RlbSgpLmdldEJ5VWlkKG8udWlkKS5nZXRPckRpZSgpLAogICAgICAgICAgICAgIGUgPSBnZC5pc0hpZ2hsaWdodGVkKG4sIHQpOwogICAgICAgICAgKGUgJiYgby5jbGlja1RvRGlzbWlzcyA/IGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgIGdkLmRlaGlnaGxpZ2h0KHQsIG4pLCB2cih0LCAkaSgpLCB7CiAgICAgICAgICAgICAgdGFiYmFyOiB0LAogICAgICAgICAgICAgIGJ1dHRvbjogbgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gOiBlID8gc3QgOiBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgICBnZC5oaWdobGlnaHQodCwgbiksIHZyKHQsIEppKCksIHsKICAgICAgICAgICAgICB0YWJiYXI6IHQsCiAgICAgICAgICAgICAgYnV0dG9uOiBuCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkobiwgdCk7CiAgICAgICAgfSwKICAgICAgICBkb21Nb2RpZmljYXRpb246IHsKICAgICAgICAgIGNsYXNzZXM6IFtvLm1hcmtlcnMudGFiQ2xhc3NdCiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0pXSksCiAgICAgIHBCID0gU2woewogICAgbmFtZTogIlRhYmJhciIsCiAgICBjb25maWdGaWVsZHM6IG1CKCksCiAgICBwYXJ0RmllbGRzOiBnQigpLAogICAgZmFjdG9yeTogZnVuY3Rpb24gZmFjdG9yeSh0LCBuLCBlLCBvKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdWlkOiB0LnVpZCwKICAgICAgICBkb206IHQuZG9tLAogICAgICAgIGNvbXBvbmVudHM6IG4sCiAgICAgICAgImRlYnVnLnNrZXRjaGVyIjogIlRhYmJhciIsCiAgICAgICAgZG9tTW9kaWZpY2F0aW9uOiB7CiAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgIHJvbGU6ICJ0YWJsaXN0IgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYmVoYXZpb3VyczogWnModC50YWJiYXJCZWhhdmlvdXJzLCBbZ2QuY29uZmlnKHsKICAgICAgICAgIGhpZ2hsaWdodENsYXNzOiB0Lm1hcmtlcnMuc2VsZWN0ZWRDbGFzcywKICAgICAgICAgIGl0ZW1DbGFzczogdC5tYXJrZXJzLnRhYkNsYXNzLAogICAgICAgICAgb25IaWdobGlnaHQ6IGZ1bmN0aW9uIG9uSGlnaGxpZ2h0KHQsIG4pIHsKICAgICAgICAgICAgb24obi5lbGVtZW50LCAiYXJpYS1zZWxlY3RlZCIsICJ0cnVlIik7CiAgICAgICAgICB9LAogICAgICAgICAgb25EZWhpZ2hsaWdodDogZnVuY3Rpb24gb25EZWhpZ2hsaWdodCh0LCBuKSB7CiAgICAgICAgICAgIG9uKG4uZWxlbWVudCwgImFyaWEtc2VsZWN0ZWQiLCAiZmFsc2UiKTsKICAgICAgICAgIH0KICAgICAgICB9KSwgTWcuY29uZmlnKHsKICAgICAgICAgIG1vZGU6ICJmbG93IiwKICAgICAgICAgIGdldEluaXRpYWw6IGZ1bmN0aW9uIGdldEluaXRpYWwodCkgewogICAgICAgICAgICByZXR1cm4gZ2QuZ2V0SGlnaGxpZ2h0ZWQodCkubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQuZWxlbWVudDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgc2VsZWN0b3I6ICIuIiArIHQubWFya2Vycy50YWJDbGFzcywKICAgICAgICAgIGV4ZWN1dGVPbk1vdmU6ICEwCiAgICAgICAgfSldKQogICAgICB9OwogICAgfQogIH0pLAogICAgICBoQiA9IHdsKHsKICAgIG5hbWU6ICJUYWJ2aWV3IiwKICAgIGNvbmZpZ0ZpZWxkczogWyRzKCJ0YWJ2aWV3QmVoYXZpb3VycyIsIFtGZ10pXSwKICAgIGZhY3Rvcnk6IGZ1bmN0aW9uIGZhY3RvcnkodCwgbikgewogICAgICByZXR1cm4gewogICAgICAgIHVpZDogdC51aWQsCiAgICAgICAgZG9tOiB0LmRvbSwKICAgICAgICBiZWhhdmlvdXJzOiBacyh0LnRhYnZpZXdCZWhhdmlvdXJzLCBbRmcuY29uZmlnKHt9KV0pLAogICAgICAgIGRvbU1vZGlmaWNhdGlvbjogewogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICByb2xlOiAidGFicGFuZWwiCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0pLAogICAgICB2QiA9IHJ0KFtUbygic2VsZWN0Rmlyc3QiLCAhMCksIEt1KCJvbkNoYW5nZVRhYiIpLCBLdSgib25EaXNtaXNzVGFiIiksIFRvKCJ0YWJzIiwgW10pLCAkcygidGFiU2VjdGlvbkJlaGF2aW91cnMiLCBbXSldKSwKICAgICAgYkIgPSBydChbcWYoewogICAgZmFjdG9yeTogcEIsCiAgICBzY2hlbWE6IFtmbygiZG9tIiksIHZvKCJtYXJrZXJzIiwgW2ZvKCJ0YWJDbGFzcyIpLCBmbygic2VsZWN0ZWRDbGFzcyIpXSldLAogICAgbmFtZTogInRhYmJhciIsCiAgICBkZWZhdWx0czogZnVuY3Rpb24gZGVmYXVsdHModCkgewogICAgICByZXR1cm4gewogICAgICAgIHRhYnM6IHQudGFicwogICAgICB9OwogICAgfQogIH0pLCBxZih7CiAgICBmYWN0b3J5OiBoQiwKICAgIG5hbWU6ICJ0YWJ2aWV3IgogIH0pXSksCiAgICAgIHlCID0gU2woewogICAgbmFtZTogIlRhYlNlY3Rpb24iLAogICAgY29uZmlnRmllbGRzOiB2QigpLAogICAgcGFydEZpZWxkczogYkIoKSwKICAgIGZhY3Rvcnk6IGZ1bmN0aW9uIGZhY3RvcnkoaSwgdCwgbiwgZSkgewogICAgICBmdW5jdGlvbiBvKHQsIG4pIHsKICAgICAgICBmbCh0LCBpLCAidGFiYmFyIikuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgbih0KS5lYWNoKGJyKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICB1aWQ6IGkudWlkLAogICAgICAgIGRvbTogaS5kb20sCiAgICAgICAgY29tcG9uZW50czogdCwKICAgICAgICBiZWhhdmlvdXJzOiBRcyhpLnRhYlNlY3Rpb25CZWhhdmlvdXJzKSwKICAgICAgICBldmVudHM6IG51KGZ0KFtpLnNlbGVjdEZpcnN0ID8gW2V1KGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICBvKHQsIGdkLmdldEZpcnN0KTsKICAgICAgICB9KV0gOiBbXSwgW0NyKEppKCksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICB2YXIgbyA9IG4uZXZlbnQuYnV0dG9uLAogICAgICAgICAgICAgIHIgPSBUZi5nZXRWYWx1ZShvKTsKICAgICAgICAgIGZsKG8sIGksICJ0YWJ2aWV3IikuZWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBWKGkudGFicywgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gdC52YWx1ZSA9PT0gcjsKICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHZhciBuID0gdC52aWV3KCk7CiAgICAgICAgICAgICAgdW4oby5lbGVtZW50LCAiaWQiKS5lYWNoKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgICAgICBvbihlLmVsZW1lbnQsICJhcmlhLWxhYmVsbGVkYnkiLCB0KTsKICAgICAgICAgICAgICB9KSwgRmcuc2V0KGUsIG4pLCBpLm9uQ2hhbmdlVGFiKGUsIG8sIG4pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pLCBDcigkaSgpLCBmdW5jdGlvbiAodCwgbikgewogICAgICAgICAgdmFyIGUgPSBuLmV2ZW50LmJ1dHRvbjsKICAgICAgICAgIGkub25EaXNtaXNzVGFiKHQsIGUpOwogICAgICAgIH0pXV0pKSwKICAgICAgICBhcGlzOiB7CiAgICAgICAgICBnZXRWaWV3SXRlbXM6IGZ1bmN0aW9uIGdldFZpZXdJdGVtcyh0KSB7CiAgICAgICAgICAgIHJldHVybiBmbCh0LCBpLCAidGFidmlldyIpLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiBGZy5jb250ZW50cyh0KTsKICAgICAgICAgICAgfSkuZ2V0T3IoW10pOwogICAgICAgICAgfSwKICAgICAgICAgIHNob3dUYWI6IGZ1bmN0aW9uIHNob3dUYWIodCwgZSkgewogICAgICAgICAgICBvKHQsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFYoZ2QuZ2V0Q2FuZGlkYXRlcyhuKSwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBUZi5nZXRWYWx1ZSh0KSA9PT0gZTsKICAgICAgICAgICAgICB9KS5maWx0ZXIoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhZ2QuaXNIaWdobGlnaHRlZChuLCB0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgfSwKICAgIGFwaXM6IHsKICAgICAgZ2V0Vmlld0l0ZW1zOiBmdW5jdGlvbiBnZXRWaWV3SXRlbXModCwgbikgewogICAgICAgIHJldHVybiB0LmdldFZpZXdJdGVtcyhuKTsKICAgICAgfSwKICAgICAgc2hvd1RhYjogZnVuY3Rpb24gc2hvd1RhYih0LCBuLCBlKSB7CiAgICAgICAgdC5zaG93VGFiKG4sIGUpOwogICAgICB9CiAgICB9CiAgfSksCiAgICAgIHhCID0gInNlbmQtZGF0YS10by1zZWN0aW9uIiwKICAgICAgd0IgPSAic2VuZC1kYXRhLXRvLXZpZXciLAogICAgICBTQiA9IEZyKCJ1cGRhdGUtZGlhbG9nIiksCiAgICAgIENCID0gRnIoInVwZGF0ZS10aXRsZSIpLAogICAgICBrQiA9IEZyKCJ1cGRhdGUtYm9keSIpLAogICAgICBPQiA9IEZyKCJ1cGRhdGUtZm9vdGVyIiksCiAgICAgIF9CID0gRnIoImJvZHktc2VuZC1tZXNzYWdlIiksCiAgICAgIFRCID0gWnYuZGV2aWNlVHlwZS5pc1RvdWNoKCksCiAgICAgIEVCID0gZnVuY3Rpb24gRUIodSwgdCkgewogICAgZnVuY3Rpb24gbih0LCBpKSB7CiAgICAgIHJldHVybiBDcih0LCBmdW5jdGlvbiAoZSwgbykgewogICAgICAgIHZhciBuLCByOwogICAgICAgIG4gPSBlLCByID0gZnVuY3Rpb24gcih0LCBuKSB7CiAgICAgICAgICBpKHUoKSwgdCwgby5ldmVudCwgZSk7CiAgICAgICAgfSwgeF8uZ2V0U3RhdGUobikuZ2V0KCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgcih0LCBuKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIEgoSChbXSwgSUUobiwgdCksICEwKSwgW24oYnksIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgIG4ub25BY3Rpb24odCwgewogICAgICAgIG5hbWU6IGUubmFtZQogICAgICB9KTsKICAgIH0pXSwgITEpOwogIH0sCiAgICAgIERCID0gZnVuY3Rpb24gREIodSwgdCwgYykgewogICAgZnVuY3Rpb24gbih0LCBpKSB7CiAgICAgIHJldHVybiBDcih0LCBmdW5jdGlvbiAoZSwgbykgewogICAgICAgIHZhciBuLCByOwogICAgICAgIG4gPSBlLCByID0gZnVuY3Rpb24gcih0LCBuKSB7CiAgICAgICAgICBpKHUoKSwgdCwgby5ldmVudCwgZSk7CiAgICAgICAgfSwgeF8uZ2V0U3RhdGUobikuZ2V0KCkuZWFjaChmdW5jdGlvbiAodCkgewogICAgICAgICAgcih0LmludGVybmFsRGlhbG9nLCBuKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIEgoSChbXSwgSUUobiwgdCksICEwKSwgW24oeXksIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgIHJldHVybiBuLm9uU3VibWl0KHQpOwogICAgfSksIG4ocHksIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgIG4ub25DaGFuZ2UodCwgewogICAgICAgIG5hbWU6IGUubmFtZQogICAgICB9KTsKICAgIH0pLCBuKGJ5LCBmdW5jdGlvbiAodCwgbiwgZSwgbykgewogICAgICBmdW5jdGlvbiByKCkgewogICAgICAgIHJldHVybiBNZy5mb2N1c0luKG8pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpKHQpIHsKICAgICAgICByZXR1cm4gYW4odCwgImRpc2FibGVkIikgfHwgdW4odCwgImFyaWEtZGlzYWJsZWQiKS5leGlzdHMoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAidHJ1ZSIgPT09IHQ7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciB1ID0gbWUoby5lbGVtZW50KSwKICAgICAgICAgIGEgPSBrYSh1KTsKICAgICAgbi5vbkFjdGlvbih0LCB7CiAgICAgICAgbmFtZTogZS5uYW1lLAogICAgICAgIHZhbHVlOiBlLnZhbHVlCiAgICAgIH0pLCBrYSh1KS5mb2xkKHIsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgaShuKSB8fCBhLmV4aXN0cyhmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuIFd0KG4sIHQpICYmIGkodCk7CiAgICAgICAgfSkgPyByKCkgOiBjKCkudG9PcHRpb25hbCgpLmZpbHRlcihmdW5jdGlvbiAodCkgewogICAgICAgICAgcmV0dXJuICFXdCh0LmVsZW1lbnQsIG4pOwogICAgICAgIH0pLmVhY2gocik7CiAgICAgIH0pOwogICAgfSksIG4oU3ksIGZ1bmN0aW9uICh0LCBuLCBlKSB7CiAgICAgIG4ub25UYWJDaGFuZ2UodCwgewogICAgICAgIG5ld1RhYk5hbWU6IGUubmFtZSwKICAgICAgICBvbGRUYWJOYW1lOiBlLm9sZE5hbWUKICAgICAgfSk7CiAgICB9KSwgb3UoZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIG4gPSB1KCk7CiAgICAgIFRmLnNldFZhbHVlKHQsIG4uZ2V0RGF0YSgpKTsKICAgIH0pXSwgITEpOwogIH0sCiAgICAgIEJCID0gVkUsCiAgICAgIE1CID0gdGlueW1jZS51dGlsLlRvb2xzLnJlc29sdmUoInRpbnltY2UudXRpbC5VUkkiKSwKICAgICAgQUIgPSBbImluc2VydENvbnRlbnQiLCAic2V0Q29udGVudCIsICJleGVjQ29tbWFuZCIsICJjbG9zZSIsICJibG9jayIsICJ1bmJsb2NrIl07CgogIG8uYWRkKCJzaWx2ZXIiLCBmdW5jdGlvbiAodCkgewogICAgdmFyIG4gPSBjRSh0KSwKICAgICAgICBlID0gbi51aU1vdGhlcnNoaXAsCiAgICAgICAgbyA9IG4uYmFja3N0YWdlLAogICAgICAgIHIgPSBuLnJlbmRlclVJLAogICAgICAgIGkgPSBuLmdldFVpOwogICAgcmV0dXJuIGV5KHQsIG8uc2hhcmVkKSwgewogICAgICByZW5kZXJVSTogciwKICAgICAgZ2V0V2luZG93TWFuYWdlckltcGw6IHJ0KFdFKHsKICAgICAgICBlZGl0b3I6IHQsCiAgICAgICAgYmFja3N0YWdlOiBvCiAgICAgIH0pKSwKICAgICAgZ2V0Tm90aWZpY2F0aW9uTWFuYWdlckltcGw6IGZ1bmN0aW9uIGdldE5vdGlmaWNhdGlvbk1hbmFnZXJJbXBsKCkgewogICAgICAgIHJldHVybiB1ID0gdCwgciA9IGUsIGwgPSB7CiAgICAgICAgICBiYWNrc3RhZ2U6IG8KICAgICAgICB9LmJhY2tzdGFnZS5zaGFyZWQsIHsKICAgICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4odCwgbikgewogICAgICAgICAgICBmdW5jdGlvbiBlKCkgewogICAgICAgICAgICAgIG4oKSwgcnAuaGlkZShjKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG8gPSAhdC5jbG9zZUJ1dHRvbiAmJiB0LnRpbWVvdXQgJiYgKDAgPCB0LnRpbWVvdXQgfHwgdC50aW1lb3V0IDwgMCksCiAgICAgICAgICAgICAgICBhID0gX3UoZ3Auc2tldGNoKHsKICAgICAgICAgICAgICB0ZXh0OiB0LnRleHQsCiAgICAgICAgICAgICAgbGV2ZWw6IHd0KFsic3VjY2VzcyIsICJlcnJvciIsICJ3YXJuaW5nIiwgIndhcm4iLCAiaW5mbyJdLCB0LnR5cGUpID8gdC50eXBlIDogdm9pZCAwLAogICAgICAgICAgICAgIHByb2dyZXNzOiAhMCA9PT0gdC5wcm9ncmVzc0JhciwKICAgICAgICAgICAgICBpY29uOiB2dC5mcm9tKHQuaWNvbiksCiAgICAgICAgICAgICAgY2xvc2VCdXR0b246ICFvLAogICAgICAgICAgICAgIG9uQWN0aW9uOiBlLAogICAgICAgICAgICAgIGljb25Qcm92aWRlcjogbC5wcm92aWRlcnMuaWNvbnMsCiAgICAgICAgICAgICAgdHJhbnNsYXRpb25Qcm92aWRlcjogbC5wcm92aWRlcnMudHJhbnNsYXRlCiAgICAgICAgICAgIH0pKSwKICAgICAgICAgICAgICAgIGMgPSBfdShycC5za2V0Y2goX2x0KHsKICAgICAgICAgICAgICBkb206IHsKICAgICAgICAgICAgICAgIHRhZzogImRpdiIsCiAgICAgICAgICAgICAgICBjbGFzc2VzOiBbInRveC1ub3RpZmljYXRpb25zLWNvbnRhaW5lciJdCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBsYXp5U2luazogbC5nZXRTaW5rLAogICAgICAgICAgICAgIGZpcmVEaXNtaXNzYWxFdmVudEluc3RlYWQ6IHt9CiAgICAgICAgICAgIH0sIGwuaGVhZGVyLmlzUG9zaXRpb25lZEF0VG9wKCkgPyB7fSA6IHsKICAgICAgICAgICAgICBmaXJlUmVwb3NpdGlvbkV2ZW50SW5zdGVhZDoge30KICAgICAgICAgICAgfSkpKTsKCiAgICAgICAgICAgIGZ1bmN0aW9uIHMoKSB7CiAgICAgICAgICAgICAgdmFyIHQgPSBNZShBdC5mcm9tRG9tKHUuZ2V0Q29udGVudEFyZWFDb250YWluZXIoKSkpLAogICAgICAgICAgICAgICAgICBuID0gQWUoKSwKICAgICAgICAgICAgICAgICAgZSA9IFVhKG4ueCwgdC54LCB0LnJpZ2h0KSwKICAgICAgICAgICAgICAgICAgbyA9IFVhKG4ueSwgdC55LCB0LmJvdHRvbSksCiAgICAgICAgICAgICAgICAgIHIgPSBNYXRoLm1heCh0LnJpZ2h0LCBuLnJpZ2h0KSwKICAgICAgICAgICAgICAgICAgaSA9IE1hdGgubWF4KHQuYm90dG9tLCBuLmJvdHRvbSk7CiAgICAgICAgICAgICAgcmV0dXJuIHZ0LnNvbWUoQmUoZSwgbywgciAtIGUsIGkgLSBvKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByLmFkZChjKSwgMCA8IHQudGltZW91dCAmJiBjcC5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBlKCk7CiAgICAgICAgICAgIH0sIHQudGltZW91dCksIHsKICAgICAgICAgICAgICBjbG9zZTogZSwKICAgICAgICAgICAgICBtb3ZlVG86IGZ1bmN0aW9uIG1vdmVUbyh0LCBuKSB7CiAgICAgICAgICAgICAgICBycC5zaG93QXQoYywgVHUoYSksIHsKICAgICAgICAgICAgICAgICAgYW5jaG9yOiB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogIm1ha2VzaGlmdCIsCiAgICAgICAgICAgICAgICAgICAgeDogdCwKICAgICAgICAgICAgICAgICAgICB5OiBuCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbW92ZVJlbDogZnVuY3Rpb24gbW92ZVJlbCh0LCBuKSB7CiAgICAgICAgICAgICAgICB2YXIgZSwKICAgICAgICAgICAgICAgICAgICBvLAogICAgICAgICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgICAgICAgaSA9IFR1KGEpLAogICAgICAgICAgICAgICAgICAgIHUgPSB7CiAgICAgICAgICAgICAgICAgIG1heEhlaWdodEZ1bmN0aW9uOiBJYygpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgImJhbm5lciIgIT09IG4gJiYgZCh0KSA/IChlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKG4pIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJiYy1iYyI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXA7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgInRjLXRjIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1cDsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSAidGMtYmMiOgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEthOwoKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEphOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KCksIG8gPSB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICJub2RlIiwKICAgICAgICAgICAgICAgICAgcm9vdDogdmUoKSwKICAgICAgICAgICAgICAgICAgbm9kZTogdnQuc29tZShBdC5mcm9tRG9tKHQpKSwKICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVzOiB1LAogICAgICAgICAgICAgICAgICBsYXlvdXRzOiB7CiAgICAgICAgICAgICAgICAgICAgb25SdGw6IGZ1bmN0aW9uIG9uUnRsKCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtlXTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uTHRyOiBmdW5jdGlvbiBvbkx0cigpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbZV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCBycC5zaG93V2l0aGluQm91bmRzKGMsIGksIHsKICAgICAgICAgICAgICAgICAgYW5jaG9yOiBvCiAgICAgICAgICAgICAgICB9LCBzKSkgOiAociA9IF9sdChfbHQoe30sIGwuYW5jaG9ycy5iYW5uZXIoKSksIHsKICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVzOiB1CiAgICAgICAgICAgICAgICB9KSwgcnAuc2hvd1dpdGhpbkJvdW5kcyhjLCBpLCB7CiAgICAgICAgICAgICAgICAgIGFuY2hvcjogcgogICAgICAgICAgICAgICAgfSwgcykpOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGV4dDogZnVuY3Rpb24gdGV4dCh0KSB7CiAgICAgICAgICAgICAgICBncC51cGRhdGVUZXh0KGEsIHQpOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2V0dGluZ3M6IHQsCiAgICAgICAgICAgICAgZ2V0RWw6IGZ1bmN0aW9uIGdldEVsKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGEuZWxlbWVudC5kb207CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBwcm9ncmVzc0JhcjogewogICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHQpIHsKICAgICAgICAgICAgICAgICAgZ3AudXBkYXRlUHJvZ3Jlc3MoYSwgdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgfSwKICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSh0KSB7CiAgICAgICAgICAgIHQuY2xvc2UoKTsKICAgICAgICAgIH0sCiAgICAgICAgICByZXBvc2l0aW9uOiBmdW5jdGlvbiByZXBvc2l0aW9uKGUpIHsKICAgICAgICAgICAgMCA8IGUubGVuZ3RoICYmIFN0KGUsIGZ1bmN0aW9uICh0LCBuKSB7CiAgICAgICAgICAgICAgMCA9PT0gbiA/IHQubW92ZVJlbChudWxsLCAiYmFubmVyIikgOiB0Lm1vdmVSZWwoZVtuIC0gMV0uZ2V0RWwoKSwgImJjLXRjIik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGdldEFyZ3M6IGZ1bmN0aW9uIGdldEFyZ3ModCkgewogICAgICAgICAgICByZXR1cm4gdC5zZXR0aW5nczsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHZhciB1LCByLCBsOwogICAgICB9LAogICAgICB1aTogaSgpCiAgICB9OwogIH0pOwp9KCk7"},null]}